//      Github.js - v0.1.3

//      Â© 2015, Akshay Sharma Released under the MIT License.

(function (root, factory) {

    // Set up library appropriately for the environment
    if (typeof define === 'function' && define.amd) {
        // Define for AMD
        define(['underscore'], factory);
    } else if (typeof exports === 'object') {
        // Export for Node, CommonJS-like modules
        module.exports = factory(require('underscore'));
    } else {
        // As browser global (root is window here)
        root.Github = factory(root._);
    }

}(this, function (_) {

    var Github = {};

    // Current version of the library. Keep in sync with `package.json`
    Github.version = '0.1.3';

    // Common GitHub API URL
    var gitApiUrl = 'https://api.github.com/';

    //        userProfile - render's the github user details to selector
    //        @param  Type - JSON -> options [username, selector]

    Github.userProfile = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 0)){
        var userUrl = gitApiUrl + 'users/' + options.username;
        gitMethods.getData(userUrl, options, gitMethods.getUserProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        repoProfile - render's the github repo details to selector
    //        @param  Type - JSON -> options [username, reponame, selector]
    //
    Github.repoProfile = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector','reponame'], 0)){
        var repoUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame;
        gitMethods.getData(repoUrl, options, gitMethods.getRepoProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        orgProfile - render's the github organization details to selector
    //        @param  Type - JSON -> options [orgname, selector]
    //
    Github.orgProfile = function (options) {

      if(options = gitMethods.initialize(options, ['orgname','selector'], 0)){
        var orgUrl = gitApiUrl + 'orgs/' + options.orgname;
        gitMethods.getData(orgUrl, options, gitMethods.getOrgProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        userActivity - render's the github user activity to selector
    //        @param  Type - JSON -> options [username, selector and limit (optional)]
    //
    Github.userActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 1)){
        var userUrl = gitApiUrl + 'users/' + options.username,
        eventsUrl = userUrl + '/events';
        gitMethods.getData(userUrl, options, gitMethods.getUserProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    Github.onlyuserActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 1)){
        var userUrl = gitApiUrl + 'users/' + options.username,
        eventsUrl = userUrl + '/events';
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };
    //
    //        repoActivity - render's the github repository activity to selector
    //        @param  Type - JSON -> options [username, reponame, selector and limit (optional)]
    //
    Github.repoActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector','reponame'], 1)){
        var repoUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame,
        eventsUrl = repoUrl + '/events';
        gitMethods.getData(repoUrl, options, gitMethods.getRepoProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        orgActivity - render's the github organization activity to selector
    //        @param  Type - JSON -> options [orgname, selector and limit (optional)]
    //
    Github.orgActivity = function (options) {

      if(options = gitMethods.initialize(options, ['orgname','selector'], 1)){
        var orgUrl = gitApiUrl + 'orgs/' + options.orgname,
        eventsUrl = orgUrl + '/events';
        gitMethods.getData(orgUrl, options, gitMethods.getOrgProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    // Underscore templates for profiles, activities, etc.
    var gitTemplates = {
      // Parent container template
      parentTpl: '<div class="gt-container">'+
                          // '<div class="gt-header gt-shadow">'+
                          //   '<div class="gt-loading-txt">Loading..</div>'+
                          // '</div>'+
                          '<%if(type){%><div class="gt-activity-cnt gt-scrollbar">'+
                            '<div class="gt-loading-txt">Loading..</div>'+
                          '</div><%}%>'+
                         '</div>',
      // User profile template
      userProfileTpl:   '<div class="gt-usr-avatar">'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<div class="gt-usr-img" style="background-image: url(<%= avatar_url%>)"> </div>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-usr-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="user-login"><%= login%></span>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-usr-details">'+
                          '<div class="gt-usr-repo">'+
                            '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="gt-usr-txt"><%= public_repos%></span>'+
                            '<span class="gt-usr-dt">Repositories</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folwr">'+
                            '<a target="_blank" href="<%= html_url + "/followers"%>">'+
                            '<span class="gt-usr-txt"><%= followers%></span>'+
                            '<span class="gt-usr-dt">Followers</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folng">'+
                            '<a target="_blank" href="<%= html_url + "/following"%>">'+
                            '<span class="gt-usr-txt"><%= following%></span>'+
                            '<span class="gt-usr-dt">Following</span>'+
                            '</a>'+
                          '</div>'+
                        '</div>',
      // Repository profile template
      repoProfileTpl:   '<div class="gt-usr-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<a target="_blank" href="<%= owner.html_url%>">'+
                            '<span class="user-login"><%= owner.login%></span>'+
                          '</a>'+
                          '<p>'+
                            '<%= description%>'+
                          '</p>'+
                        '</div>'+
                        '<div class="gt-repo-details">'+
                          '<div class="gt-usr-repo">'+
                            '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="gt-usr-txt"><%= stargazers_count%></span>'+
                            '<span class="gt-usr-dt">Stars</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folwr">'+
                            '<a target="_blank" href="<%= html_url %>">'+
                            '<span class="gt-usr-txt"><%= subscribers_count%></span>'+
                            '<span class="gt-usr-dt">Watchers</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folng">'+
                            '<a target="_blank" href="<%= html_url %>">'+
                            '<span class="gt-usr-txt"><%= forks_count%></span>'+
                            '<span class="gt-usr-dt">Forks</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-repo-lg-stat">'+
                          '</div>'+
                        '</div>',
      // Organization profile template
      orgProfileTpl:    '<div class="gt-org-avatar">'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<div class="gt-org-img" style="background-image: url(<%= avatar_url%>)"> </div>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-org-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<%if(blog){%><a target="_blank" href="<%= blog%>" class="gt-org-link">'+
                            '<span class="user-login">Website</span>'+
                          '</a><%}%>'+
                          '<%if(email){%><a target="_blank" href="mailto:<%= email%>" class="gt-org-link">'+
                            '<span class="user-login">Email</span>'+
                          '</a><%}%>'+
                          '<br><span class="gt-org-repos"><%= public_repos%></span>'+
                          '<span class="gt-org-repos"> Public Repositories</span>'+
                        '</div>',
      // Parent activity container template
      gitActivityTpl: '<div class="gt-activity <%=type%>">'+
                          '<div class="gt-avatar-cnt">'+
                            '<a target="_blank" href="https://github.com/<%= actor.login%>">'+
                              '<img src="<%=actor.avatar_url%>" class="gt-usr-avatar">'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-act-cnt">'+
                              '<div title="<%= created_at%>" class="gt-time-cnt"><div class="gt-time-str"><%= timeString%></div></div>'+
                              '<%= userLink%>'+'<%= message%>'+
                          '</div>'+
                          '<div class="gt-clearfix"></div>'+
                      '</div>',
      // Activity templates keyed with activity type
      CommitCommentEvent:'<span> commented on commit <%= commentLink%> </span>'+
                         '<p><%= payload.comment.body%></p>',
      CreateEvent: '<span> created <%= payload.ref_type%> <%= branchLink%> at <%= repoLink%> </span>',
      DeleteEvent: '<span> deleted <%= payload.ref%> <%= payload.ref_type%> at <%= repoLink%> </span>',
      ForkEvent:  '<span> forked <%= repoLink%> to <%= forkLink%> </span>',
      GollumEvent: '<span> <%= actionType%> the <%= repoLink%> wiki</span>'+
                      '<p><%= wikiMessage%></p>',
      IssueCommentEvent: '<span> commented on issue <%= commentLink%> </span>'+
                              '<p><%= payload.comment.body%></p>',
      IssuesEvent: '<span> <%= payload.action%> issue <%= issueUrl%> </span>',
      MemberEvent: '<span> added <%= memberLink%> to <%= repoLink%> </span>',
      PublicEvent: '<span> open sourced <%= repoLink%> </span>',
      PullRequestEvent: '<span> <%= payload.action%> pull request <%= mergeRequestUrl%> </span>'+
                        '<p><%= payload.pull_request.title%></p>'+
                        '<p class="pull-req-info"><%= payload.pull_request.commits%><%if(payload.pull_request.commits > 1){%> commits <%}else{%> commit <%}%> '+
                        'with <%= payload.pull_request.changed_files%> <%if(payload.pull_request.commits > 1){%> files <%}else{%> file <%}%> changed.</p>',
      PullRequestReviewCommentEvent: '<span> commented on pull request <%= pullCommentUrl%> </span>'+
                                     '<p><%= payload.comment.body%></p>',
      PushEvent: '<span> pushed to <%= branchLink%> at <%= repoLink%> </span>'+
                 '<%= commitsHtml%>',
      ReleaseEvent: '<span> released <%= tagLink%> at <%= repoLink%> </span>'+
                    '<br><%= zipLink%>',
      WatchEvent: '<span> starred <%= repoLink%> </span>',
      noActivityTpl: '<div class="gt-no-activity">'+
                        '<span> There are no public events for this account in past 90 days. </span>'+
                     '</div>',
      notFoundTpl: '<div class="gt-no-activity">'+
                        '<span> This account does not exist. </span>'+
                     '</div>'
    };

    // Object for locally used methods
    var gitMethods = {
      // Check variables and render base template
      initialize: function(options, variables, type){
        // Validate varaibles
        for (var i = 0; i < variables.length; i++) {
          if(!options[variables[i]])
            return false;
        }
        // Type - 0 - only profile

        // Type - 1 - profile and acitivity feed
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates['parentTpl'],{
          type: type
        }),options.selector);

        // Set limit value
        options.limit = gitMethods.setLimit(options.limit);
        return options;
      },

      // Check if value is integer
      checkInteger: function (value) {
        if (value === parseInt(value, 10))
          return true;
        else
          return false;
      },

      // Get the rendered template with data
      getRenderedHTML: function (template, data) {
        if (data) {
          return _.template(template)(data);
        } else{
          return _.template(template)();
        }
      },

      // Render User profile HTML
      getUserProfileHTML: function (data, options){
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.userProfileTpl, data), options.selector,'.gt-header');
      },

      // Render the repository profile HTML with language stats
      getRepoProfileHTML: function (data, options){
        var languageUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame + '/languages';
        // Render template
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.repoProfileTpl, data), options.selector,'.gt-header');
        // Fetch language stat for repo
        gitMethods.getData(languageUrl, options, gitMethods.getLanguageHTML);
      },

      // Render organization profile HTML
      getOrgProfileHTML: function (data, options){
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.orgProfileTpl, data), options.selector,'.gt-header');
      },

      // Render recent public activities of user/repo/organization
      getPublicActivityHTML: function (data,options) {
        var html = '';
        // Get min of limit of data size
        var length = (options.limit < data.length)? options.limit : data.length;

        if (length==0) {
          // If no activity in last 90 days
          html += gitMethods.getRenderedHTML(gitTemplates['noActivityTpl']);
        }
        else{
          // Loop over all the activities
          for(var index = 0; index < length; index++){
            var activity = data[index];
            var payload = activity.payload;

            // Get attributes common to all activities
            activity.timeString = gitMethods.millisecondsToStr(new Date() - new Date(activity.created_at));
            activity.userLink = gitMethods.getGitHubLink(activity.actor.login, activity.actor.login);
            activity.repoLink = gitMethods.getGitHubLink(activity.repo.name, activity.repo.name);

            // Get the branch name
            activity.branchLink = '';
            if (payload.ref) {
              if (payload.ref.substring(0, 11) === 'refs/heads/') {
                activity.branch = payload.ref.substring(11);
              } else {
                activity.branch = payload.ref;
              }
              activity.branchLink = gitMethods.getGitHubLink(activity.repo.name + '/tree/' + activity.branch, activity.branch);
            }

            // Get the HTML of selected activity type
            switch(activity.type){
              case 'CommitCommentEvent': activity.commentLink = gitMethods.getLink(payload.comment.html_url, activity.repo.name + '@' +payload.comment.commit_id.substring(0,6));
                                  break;
              case 'CreateEvent':
                                  break;
              case 'DeleteEvent':
                                  break;
              case 'ForkEvent':   activity.forkLink = gitMethods.getGitHubLink(payload.forkee.html_url, payload.forkee.full_name);
                                  break;
              case 'GollumEvent': var page = payload.pages[0];
                                  activity.actionType = page.action;
                                  activity.wikiMessage = activity.actionType.charAt(0).toUpperCase() + activity.actionType.slice(1) + ' ';
                                  activity.wikiMessage += gitMethods.getLink(page.html_url, page.title);
                                  break;
              case 'IssueCommentEvent': activity.commentLink= gitMethods.getLink(payload.comment.html_url, activity.repo.name + '#' +payload.issue.number);
                                  break;
              case 'IssuesEvent': activity.issueUrl = gitMethods.getLink(payload.issue.html_url, activity.repo.name + '#' +payload.issue.number);
                                  break;
              case 'MemberEvent': activity.memberLink = gitMethods.getGitHubLink(payload.member.login, payload.member.login);
                                  break;
              case 'PublicEvent':
                                  break;
              case 'PullRequestEvent': activity.mergeRequestUrl = gitMethods.getLink(payload.pull_request.html_url, activity.repo.name + '#' +payload.pull_request.number);
                                  break;
              case 'PullRequestReviewCommentEvent': activity.pullCommentUrl= gitMethods.getLink(payload.comment.html_url, activity.repo.name + '#' +payload.pull_request.number);
                                  break;
              case 'PushEvent':   activity.commitsHtml = gitMethods.getCommitsHTML(activity);
                                  break;
              case 'ReleaseEvent': activity.tagLink = gitMethods.getLink(payload.release.html_url, payload.release.tag_name);
                                   activity.zipLink = gitMethods.getLink(payload.release.zipball_url, 'Download Source Code (zip)')
                                  break;
              case 'WatchEvent':
                                  break;
            }
            // Get activity specific message
            activity.message = gitMethods.getRenderedHTML(gitTemplates[activity.type], activity);
            html += gitMethods.getRenderedHTML(gitTemplates['gitActivityTpl'],activity);

          }
        }
        // Render created activity HTML to DOM
        gitMethods.renderContent(html, options.selector, '.gt-activity-cnt');
      },

      // Form HTML for commits in PushEvent
      getCommitsHTML: function(activity){
          var html = '<ul class="gt-commit-list">',
          liElement, shaLink, commitMessage,  commit, index,
          compareLink = '',
          payload = activity.payload,
          length = payload.commits.length,
          shaDiff = payload.before + '...' + payload.head;

          // Get links for 2 or less commit
          for(index = 0; index < length; index++){
            if (index>1) break;
            commit = payload.commits[index];
            // Create commit li element
            liElement = '<li class="gt-commit-item" >';
            shaLink = gitMethods.getGitHubLink(activity.repo.name + '/commit/' + commit.sha, commit.sha.substring(0, 6));
            commitMessage = '<span class="gt-commit-msg">' + commit.message.substring(0,150) + '</span>';
            liElement += shaLink
            liElement += commitMessage;
            liElement += '</li>'
            html += liElement;
          }

          // Get the diff link between commits
          if (length === 2) {
            compareLink = gitMethods.getGitHubLink(activity.repo.name + '/compare/' + shaDiff, 'View comparison for these 2 commits &raquo;','gt-compare-link');
          } else if (length > 2) {
            compareLink = gitMethods.getGitHubLink(activity.repo.name + '/compare/' + shaDiff, (length-2)+' more ' + gitMethods.getPluralWord(length-2,'commit') + ' &raquo;','gt-compare-link');
          }

          html += '</ul>'
          html += compareLink;

          return html;
      },

      // Utility for asynchronous AJAX calls
      getData: function(url, options, callback){
        var data, request;
        request = new XMLHttpRequest();
        request.open('GET', url, true);
        // Use OAuth token if available
        if (options.OAuth) {
          request.setRequestHeader('Authorization', 'Token ' + options.OAuth);
        }

        request.onload = function(e) {
          if (request.status >= 200 && request.status < 400){
            data = JSON.parse(request.responseText);
            callback(data, options);
          } else {
            // Unsuccessful request - invalid username/ lost internet connectivity/ exceeded rate limit/ API URL not found
            gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.notFoundTpl, data), options.selector,'.gt-container');
            console.error('An error occurred while connecting to GitHub API.');
          }
        };

        request.onerror = function(e) {
          console.error('An error occurred while connecting to GitHub API.');
        };

        request.send();
      },

      // Get anchor tag HTML for URL
      getLink: function(url, title, cssClass) {
        if (!title)
          title = url;
        if (typeof(cssClass) === 'undefined')
          cssClass = '';
        return gitMethods.getRenderedHTML('<a class="' + cssClass + '" href="<%=url%>" target="_blank"><%=title%></a>', { url: url, title: title });
      },

      // Get anchor tag HTML for non-github URL
      getGitHubLink: function(url, title, cssClass) {
        if (!title)
          title = url;
        if (typeof(cssClass) === 'undefined')
          cssClass = '';
        return gitMethods.getLink('https://github.com/' + url, title, cssClass);
      },

      //  Only for plurals ending with 's'. Yeah! this sucks.
      getPluralWord: function (count, word) {
        if (count !== 1) return word + 's';
        return word;
      },

      // Get repository language stat HTML
      getLanguageHTML: function(data, options){
        var languageData = [], sum = 0,
        percentage, languageHtml = '';
        // Get total size and create array which can be sorted by value
        _.each(data, function(value, key){
            var data = {};
            data.language = key;
            data.size = value;
            languageData.push(data);
            sum += value;
        });

        // Sort languages by usage in repo
        languageData = languageData.sort(function(a, b){return b.size - a.size});

        // Get HTML for each language
        _.each(languageData, function(element){
            percentage = (parseInt(element.size)/sum*100).toFixed(1);
            languageHtml +='<div class="gt-repo-lg-cnt" style="width: '+ percentage +'%; background: #'+ gitMethods.getRandomColor() +'; " >'+
                   ' <div class="gt-repo-lg-name" data-title="'+ element.language +' ('+ percentage +'%)"> </div> </div>';
        });

        // Render language HTML to the container
        gitMethods.renderContent(languageHtml, options.selector,'.gt-repo-lg-stat');
      },

      // Get random HEX code for color
      getRandomColor: function(){
        return Math.random().toString(16).substring(2, 8);
      },

      // Convert milliseconds to time string
      millisecondsToStr: function(milliseconds) {
        function numberEnding(number) {
          return (number > 1) ? 's ago' : ' ago';
        }
        var temp = Math.floor(milliseconds / 1000);

        var years = Math.floor(temp / 31536000);
        if (years) return years + ' year' + numberEnding(years);

        var months = Math.floor((temp %= 31536000) / 2592000);
        if (months) return months + ' month' + numberEnding(months);

        var days = Math.floor((temp %= 2592000) / 86400);
        if (days) return days + ' day' + numberEnding(days);

        var hours = Math.floor((temp %= 86400) / 3600);
        if (hours) return 'about ' + hours + ' hour' + numberEnding(hours);

        var minutes = Math.floor((temp %= 3600) / 60);
        if (minutes) return minutes + ' minute' + numberEnding(minutes);

        var seconds = temp % 60;
        if (seconds) return seconds + ' second' + numberEnding(seconds);

        return 'just now';
      },

      // Render the content to the selector or subSelector
      renderContent: function(content, selector, subSelector){
        var selectorDivs = document.querySelectorAll(selector);

        for (var i = 0; i < selectorDivs.length; i++) {
          // if subSelector is passed, find it
          if (subSelector) {
            selectorDiv = selectorDivs[i].querySelector(subSelector);
          } else{
            selectorDiv = selectorDivs[i];
          }
          selectorDiv.innerHTML = content;
        }

      },

      // Set render limit for activities - default is 30
      setLimit: function(value){
        var limit;
        if (value !== 'undefined' && gitMethods.checkInteger(limit = parseInt(value, 10))) {
          limit = (limit>30)?30:limit;
        } else {
          limit = 30;
        }
        return limit;
      }

    };


    return Github;
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJnaXRodWIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gICAgICBHaXRodWIuanMgLSB2MC4xLjNcclxuXHJcbi8vICAgICAgwqkgMjAxNSwgQWtzaGF5IFNoYXJtYSBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcblxyXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcclxuXHJcbiAgICAvLyBTZXQgdXAgbGlicmFyeSBhcHByb3ByaWF0ZWx5IGZvciB0aGUgZW52aXJvbm1lbnRcclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgICAgICAvLyBEZWZpbmUgZm9yIEFNRFxyXG4gICAgICAgIGRlZmluZShbJ3VuZGVyc2NvcmUnXSwgZmFjdG9yeSk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIC8vIEV4cG9ydCBmb3IgTm9kZSwgQ29tbW9uSlMtbGlrZSBtb2R1bGVzXHJcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ3VuZGVyc2NvcmUnKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEFzIGJyb3dzZXIgZ2xvYmFsIChyb290IGlzIHdpbmRvdyBoZXJlKVxyXG4gICAgICAgIHJvb3QuR2l0aHViID0gZmFjdG9yeShyb290Ll8pO1xyXG4gICAgfVxyXG5cclxufSh0aGlzLCBmdW5jdGlvbiAoXykge1xyXG5cclxuICAgIHZhciBHaXRodWIgPSB7fTtcclxuXHJcbiAgICAvLyBDdXJyZW50IHZlcnNpb24gb2YgdGhlIGxpYnJhcnkuIEtlZXAgaW4gc3luYyB3aXRoIGBwYWNrYWdlLmpzb25gXHJcbiAgICBHaXRodWIudmVyc2lvbiA9ICcwLjEuMyc7XHJcblxyXG4gICAgLy8gQ29tbW9uIEdpdEh1YiBBUEkgVVJMXHJcbiAgICB2YXIgZ2l0QXBpVXJsID0gJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vJztcclxuXHJcbiAgICAvLyAgICAgICAgdXNlclByb2ZpbGUgLSByZW5kZXIncyB0aGUgZ2l0aHViIHVzZXIgZGV0YWlscyB0byBzZWxlY3RvclxyXG4gICAgLy8gICAgICAgIEBwYXJhbSAgVHlwZSAtIEpTT04gLT4gb3B0aW9ucyBbdXNlcm5hbWUsIHNlbGVjdG9yXVxyXG5cclxuICAgIEdpdGh1Yi51c2VyUHJvZmlsZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcblxyXG4gICAgICBpZihvcHRpb25zID0gZ2l0TWV0aG9kcy5pbml0aWFsaXplKG9wdGlvbnMsIFsndXNlcm5hbWUnLCdzZWxlY3RvciddLCAwKSl7XHJcbiAgICAgICAgdmFyIHVzZXJVcmwgPSBnaXRBcGlVcmwgKyAndXNlcnMvJyArIG9wdGlvbnMudXNlcm5hbWU7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKHVzZXJVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0VXNlclByb2ZpbGVIVE1MKTtcclxuICAgICAgfSBlbHNle1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXJhbWV0ZXJzIG5vdCBwYXNzZWQgY29ycmVjdGx5XCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAvL1xyXG4gICAgLy8gICAgICAgIHJlcG9Qcm9maWxlIC0gcmVuZGVyJ3MgdGhlIGdpdGh1YiByZXBvIGRldGFpbHMgdG8gc2VsZWN0b3JcclxuICAgIC8vICAgICAgICBAcGFyYW0gIFR5cGUgLSBKU09OIC0+IG9wdGlvbnMgW3VzZXJuYW1lLCByZXBvbmFtZSwgc2VsZWN0b3JdXHJcbiAgICAvL1xyXG4gICAgR2l0aHViLnJlcG9Qcm9maWxlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuXHJcbiAgICAgIGlmKG9wdGlvbnMgPSBnaXRNZXRob2RzLmluaXRpYWxpemUob3B0aW9ucywgWyd1c2VybmFtZScsJ3NlbGVjdG9yJywncmVwb25hbWUnXSwgMCkpe1xyXG4gICAgICAgIHZhciByZXBvVXJsID0gZ2l0QXBpVXJsICsgJ3JlcG9zLycgKyBvcHRpb25zLnVzZXJuYW1lICsnLycrIG9wdGlvbnMucmVwb25hbWU7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKHJlcG9VcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0UmVwb1Byb2ZpbGVIVE1MKTtcclxuICAgICAgfSBlbHNle1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXJhbWV0ZXJzIG5vdCBwYXNzZWQgY29ycmVjdGx5XCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAvL1xyXG4gICAgLy8gICAgICAgIG9yZ1Byb2ZpbGUgLSByZW5kZXIncyB0aGUgZ2l0aHViIG9yZ2FuaXphdGlvbiBkZXRhaWxzIHRvIHNlbGVjdG9yXHJcbiAgICAvLyAgICAgICAgQHBhcmFtICBUeXBlIC0gSlNPTiAtPiBvcHRpb25zIFtvcmduYW1lLCBzZWxlY3Rvcl1cclxuICAgIC8vXHJcbiAgICBHaXRodWIub3JnUHJvZmlsZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcblxyXG4gICAgICBpZihvcHRpb25zID0gZ2l0TWV0aG9kcy5pbml0aWFsaXplKG9wdGlvbnMsIFsnb3JnbmFtZScsJ3NlbGVjdG9yJ10sIDApKXtcclxuICAgICAgICB2YXIgb3JnVXJsID0gZ2l0QXBpVXJsICsgJ29yZ3MvJyArIG9wdGlvbnMub3JnbmFtZTtcclxuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEob3JnVXJsLCBvcHRpb25zLCBnaXRNZXRob2RzLmdldE9yZ1Byb2ZpbGVIVE1MKTtcclxuICAgICAgfSBlbHNle1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXJhbWV0ZXJzIG5vdCBwYXNzZWQgY29ycmVjdGx5XCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAvL1xyXG4gICAgLy8gICAgICAgIHVzZXJBY3Rpdml0eSAtIHJlbmRlcidzIHRoZSBnaXRodWIgdXNlciBhY3Rpdml0eSB0byBzZWxlY3RvclxyXG4gICAgLy8gICAgICAgIEBwYXJhbSAgVHlwZSAtIEpTT04gLT4gb3B0aW9ucyBbdXNlcm5hbWUsIHNlbGVjdG9yIGFuZCBsaW1pdCAob3B0aW9uYWwpXVxyXG4gICAgLy9cclxuICAgIEdpdGh1Yi51c2VyQWN0aXZpdHkgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cclxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ3VzZXJuYW1lJywnc2VsZWN0b3InXSwgMSkpe1xyXG4gICAgICAgIHZhciB1c2VyVXJsID0gZ2l0QXBpVXJsICsgJ3VzZXJzLycgKyBvcHRpb25zLnVzZXJuYW1lLFxyXG4gICAgICAgIGV2ZW50c1VybCA9IHVzZXJVcmwgKyAnL2V2ZW50cyc7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKHVzZXJVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0VXNlclByb2ZpbGVIVE1MKTtcclxuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEoZXZlbnRzVXJsLCBvcHRpb25zLCBnaXRNZXRob2RzLmdldFB1YmxpY0FjdGl2aXR5SFRNTCk7XHJcbiAgICAgIH0gZWxzZXtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcclxuICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG4gICAgR2l0aHViLm9ubHl1c2VyQWN0aXZpdHkgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cclxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ3VzZXJuYW1lJywnc2VsZWN0b3InXSwgMSkpe1xyXG4gICAgICAgIHZhciB1c2VyVXJsID0gZ2l0QXBpVXJsICsgJ3VzZXJzLycgKyBvcHRpb25zLnVzZXJuYW1lLFxyXG4gICAgICAgIGV2ZW50c1VybCA9IHVzZXJVcmwgKyAnL2V2ZW50cyc7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKGV2ZW50c1VybCwgb3B0aW9ucywgZ2l0TWV0aG9kcy5nZXRQdWJsaWNBY3Rpdml0eUhUTUwpO1xyXG4gICAgICB9IGVsc2V7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlBhcmFtZXRlcnMgbm90IHBhc3NlZCBjb3JyZWN0bHlcIik7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9O1xyXG4gICAgLy9cclxuICAgIC8vICAgICAgICByZXBvQWN0aXZpdHkgLSByZW5kZXIncyB0aGUgZ2l0aHViIHJlcG9zaXRvcnkgYWN0aXZpdHkgdG8gc2VsZWN0b3JcclxuICAgIC8vICAgICAgICBAcGFyYW0gIFR5cGUgLSBKU09OIC0+IG9wdGlvbnMgW3VzZXJuYW1lLCByZXBvbmFtZSwgc2VsZWN0b3IgYW5kIGxpbWl0IChvcHRpb25hbCldXHJcbiAgICAvL1xyXG4gICAgR2l0aHViLnJlcG9BY3Rpdml0eSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcblxyXG4gICAgICBpZihvcHRpb25zID0gZ2l0TWV0aG9kcy5pbml0aWFsaXplKG9wdGlvbnMsIFsndXNlcm5hbWUnLCdzZWxlY3RvcicsJ3JlcG9uYW1lJ10sIDEpKXtcclxuICAgICAgICB2YXIgcmVwb1VybCA9IGdpdEFwaVVybCArICdyZXBvcy8nICsgb3B0aW9ucy51c2VybmFtZSArJy8nKyBvcHRpb25zLnJlcG9uYW1lLFxyXG4gICAgICAgIGV2ZW50c1VybCA9IHJlcG9VcmwgKyAnL2V2ZW50cyc7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKHJlcG9VcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0UmVwb1Byb2ZpbGVIVE1MKTtcclxuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEoZXZlbnRzVXJsLCBvcHRpb25zLCBnaXRNZXRob2RzLmdldFB1YmxpY0FjdGl2aXR5SFRNTCk7XHJcbiAgICAgIH0gZWxzZXtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcclxuICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG4gICAgLy9cclxuICAgIC8vICAgICAgICBvcmdBY3Rpdml0eSAtIHJlbmRlcidzIHRoZSBnaXRodWIgb3JnYW5pemF0aW9uIGFjdGl2aXR5IHRvIHNlbGVjdG9yXHJcbiAgICAvLyAgICAgICAgQHBhcmFtICBUeXBlIC0gSlNPTiAtPiBvcHRpb25zIFtvcmduYW1lLCBzZWxlY3RvciBhbmQgbGltaXQgKG9wdGlvbmFsKV1cclxuICAgIC8vXHJcbiAgICBHaXRodWIub3JnQWN0aXZpdHkgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cclxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ29yZ25hbWUnLCdzZWxlY3RvciddLCAxKSl7XHJcbiAgICAgICAgdmFyIG9yZ1VybCA9IGdpdEFwaVVybCArICdvcmdzLycgKyBvcHRpb25zLm9yZ25hbWUsXHJcbiAgICAgICAgZXZlbnRzVXJsID0gb3JnVXJsICsgJy9ldmVudHMnO1xyXG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShvcmdVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0T3JnUHJvZmlsZUhUTUwpO1xyXG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShldmVudHNVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0UHVibGljQWN0aXZpdHlIVE1MKTtcclxuICAgICAgfSBlbHNle1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXJhbWV0ZXJzIG5vdCBwYXNzZWQgY29ycmVjdGx5XCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRlcyBmb3IgcHJvZmlsZXMsIGFjdGl2aXRpZXMsIGV0Yy5cclxuICAgIHZhciBnaXRUZW1wbGF0ZXMgPSB7XHJcbiAgICAgIC8vIFBhcmVudCBjb250YWluZXIgdGVtcGxhdGVcclxuICAgICAgcGFyZW50VHBsOiAnPGRpdiBjbGFzcz1cImd0LWNvbnRhaW5lclwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJzxkaXYgY2xhc3M9XCJndC1oZWFkZXIgZ3Qtc2hhZG93XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICc8ZGl2IGNsYXNzPVwiZ3QtbG9hZGluZy10eHRcIj5Mb2FkaW5nLi48L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8JWlmKHR5cGUpeyU+PGRpdiBjbGFzcz1cImd0LWFjdGl2aXR5LWNudCBndC1zY3JvbGxiYXJcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1sb2FkaW5nLXR4dFwiPkxvYWRpbmcuLjwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PjwlfSU+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxyXG4gICAgICAvLyBVc2VyIHByb2ZpbGUgdGVtcGxhdGVcclxuICAgICAgdXNlclByb2ZpbGVUcGw6ICAgJzxkaXYgY2xhc3M9XCJndC11c3ItYXZhdGFyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWltZ1wiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKDwlPSBhdmF0YXJfdXJsJT4pXCI+IDwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItbmFtZVwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1uYW1lXCI+PCU9IG5hbWUlPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsJT5cIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1sb2dpblwiPjwlPSBsb2dpbiU+PC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItZGV0YWlsc1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItcmVwb1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci10eHRcIj48JT0gcHVibGljX3JlcG9zJT48L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci1kdFwiPlJlcG9zaXRvcmllczwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWZvbHdyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsICsgXCIvZm9sbG93ZXJzXCIlPlwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItdHh0XCI+PCU9IGZvbGxvd2VycyU+PC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItZHRcIj5Gb2xsb3dlcnM8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXVzci1mb2xuZ1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCArIFwiL2ZvbGxvd2luZ1wiJT5cIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLXR4dFwiPjwlPSBmb2xsb3dpbmclPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLWR0XCI+Rm9sbG93aW5nPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxyXG4gICAgICAvLyBSZXBvc2l0b3J5IHByb2ZpbGUgdGVtcGxhdGVcclxuICAgICAgcmVwb1Byb2ZpbGVUcGw6ICAgJzxkaXYgY2xhc3M9XCJndC11c3ItbmFtZVwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1uYW1lXCI+PCU9IG5hbWUlPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IG93bmVyLmh0bWxfdXJsJT5cIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1sb2dpblwiPjwlPSBvd25lci5sb2dpbiU+PC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8cD4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwlPSBkZXNjcmlwdGlvbiU+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9wPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXJlcG8tZGV0YWlsc1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItcmVwb1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci10eHRcIj48JT0gc3RhcmdhemVyc19jb3VudCU+PC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItZHRcIj5TdGFyczwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWZvbHdyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsICU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci10eHRcIj48JT0gc3Vic2NyaWJlcnNfY291bnQlPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLWR0XCI+V2F0Y2hlcnM8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXVzci1mb2xuZ1wiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCAlPlwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItdHh0XCI+PCU9IGZvcmtzX2NvdW50JT48L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci1kdFwiPkZvcmtzPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1yZXBvLWxnLXN0YXRcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyxcclxuICAgICAgLy8gT3JnYW5pemF0aW9uIHByb2ZpbGUgdGVtcGxhdGVcclxuICAgICAgb3JnUHJvZmlsZVRwbDogICAgJzxkaXYgY2xhc3M9XCJndC1vcmctYXZhdGFyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3Qtb3JnLWltZ1wiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKDwlPSBhdmF0YXJfdXJsJT4pXCI+IDwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1vcmctbmFtZVwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1uYW1lXCI+PCU9IG5hbWUlPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8JWlmKGJsb2cpeyU+PGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBibG9nJT5cIiBjbGFzcz1cImd0LW9yZy1saW5rXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cInVzZXItbG9naW5cIj5XZWJzaXRlPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT48JX0lPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwlaWYoZW1haWwpeyU+PGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIm1haWx0bzo8JT0gZW1haWwlPlwiIGNsYXNzPVwiZ3Qtb3JnLWxpbmtcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1sb2dpblwiPkVtYWlsPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT48JX0lPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxicj48c3BhbiBjbGFzcz1cImd0LW9yZy1yZXBvc1wiPjwlPSBwdWJsaWNfcmVwb3MlPjwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LW9yZy1yZXBvc1wiPiBQdWJsaWMgUmVwb3NpdG9yaWVzPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxyXG4gICAgICAvLyBQYXJlbnQgYWN0aXZpdHkgY29udGFpbmVyIHRlbXBsYXRlXHJcbiAgICAgIGdpdEFjdGl2aXR5VHBsOiAnPGRpdiBjbGFzcz1cImd0LWFjdGl2aXR5IDwlPXR5cGUlPlwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1hdmF0YXItY250XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tLzwlPSBhY3Rvci5sb2dpbiU+XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiPCU9YWN0b3IuYXZhdGFyX3VybCU+XCIgY2xhc3M9XCJndC11c3ItYXZhdGFyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LWFjdC1jbnRcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiB0aXRsZT1cIjwlPSBjcmVhdGVkX2F0JT5cIiBjbGFzcz1cImd0LXRpbWUtY250XCI+PGRpdiBjbGFzcz1cImd0LXRpbWUtc3RyXCI+PCU9IHRpbWVTdHJpbmclPjwvZGl2PjwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8JT0gdXNlckxpbmslPicrJzwlPSBtZXNzYWdlJT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtY2xlYXJmaXhcIj48L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXHJcbiAgICAgIC8vIEFjdGl2aXR5IHRlbXBsYXRlcyBrZXllZCB3aXRoIGFjdGl2aXR5IHR5cGVcclxuICAgICAgQ29tbWl0Q29tbWVudEV2ZW50Oic8c3Bhbj4gY29tbWVudGVkIG9uIGNvbW1pdCA8JT0gY29tbWVudExpbmslPiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICc8cD48JT0gcGF5bG9hZC5jb21tZW50LmJvZHklPjwvcD4nLFxyXG4gICAgICBDcmVhdGVFdmVudDogJzxzcGFuPiBjcmVhdGVkIDwlPSBwYXlsb2FkLnJlZl90eXBlJT4gPCU9IGJyYW5jaExpbmslPiBhdCA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JyxcclxuICAgICAgRGVsZXRlRXZlbnQ6ICc8c3Bhbj4gZGVsZXRlZCA8JT0gcGF5bG9hZC5yZWYlPiA8JT0gcGF5bG9hZC5yZWZfdHlwZSU+IGF0IDwlPSByZXBvTGluayU+IDwvc3Bhbj4nLFxyXG4gICAgICBGb3JrRXZlbnQ6ICAnPHNwYW4+IGZvcmtlZCA8JT0gcmVwb0xpbmslPiB0byA8JT0gZm9ya0xpbmslPiA8L3NwYW4+JyxcclxuICAgICAgR29sbHVtRXZlbnQ6ICc8c3Bhbj4gPCU9IGFjdGlvblR5cGUlPiB0aGUgPCU9IHJlcG9MaW5rJT4gd2lraTwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgJzxwPjwlPSB3aWtpTWVzc2FnZSU+PC9wPicsXHJcbiAgICAgIElzc3VlQ29tbWVudEV2ZW50OiAnPHNwYW4+IGNvbW1lbnRlZCBvbiBpc3N1ZSA8JT0gY29tbWVudExpbmslPiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwPjwlPSBwYXlsb2FkLmNvbW1lbnQuYm9keSU+PC9wPicsXHJcbiAgICAgIElzc3Vlc0V2ZW50OiAnPHNwYW4+IDwlPSBwYXlsb2FkLmFjdGlvbiU+IGlzc3VlIDwlPSBpc3N1ZVVybCU+IDwvc3Bhbj4nLFxyXG4gICAgICBNZW1iZXJFdmVudDogJzxzcGFuPiBhZGRlZCA8JT0gbWVtYmVyTGluayU+IHRvIDwlPSByZXBvTGluayU+IDwvc3Bhbj4nLFxyXG4gICAgICBQdWJsaWNFdmVudDogJzxzcGFuPiBvcGVuIHNvdXJjZWQgPCU9IHJlcG9MaW5rJT4gPC9zcGFuPicsXHJcbiAgICAgIFB1bGxSZXF1ZXN0RXZlbnQ6ICc8c3Bhbj4gPCU9IHBheWxvYWQuYWN0aW9uJT4gcHVsbCByZXF1ZXN0IDwlPSBtZXJnZVJlcXVlc3RVcmwlPiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxwPjwlPSBwYXlsb2FkLnB1bGxfcmVxdWVzdC50aXRsZSU+PC9wPicrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8cCBjbGFzcz1cInB1bGwtcmVxLWluZm9cIj48JT0gcGF5bG9hZC5wdWxsX3JlcXVlc3QuY29tbWl0cyU+PCVpZihwYXlsb2FkLnB1bGxfcmVxdWVzdC5jb21taXRzID4gMSl7JT4gY29tbWl0cyA8JX1lbHNleyU+IGNvbW1pdCA8JX0lPiAnK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnd2l0aCA8JT0gcGF5bG9hZC5wdWxsX3JlcXVlc3QuY2hhbmdlZF9maWxlcyU+IDwlaWYocGF5bG9hZC5wdWxsX3JlcXVlc3QuY29tbWl0cyA+IDEpeyU+IGZpbGVzIDwlfWVsc2V7JT4gZmlsZSA8JX0lPiBjaGFuZ2VkLjwvcD4nLFxyXG4gICAgICBQdWxsUmVxdWVzdFJldmlld0NvbW1lbnRFdmVudDogJzxzcGFuPiBjb21tZW50ZWQgb24gcHVsbCByZXF1ZXN0IDwlPSBwdWxsQ29tbWVudFVybCU+IDwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwPjwlPSBwYXlsb2FkLmNvbW1lbnQuYm9keSU+PC9wPicsXHJcbiAgICAgIFB1c2hFdmVudDogJzxzcGFuPiBwdXNoZWQgdG8gPCU9IGJyYW5jaExpbmslPiBhdCA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAnPCU9IGNvbW1pdHNIdG1sJT4nLFxyXG4gICAgICBSZWxlYXNlRXZlbnQ6ICc8c3Bhbj4gcmVsZWFzZWQgPCU9IHRhZ0xpbmslPiBhdCA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAnPGJyPjwlPSB6aXBMaW5rJT4nLFxyXG4gICAgICBXYXRjaEV2ZW50OiAnPHNwYW4+IHN0YXJyZWQgPCU9IHJlcG9MaW5rJT4gPC9zcGFuPicsXHJcbiAgICAgIG5vQWN0aXZpdHlUcGw6ICc8ZGl2IGNsYXNzPVwiZ3Qtbm8tYWN0aXZpdHlcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4+IFRoZXJlIGFyZSBubyBwdWJsaWMgZXZlbnRzIGZvciB0aGlzIGFjY291bnQgaW4gcGFzdCA5MCBkYXlzLiA8L3NwYW4+JytcclxuICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXHJcbiAgICAgIG5vdEZvdW5kVHBsOiAnPGRpdiBjbGFzcz1cImd0LW5vLWFjdGl2aXR5XCI+JytcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuPiBUaGlzIGFjY291bnQgZG9lcyBub3QgZXhpc3QuIDwvc3Bhbj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAnPC9kaXY+J1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBPYmplY3QgZm9yIGxvY2FsbHkgdXNlZCBtZXRob2RzXHJcbiAgICB2YXIgZ2l0TWV0aG9kcyA9IHtcclxuICAgICAgLy8gQ2hlY2sgdmFyaWFibGVzIGFuZCByZW5kZXIgYmFzZSB0ZW1wbGF0ZVxyXG4gICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zLCB2YXJpYWJsZXMsIHR5cGUpe1xyXG4gICAgICAgIC8vIFZhbGlkYXRlIHZhcmFpYmxlc1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFyaWFibGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBpZighb3B0aW9uc1t2YXJpYWJsZXNbaV1dKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFR5cGUgLSAwIC0gb25seSBwcm9maWxlXHJcblxyXG4gICAgICAgIC8vIFR5cGUgLSAxIC0gcHJvZmlsZSBhbmQgYWNpdGl2aXR5IGZlZWRcclxuICAgICAgICBnaXRNZXRob2RzLnJlbmRlckNvbnRlbnQoZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzWydwYXJlbnRUcGwnXSx7XHJcbiAgICAgICAgICB0eXBlOiB0eXBlXHJcbiAgICAgICAgfSksb3B0aW9ucy5zZWxlY3Rvcik7XHJcblxyXG4gICAgICAgIC8vIFNldCBsaW1pdCB2YWx1ZVxyXG4gICAgICAgIG9wdGlvbnMubGltaXQgPSBnaXRNZXRob2RzLnNldExpbWl0KG9wdGlvbnMubGltaXQpO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gQ2hlY2sgaWYgdmFsdWUgaXMgaW50ZWdlclxyXG4gICAgICBjaGVja0ludGVnZXI6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gcGFyc2VJbnQodmFsdWUsIDEwKSlcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgcmVuZGVyZWQgdGVtcGxhdGUgd2l0aCBkYXRhXHJcbiAgICAgIGdldFJlbmRlcmVkSFRNTDogZnVuY3Rpb24gKHRlbXBsYXRlLCBkYXRhKSB7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgIHJldHVybiBfLnRlbXBsYXRlKHRlbXBsYXRlKShkYXRhKTtcclxuICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICByZXR1cm4gXy50ZW1wbGF0ZSh0ZW1wbGF0ZSkoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBSZW5kZXIgVXNlciBwcm9maWxlIEhUTUxcclxuICAgICAgZ2V0VXNlclByb2ZpbGVIVE1MOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucyl7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlcy51c2VyUHJvZmlsZVRwbCwgZGF0YSksIG9wdGlvbnMuc2VsZWN0b3IsJy5ndC1oZWFkZXInKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFJlbmRlciB0aGUgcmVwb3NpdG9yeSBwcm9maWxlIEhUTUwgd2l0aCBsYW5ndWFnZSBzdGF0c1xyXG4gICAgICBnZXRSZXBvUHJvZmlsZUhUTUw6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKXtcclxuICAgICAgICB2YXIgbGFuZ3VhZ2VVcmwgPSBnaXRBcGlVcmwgKyAncmVwb3MvJyArIG9wdGlvbnMudXNlcm5hbWUgKycvJysgb3B0aW9ucy5yZXBvbmFtZSArICcvbGFuZ3VhZ2VzJztcclxuICAgICAgICAvLyBSZW5kZXIgdGVtcGxhdGVcclxuICAgICAgICBnaXRNZXRob2RzLnJlbmRlckNvbnRlbnQoZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzLnJlcG9Qcm9maWxlVHBsLCBkYXRhKSwgb3B0aW9ucy5zZWxlY3RvciwnLmd0LWhlYWRlcicpO1xyXG4gICAgICAgIC8vIEZldGNoIGxhbmd1YWdlIHN0YXQgZm9yIHJlcG9cclxuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEobGFuZ3VhZ2VVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0TGFuZ3VhZ2VIVE1MKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFJlbmRlciBvcmdhbml6YXRpb24gcHJvZmlsZSBIVE1MXHJcbiAgICAgIGdldE9yZ1Byb2ZpbGVIVE1MOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucyl7XHJcbiAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlcy5vcmdQcm9maWxlVHBsLCBkYXRhKSwgb3B0aW9ucy5zZWxlY3RvciwnLmd0LWhlYWRlcicpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gUmVuZGVyIHJlY2VudCBwdWJsaWMgYWN0aXZpdGllcyBvZiB1c2VyL3JlcG8vb3JnYW5pemF0aW9uXHJcbiAgICAgIGdldFB1YmxpY0FjdGl2aXR5SFRNTDogZnVuY3Rpb24gKGRhdGEsb3B0aW9ucykge1xyXG4gICAgICAgIHZhciBodG1sID0gJyc7XHJcbiAgICAgICAgLy8gR2V0IG1pbiBvZiBsaW1pdCBvZiBkYXRhIHNpemVcclxuICAgICAgICB2YXIgbGVuZ3RoID0gKG9wdGlvbnMubGltaXQgPCBkYXRhLmxlbmd0aCk/IG9wdGlvbnMubGltaXQgOiBkYXRhLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKGxlbmd0aD09MCkge1xyXG4gICAgICAgICAgLy8gSWYgbm8gYWN0aXZpdHkgaW4gbGFzdCA5MCBkYXlzXHJcbiAgICAgICAgICBodG1sICs9IGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlc1snbm9BY3Rpdml0eVRwbCddKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgIC8vIExvb3Agb3ZlciBhbGwgdGhlIGFjdGl2aXRpZXNcclxuICAgICAgICAgIGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyl7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eSA9IGRhdGFbaW5kZXhdO1xyXG4gICAgICAgICAgICB2YXIgcGF5bG9hZCA9IGFjdGl2aXR5LnBheWxvYWQ7XHJcblxyXG4gICAgICAgICAgICAvLyBHZXQgYXR0cmlidXRlcyBjb21tb24gdG8gYWxsIGFjdGl2aXRpZXNcclxuICAgICAgICAgICAgYWN0aXZpdHkudGltZVN0cmluZyA9IGdpdE1ldGhvZHMubWlsbGlzZWNvbmRzVG9TdHIobmV3IERhdGUoKSAtIG5ldyBEYXRlKGFjdGl2aXR5LmNyZWF0ZWRfYXQpKTtcclxuICAgICAgICAgICAgYWN0aXZpdHkudXNlckxpbmsgPSBnaXRNZXRob2RzLmdldEdpdEh1YkxpbmsoYWN0aXZpdHkuYWN0b3IubG9naW4sIGFjdGl2aXR5LmFjdG9yLmxvZ2luKTtcclxuICAgICAgICAgICAgYWN0aXZpdHkucmVwb0xpbmsgPSBnaXRNZXRob2RzLmdldEdpdEh1YkxpbmsoYWN0aXZpdHkucmVwby5uYW1lLCBhY3Rpdml0eS5yZXBvLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgLy8gR2V0IHRoZSBicmFuY2ggbmFtZVxyXG4gICAgICAgICAgICBhY3Rpdml0eS5icmFuY2hMaW5rID0gJyc7XHJcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLnJlZikge1xyXG4gICAgICAgICAgICAgIGlmIChwYXlsb2FkLnJlZi5zdWJzdHJpbmcoMCwgMTEpID09PSAncmVmcy9oZWFkcy8nKSB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eS5icmFuY2ggPSBwYXlsb2FkLnJlZi5zdWJzdHJpbmcoMTEpO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eS5icmFuY2ggPSBwYXlsb2FkLnJlZjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgYWN0aXZpdHkuYnJhbmNoTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL3RyZWUvJyArIGFjdGl2aXR5LmJyYW5jaCwgYWN0aXZpdHkuYnJhbmNoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gR2V0IHRoZSBIVE1MIG9mIHNlbGVjdGVkIGFjdGl2aXR5IHR5cGVcclxuICAgICAgICAgICAgc3dpdGNoKGFjdGl2aXR5LnR5cGUpe1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0NvbW1pdENvbW1lbnRFdmVudCc6IGFjdGl2aXR5LmNvbW1lbnRMaW5rID0gZ2l0TWV0aG9kcy5nZXRMaW5rKHBheWxvYWQuY29tbWVudC5odG1sX3VybCwgYWN0aXZpdHkucmVwby5uYW1lICsgJ0AnICtwYXlsb2FkLmNvbW1lbnQuY29tbWl0X2lkLnN1YnN0cmluZygwLDYpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0NyZWF0ZUV2ZW50JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0RlbGV0ZUV2ZW50JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0ZvcmtFdmVudCc6ICAgYWN0aXZpdHkuZm9ya0xpbmsgPSBnaXRNZXRob2RzLmdldEdpdEh1YkxpbmsocGF5bG9hZC5mb3JrZWUuaHRtbF91cmwsIHBheWxvYWQuZm9ya2VlLmZ1bGxfbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdHb2xsdW1FdmVudCc6IHZhciBwYWdlID0gcGF5bG9hZC5wYWdlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LmFjdGlvblR5cGUgPSBwYWdlLmFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5Lndpa2lNZXNzYWdlID0gYWN0aXZpdHkuYWN0aW9uVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFjdGl2aXR5LmFjdGlvblR5cGUuc2xpY2UoMSkgKyAnICc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS53aWtpTWVzc2FnZSArPSBnaXRNZXRob2RzLmdldExpbmsocGFnZS5odG1sX3VybCwgcGFnZS50aXRsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdJc3N1ZUNvbW1lbnRFdmVudCc6IGFjdGl2aXR5LmNvbW1lbnRMaW5rPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5jb21tZW50Lmh0bWxfdXJsLCBhY3Rpdml0eS5yZXBvLm5hbWUgKyAnIycgK3BheWxvYWQuaXNzdWUubnVtYmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0lzc3Vlc0V2ZW50JzogYWN0aXZpdHkuaXNzdWVVcmwgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5pc3N1ZS5odG1sX3VybCwgYWN0aXZpdHkucmVwby5uYW1lICsgJyMnICtwYXlsb2FkLmlzc3VlLm51bWJlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdNZW1iZXJFdmVudCc6IGFjdGl2aXR5Lm1lbWJlckxpbmsgPSBnaXRNZXRob2RzLmdldEdpdEh1YkxpbmsocGF5bG9hZC5tZW1iZXIubG9naW4sIHBheWxvYWQubWVtYmVyLmxvZ2luKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1B1YmxpY0V2ZW50JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1B1bGxSZXF1ZXN0RXZlbnQnOiBhY3Rpdml0eS5tZXJnZVJlcXVlc3RVcmwgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5wdWxsX3JlcXVlc3QuaHRtbF91cmwsIGFjdGl2aXR5LnJlcG8ubmFtZSArICcjJyArcGF5bG9hZC5wdWxsX3JlcXVlc3QubnVtYmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1B1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudEV2ZW50JzogYWN0aXZpdHkucHVsbENvbW1lbnRVcmw9IGdpdE1ldGhvZHMuZ2V0TGluayhwYXlsb2FkLmNvbW1lbnQuaHRtbF91cmwsIGFjdGl2aXR5LnJlcG8ubmFtZSArICcjJyArcGF5bG9hZC5wdWxsX3JlcXVlc3QubnVtYmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1B1c2hFdmVudCc6ICAgYWN0aXZpdHkuY29tbWl0c0h0bWwgPSBnaXRNZXRob2RzLmdldENvbW1pdHNIVE1MKGFjdGl2aXR5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1JlbGVhc2VFdmVudCc6IGFjdGl2aXR5LnRhZ0xpbmsgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5yZWxlYXNlLmh0bWxfdXJsLCBwYXlsb2FkLnJlbGVhc2UudGFnX25hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnppcExpbmsgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5yZWxlYXNlLnppcGJhbGxfdXJsLCAnRG93bmxvYWQgU291cmNlIENvZGUgKHppcCknKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnV2F0Y2hFdmVudCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBHZXQgYWN0aXZpdHkgc3BlY2lmaWMgbWVzc2FnZVxyXG4gICAgICAgICAgICBhY3Rpdml0eS5tZXNzYWdlID0gZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzW2FjdGl2aXR5LnR5cGVdLCBhY3Rpdml0eSk7XHJcbiAgICAgICAgICAgIGh0bWwgKz0gZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzWydnaXRBY3Rpdml0eVRwbCddLGFjdGl2aXR5KTtcclxuXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFJlbmRlciBjcmVhdGVkIGFjdGl2aXR5IEhUTUwgdG8gRE9NXHJcbiAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGh0bWwsIG9wdGlvbnMuc2VsZWN0b3IsICcuZ3QtYWN0aXZpdHktY250Jyk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBGb3JtIEhUTUwgZm9yIGNvbW1pdHMgaW4gUHVzaEV2ZW50XHJcbiAgICAgIGdldENvbW1pdHNIVE1MOiBmdW5jdGlvbihhY3Rpdml0eSl7XHJcbiAgICAgICAgICB2YXIgaHRtbCA9ICc8dWwgY2xhc3M9XCJndC1jb21taXQtbGlzdFwiPicsXHJcbiAgICAgICAgICBsaUVsZW1lbnQsIHNoYUxpbmssIGNvbW1pdE1lc3NhZ2UsICBjb21taXQsIGluZGV4LFxyXG4gICAgICAgICAgY29tcGFyZUxpbmsgPSAnJyxcclxuICAgICAgICAgIHBheWxvYWQgPSBhY3Rpdml0eS5wYXlsb2FkLFxyXG4gICAgICAgICAgbGVuZ3RoID0gcGF5bG9hZC5jb21taXRzLmxlbmd0aCxcclxuICAgICAgICAgIHNoYURpZmYgPSBwYXlsb2FkLmJlZm9yZSArICcuLi4nICsgcGF5bG9hZC5oZWFkO1xyXG5cclxuICAgICAgICAgIC8vIEdldCBsaW5rcyBmb3IgMiBvciBsZXNzIGNvbW1pdFxyXG4gICAgICAgICAgZm9yKGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4Kyspe1xyXG4gICAgICAgICAgICBpZiAoaW5kZXg+MSkgYnJlYWs7XHJcbiAgICAgICAgICAgIGNvbW1pdCA9IHBheWxvYWQuY29tbWl0c1tpbmRleF07XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBjb21taXQgbGkgZWxlbWVudFxyXG4gICAgICAgICAgICBsaUVsZW1lbnQgPSAnPGxpIGNsYXNzPVwiZ3QtY29tbWl0LWl0ZW1cIiA+JztcclxuICAgICAgICAgICAgc2hhTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL2NvbW1pdC8nICsgY29tbWl0LnNoYSwgY29tbWl0LnNoYS5zdWJzdHJpbmcoMCwgNikpO1xyXG4gICAgICAgICAgICBjb21taXRNZXNzYWdlID0gJzxzcGFuIGNsYXNzPVwiZ3QtY29tbWl0LW1zZ1wiPicgKyBjb21taXQubWVzc2FnZS5zdWJzdHJpbmcoMCwxNTApICsgJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICBsaUVsZW1lbnQgKz0gc2hhTGlua1xyXG4gICAgICAgICAgICBsaUVsZW1lbnQgKz0gY29tbWl0TWVzc2FnZTtcclxuICAgICAgICAgICAgbGlFbGVtZW50ICs9ICc8L2xpPidcclxuICAgICAgICAgICAgaHRtbCArPSBsaUVsZW1lbnQ7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gR2V0IHRoZSBkaWZmIGxpbmsgYmV0d2VlbiBjb21taXRzXHJcbiAgICAgICAgICBpZiAobGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgIGNvbXBhcmVMaW5rID0gZ2l0TWV0aG9kcy5nZXRHaXRIdWJMaW5rKGFjdGl2aXR5LnJlcG8ubmFtZSArICcvY29tcGFyZS8nICsgc2hhRGlmZiwgJ1ZpZXcgY29tcGFyaXNvbiBmb3IgdGhlc2UgMiBjb21taXRzICZyYXF1bzsnLCdndC1jb21wYXJlLWxpbmsnKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID4gMikge1xyXG4gICAgICAgICAgICBjb21wYXJlTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL2NvbXBhcmUvJyArIHNoYURpZmYsIChsZW5ndGgtMikrJyBtb3JlICcgKyBnaXRNZXRob2RzLmdldFBsdXJhbFdvcmQobGVuZ3RoLTIsJ2NvbW1pdCcpICsgJyAmcmFxdW87JywnZ3QtY29tcGFyZS1saW5rJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaHRtbCArPSAnPC91bD4nXHJcbiAgICAgICAgICBodG1sICs9IGNvbXBhcmVMaW5rO1xyXG5cclxuICAgICAgICAgIHJldHVybiBodG1sO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gVXRpbGl0eSBmb3IgYXN5bmNocm9ub3VzIEFKQVggY2FsbHNcclxuICAgICAgZ2V0RGF0YTogZnVuY3Rpb24odXJsLCBvcHRpb25zLCBjYWxsYmFjayl7XHJcbiAgICAgICAgdmFyIGRhdGEsIHJlcXVlc3Q7XHJcbiAgICAgICAgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCB0cnVlKTtcclxuICAgICAgICAvLyBVc2UgT0F1dGggdG9rZW4gaWYgYXZhaWxhYmxlXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuT0F1dGgpIHtcclxuICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsICdUb2tlbiAnICsgb3B0aW9ucy5PQXV0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA+PSAyMDAgJiYgcmVxdWVzdC5zdGF0dXMgPCA0MDApe1xyXG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gVW5zdWNjZXNzZnVsIHJlcXVlc3QgLSBpbnZhbGlkIHVzZXJuYW1lLyBsb3N0IGludGVybmV0IGNvbm5lY3Rpdml0eS8gZXhjZWVkZWQgcmF0ZSBsaW1pdC8gQVBJIFVSTCBub3QgZm91bmRcclxuICAgICAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlcy5ub3RGb3VuZFRwbCwgZGF0YSksIG9wdGlvbnMuc2VsZWN0b3IsJy5ndC1jb250YWluZXInKTtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgY29ubmVjdGluZyB0byBHaXRIdWIgQVBJLicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGNvbm5lY3RpbmcgdG8gR2l0SHViIEFQSS4nKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXF1ZXN0LnNlbmQoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIEdldCBhbmNob3IgdGFnIEhUTUwgZm9yIFVSTFxyXG4gICAgICBnZXRMaW5rOiBmdW5jdGlvbih1cmwsIHRpdGxlLCBjc3NDbGFzcykge1xyXG4gICAgICAgIGlmICghdGl0bGUpXHJcbiAgICAgICAgICB0aXRsZSA9IHVybDtcclxuICAgICAgICBpZiAodHlwZW9mKGNzc0NsYXNzKSA9PT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAgICBjc3NDbGFzcyA9ICcnO1xyXG4gICAgICAgIHJldHVybiBnaXRNZXRob2RzLmdldFJlbmRlcmVkSFRNTCgnPGEgY2xhc3M9XCInICsgY3NzQ2xhc3MgKyAnXCIgaHJlZj1cIjwlPXVybCU+XCIgdGFyZ2V0PVwiX2JsYW5rXCI+PCU9dGl0bGUlPjwvYT4nLCB7IHVybDogdXJsLCB0aXRsZTogdGl0bGUgfSk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBHZXQgYW5jaG9yIHRhZyBIVE1MIGZvciBub24tZ2l0aHViIFVSTFxyXG4gICAgICBnZXRHaXRIdWJMaW5rOiBmdW5jdGlvbih1cmwsIHRpdGxlLCBjc3NDbGFzcykge1xyXG4gICAgICAgIGlmICghdGl0bGUpXHJcbiAgICAgICAgICB0aXRsZSA9IHVybDtcclxuICAgICAgICBpZiAodHlwZW9mKGNzc0NsYXNzKSA9PT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAgICBjc3NDbGFzcyA9ICcnO1xyXG4gICAgICAgIHJldHVybiBnaXRNZXRob2RzLmdldExpbmsoJ2h0dHBzOi8vZ2l0aHViLmNvbS8nICsgdXJsLCB0aXRsZSwgY3NzQ2xhc3MpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gIE9ubHkgZm9yIHBsdXJhbHMgZW5kaW5nIHdpdGggJ3MnLiBZZWFoISB0aGlzIHN1Y2tzLlxyXG4gICAgICBnZXRQbHVyYWxXb3JkOiBmdW5jdGlvbiAoY291bnQsIHdvcmQpIHtcclxuICAgICAgICBpZiAoY291bnQgIT09IDEpIHJldHVybiB3b3JkICsgJ3MnO1xyXG4gICAgICAgIHJldHVybiB3b3JkO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gR2V0IHJlcG9zaXRvcnkgbGFuZ3VhZ2Ugc3RhdCBIVE1MXHJcbiAgICAgIGdldExhbmd1YWdlSFRNTDogZnVuY3Rpb24oZGF0YSwgb3B0aW9ucyl7XHJcbiAgICAgICAgdmFyIGxhbmd1YWdlRGF0YSA9IFtdLCBzdW0gPSAwLFxyXG4gICAgICAgIHBlcmNlbnRhZ2UsIGxhbmd1YWdlSHRtbCA9ICcnO1xyXG4gICAgICAgIC8vIEdldCB0b3RhbCBzaXplIGFuZCBjcmVhdGUgYXJyYXkgd2hpY2ggY2FuIGJlIHNvcnRlZCBieSB2YWx1ZVxyXG4gICAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSwga2V5KXtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgZGF0YS5sYW5ndWFnZSA9IGtleTtcclxuICAgICAgICAgICAgZGF0YS5zaXplID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGxhbmd1YWdlRGF0YS5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICBzdW0gKz0gdmFsdWU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFNvcnQgbGFuZ3VhZ2VzIGJ5IHVzYWdlIGluIHJlcG9cclxuICAgICAgICBsYW5ndWFnZURhdGEgPSBsYW5ndWFnZURhdGEuc29ydChmdW5jdGlvbihhLCBiKXtyZXR1cm4gYi5zaXplIC0gYS5zaXplfSk7XHJcblxyXG4gICAgICAgIC8vIEdldCBIVE1MIGZvciBlYWNoIGxhbmd1YWdlXHJcbiAgICAgICAgXy5lYWNoKGxhbmd1YWdlRGF0YSwgZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAocGFyc2VJbnQoZWxlbWVudC5zaXplKS9zdW0qMTAwKS50b0ZpeGVkKDEpO1xyXG4gICAgICAgICAgICBsYW5ndWFnZUh0bWwgKz0nPGRpdiBjbGFzcz1cImd0LXJlcG8tbGctY250XCIgc3R5bGU9XCJ3aWR0aDogJysgcGVyY2VudGFnZSArJyU7IGJhY2tncm91bmQ6ICMnKyBnaXRNZXRob2RzLmdldFJhbmRvbUNvbG9yKCkgKyc7IFwiID4nK1xyXG4gICAgICAgICAgICAgICAgICAgJyA8ZGl2IGNsYXNzPVwiZ3QtcmVwby1sZy1uYW1lXCIgZGF0YS10aXRsZT1cIicrIGVsZW1lbnQubGFuZ3VhZ2UgKycgKCcrIHBlcmNlbnRhZ2UgKyclKVwiPiA8L2Rpdj4gPC9kaXY+JztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gUmVuZGVyIGxhbmd1YWdlIEhUTUwgdG8gdGhlIGNvbnRhaW5lclxyXG4gICAgICAgIGdpdE1ldGhvZHMucmVuZGVyQ29udGVudChsYW5ndWFnZUh0bWwsIG9wdGlvbnMuc2VsZWN0b3IsJy5ndC1yZXBvLWxnLXN0YXQnKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIEdldCByYW5kb20gSEVYIGNvZGUgZm9yIGNvbG9yXHJcbiAgICAgIGdldFJhbmRvbUNvbG9yOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMiwgOCk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBDb252ZXJ0IG1pbGxpc2Vjb25kcyB0byB0aW1lIHN0cmluZ1xyXG4gICAgICBtaWxsaXNlY29uZHNUb1N0cjogZnVuY3Rpb24obWlsbGlzZWNvbmRzKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gbnVtYmVyRW5kaW5nKG51bWJlcikge1xyXG4gICAgICAgICAgcmV0dXJuIChudW1iZXIgPiAxKSA/ICdzIGFnbycgOiAnIGFnbyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB0ZW1wID0gTWF0aC5mbG9vcihtaWxsaXNlY29uZHMgLyAxMDAwKTtcclxuXHJcbiAgICAgICAgdmFyIHllYXJzID0gTWF0aC5mbG9vcih0ZW1wIC8gMzE1MzYwMDApO1xyXG4gICAgICAgIGlmICh5ZWFycykgcmV0dXJuIHllYXJzICsgJyB5ZWFyJyArIG51bWJlckVuZGluZyh5ZWFycyk7XHJcblxyXG4gICAgICAgIHZhciBtb250aHMgPSBNYXRoLmZsb29yKCh0ZW1wICU9IDMxNTM2MDAwKSAvIDI1OTIwMDApO1xyXG4gICAgICAgIGlmIChtb250aHMpIHJldHVybiBtb250aHMgKyAnIG1vbnRoJyArIG51bWJlckVuZGluZyhtb250aHMpO1xyXG5cclxuICAgICAgICB2YXIgZGF5cyA9IE1hdGguZmxvb3IoKHRlbXAgJT0gMjU5MjAwMCkgLyA4NjQwMCk7XHJcbiAgICAgICAgaWYgKGRheXMpIHJldHVybiBkYXlzICsgJyBkYXknICsgbnVtYmVyRW5kaW5nKGRheXMpO1xyXG5cclxuICAgICAgICB2YXIgaG91cnMgPSBNYXRoLmZsb29yKCh0ZW1wICU9IDg2NDAwKSAvIDM2MDApO1xyXG4gICAgICAgIGlmIChob3VycykgcmV0dXJuICdhYm91dCAnICsgaG91cnMgKyAnIGhvdXInICsgbnVtYmVyRW5kaW5nKGhvdXJzKTtcclxuXHJcbiAgICAgICAgdmFyIG1pbnV0ZXMgPSBNYXRoLmZsb29yKCh0ZW1wICU9IDM2MDApIC8gNjApO1xyXG4gICAgICAgIGlmIChtaW51dGVzKSByZXR1cm4gbWludXRlcyArICcgbWludXRlJyArIG51bWJlckVuZGluZyhtaW51dGVzKTtcclxuXHJcbiAgICAgICAgdmFyIHNlY29uZHMgPSB0ZW1wICUgNjA7XHJcbiAgICAgICAgaWYgKHNlY29uZHMpIHJldHVybiBzZWNvbmRzICsgJyBzZWNvbmQnICsgbnVtYmVyRW5kaW5nKHNlY29uZHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gJ2p1c3Qgbm93JztcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFJlbmRlciB0aGUgY29udGVudCB0byB0aGUgc2VsZWN0b3Igb3Igc3ViU2VsZWN0b3JcclxuICAgICAgcmVuZGVyQ29udGVudDogZnVuY3Rpb24oY29udGVudCwgc2VsZWN0b3IsIHN1YlNlbGVjdG9yKXtcclxuICAgICAgICB2YXIgc2VsZWN0b3JEaXZzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0b3JEaXZzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAvLyBpZiBzdWJTZWxlY3RvciBpcyBwYXNzZWQsIGZpbmQgaXRcclxuICAgICAgICAgIGlmIChzdWJTZWxlY3Rvcikge1xyXG4gICAgICAgICAgICBzZWxlY3RvckRpdiA9IHNlbGVjdG9yRGl2c1tpXS5xdWVyeVNlbGVjdG9yKHN1YlNlbGVjdG9yKTtcclxuICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgc2VsZWN0b3JEaXYgPSBzZWxlY3RvckRpdnNbaV07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWxlY3RvckRpdi5pbm5lckhUTUwgPSBjb250ZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBTZXQgcmVuZGVyIGxpbWl0IGZvciBhY3Rpdml0aWVzIC0gZGVmYXVsdCBpcyAzMFxyXG4gICAgICBzZXRMaW1pdDogZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgIHZhciBsaW1pdDtcclxuICAgICAgICBpZiAodmFsdWUgIT09ICd1bmRlZmluZWQnICYmIGdpdE1ldGhvZHMuY2hlY2tJbnRlZ2VyKGxpbWl0ID0gcGFyc2VJbnQodmFsdWUsIDEwKSkpIHtcclxuICAgICAgICAgIGxpbWl0ID0gKGxpbWl0PjMwKT8zMDpsaW1pdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGltaXQgPSAzMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGxpbWl0O1xyXG4gICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgcmV0dXJuIEdpdGh1YjtcclxufSkpOyJdLCJmaWxlIjoiZ2l0aHViLm1pbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
