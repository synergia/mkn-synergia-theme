//      Github.js - v0.1.3

//      Â© 2015, Akshay Sharma Released under the MIT License.

(function (root, factory) {

    // Set up library appropriately for the environment
    if (typeof define === 'function' && define.amd) {
        // Define for AMD
        define(['underscore'], factory);
    } else if (typeof exports === 'object') {
        // Export for Node, CommonJS-like modules
        module.exports = factory(require('underscore'));
    } else {
        // As browser global (root is window here)
        root.Github = factory(root._);
    }

}(this, function (_) {

    var Github = {};

    // Current version of the library. Keep in sync with `package.json`
    Github.version = '0.1.3';

    // Common GitHub API URL
    var gitApiUrl = 'https://api.github.com/';

    //        userProfile - render's the github user details to selector
    //        @param  Type - JSON -> options [username, selector]

    Github.userProfile = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 0)){
        var userUrl = gitApiUrl + 'users/' + options.username;
        gitMethods.getData(userUrl, options, gitMethods.getUserProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        repoProfile - render's the github repo details to selector
    //        @param  Type - JSON -> options [username, reponame, selector]
    //
    Github.repoProfile = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector','reponame'], 0)){
        var repoUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame;
        gitMethods.getData(repoUrl, options, gitMethods.getRepoProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        orgProfile - render's the github organization details to selector
    //        @param  Type - JSON -> options [orgname, selector]
    //
    Github.orgProfile = function (options) {

      if(options = gitMethods.initialize(options, ['orgname','selector'], 0)){
        var orgUrl = gitApiUrl + 'orgs/' + options.orgname;
        gitMethods.getData(orgUrl, options, gitMethods.getOrgProfileHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        userActivity - render's the github user activity to selector
    //        @param  Type - JSON -> options [username, selector and limit (optional)]
    //
    Github.userActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 1)){
        var userUrl = gitApiUrl + 'users/' + options.username,
        eventsUrl = userUrl + '/events';
        gitMethods.getData(userUrl, options, gitMethods.getUserProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    Github.onlyuserActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector'], 1)){
        var userUrl = gitApiUrl + 'users/' + options.username,
        eventsUrl = userUrl + '/events';
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };
    //
    //        repoActivity - render's the github repository activity to selector
    //        @param  Type - JSON -> options [username, reponame, selector and limit (optional)]
    //
    Github.repoActivity = function (options) {

      if(options = gitMethods.initialize(options, ['username','selector','reponame'], 1)){
        var repoUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame,
        eventsUrl = repoUrl + '/events';
        gitMethods.getData(repoUrl, options, gitMethods.getRepoProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    //
    //        orgActivity - render's the github organization activity to selector
    //        @param  Type - JSON -> options [orgname, selector and limit (optional)]
    //
    Github.orgActivity = function (options) {

      if(options = gitMethods.initialize(options, ['orgname','selector'], 1)){
        var orgUrl = gitApiUrl + 'orgs/' + options.orgname,
        eventsUrl = orgUrl + '/events';
        gitMethods.getData(orgUrl, options, gitMethods.getOrgProfileHTML);
        gitMethods.getData(eventsUrl, options, gitMethods.getPublicActivityHTML);
      } else{
        console.error("Parameters not passed correctly");
      }

    };

    // Underscore templates for profiles, activities, etc.
    var gitTemplates = {
      // Parent container template
      parentTpl: '<div class="gt-container">'+
                          // '<div class="gt-header gt-shadow">'+
                          //   '<div class="gt-loading-txt">Loading..</div>'+
                          // '</div>'+
                          '<%if(type){%><div class="gt-activity-cnt gt-scrollbar">'+
                            '<div class="gt-loading-txt">Loading..</div>'+
                          '</div><%}%>'+
                         '</div>',
      // User profile template
      userProfileTpl:   '<div class="gt-usr-avatar">'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<div class="gt-usr-img" style="background-image: url(<%= avatar_url%>)"> </div>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-usr-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="user-login"><%= login%></span>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-usr-details">'+
                          '<div class="gt-usr-repo">'+
                            '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="gt-usr-txt"><%= public_repos%></span>'+
                            '<span class="gt-usr-dt">Repositories</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folwr">'+
                            '<a target="_blank" href="<%= html_url + "/followers"%>">'+
                            '<span class="gt-usr-txt"><%= followers%></span>'+
                            '<span class="gt-usr-dt">Followers</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folng">'+
                            '<a target="_blank" href="<%= html_url + "/following"%>">'+
                            '<span class="gt-usr-txt"><%= following%></span>'+
                            '<span class="gt-usr-dt">Following</span>'+
                            '</a>'+
                          '</div>'+
                        '</div>',
      // Repository profile template
      repoProfileTpl:   '<div class="gt-usr-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<a target="_blank" href="<%= owner.html_url%>">'+
                            '<span class="user-login"><%= owner.login%></span>'+
                          '</a>'+
                          '<p>'+
                            '<%= description%>'+
                          '</p>'+
                        '</div>'+
                        '<div class="gt-repo-details">'+
                          '<div class="gt-usr-repo">'+
                            '<a target="_blank" href="<%= html_url%>">'+
                            '<span class="gt-usr-txt"><%= stargazers_count%></span>'+
                            '<span class="gt-usr-dt">Stars</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folwr">'+
                            '<a target="_blank" href="<%= html_url %>">'+
                            '<span class="gt-usr-txt"><%= subscribers_count%></span>'+
                            '<span class="gt-usr-dt">Watchers</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-usr-folng">'+
                            '<a target="_blank" href="<%= html_url %>">'+
                            '<span class="gt-usr-txt"><%= forks_count%></span>'+
                            '<span class="gt-usr-dt">Forks</span>'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-repo-lg-stat">'+
                          '</div>'+
                        '</div>',
      // Organization profile template
      orgProfileTpl:    '<div class="gt-org-avatar">'+
                          '<a target="_blank" href="<%= html_url%>">'+
                            '<div class="gt-org-img" style="background-image: url(<%= avatar_url%>)"> </div>'+
                          '</a>'+
                        '</div>'+
                        '<div class="gt-org-name">'+
                          '<span class="user-name"><%= name%></span>'+
                          '<%if(blog){%><a target="_blank" href="<%= blog%>" class="gt-org-link">'+
                            '<span class="user-login">Website</span>'+
                          '</a><%}%>'+
                          '<%if(email){%><a target="_blank" href="mailto:<%= email%>" class="gt-org-link">'+
                            '<span class="user-login">Email</span>'+
                          '</a><%}%>'+
                          '<br><span class="gt-org-repos"><%= public_repos%></span>'+
                          '<span class="gt-org-repos"> Public Repositories</span>'+
                        '</div>',
      // Parent activity container template
      gitActivityTpl: '<div class="gt-activity <%=type%>">'+
                          '<div class="gt-avatar-cnt">'+
                            '<a target="_blank" href="https://github.com/<%= actor.login%>">'+
                              '<img src="<%=actor.avatar_url%>" class="gt-usr-avatar">'+
                            '</a>'+
                          '</div>'+
                          '<div class="gt-act-cnt">'+
                              '<div title="<%= created_at%>" class="gt-time-cnt"><div class="gt-time-str"><%= timeString%></div></div>'+
                              '<%= userLink%>'+'<%= message%>'+
                          '</div>'+
                          '<div class="gt-clearfix"></div>'+
                      '</div>',
      // Activity templates keyed with activity type
      CommitCommentEvent:'<span> commented on commit <%= commentLink%> </span>'+
                         '<p><%= payload.comment.body%></p>',
      CreateEvent: '<span> created <%= payload.ref_type%> <%= branchLink%> at <%= repoLink%> </span>',
      DeleteEvent: '<span> deleted <%= payload.ref%> <%= payload.ref_type%> at <%= repoLink%> </span>',
      ForkEvent:  '<span> forked <%= repoLink%> to <%= forkLink%> </span>',
      GollumEvent: '<span> <%= actionType%> the <%= repoLink%> wiki</span>'+
                      '<p><%= wikiMessage%></p>',
      IssueCommentEvent: '<span> commented on issue <%= commentLink%> </span>'+
                              '<p><%= payload.comment.body%></p>',
      IssuesEvent: '<span> <%= payload.action%> issue <%= issueUrl%> </span>',
      MemberEvent: '<span> added <%= memberLink%> to <%= repoLink%> </span>',
      PublicEvent: '<span> open sourced <%= repoLink%> </span>',
      PullRequestEvent: '<span> <%= payload.action%> pull request <%= mergeRequestUrl%> </span>'+
                        '<p><%= payload.pull_request.title%></p>'+
                        '<p class="pull-req-info"><%= payload.pull_request.commits%><%if(payload.pull_request.commits > 1){%> commits <%}else{%> commit <%}%> '+
                        'with <%= payload.pull_request.changed_files%> <%if(payload.pull_request.commits > 1){%> files <%}else{%> file <%}%> changed.</p>',
      PullRequestReviewCommentEvent: '<span> commented on pull request <%= pullCommentUrl%> </span>'+
                                     '<p><%= payload.comment.body%></p>',
      PushEvent: '<span> pushed to <%= branchLink%> at <%= repoLink%> </span>'+
                 '<%= commitsHtml%>',
      ReleaseEvent: '<span> released <%= tagLink%> at <%= repoLink%> </span>'+
                    '<br><%= zipLink%>',
      WatchEvent: '<span> starred <%= repoLink%> </span>',
      noActivityTpl: '<div class="gt-no-activity">'+
                        '<span> There are no public events for this account in past 90 days. </span>'+
                     '</div>',
      notFoundTpl: '<div class="gt-no-activity">'+
                        '<span> This account does not exist. </span>'+
                     '</div>'
    };

    // Object for locally used methods
    var gitMethods = {
      // Check variables and render base template
      initialize: function(options, variables, type){
        // Validate varaibles
        for (var i = 0; i < variables.length; i++) {
          if(!options[variables[i]])
            return false;
        }
        // Type - 0 - only profile

        // Type - 1 - profile and acitivity feed
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates['parentTpl'],{
          type: type
        }),options.selector);

        // Set limit value
        options.limit = gitMethods.setLimit(options.limit);
        return options;
      },

      // Check if value is integer
      checkInteger: function (value) {
        if (value === parseInt(value, 10))
          return true;
        else
          return false;
      },

      // Get the rendered template with data
      getRenderedHTML: function (template, data) {
        if (data) {
          return _.template(template)(data);
        } else{
          return _.template(template)();
        }
      },

      // Render User profile HTML
      getUserProfileHTML: function (data, options){
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.userProfileTpl, data), options.selector,'.gt-header');
      },

      // Render the repository profile HTML with language stats
      getRepoProfileHTML: function (data, options){
        var languageUrl = gitApiUrl + 'repos/' + options.username +'/'+ options.reponame + '/languages';
        // Render template
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.repoProfileTpl, data), options.selector,'.gt-header');
        // Fetch language stat for repo
        gitMethods.getData(languageUrl, options, gitMethods.getLanguageHTML);
      },

      // Render organization profile HTML
      getOrgProfileHTML: function (data, options){
        gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.orgProfileTpl, data), options.selector,'.gt-header');
      },

      // Render recent public activities of user/repo/organization
      getPublicActivityHTML: function (data,options) {
        var html = '';
        // Get min of limit of data size
        var length = (options.limit < data.length)? options.limit : data.length;

        if (length==0) {
          // If no activity in last 90 days
          html += gitMethods.getRenderedHTML(gitTemplates['noActivityTpl']);
        }
        else{
          // Loop over all the activities
          for(var index = 0; index < length; index++){
            var activity = data[index];
            var payload = activity.payload;

            // Get attributes common to all activities
            activity.timeString = gitMethods.millisecondsToStr(new Date() - new Date(activity.created_at));
            activity.userLink = gitMethods.getGitHubLink(activity.actor.login, activity.actor.login);
            activity.repoLink = gitMethods.getGitHubLink(activity.repo.name, activity.repo.name);

            // Get the branch name
            activity.branchLink = '';
            if (payload.ref) {
              if (payload.ref.substring(0, 11) === 'refs/heads/') {
                activity.branch = payload.ref.substring(11);
              } else {
                activity.branch = payload.ref;
              }
              activity.branchLink = gitMethods.getGitHubLink(activity.repo.name + '/tree/' + activity.branch, activity.branch);
            }

            // Get the HTML of selected activity type
            switch(activity.type){
              case 'CommitCommentEvent': activity.commentLink = gitMethods.getLink(payload.comment.html_url, activity.repo.name + '@' +payload.comment.commit_id.substring(0,6));
                                  break;
              case 'CreateEvent':
                                  break;
              case 'DeleteEvent':
                                  break;
              case 'ForkEvent':   activity.forkLink = gitMethods.getGitHubLink(payload.forkee.html_url, payload.forkee.full_name);
                                  break;
              case 'GollumEvent': var page = payload.pages[0];
                                  activity.actionType = page.action;
                                  activity.wikiMessage = activity.actionType.charAt(0).toUpperCase() + activity.actionType.slice(1) + ' ';
                                  activity.wikiMessage += gitMethods.getLink(page.html_url, page.title);
                                  break;
              case 'IssueCommentEvent': activity.commentLink= gitMethods.getLink(payload.comment.html_url, activity.repo.name + '#' +payload.issue.number);
                                  break;
              case 'IssuesEvent': activity.issueUrl = gitMethods.getLink(payload.issue.html_url, activity.repo.name + '#' +payload.issue.number);
                                  break;
              case 'MemberEvent': activity.memberLink = gitMethods.getGitHubLink(payload.member.login, payload.member.login);
                                  break;
              case 'PublicEvent':
                                  break;
              case 'PullRequestEvent': activity.mergeRequestUrl = gitMethods.getLink(payload.pull_request.html_url, activity.repo.name + '#' +payload.pull_request.number);
                                  break;
              case 'PullRequestReviewCommentEvent': activity.pullCommentUrl= gitMethods.getLink(payload.comment.html_url, activity.repo.name + '#' +payload.pull_request.number);
                                  break;
              case 'PushEvent':   activity.commitsHtml = gitMethods.getCommitsHTML(activity);
                                  break;
              case 'ReleaseEvent': activity.tagLink = gitMethods.getLink(payload.release.html_url, payload.release.tag_name);
                                   activity.zipLink = gitMethods.getLink(payload.release.zipball_url, 'Download Source Code (zip)')
                                  break;
              case 'WatchEvent':
                                  break;
            }
            // Get activity specific message
            activity.message = gitMethods.getRenderedHTML(gitTemplates[activity.type], activity);
            html += gitMethods.getRenderedHTML(gitTemplates['gitActivityTpl'],activity);

          }
        }
        // Render created activity HTML to DOM
        gitMethods.renderContent(html, options.selector, '.gt-activity-cnt');
      },

      // Form HTML for commits in PushEvent
      getCommitsHTML: function(activity){
          var html = '<ul class="gt-commit-list">',
          liElement, shaLink, commitMessage,  commit, index,
          compareLink = '',
          payload = activity.payload,
          length = payload.commits.length,
          shaDiff = payload.before + '...' + payload.head;

          // Get links for 2 or less commit
          for(index = 0; index < length; index++){
            if (index>1) break;
            commit = payload.commits[index];
            // Create commit li element
            liElement = '<li class="gt-commit-item" >';
            shaLink = gitMethods.getGitHubLink(activity.repo.name + '/commit/' + commit.sha, commit.sha.substring(0, 6));
            commitMessage = '<span class="gt-commit-msg">' + commit.message.substring(0,150) + '</span>';
            liElement += shaLink
            liElement += commitMessage;
            liElement += '</li>'
            html += liElement;
          }

          // Get the diff link between commits
          if (length === 2) {
            compareLink = gitMethods.getGitHubLink(activity.repo.name + '/compare/' + shaDiff, 'View comparison for these 2 commits &raquo;','gt-compare-link');
          } else if (length > 2) {
            compareLink = gitMethods.getGitHubLink(activity.repo.name + '/compare/' + shaDiff, (length-2)+' more ' + gitMethods.getPluralWord(length-2,'commit') + ' &raquo;','gt-compare-link');
          }

          html += '</ul>'
          html += compareLink;

          return html;
      },

      // Utility for asynchronous AJAX calls
      getData: function(url, options, callback){
        var data, request;
        request = new XMLHttpRequest();
        request.open('GET', url, true);
        // Use OAuth token if available
        if (options.OAuth) {
          request.setRequestHeader('Authorization', 'Token ' + options.OAuth);
        }

        request.onload = function(e) {
          if (request.status >= 200 && request.status < 400){
            data = JSON.parse(request.responseText);
            callback(data, options);
          } else {
            // Unsuccessful request - invalid username/ lost internet connectivity/ exceeded rate limit/ API URL not found
            gitMethods.renderContent(gitMethods.getRenderedHTML(gitTemplates.notFoundTpl, data), options.selector,'.gt-container');
            console.error('An error occurred while connecting to GitHub API.');
          }
        };

        request.onerror = function(e) {
          console.error('An error occurred while connecting to GitHub API.');
        };

        request.send();
      },

      // Get anchor tag HTML for URL
      getLink: function(url, title, cssClass) {
        if (!title)
          title = url;
        if (typeof(cssClass) === 'undefined')
          cssClass = '';
        return gitMethods.getRenderedHTML('<a class="' + cssClass + '" href="<%=url%>" target="_blank"><%=title%></a>', { url: url, title: title });
      },

      // Get anchor tag HTML for non-github URL
      getGitHubLink: function(url, title, cssClass) {
        if (!title)
          title = url;
        if (typeof(cssClass) === 'undefined')
          cssClass = '';
        return gitMethods.getLink('https://github.com/' + url, title, cssClass);
      },

      //  Only for plurals ending with 's'. Yeah! this sucks.
      getPluralWord: function (count, word) {
        if (count !== 1) return word + 's';
        return word;
      },

      // Get repository language stat HTML
      getLanguageHTML: function(data, options){
        var languageData = [], sum = 0,
        percentage, languageHtml = '';
        // Get total size and create array which can be sorted by value
        _.each(data, function(value, key){
            var data = {};
            data.language = key;
            data.size = value;
            languageData.push(data);
            sum += value;
        });

        // Sort languages by usage in repo
        languageData = languageData.sort(function(a, b){return b.size - a.size});

        // Get HTML for each language
        _.each(languageData, function(element){
            percentage = (parseInt(element.size)/sum*100).toFixed(1);
            languageHtml +='<div class="gt-repo-lg-cnt" style="width: '+ percentage +'%; background: #'+ gitMethods.getRandomColor() +'; " >'+
                   ' <div class="gt-repo-lg-name" data-title="'+ element.language +' ('+ percentage +'%)"> </div> </div>';
        });

        // Render language HTML to the container
        gitMethods.renderContent(languageHtml, options.selector,'.gt-repo-lg-stat');
      },

      // Get random HEX code for color
      getRandomColor: function(){
        return Math.random().toString(16).substring(2, 8);
      },

      // Convert milliseconds to time string
      millisecondsToStr: function(milliseconds) {
        function numberEnding(number) {
          return (number > 1) ? 's ago' : ' ago';
        }
        var temp = Math.floor(milliseconds / 1000);

        var years = Math.floor(temp / 31536000);
        if (years) return years + ' year' + numberEnding(years);

        var months = Math.floor((temp %= 31536000) / 2592000);
        if (months) return months + ' month' + numberEnding(months);

        var days = Math.floor((temp %= 2592000) / 86400);
        if (days) return days + ' day' + numberEnding(days);

        var hours = Math.floor((temp %= 86400) / 3600);
        if (hours) return 'about ' + hours + ' hour' + numberEnding(hours);

        var minutes = Math.floor((temp %= 3600) / 60);
        if (minutes) return minutes + ' minute' + numberEnding(minutes);

        var seconds = temp % 60;
        if (seconds) return seconds + ' second' + numberEnding(seconds);

        return 'just now';
      },

      // Render the content to the selector or subSelector
      renderContent: function(content, selector, subSelector){
        var selectorDivs = document.querySelectorAll(selector);

        for (var i = 0; i < selectorDivs.length; i++) {
          // if subSelector is passed, find it
          if (subSelector) {
            selectorDiv = selectorDivs[i].querySelector(subSelector);
          } else{
            selectorDiv = selectorDivs[i];
          }
          selectorDiv.innerHTML = content;
        }

      },

      // Set render limit for activities - default is 30
      setLimit: function(value){
        var limit;
        if (value !== 'undefined' && gitMethods.checkInteger(limit = parseInt(value, 10))) {
          limit = (limit>30)?30:limit;
        } else {
          limit = 30;
        }
        return limit;
      }

    };


    return Github;
}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJnaXRodWIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gICAgICBHaXRodWIuanMgLSB2MC4xLjNcblxuLy8gICAgICDCqSAyMDE1LCBBa3NoYXkgU2hhcm1hIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cblxuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG5cbiAgICAvLyBTZXQgdXAgbGlicmFyeSBhcHByb3ByaWF0ZWx5IGZvciB0aGUgZW52aXJvbm1lbnRcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIC8vIERlZmluZSBmb3IgQU1EXG4gICAgICAgIGRlZmluZShbJ3VuZGVyc2NvcmUnXSwgZmFjdG9yeSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gRXhwb3J0IGZvciBOb2RlLCBDb21tb25KUy1saWtlIG1vZHVsZXNcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ3VuZGVyc2NvcmUnKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQXMgYnJvd3NlciBnbG9iYWwgKHJvb3QgaXMgd2luZG93IGhlcmUpXG4gICAgICAgIHJvb3QuR2l0aHViID0gZmFjdG9yeShyb290Ll8pO1xuICAgIH1cblxufSh0aGlzLCBmdW5jdGlvbiAoXykge1xuXG4gICAgdmFyIEdpdGh1YiA9IHt9O1xuXG4gICAgLy8gQ3VycmVudCB2ZXJzaW9uIG9mIHRoZSBsaWJyYXJ5LiBLZWVwIGluIHN5bmMgd2l0aCBgcGFja2FnZS5qc29uYFxuICAgIEdpdGh1Yi52ZXJzaW9uID0gJzAuMS4zJztcblxuICAgIC8vIENvbW1vbiBHaXRIdWIgQVBJIFVSTFxuICAgIHZhciBnaXRBcGlVcmwgPSAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS8nO1xuXG4gICAgLy8gICAgICAgIHVzZXJQcm9maWxlIC0gcmVuZGVyJ3MgdGhlIGdpdGh1YiB1c2VyIGRldGFpbHMgdG8gc2VsZWN0b3JcbiAgICAvLyAgICAgICAgQHBhcmFtICBUeXBlIC0gSlNPTiAtPiBvcHRpb25zIFt1c2VybmFtZSwgc2VsZWN0b3JdXG5cbiAgICBHaXRodWIudXNlclByb2ZpbGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgICBpZihvcHRpb25zID0gZ2l0TWV0aG9kcy5pbml0aWFsaXplKG9wdGlvbnMsIFsndXNlcm5hbWUnLCdzZWxlY3RvciddLCAwKSl7XG4gICAgICAgIHZhciB1c2VyVXJsID0gZ2l0QXBpVXJsICsgJ3VzZXJzLycgKyBvcHRpb25zLnVzZXJuYW1lO1xuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEodXNlclVybCwgb3B0aW9ucywgZ2l0TWV0aG9kcy5nZXRVc2VyUHJvZmlsZUhUTUwpO1xuICAgICAgfSBlbHNle1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcbiAgICAgIH1cblxuICAgIH07XG5cbiAgICAvL1xuICAgIC8vICAgICAgICByZXBvUHJvZmlsZSAtIHJlbmRlcidzIHRoZSBnaXRodWIgcmVwbyBkZXRhaWxzIHRvIHNlbGVjdG9yXG4gICAgLy8gICAgICAgIEBwYXJhbSAgVHlwZSAtIEpTT04gLT4gb3B0aW9ucyBbdXNlcm5hbWUsIHJlcG9uYW1lLCBzZWxlY3Rvcl1cbiAgICAvL1xuICAgIEdpdGh1Yi5yZXBvUHJvZmlsZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICAgIGlmKG9wdGlvbnMgPSBnaXRNZXRob2RzLmluaXRpYWxpemUob3B0aW9ucywgWyd1c2VybmFtZScsJ3NlbGVjdG9yJywncmVwb25hbWUnXSwgMCkpe1xuICAgICAgICB2YXIgcmVwb1VybCA9IGdpdEFwaVVybCArICdyZXBvcy8nICsgb3B0aW9ucy51c2VybmFtZSArJy8nKyBvcHRpb25zLnJlcG9uYW1lO1xuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEocmVwb1VybCwgb3B0aW9ucywgZ2l0TWV0aG9kcy5nZXRSZXBvUHJvZmlsZUhUTUwpO1xuICAgICAgfSBlbHNle1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcbiAgICAgIH1cblxuICAgIH07XG5cbiAgICAvL1xuICAgIC8vICAgICAgICBvcmdQcm9maWxlIC0gcmVuZGVyJ3MgdGhlIGdpdGh1YiBvcmdhbml6YXRpb24gZGV0YWlscyB0byBzZWxlY3RvclxuICAgIC8vICAgICAgICBAcGFyYW0gIFR5cGUgLSBKU09OIC0+IG9wdGlvbnMgW29yZ25hbWUsIHNlbGVjdG9yXVxuICAgIC8vXG4gICAgR2l0aHViLm9yZ1Byb2ZpbGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgICBpZihvcHRpb25zID0gZ2l0TWV0aG9kcy5pbml0aWFsaXplKG9wdGlvbnMsIFsnb3JnbmFtZScsJ3NlbGVjdG9yJ10sIDApKXtcbiAgICAgICAgdmFyIG9yZ1VybCA9IGdpdEFwaVVybCArICdvcmdzLycgKyBvcHRpb25zLm9yZ25hbWU7XG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShvcmdVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0T3JnUHJvZmlsZUhUTUwpO1xuICAgICAgfSBlbHNle1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcbiAgICAgIH1cblxuICAgIH07XG5cbiAgICAvL1xuICAgIC8vICAgICAgICB1c2VyQWN0aXZpdHkgLSByZW5kZXIncyB0aGUgZ2l0aHViIHVzZXIgYWN0aXZpdHkgdG8gc2VsZWN0b3JcbiAgICAvLyAgICAgICAgQHBhcmFtICBUeXBlIC0gSlNPTiAtPiBvcHRpb25zIFt1c2VybmFtZSwgc2VsZWN0b3IgYW5kIGxpbWl0IChvcHRpb25hbCldXG4gICAgLy9cbiAgICBHaXRodWIudXNlckFjdGl2aXR5ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ3VzZXJuYW1lJywnc2VsZWN0b3InXSwgMSkpe1xuICAgICAgICB2YXIgdXNlclVybCA9IGdpdEFwaVVybCArICd1c2Vycy8nICsgb3B0aW9ucy51c2VybmFtZSxcbiAgICAgICAgZXZlbnRzVXJsID0gdXNlclVybCArICcvZXZlbnRzJztcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKHVzZXJVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0VXNlclByb2ZpbGVIVE1MKTtcbiAgICAgICAgZ2l0TWV0aG9kcy5nZXREYXRhKGV2ZW50c1VybCwgb3B0aW9ucywgZ2l0TWV0aG9kcy5nZXRQdWJsaWNBY3Rpdml0eUhUTUwpO1xuICAgICAgfSBlbHNle1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFyYW1ldGVycyBub3QgcGFzc2VkIGNvcnJlY3RseVwiKTtcbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBHaXRodWIub25seXVzZXJBY3Rpdml0eSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICAgIGlmKG9wdGlvbnMgPSBnaXRNZXRob2RzLmluaXRpYWxpemUob3B0aW9ucywgWyd1c2VybmFtZScsJ3NlbGVjdG9yJ10sIDEpKXtcbiAgICAgICAgdmFyIHVzZXJVcmwgPSBnaXRBcGlVcmwgKyAndXNlcnMvJyArIG9wdGlvbnMudXNlcm5hbWUsXG4gICAgICAgIGV2ZW50c1VybCA9IHVzZXJVcmwgKyAnL2V2ZW50cyc7XG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShldmVudHNVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0UHVibGljQWN0aXZpdHlIVE1MKTtcbiAgICAgIH0gZWxzZXtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlBhcmFtZXRlcnMgbm90IHBhc3NlZCBjb3JyZWN0bHlcIik7XG4gICAgICB9XG5cbiAgICB9O1xuICAgIC8vXG4gICAgLy8gICAgICAgIHJlcG9BY3Rpdml0eSAtIHJlbmRlcidzIHRoZSBnaXRodWIgcmVwb3NpdG9yeSBhY3Rpdml0eSB0byBzZWxlY3RvclxuICAgIC8vICAgICAgICBAcGFyYW0gIFR5cGUgLSBKU09OIC0+IG9wdGlvbnMgW3VzZXJuYW1lLCByZXBvbmFtZSwgc2VsZWN0b3IgYW5kIGxpbWl0IChvcHRpb25hbCldXG4gICAgLy9cbiAgICBHaXRodWIucmVwb0FjdGl2aXR5ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ3VzZXJuYW1lJywnc2VsZWN0b3InLCdyZXBvbmFtZSddLCAxKSl7XG4gICAgICAgIHZhciByZXBvVXJsID0gZ2l0QXBpVXJsICsgJ3JlcG9zLycgKyBvcHRpb25zLnVzZXJuYW1lICsnLycrIG9wdGlvbnMucmVwb25hbWUsXG4gICAgICAgIGV2ZW50c1VybCA9IHJlcG9VcmwgKyAnL2V2ZW50cyc7XG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShyZXBvVXJsLCBvcHRpb25zLCBnaXRNZXRob2RzLmdldFJlcG9Qcm9maWxlSFRNTCk7XG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShldmVudHNVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0UHVibGljQWN0aXZpdHlIVE1MKTtcbiAgICAgIH0gZWxzZXtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlBhcmFtZXRlcnMgbm90IHBhc3NlZCBjb3JyZWN0bHlcIik7XG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgLy9cbiAgICAvLyAgICAgICAgb3JnQWN0aXZpdHkgLSByZW5kZXIncyB0aGUgZ2l0aHViIG9yZ2FuaXphdGlvbiBhY3Rpdml0eSB0byBzZWxlY3RvclxuICAgIC8vICAgICAgICBAcGFyYW0gIFR5cGUgLSBKU09OIC0+IG9wdGlvbnMgW29yZ25hbWUsIHNlbGVjdG9yIGFuZCBsaW1pdCAob3B0aW9uYWwpXVxuICAgIC8vXG4gICAgR2l0aHViLm9yZ0FjdGl2aXR5ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgaWYob3B0aW9ucyA9IGdpdE1ldGhvZHMuaW5pdGlhbGl6ZShvcHRpb25zLCBbJ29yZ25hbWUnLCdzZWxlY3RvciddLCAxKSl7XG4gICAgICAgIHZhciBvcmdVcmwgPSBnaXRBcGlVcmwgKyAnb3Jncy8nICsgb3B0aW9ucy5vcmduYW1lLFxuICAgICAgICBldmVudHNVcmwgPSBvcmdVcmwgKyAnL2V2ZW50cyc7XG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShvcmdVcmwsIG9wdGlvbnMsIGdpdE1ldGhvZHMuZ2V0T3JnUHJvZmlsZUhUTUwpO1xuICAgICAgICBnaXRNZXRob2RzLmdldERhdGEoZXZlbnRzVXJsLCBvcHRpb25zLCBnaXRNZXRob2RzLmdldFB1YmxpY0FjdGl2aXR5SFRNTCk7XG4gICAgICB9IGVsc2V7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXJhbWV0ZXJzIG5vdCBwYXNzZWQgY29ycmVjdGx5XCIpO1xuICAgICAgfVxuXG4gICAgfTtcblxuICAgIC8vIFVuZGVyc2NvcmUgdGVtcGxhdGVzIGZvciBwcm9maWxlcywgYWN0aXZpdGllcywgZXRjLlxuICAgIHZhciBnaXRUZW1wbGF0ZXMgPSB7XG4gICAgICAvLyBQYXJlbnQgY29udGFpbmVyIHRlbXBsYXRlXG4gICAgICBwYXJlbnRUcGw6ICc8ZGl2IGNsYXNzPVwiZ3QtY29udGFpbmVyXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJzxkaXYgY2xhc3M9XCJndC1oZWFkZXIgZ3Qtc2hhZG93XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAnPGRpdiBjbGFzcz1cImd0LWxvYWRpbmctdHh0XCI+TG9hZGluZy4uPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8JWlmKHR5cGUpeyU+PGRpdiBjbGFzcz1cImd0LWFjdGl2aXR5LWNudCBndC1zY3JvbGxiYXJcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtbG9hZGluZy10eHRcIj5Mb2FkaW5nLi48L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+PCV9JT4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgLy8gVXNlciBwcm9maWxlIHRlbXBsYXRlXG4gICAgICB1c2VyUHJvZmlsZVRwbDogICAnPGRpdiBjbGFzcz1cImd0LXVzci1hdmF0YXJcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXVzci1pbWdcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCg8JT0gYXZhdGFyX3VybCU+KVwiPiA8L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLW5hbWVcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJ1c2VyLW5hbWVcIj48JT0gbmFtZSU+PC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsJT5cIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cInVzZXItbG9naW5cIj48JT0gbG9naW4lPjwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWRldGFpbHNcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXVzci1yZXBvXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItdHh0XCI+PCU9IHB1YmxpY19yZXBvcyU+PC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLWR0XCI+UmVwb3NpdG9yaWVzPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItZm9sd3JcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsICsgXCIvZm9sbG93ZXJzXCIlPlwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLXR4dFwiPjwlPSBmb2xsb3dlcnMlPjwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci1kdFwiPkZvbGxvd2Vyczwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWZvbG5nXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCArIFwiL2ZvbGxvd2luZ1wiJT5cIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci10eHRcIj48JT0gZm9sbG93aW5nJT48L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItZHRcIj5Gb2xsb3dpbmc8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXG4gICAgICAvLyBSZXBvc2l0b3J5IHByb2ZpbGUgdGVtcGxhdGVcbiAgICAgIHJlcG9Qcm9maWxlVHBsOiAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLW5hbWVcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJ1c2VyLW5hbWVcIj48JT0gbmFtZSU+PC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IG93bmVyLmh0bWxfdXJsJT5cIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cInVzZXItbG9naW5cIj48JT0gb3duZXIubG9naW4lPjwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8cD4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8JT0gZGVzY3JpcHRpb24lPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L3A+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1yZXBvLWRldGFpbHNcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXVzci1yZXBvXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCU+XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItdHh0XCI+PCU9IHN0YXJnYXplcnNfY291bnQlPjwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImd0LXVzci1kdFwiPlN0YXJzPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC11c3ItZm9sd3JcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiPCU9IGh0bWxfdXJsICU+XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItdHh0XCI+PCU9IHN1YnNjcmliZXJzX2NvdW50JT48L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJndC11c3ItZHRcIj5XYXRjaGVyczwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtdXNyLWZvbG5nXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIjwlPSBodG1sX3VybCAlPlwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLXR4dFwiPjwlPSBmb3Jrc19jb3VudCU+PC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3QtdXNyLWR0XCI+Rm9ya3M8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LXJlcG8tbGctc3RhdFwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXG4gICAgICAvLyBPcmdhbml6YXRpb24gcHJvZmlsZSB0ZW1wbGF0ZVxuICAgICAgb3JnUHJvZmlsZVRwbDogICAgJzxkaXYgY2xhc3M9XCJndC1vcmctYXZhdGFyXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxhIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9XCI8JT0gaHRtbF91cmwlPlwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1vcmctaW1nXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoPCU9IGF2YXRhcl91cmwlPilcIj4gPC9kaXY+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImd0LW9yZy1uYW1lXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1uYW1lXCI+PCU9IG5hbWUlPjwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnPCVpZihibG9nKXslPjxhIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9XCI8JT0gYmxvZyU+XCIgY2xhc3M9XCJndC1vcmctbGlua1wiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwidXNlci1sb2dpblwiPldlYnNpdGU8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT48JX0lPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8JWlmKGVtYWlsKXslPjxhIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9XCJtYWlsdG86PCU9IGVtYWlsJT5cIiBjbGFzcz1cImd0LW9yZy1saW5rXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJ1c2VyLWxvZ2luXCI+RW1haWw8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvYT48JX0lPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YnI+PHNwYW4gY2xhc3M9XCJndC1vcmctcmVwb3NcIj48JT0gcHVibGljX3JlcG9zJT48L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZ3Qtb3JnLXJlcG9zXCI+IFB1YmxpYyBSZXBvc2l0b3JpZXM8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgLy8gUGFyZW50IGFjdGl2aXR5IGNvbnRhaW5lciB0ZW1wbGF0ZVxuICAgICAgZ2l0QWN0aXZpdHlUcGw6ICc8ZGl2IGNsYXNzPVwiZ3QtYWN0aXZpdHkgPCU9dHlwZSU+XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJndC1hdmF0YXItY250XCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cImh0dHBzOi8vZ2l0aHViLmNvbS88JT0gYWN0b3IubG9naW4lPlwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGltZyBzcmM9XCI8JT1hY3Rvci5hdmF0YXJfdXJsJT5cIiBjbGFzcz1cImd0LXVzci1hdmF0YXJcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2E+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtYWN0LWNudFwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiB0aXRsZT1cIjwlPSBjcmVhdGVkX2F0JT5cIiBjbGFzcz1cImd0LXRpbWUtY250XCI+PGRpdiBjbGFzcz1cImd0LXRpbWUtc3RyXCI+PCU9IHRpbWVTdHJpbmclPjwvZGl2PjwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPCU9IHVzZXJMaW5rJT4nKyc8JT0gbWVzc2FnZSU+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZ3QtY2xlYXJmaXhcIj48L2Rpdj4nK1xuICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgLy8gQWN0aXZpdHkgdGVtcGxhdGVzIGtleWVkIHdpdGggYWN0aXZpdHkgdHlwZVxuICAgICAgQ29tbWl0Q29tbWVudEV2ZW50Oic8c3Bhbj4gY29tbWVudGVkIG9uIGNvbW1pdCA8JT0gY29tbWVudExpbmslPiA8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+PCU9IHBheWxvYWQuY29tbWVudC5ib2R5JT48L3A+JyxcbiAgICAgIENyZWF0ZUV2ZW50OiAnPHNwYW4+IGNyZWF0ZWQgPCU9IHBheWxvYWQucmVmX3R5cGUlPiA8JT0gYnJhbmNoTGluayU+IGF0IDwlPSByZXBvTGluayU+IDwvc3Bhbj4nLFxuICAgICAgRGVsZXRlRXZlbnQ6ICc8c3Bhbj4gZGVsZXRlZCA8JT0gcGF5bG9hZC5yZWYlPiA8JT0gcGF5bG9hZC5yZWZfdHlwZSU+IGF0IDwlPSByZXBvTGluayU+IDwvc3Bhbj4nLFxuICAgICAgRm9ya0V2ZW50OiAgJzxzcGFuPiBmb3JrZWQgPCU9IHJlcG9MaW5rJT4gdG8gPCU9IGZvcmtMaW5rJT4gPC9zcGFuPicsXG4gICAgICBHb2xsdW1FdmVudDogJzxzcGFuPiA8JT0gYWN0aW9uVHlwZSU+IHRoZSA8JT0gcmVwb0xpbmslPiB3aWtpPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgJzxwPjwlPSB3aWtpTWVzc2FnZSU+PC9wPicsXG4gICAgICBJc3N1ZUNvbW1lbnRFdmVudDogJzxzcGFuPiBjb21tZW50ZWQgb24gaXNzdWUgPCU9IGNvbW1lbnRMaW5rJT4gPC9zcGFuPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+PCU9IHBheWxvYWQuY29tbWVudC5ib2R5JT48L3A+JyxcbiAgICAgIElzc3Vlc0V2ZW50OiAnPHNwYW4+IDwlPSBwYXlsb2FkLmFjdGlvbiU+IGlzc3VlIDwlPSBpc3N1ZVVybCU+IDwvc3Bhbj4nLFxuICAgICAgTWVtYmVyRXZlbnQ6ICc8c3Bhbj4gYWRkZWQgPCU9IG1lbWJlckxpbmslPiB0byA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JyxcbiAgICAgIFB1YmxpY0V2ZW50OiAnPHNwYW4+IG9wZW4gc291cmNlZCA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JyxcbiAgICAgIFB1bGxSZXF1ZXN0RXZlbnQ6ICc8c3Bhbj4gPCU9IHBheWxvYWQuYWN0aW9uJT4gcHVsbCByZXF1ZXN0IDwlPSBtZXJnZVJlcXVlc3RVcmwlPiA8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICc8cD48JT0gcGF5bG9hZC5wdWxsX3JlcXVlc3QudGl0bGUlPjwvcD4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwicHVsbC1yZXEtaW5mb1wiPjwlPSBwYXlsb2FkLnB1bGxfcmVxdWVzdC5jb21taXRzJT48JWlmKHBheWxvYWQucHVsbF9yZXF1ZXN0LmNvbW1pdHMgPiAxKXslPiBjb21taXRzIDwlfWVsc2V7JT4gY29tbWl0IDwlfSU+ICcrXG4gICAgICAgICAgICAgICAgICAgICAgICAnd2l0aCA8JT0gcGF5bG9hZC5wdWxsX3JlcXVlc3QuY2hhbmdlZF9maWxlcyU+IDwlaWYocGF5bG9hZC5wdWxsX3JlcXVlc3QuY29tbWl0cyA+IDEpeyU+IGZpbGVzIDwlfWVsc2V7JT4gZmlsZSA8JX0lPiBjaGFuZ2VkLjwvcD4nLFxuICAgICAgUHVsbFJlcXVlc3RSZXZpZXdDb21tZW50RXZlbnQ6ICc8c3Bhbj4gY29tbWVudGVkIG9uIHB1bGwgcmVxdWVzdCA8JT0gcHVsbENvbW1lbnRVcmwlPiA8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+PCU9IHBheWxvYWQuY29tbWVudC5ib2R5JT48L3A+JyxcbiAgICAgIFB1c2hFdmVudDogJzxzcGFuPiBwdXNoZWQgdG8gPCU9IGJyYW5jaExpbmslPiBhdCA8JT0gcmVwb0xpbmslPiA8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgJzwlPSBjb21taXRzSHRtbCU+JyxcbiAgICAgIFJlbGVhc2VFdmVudDogJzxzcGFuPiByZWxlYXNlZCA8JT0gdGFnTGluayU+IGF0IDwlPSByZXBvTGluayU+IDwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAnPGJyPjwlPSB6aXBMaW5rJT4nLFxuICAgICAgV2F0Y2hFdmVudDogJzxzcGFuPiBzdGFycmVkIDwlPSByZXBvTGluayU+IDwvc3Bhbj4nLFxuICAgICAgbm9BY3Rpdml0eVRwbDogJzxkaXYgY2xhc3M9XCJndC1uby1hY3Rpdml0eVwiPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4+IFRoZXJlIGFyZSBubyBwdWJsaWMgZXZlbnRzIGZvciB0aGlzIGFjY291bnQgaW4gcGFzdCA5MCBkYXlzLiA8L3NwYW4+JytcbiAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgbm90Rm91bmRUcGw6ICc8ZGl2IGNsYXNzPVwiZ3Qtbm8tYWN0aXZpdHlcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuPiBUaGlzIGFjY291bnQgZG9lcyBub3QgZXhpc3QuIDwvc3Bhbj4nK1xuICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PidcbiAgICB9O1xuXG4gICAgLy8gT2JqZWN0IGZvciBsb2NhbGx5IHVzZWQgbWV0aG9kc1xuICAgIHZhciBnaXRNZXRob2RzID0ge1xuICAgICAgLy8gQ2hlY2sgdmFyaWFibGVzIGFuZCByZW5kZXIgYmFzZSB0ZW1wbGF0ZVxuICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucywgdmFyaWFibGVzLCB0eXBlKXtcbiAgICAgICAgLy8gVmFsaWRhdGUgdmFyYWlibGVzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFyaWFibGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYoIW9wdGlvbnNbdmFyaWFibGVzW2ldXSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUeXBlIC0gMCAtIG9ubHkgcHJvZmlsZVxuXG4gICAgICAgIC8vIFR5cGUgLSAxIC0gcHJvZmlsZSBhbmQgYWNpdGl2aXR5IGZlZWRcbiAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlc1sncGFyZW50VHBsJ10se1xuICAgICAgICAgIHR5cGU6IHR5cGVcbiAgICAgICAgfSksb3B0aW9ucy5zZWxlY3Rvcik7XG5cbiAgICAgICAgLy8gU2V0IGxpbWl0IHZhbHVlXG4gICAgICAgIG9wdGlvbnMubGltaXQgPSBnaXRNZXRob2RzLnNldExpbWl0KG9wdGlvbnMubGltaXQpO1xuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgIH0sXG5cbiAgICAgIC8vIENoZWNrIGlmIHZhbHVlIGlzIGludGVnZXJcbiAgICAgIGNoZWNrSW50ZWdlcjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gcGFyc2VJbnQodmFsdWUsIDEwKSlcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIEdldCB0aGUgcmVuZGVyZWQgdGVtcGxhdGUgd2l0aCBkYXRhXG4gICAgICBnZXRSZW5kZXJlZEhUTUw6IGZ1bmN0aW9uICh0ZW1wbGF0ZSwgZGF0YSkge1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgIHJldHVybiBfLnRlbXBsYXRlKHRlbXBsYXRlKShkYXRhKTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgIHJldHVybiBfLnRlbXBsYXRlKHRlbXBsYXRlKSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICAvLyBSZW5kZXIgVXNlciBwcm9maWxlIEhUTUxcbiAgICAgIGdldFVzZXJQcm9maWxlSFRNTDogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpe1xuICAgICAgICBnaXRNZXRob2RzLnJlbmRlckNvbnRlbnQoZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzLnVzZXJQcm9maWxlVHBsLCBkYXRhKSwgb3B0aW9ucy5zZWxlY3RvciwnLmd0LWhlYWRlcicpO1xuICAgICAgfSxcblxuICAgICAgLy8gUmVuZGVyIHRoZSByZXBvc2l0b3J5IHByb2ZpbGUgSFRNTCB3aXRoIGxhbmd1YWdlIHN0YXRzXG4gICAgICBnZXRSZXBvUHJvZmlsZUhUTUw6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKXtcbiAgICAgICAgdmFyIGxhbmd1YWdlVXJsID0gZ2l0QXBpVXJsICsgJ3JlcG9zLycgKyBvcHRpb25zLnVzZXJuYW1lICsnLycrIG9wdGlvbnMucmVwb25hbWUgKyAnL2xhbmd1YWdlcyc7XG4gICAgICAgIC8vIFJlbmRlciB0ZW1wbGF0ZVxuICAgICAgICBnaXRNZXRob2RzLnJlbmRlckNvbnRlbnQoZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzLnJlcG9Qcm9maWxlVHBsLCBkYXRhKSwgb3B0aW9ucy5zZWxlY3RvciwnLmd0LWhlYWRlcicpO1xuICAgICAgICAvLyBGZXRjaCBsYW5ndWFnZSBzdGF0IGZvciByZXBvXG4gICAgICAgIGdpdE1ldGhvZHMuZ2V0RGF0YShsYW5ndWFnZVVybCwgb3B0aW9ucywgZ2l0TWV0aG9kcy5nZXRMYW5ndWFnZUhUTUwpO1xuICAgICAgfSxcblxuICAgICAgLy8gUmVuZGVyIG9yZ2FuaXphdGlvbiBwcm9maWxlIEhUTUxcbiAgICAgIGdldE9yZ1Byb2ZpbGVIVE1MOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucyl7XG4gICAgICAgIGdpdE1ldGhvZHMucmVuZGVyQ29udGVudChnaXRNZXRob2RzLmdldFJlbmRlcmVkSFRNTChnaXRUZW1wbGF0ZXMub3JnUHJvZmlsZVRwbCwgZGF0YSksIG9wdGlvbnMuc2VsZWN0b3IsJy5ndC1oZWFkZXInKTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIFJlbmRlciByZWNlbnQgcHVibGljIGFjdGl2aXRpZXMgb2YgdXNlci9yZXBvL29yZ2FuaXphdGlvblxuICAgICAgZ2V0UHVibGljQWN0aXZpdHlIVE1MOiBmdW5jdGlvbiAoZGF0YSxvcHRpb25zKSB7XG4gICAgICAgIHZhciBodG1sID0gJyc7XG4gICAgICAgIC8vIEdldCBtaW4gb2YgbGltaXQgb2YgZGF0YSBzaXplXG4gICAgICAgIHZhciBsZW5ndGggPSAob3B0aW9ucy5saW1pdCA8IGRhdGEubGVuZ3RoKT8gb3B0aW9ucy5saW1pdCA6IGRhdGEubGVuZ3RoO1xuXG4gICAgICAgIGlmIChsZW5ndGg9PTApIHtcbiAgICAgICAgICAvLyBJZiBubyBhY3Rpdml0eSBpbiBsYXN0IDkwIGRheXNcbiAgICAgICAgICBodG1sICs9IGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlc1snbm9BY3Rpdml0eVRwbCddKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgIC8vIExvb3Agb3ZlciBhbGwgdGhlIGFjdGl2aXRpZXNcbiAgICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gZGF0YVtpbmRleF07XG4gICAgICAgICAgICB2YXIgcGF5bG9hZCA9IGFjdGl2aXR5LnBheWxvYWQ7XG5cbiAgICAgICAgICAgIC8vIEdldCBhdHRyaWJ1dGVzIGNvbW1vbiB0byBhbGwgYWN0aXZpdGllc1xuICAgICAgICAgICAgYWN0aXZpdHkudGltZVN0cmluZyA9IGdpdE1ldGhvZHMubWlsbGlzZWNvbmRzVG9TdHIobmV3IERhdGUoKSAtIG5ldyBEYXRlKGFjdGl2aXR5LmNyZWF0ZWRfYXQpKTtcbiAgICAgICAgICAgIGFjdGl2aXR5LnVzZXJMaW5rID0gZ2l0TWV0aG9kcy5nZXRHaXRIdWJMaW5rKGFjdGl2aXR5LmFjdG9yLmxvZ2luLCBhY3Rpdml0eS5hY3Rvci5sb2dpbik7XG4gICAgICAgICAgICBhY3Rpdml0eS5yZXBvTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUsIGFjdGl2aXR5LnJlcG8ubmFtZSk7XG5cbiAgICAgICAgICAgIC8vIEdldCB0aGUgYnJhbmNoIG5hbWVcbiAgICAgICAgICAgIGFjdGl2aXR5LmJyYW5jaExpbmsgPSAnJztcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLnJlZikge1xuICAgICAgICAgICAgICBpZiAocGF5bG9hZC5yZWYuc3Vic3RyaW5nKDAsIDExKSA9PT0gJ3JlZnMvaGVhZHMvJykge1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5LmJyYW5jaCA9IHBheWxvYWQucmVmLnN1YnN0cmluZygxMSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHkuYnJhbmNoID0gcGF5bG9hZC5yZWY7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYWN0aXZpdHkuYnJhbmNoTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL3RyZWUvJyArIGFjdGl2aXR5LmJyYW5jaCwgYWN0aXZpdHkuYnJhbmNoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBIVE1MIG9mIHNlbGVjdGVkIGFjdGl2aXR5IHR5cGVcbiAgICAgICAgICAgIHN3aXRjaChhY3Rpdml0eS50eXBlKXtcbiAgICAgICAgICAgICAgY2FzZSAnQ29tbWl0Q29tbWVudEV2ZW50JzogYWN0aXZpdHkuY29tbWVudExpbmsgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5jb21tZW50Lmh0bWxfdXJsLCBhY3Rpdml0eS5yZXBvLm5hbWUgKyAnQCcgK3BheWxvYWQuY29tbWVudC5jb21taXRfaWQuc3Vic3RyaW5nKDAsNikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdDcmVhdGVFdmVudCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ0RlbGV0ZUV2ZW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnRm9ya0V2ZW50JzogICBhY3Rpdml0eS5mb3JrTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhwYXlsb2FkLmZvcmtlZS5odG1sX3VybCwgcGF5bG9hZC5mb3JrZWUuZnVsbF9uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnR29sbHVtRXZlbnQnOiB2YXIgcGFnZSA9IHBheWxvYWQucGFnZXNbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkuYWN0aW9uVHlwZSA9IHBhZ2UuYWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5Lndpa2lNZXNzYWdlID0gYWN0aXZpdHkuYWN0aW9uVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFjdGl2aXR5LmFjdGlvblR5cGUuc2xpY2UoMSkgKyAnICc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkud2lraU1lc3NhZ2UgKz0gZ2l0TWV0aG9kcy5nZXRMaW5rKHBhZ2UuaHRtbF91cmwsIHBhZ2UudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdJc3N1ZUNvbW1lbnRFdmVudCc6IGFjdGl2aXR5LmNvbW1lbnRMaW5rPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5jb21tZW50Lmh0bWxfdXJsLCBhY3Rpdml0eS5yZXBvLm5hbWUgKyAnIycgK3BheWxvYWQuaXNzdWUubnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnSXNzdWVzRXZlbnQnOiBhY3Rpdml0eS5pc3N1ZVVybCA9IGdpdE1ldGhvZHMuZ2V0TGluayhwYXlsb2FkLmlzc3VlLmh0bWxfdXJsLCBhY3Rpdml0eS5yZXBvLm5hbWUgKyAnIycgK3BheWxvYWQuaXNzdWUubnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnTWVtYmVyRXZlbnQnOiBhY3Rpdml0eS5tZW1iZXJMaW5rID0gZ2l0TWV0aG9kcy5nZXRHaXRIdWJMaW5rKHBheWxvYWQubWVtYmVyLmxvZ2luLCBwYXlsb2FkLm1lbWJlci5sb2dpbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ1B1YmxpY0V2ZW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnUHVsbFJlcXVlc3RFdmVudCc6IGFjdGl2aXR5Lm1lcmdlUmVxdWVzdFVybCA9IGdpdE1ldGhvZHMuZ2V0TGluayhwYXlsb2FkLnB1bGxfcmVxdWVzdC5odG1sX3VybCwgYWN0aXZpdHkucmVwby5uYW1lICsgJyMnICtwYXlsb2FkLnB1bGxfcmVxdWVzdC5udW1iZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdQdWxsUmVxdWVzdFJldmlld0NvbW1lbnRFdmVudCc6IGFjdGl2aXR5LnB1bGxDb21tZW50VXJsPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5jb21tZW50Lmh0bWxfdXJsLCBhY3Rpdml0eS5yZXBvLm5hbWUgKyAnIycgK3BheWxvYWQucHVsbF9yZXF1ZXN0Lm51bWJlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ1B1c2hFdmVudCc6ICAgYWN0aXZpdHkuY29tbWl0c0h0bWwgPSBnaXRNZXRob2RzLmdldENvbW1pdHNIVE1MKGFjdGl2aXR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnUmVsZWFzZUV2ZW50JzogYWN0aXZpdHkudGFnTGluayA9IGdpdE1ldGhvZHMuZ2V0TGluayhwYXlsb2FkLnJlbGVhc2UuaHRtbF91cmwsIHBheWxvYWQucmVsZWFzZS50YWdfbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnppcExpbmsgPSBnaXRNZXRob2RzLmdldExpbmsocGF5bG9hZC5yZWxlYXNlLnppcGJhbGxfdXJsLCAnRG93bmxvYWQgU291cmNlIENvZGUgKHppcCknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdXYXRjaEV2ZW50JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEdldCBhY3Rpdml0eSBzcGVjaWZpYyBtZXNzYWdlXG4gICAgICAgICAgICBhY3Rpdml0eS5tZXNzYWdlID0gZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoZ2l0VGVtcGxhdGVzW2FjdGl2aXR5LnR5cGVdLCBhY3Rpdml0eSk7XG4gICAgICAgICAgICBodG1sICs9IGdpdE1ldGhvZHMuZ2V0UmVuZGVyZWRIVE1MKGdpdFRlbXBsYXRlc1snZ2l0QWN0aXZpdHlUcGwnXSxhY3Rpdml0eSk7XG5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVuZGVyIGNyZWF0ZWQgYWN0aXZpdHkgSFRNTCB0byBET01cbiAgICAgICAgZ2l0TWV0aG9kcy5yZW5kZXJDb250ZW50KGh0bWwsIG9wdGlvbnMuc2VsZWN0b3IsICcuZ3QtYWN0aXZpdHktY250Jyk7XG4gICAgICB9LFxuXG4gICAgICAvLyBGb3JtIEhUTUwgZm9yIGNvbW1pdHMgaW4gUHVzaEV2ZW50XG4gICAgICBnZXRDb21taXRzSFRNTDogZnVuY3Rpb24oYWN0aXZpdHkpe1xuICAgICAgICAgIHZhciBodG1sID0gJzx1bCBjbGFzcz1cImd0LWNvbW1pdC1saXN0XCI+JyxcbiAgICAgICAgICBsaUVsZW1lbnQsIHNoYUxpbmssIGNvbW1pdE1lc3NhZ2UsICBjb21taXQsIGluZGV4LFxuICAgICAgICAgIGNvbXBhcmVMaW5rID0gJycsXG4gICAgICAgICAgcGF5bG9hZCA9IGFjdGl2aXR5LnBheWxvYWQsXG4gICAgICAgICAgbGVuZ3RoID0gcGF5bG9hZC5jb21taXRzLmxlbmd0aCxcbiAgICAgICAgICBzaGFEaWZmID0gcGF5bG9hZC5iZWZvcmUgKyAnLi4uJyArIHBheWxvYWQuaGVhZDtcblxuICAgICAgICAgIC8vIEdldCBsaW5rcyBmb3IgMiBvciBsZXNzIGNvbW1pdFxuICAgICAgICAgIGZvcihpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKXtcbiAgICAgICAgICAgIGlmIChpbmRleD4xKSBicmVhaztcbiAgICAgICAgICAgIGNvbW1pdCA9IHBheWxvYWQuY29tbWl0c1tpbmRleF07XG4gICAgICAgICAgICAvLyBDcmVhdGUgY29tbWl0IGxpIGVsZW1lbnRcbiAgICAgICAgICAgIGxpRWxlbWVudCA9ICc8bGkgY2xhc3M9XCJndC1jb21taXQtaXRlbVwiID4nO1xuICAgICAgICAgICAgc2hhTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL2NvbW1pdC8nICsgY29tbWl0LnNoYSwgY29tbWl0LnNoYS5zdWJzdHJpbmcoMCwgNikpO1xuICAgICAgICAgICAgY29tbWl0TWVzc2FnZSA9ICc8c3BhbiBjbGFzcz1cImd0LWNvbW1pdC1tc2dcIj4nICsgY29tbWl0Lm1lc3NhZ2Uuc3Vic3RyaW5nKDAsMTUwKSArICc8L3NwYW4+JztcbiAgICAgICAgICAgIGxpRWxlbWVudCArPSBzaGFMaW5rXG4gICAgICAgICAgICBsaUVsZW1lbnQgKz0gY29tbWl0TWVzc2FnZTtcbiAgICAgICAgICAgIGxpRWxlbWVudCArPSAnPC9saT4nXG4gICAgICAgICAgICBodG1sICs9IGxpRWxlbWVudDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBHZXQgdGhlIGRpZmYgbGluayBiZXR3ZWVuIGNvbW1pdHNcbiAgICAgICAgICBpZiAobGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICBjb21wYXJlTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL2NvbXBhcmUvJyArIHNoYURpZmYsICdWaWV3IGNvbXBhcmlzb24gZm9yIHRoZXNlIDIgY29tbWl0cyAmcmFxdW87JywnZ3QtY29tcGFyZS1saW5rJyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPiAyKSB7XG4gICAgICAgICAgICBjb21wYXJlTGluayA9IGdpdE1ldGhvZHMuZ2V0R2l0SHViTGluayhhY3Rpdml0eS5yZXBvLm5hbWUgKyAnL2NvbXBhcmUvJyArIHNoYURpZmYsIChsZW5ndGgtMikrJyBtb3JlICcgKyBnaXRNZXRob2RzLmdldFBsdXJhbFdvcmQobGVuZ3RoLTIsJ2NvbW1pdCcpICsgJyAmcmFxdW87JywnZ3QtY29tcGFyZS1saW5rJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaHRtbCArPSAnPC91bD4nXG4gICAgICAgICAgaHRtbCArPSBjb21wYXJlTGluaztcblxuICAgICAgICAgIHJldHVybiBodG1sO1xuICAgICAgfSxcblxuICAgICAgLy8gVXRpbGl0eSBmb3IgYXN5bmNocm9ub3VzIEFKQVggY2FsbHNcbiAgICAgIGdldERhdGE6IGZ1bmN0aW9uKHVybCwgb3B0aW9ucywgY2FsbGJhY2spe1xuICAgICAgICB2YXIgZGF0YSwgcmVxdWVzdDtcbiAgICAgICAgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgIC8vIFVzZSBPQXV0aCB0b2tlbiBpZiBhdmFpbGFibGVcbiAgICAgICAgaWYgKG9wdGlvbnMuT0F1dGgpIHtcbiAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0F1dGhvcml6YXRpb24nLCAnVG9rZW4gJyArIG9wdGlvbnMuT0F1dGgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID49IDIwMCAmJiByZXF1ZXN0LnN0YXR1cyA8IDQwMCl7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhLCBvcHRpb25zKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVW5zdWNjZXNzZnVsIHJlcXVlc3QgLSBpbnZhbGlkIHVzZXJuYW1lLyBsb3N0IGludGVybmV0IGNvbm5lY3Rpdml0eS8gZXhjZWVkZWQgcmF0ZSBsaW1pdC8gQVBJIFVSTCBub3QgZm91bmRcbiAgICAgICAgICAgIGdpdE1ldGhvZHMucmVuZGVyQ29udGVudChnaXRNZXRob2RzLmdldFJlbmRlcmVkSFRNTChnaXRUZW1wbGF0ZXMubm90Rm91bmRUcGwsIGRhdGEpLCBvcHRpb25zLnNlbGVjdG9yLCcuZ3QtY29udGFpbmVyJyk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBjb25uZWN0aW5nIHRvIEdpdEh1YiBBUEkuJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBjb25uZWN0aW5nIHRvIEdpdEh1YiBBUEkuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVxdWVzdC5zZW5kKCk7XG4gICAgICB9LFxuXG4gICAgICAvLyBHZXQgYW5jaG9yIHRhZyBIVE1MIGZvciBVUkxcbiAgICAgIGdldExpbms6IGZ1bmN0aW9uKHVybCwgdGl0bGUsIGNzc0NsYXNzKSB7XG4gICAgICAgIGlmICghdGl0bGUpXG4gICAgICAgICAgdGl0bGUgPSB1cmw7XG4gICAgICAgIGlmICh0eXBlb2YoY3NzQ2xhc3MpID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICBjc3NDbGFzcyA9ICcnO1xuICAgICAgICByZXR1cm4gZ2l0TWV0aG9kcy5nZXRSZW5kZXJlZEhUTUwoJzxhIGNsYXNzPVwiJyArIGNzc0NsYXNzICsgJ1wiIGhyZWY9XCI8JT11cmwlPlwiIHRhcmdldD1cIl9ibGFua1wiPjwlPXRpdGxlJT48L2E+JywgeyB1cmw6IHVybCwgdGl0bGU6IHRpdGxlIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gR2V0IGFuY2hvciB0YWcgSFRNTCBmb3Igbm9uLWdpdGh1YiBVUkxcbiAgICAgIGdldEdpdEh1Ykxpbms6IGZ1bmN0aW9uKHVybCwgdGl0bGUsIGNzc0NsYXNzKSB7XG4gICAgICAgIGlmICghdGl0bGUpXG4gICAgICAgICAgdGl0bGUgPSB1cmw7XG4gICAgICAgIGlmICh0eXBlb2YoY3NzQ2xhc3MpID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICBjc3NDbGFzcyA9ICcnO1xuICAgICAgICByZXR1cm4gZ2l0TWV0aG9kcy5nZXRMaW5rKCdodHRwczovL2dpdGh1Yi5jb20vJyArIHVybCwgdGl0bGUsIGNzc0NsYXNzKTtcbiAgICAgIH0sXG5cbiAgICAgIC8vICBPbmx5IGZvciBwbHVyYWxzIGVuZGluZyB3aXRoICdzJy4gWWVhaCEgdGhpcyBzdWNrcy5cbiAgICAgIGdldFBsdXJhbFdvcmQ6IGZ1bmN0aW9uIChjb3VudCwgd29yZCkge1xuICAgICAgICBpZiAoY291bnQgIT09IDEpIHJldHVybiB3b3JkICsgJ3MnO1xuICAgICAgICByZXR1cm4gd29yZDtcbiAgICAgIH0sXG5cbiAgICAgIC8vIEdldCByZXBvc2l0b3J5IGxhbmd1YWdlIHN0YXQgSFRNTFxuICAgICAgZ2V0TGFuZ3VhZ2VIVE1MOiBmdW5jdGlvbihkYXRhLCBvcHRpb25zKXtcbiAgICAgICAgdmFyIGxhbmd1YWdlRGF0YSA9IFtdLCBzdW0gPSAwLFxuICAgICAgICBwZXJjZW50YWdlLCBsYW5ndWFnZUh0bWwgPSAnJztcbiAgICAgICAgLy8gR2V0IHRvdGFsIHNpemUgYW5kIGNyZWF0ZSBhcnJheSB3aGljaCBjYW4gYmUgc29ydGVkIGJ5IHZhbHVlXG4gICAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSwga2V5KXtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgICBkYXRhLmxhbmd1YWdlID0ga2V5O1xuICAgICAgICAgICAgZGF0YS5zaXplID0gdmFsdWU7XG4gICAgICAgICAgICBsYW5ndWFnZURhdGEucHVzaChkYXRhKTtcbiAgICAgICAgICAgIHN1bSArPSB2YWx1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU29ydCBsYW5ndWFnZXMgYnkgdXNhZ2UgaW4gcmVwb1xuICAgICAgICBsYW5ndWFnZURhdGEgPSBsYW5ndWFnZURhdGEuc29ydChmdW5jdGlvbihhLCBiKXtyZXR1cm4gYi5zaXplIC0gYS5zaXplfSk7XG5cbiAgICAgICAgLy8gR2V0IEhUTUwgZm9yIGVhY2ggbGFuZ3VhZ2VcbiAgICAgICAgXy5lYWNoKGxhbmd1YWdlRGF0YSwgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICBwZXJjZW50YWdlID0gKHBhcnNlSW50KGVsZW1lbnQuc2l6ZSkvc3VtKjEwMCkudG9GaXhlZCgxKTtcbiAgICAgICAgICAgIGxhbmd1YWdlSHRtbCArPSc8ZGl2IGNsYXNzPVwiZ3QtcmVwby1sZy1jbnRcIiBzdHlsZT1cIndpZHRoOiAnKyBwZXJjZW50YWdlICsnJTsgYmFja2dyb3VuZDogIycrIGdpdE1ldGhvZHMuZ2V0UmFuZG9tQ29sb3IoKSArJzsgXCIgPicrXG4gICAgICAgICAgICAgICAgICAgJyA8ZGl2IGNsYXNzPVwiZ3QtcmVwby1sZy1uYW1lXCIgZGF0YS10aXRsZT1cIicrIGVsZW1lbnQubGFuZ3VhZ2UgKycgKCcrIHBlcmNlbnRhZ2UgKyclKVwiPiA8L2Rpdj4gPC9kaXY+JztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGxhbmd1YWdlIEhUTUwgdG8gdGhlIGNvbnRhaW5lclxuICAgICAgICBnaXRNZXRob2RzLnJlbmRlckNvbnRlbnQobGFuZ3VhZ2VIdG1sLCBvcHRpb25zLnNlbGVjdG9yLCcuZ3QtcmVwby1sZy1zdGF0Jyk7XG4gICAgICB9LFxuXG4gICAgICAvLyBHZXQgcmFuZG9tIEhFWCBjb2RlIGZvciBjb2xvclxuICAgICAgZ2V0UmFuZG9tQ29sb3I6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMiwgOCk7XG4gICAgICB9LFxuXG4gICAgICAvLyBDb252ZXJ0IG1pbGxpc2Vjb25kcyB0byB0aW1lIHN0cmluZ1xuICAgICAgbWlsbGlzZWNvbmRzVG9TdHI6IGZ1bmN0aW9uKG1pbGxpc2Vjb25kcykge1xuICAgICAgICBmdW5jdGlvbiBudW1iZXJFbmRpbmcobnVtYmVyKSB7XG4gICAgICAgICAgcmV0dXJuIChudW1iZXIgPiAxKSA/ICdzIGFnbycgOiAnIGFnbyc7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRlbXAgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kcyAvIDEwMDApO1xuXG4gICAgICAgIHZhciB5ZWFycyA9IE1hdGguZmxvb3IodGVtcCAvIDMxNTM2MDAwKTtcbiAgICAgICAgaWYgKHllYXJzKSByZXR1cm4geWVhcnMgKyAnIHllYXInICsgbnVtYmVyRW5kaW5nKHllYXJzKTtcblxuICAgICAgICB2YXIgbW9udGhzID0gTWF0aC5mbG9vcigodGVtcCAlPSAzMTUzNjAwMCkgLyAyNTkyMDAwKTtcbiAgICAgICAgaWYgKG1vbnRocykgcmV0dXJuIG1vbnRocyArICcgbW9udGgnICsgbnVtYmVyRW5kaW5nKG1vbnRocyk7XG5cbiAgICAgICAgdmFyIGRheXMgPSBNYXRoLmZsb29yKCh0ZW1wICU9IDI1OTIwMDApIC8gODY0MDApO1xuICAgICAgICBpZiAoZGF5cykgcmV0dXJuIGRheXMgKyAnIGRheScgKyBudW1iZXJFbmRpbmcoZGF5cyk7XG5cbiAgICAgICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcigodGVtcCAlPSA4NjQwMCkgLyAzNjAwKTtcbiAgICAgICAgaWYgKGhvdXJzKSByZXR1cm4gJ2Fib3V0ICcgKyBob3VycyArICcgaG91cicgKyBudW1iZXJFbmRpbmcoaG91cnMpO1xuXG4gICAgICAgIHZhciBtaW51dGVzID0gTWF0aC5mbG9vcigodGVtcCAlPSAzNjAwKSAvIDYwKTtcbiAgICAgICAgaWYgKG1pbnV0ZXMpIHJldHVybiBtaW51dGVzICsgJyBtaW51dGUnICsgbnVtYmVyRW5kaW5nKG1pbnV0ZXMpO1xuXG4gICAgICAgIHZhciBzZWNvbmRzID0gdGVtcCAlIDYwO1xuICAgICAgICBpZiAoc2Vjb25kcykgcmV0dXJuIHNlY29uZHMgKyAnIHNlY29uZCcgKyBudW1iZXJFbmRpbmcoc2Vjb25kcyk7XG5cbiAgICAgICAgcmV0dXJuICdqdXN0IG5vdyc7XG4gICAgICB9LFxuXG4gICAgICAvLyBSZW5kZXIgdGhlIGNvbnRlbnQgdG8gdGhlIHNlbGVjdG9yIG9yIHN1YlNlbGVjdG9yXG4gICAgICByZW5kZXJDb250ZW50OiBmdW5jdGlvbihjb250ZW50LCBzZWxlY3Rvciwgc3ViU2VsZWN0b3Ipe1xuICAgICAgICB2YXIgc2VsZWN0b3JEaXZzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RvckRpdnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAvLyBpZiBzdWJTZWxlY3RvciBpcyBwYXNzZWQsIGZpbmQgaXRcbiAgICAgICAgICBpZiAoc3ViU2VsZWN0b3IpIHtcbiAgICAgICAgICAgIHNlbGVjdG9yRGl2ID0gc2VsZWN0b3JEaXZzW2ldLnF1ZXJ5U2VsZWN0b3Ioc3ViU2VsZWN0b3IpO1xuICAgICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgIHNlbGVjdG9yRGl2ID0gc2VsZWN0b3JEaXZzW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWxlY3RvckRpdi5pbm5lckhUTUwgPSBjb250ZW50O1xuICAgICAgICB9XG5cbiAgICAgIH0sXG5cbiAgICAgIC8vIFNldCByZW5kZXIgbGltaXQgZm9yIGFjdGl2aXRpZXMgLSBkZWZhdWx0IGlzIDMwXG4gICAgICBzZXRMaW1pdDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICB2YXIgbGltaXQ7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2l0TWV0aG9kcy5jaGVja0ludGVnZXIobGltaXQgPSBwYXJzZUludCh2YWx1ZSwgMTApKSkge1xuICAgICAgICAgIGxpbWl0ID0gKGxpbWl0PjMwKT8zMDpsaW1pdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsaW1pdCA9IDMwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW1pdDtcbiAgICAgIH1cblxuICAgIH07XG5cblxuICAgIHJldHVybiBHaXRodWI7XG59KSk7XG4iXSwiZmlsZSI6ImdpdGh1Yi5taW4uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
