// main.js //
// Wszystko wrzucamy tu

// https://github.com/eduardomb/scroll-up-bar/

(function($) {
    'use strict';
  
    var _destroyFn;
  
    $.scrollupbar = function($bar, options) {
      // Default options
      options = $.extend({
        enterViewport: $.noop,
        fullyEnterViewport: $.noop,
        exitViewport: $.noop,
        partiallyExitViewport: $.noop
      }, options);
  
      function isFullyInViewport() {
        return $window.scrollTop() <= $bar.offset().top;
      }
  
      function isInViewport() {
        return $window.scrollTop() < $bar.offset().top + $bar.outerHeight();
      }
  
      var $window = $(window),
          $document = $(document),
          minY = $bar.css('position') == 'fixed' ? 0 : $bar.offset().top,
          lastY = $window.scrollTop(), // Use last Y to detect scroll direction.
          initialPosTop = $bar.position().top,
          timeout;
  
      $.scrollupbar.isInViewport = isInViewport();
      $.scrollupbar.isFullyInViewport = isFullyInViewport();
  
      $window.on('scroll.scrollupbar', function() {
        var y = $window.scrollTop(),
            barHeight = $bar.outerHeight();
  
        // Ignore elastic scrolling.
        if (y < 0 || y > ($document.height() - $window.height())) {
          return;
        }
  
        // Cancel the event fired by the previous scroll.
        if (timeout) {
          clearTimeout(timeout);
        }
  
        if (y < lastY) { // Scrolling up
          // If the bar is hidden, place it right above the top frame.
          if (!$.scrollupbar.isInViewport && lastY - barHeight >= minY) {
            $bar.css('top', lastY - barHeight);
            $.scrollupbar.isInViewport = true;
            options.enterViewport();
          }
  
          // Scrolls up bigger than the bar's height fixes the bar on top.
          if (isFullyInViewport()) {
            if (y >= minY) {
              $bar.css({
                'position': 'fixed',
                'top': 0
              });
            } else {
              $bar.css({
                'position': 'absolute',
                'top': initialPosTop
              });
            }
  
            if (!$.scrollupbar.isFullyInViewport) {
              $.scrollupbar.isFullyInViewport = true;
              options.fullyEnterViewport();
            }
          }
  
          // Fire an event to reveal the entire bar after 400ms if the scroll
          // wasn't big enough.
          timeout = setTimeout(function() {
            if (!$.scrollupbar.isFullyInViewport) {
              $bar.css({
                'position': 'fixed',
                'top': $bar.offset().top - y
              });
  
              $bar.animate({'top': 0}, 100, function() {
                $.scrollupbar.isFullyInViewport = true;
                options.fullyEnterViewport();
              });
            }
          }, 400);
        } else if (y > lastY) { // Scrolling down
          // Unfix the bar allowing it to scroll with the page.
          if ($.scrollupbar.isFullyInViewport) {
            $bar.css({
              // translate3d fixes iOS invisible element bug when changing
              // position values while scrolling.
              'transform': 'translate3d(0, 0, 0)',
              'position': 'absolute',
              'top': lastY > minY ? lastY : initialPosTop
            });
  
            if (!isFullyInViewport()) {
              $.scrollupbar.isFullyInViewport = false;
              options.partiallyExitViewport();
            }
          }
  
          if ($.scrollupbar.isInViewport && !isInViewport()) {
            $.scrollupbar.isInViewport = false;
            options.exitViewport();
          }
  
          // Fire an event to hide the entire bar after 400ms if the scroll
          // wasn't big enough.
          timeout = setTimeout(function() {
            if (isInViewport() && y - barHeight >= minY) {
              $bar.animate({'top': y - barHeight}, 100, function() {
                $.scrollupbar.isInViewport = false;
                options.exitViewport();
              });
            }
          }, 400);
        }
  
        lastY = y;
      });
  
      _destroyFn = function() {
        // Unbind all listeners added by scrollupbar plugin
        $window.off('.scrollupbar');
  
        // Restore original bar position.
        $bar.css({
          'position': 'absolute',
          'top': initialPosTop
        });
      };
  
      return $bar;
    };
  
    $.scrollupbar.destroy = function() {
      if (_destroyFn) {
        return _destroyFn();
      }
    };
  
    $.fn.scrollupbar = function(options) {
      return $.scrollupbar(this, options);
    };
  })(jQuery);

jQuery(function($) {

    /**
     * Dropy
     * http://codepen.io/Tombek/pen/OPvpLe
     */
    var dropy = {
      $dropys: null,
      openClass: 'open',
      selectClass: 'selected',
      init: function(){
        var self = this;
    
        self.$dropys = $('.dropy');
        self.eventHandler();
      },
      eventHandler: function(){
        var self = this;
    
        // Opening a dropy
        self.$dropys.find('.dropy__title').click(function(){
          self.$dropys.removeClass(self.openClass);
          $(this).parents('.dropy').addClass(self.openClass);
        });
    
        // Click on a dropy list
        self.$dropys.find('.dropy__content ul li a').click(function(){
          var $that = $(this);
          var $dropy = $that.parents('.dropy');
          var $input = $dropy.find('input');
          var $title = $(this).parents('.dropy').find('.dropy__title span');
    
          // Remove selected class
          $dropy.find('.dropy__content a').each(function(){
            $(this).removeClass(self.selectClass);
          });
    
          // Update selected value
          $title.html($that.html());
          $input.val($that.attr('data-value')).trigger('change');
    
          // If back to default, remove selected class else addclass on right element
          if($that.hasClass('dropy__header')){
            $title.removeClass(self.selectClass);
            $title.html($title.attr('data-title'));
          }
          else{
            $title.addClass(self.selectClass);
            $that.addClass(self.selectClass);
          }
    
          // Close dropdown
          $dropy.removeClass(self.openClass);
        });
    
        // Close all dropdown onclick on another element
        $(document).bind('click', function(e){
            if (! $(e.target).parents().hasClass('dropy')){ self.$dropys.removeClass(self.openClass); }
        });
      }
    };
    
    $(function(){
      dropy.init();
    });

       function cardExcerpt() {
        $(".card__excerpt").text(function(index, currentText) {
          return currentText.substr(0, 125) + '\u2026';
        });
      }
      cardExcerpt();

    // Pakuje mniejsze obrazki bez podpisu w <figure> //
    // Jeśli obrazek ma tytuł, tym się zajmuje php funkcja w project-functions.php
    $('.project__content p').each(function(index) {
      var some_img = $(this).find('img');
      var width = some_img.width();
      if (width < 980) {
        some_img.wrap("<figure></figure>");
      }
    });

    // Notyfikacje, powiadomienia //
    $(".note-close").click(function() {
      $(this).parent()
        .animate({
          opacity: 0
        }, 250, function() {
          $(this)
            .animate({
              marginBottom: 0
            }, 250)
            .children()
            .animate({
              padding: 0
            }, 250)
            .wrapInner("<div />")
            .children()
            .slideUp(250, function() {
              $(this).closest(".note").remove();
            });
        });
    });

    (function() {
        var recruitment = document.getElementById('recruitment');
        if (recruitment) {
            recruitment.style.backgroundImage = "url('" + recruitment.dataset.bg + "')";
        }
    })();

    //// = partials/show-nicknames.js

    $(document).ready(function(){
        // $("#nav-mobile").html($("#nav-main").html());
        $("#nav-trigger .navicon-button").click(function(){
          console.info('Burger clicked');
            if ($("#nav ul").hasClass("nav__menu--expanded")) {
                $("#nav ul").removeClass("nav__menu--expanded").slideUp(250);
                $(this).removeClass("open");
            } else {
                $("#nav ul").addClass("nav__menu--expanded").slideDown(250);
                $(this).addClass("open");
            }
        });
    });

    (function() {
        // Żeby tooltip nie klikał
        $('.tooltip').on('click', function(e) {
            e.preventDefault();
        });
    
        $('[data-github]').hover(function(e) {
            loadGithub();
            $(this).children('.tooltip').addClass('tooltip--active');
        }, function(e) {
            $(this).children('.tooltip').removeClass('tooltip--active');
        });
    
        $('[data-lastfm]').hover(function(e) {
            loadLastfm();
            $(this).children('.tooltip').addClass('tooltip--active');
        }, function(e) {
            $(this).children('.tooltip').removeClass('tooltip--active');
        });
    })();

    function loadGithub() {
        // Pobiera url z hrefa
        var profileUrl = $('a[data-github]').attr('href');
        // Odpowiednio obcina go do username
        var username = profileUrl.substr(19);
        // Dodaje username do url zapytania
        var requri = 'https://api.github.com/users/' + username;
        // Sprawdza, czy tooltip pusty, by nie generować nowych zapytań
        // i nie dodawać po raz kolejny dane do tooltipa
        if ($('[data-github] .tooltip').is(':empty')) {
            requestJSON(requri, function(json) {
                if (json.message === "Nie znaleziono" || username === '') {
                    $('[data-github] .tooltip').html("<h2>Brak informacji</h2>");
                } else {
                    username = json.login;
                    var profileurl = json.html_url;
                    var reposnum = json.public_repos;
                    var aviurl = json.avatar_url;
    
    
                    var outhtml = '<div class="gh">' +
                        '<h4 class="gh__name"><a class="link" href="' + profileurl + '"><img class="gh__avatar" src="' + aviurl + '">@' + username + '</a></h4>';
                    outhtml = outhtml + '<span class="gh__repos">Repozytoriów: ' + reposnum + '</span><hr/></div>';
                    $('[data-github] .tooltip').append(outhtml);
    
                } // end else statement
            }); // end requestJSON Ajax call
        }
    
        function requestJSON(url, callback) {
            $.ajax({
                url: url,
                complete: function(xhr) {
                    callback.call(null, xhr.responseJSON);
                }
            });
        }
    }

    function loadLastfm() {
        // Pobiera url z hrefa
        var profileUrl = $('a[data-lastfm]').attr('href');
        // Odpowiednio obcina go do username
        var username = profileUrl.substr(27);
        var baseUrl = 'http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks';
        var api_key = '299020c062c481f083ecd0276c315e3a';
    
        var requestUrl = baseUrl + '&user=' + username + '&api_key=' + api_key + '&format=json';
        console.log(username);
        if ($('[data-lastfm] .tooltip').is(':empty')) {
            $.getJSON(requestUrl, function(data) {
                var artist = data.recenttracks.track[0].artist["#text"];
                var song = data.recenttracks.track[0]["name"];
                var cover = data.recenttracks.track[0].image[3]["#text"];
                if (cover === "") {
                    cover = "http://img2-ak.lst.fm/i/u/174s/4128a6eb29f94943c9d206c08e625904.png";
                }
                var outhtml = '<div class="lf"><img class="lf__cover" src="' + cover + '"/><div class="lf__trackInfo"><span class="lf__artist">' + artist + '</span><span class="lf__song">' + song + '</span></div></div>';
                $('[data-lastfm] .tooltip').append(outhtml);
            });
        }
    }

    $(function() {
        $('a[href*="#"]:not(.link--tab)').click(function() {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    $('html, body').animate({
                        scrollTop: target.offset().top
                    }, 800);
                    return false;
                }
            }
        });
    });

    $(document).ready(function() {
          var bLazy = new Blazy({
            offset: 20,
            selector: '.blazy',
            loadInvisible: false,
            breakpoints: [{
              width: 360, // Max-width
              src: 'data-src-small'
            }],
            success: function(element) {
              $(element).parent().removeClass('loading', 500);
              updateCounter();
            },
            error: function(element, msg) {
              if (msg === 'missing') {
                $(element).parent().removeClass('loading', 500); // Data-src is missing
                console.error("bLazy: data-src is missing");
              } else if (msg === 'invalid') {
                $(element).parent().removeClass('loading', 500);
                // Data-src is invalid
                console.error("bLazy: data-src is invalid");
        
              }
            }
          });
          // not needed, only here to illustrate amount of loaded images
          var imageLoaded = 0;
        
          function updateCounter() {
            imageLoaded++;
            console.info("bLazy: Images loaded: %d", imageLoaded);
          }
        
          // tabs(bLazy);

        ////= member.js

        //Skraca imiona, by nie wychodziły za bloki
        $('.membercard__name a').each(function(index) {
            var a = $(this);
            if (a.html().length > 17) {
                var name = a.text();
                // console.log(name);
                var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
                // console.log(trimmed_name);
                a.text(trimmed_name);
                if (a.html().length > 17) {
                    a.parent().addClass('membercard__name--tooLong');
                }
            }
        });
        
        $('.membercardSmall__name a').each(function(index) {
            var length = $(this).html().length;
            if (length > 14) {
                var name = $(this).text();
                // console.log(name);
                var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
                // console.log(trimmed_name);
                $(this).text(trimmed_name);
            }
        });

        (function() {
            var recruitment = document.getElementById('recruitment');
            if (recruitment) {
                recruitment.style.backgroundImage = "url('" + recruitment.dataset.bg + "')";
            }
        })();

        (function() {
            var ajax_url = $('.global').attr('data-ajax-url');
            var post_offset = 0;
            var incNumber = 6; // ilość postów do załadowania
        
            var projects = (function(setProjects) {
                var loaded;
                var total;
                return {
                    incLoaded: function() {
                        loaded = loaded + incNumber;
                    },
                    getLoaded: function() {
                        return loaded;
                    },
                    setLoaded: function(setProjects) {
                        loaded = setProjects;
                    },
                    setTotal: function(setProjects) {
                        total = setProjects;
                    },
                    getTotal: function() {
                        return total;
                    }
                };
            })();
            var loadingButton = (function(button){
                return {
                    showSpinner: function(button) {
                        button.html('<div class="spinner"></div>');
                    },
                    showCaption: function(button) {
                        button.html('Zobacz starsze');
                    },
                    hide: function(button) {
                        button.hide();
                    }
                };
            })();
        
            $('#load_more_posts').on('click', loadMore);
            $('#load_more').on('click', loadProjects);
        
            function loadMore() {
                console.log('Clicked load_more');
                $(this).html('<div class="spinner"></div>');
                post_offset = parseInt(post_offset) + 6;
                $.ajax({
                    url: ajax_url,
                    type: 'POST',
                    data: {
                        action: 'load_posts',
                        post_offset: post_offset,
                    },
                    success: function(data) {
                        $('#load_more_posts').html('Zobacz starsze');
                        $('#posts .cardsWrapper').append(data);
                        console.info('Ajax: OK');
                        bLazy.revalidate();
                        cardExcerpt();
                    }
                });
            }
        
            function loadProjects() {
                var thisParent = $(this).parent();
                // ustawia całkowitą liczbę danych projektów
                projects.setTotal(thisParent.attr('data-total'));
                // jeśli jeszcze nie pobierano ajaxem projektów, to ustawia wartość
                // równą już wyświetlonych
                if (!projects.getLoaded()) {
                    projects.setLoaded(thisParent.find('.card').length);
                    console.log('Already:', projects.getLoaded());
                }
                var projects_status = thisParent.attr('data-projects-status');
                post_offset = parseInt(post_offset) + incNumber;
        
                if (projects.getTotal() > projects.getLoaded()) {
                    loadingButton.showSpinner($('#load_more'));
                    $.ajax({
                        url: ajax_url,
                        type: 'POST',
                        data: {
                            action: 'load_projects',
                            post_offset: post_offset,
                            projects_status: projects_status,
                        },
                        success: function(data) {
                            thisParent.children('.cardsWrapper').append(data);
                            bLazy.revalidate();
                            cardExcerpt();
                            loadingButton.showCaption($('#load_more'));
                            projects.incLoaded();
                            console.info('Ajax: Loaded more %s projects: %d/%d', projects_status, projects.getLoaded(), projects.getTotal());
                            if (projects.getTotal() <= projects.getLoaded()) {
                                loadingButton.hide($('#load_more'));
                            }
                        }
                    });
                } else {
                    return false;
                }
            }
        })();

        function initTopbar() {
            $('.topbarWrapper').scrollupbar({
                enterViewport: function() {
                    $('.topbarWrapper').addClass('topbarWrapper--visible');
                },
                fullyEnterViewport: function() {
                    $('#last-event').text('fullyEnterViewport');
                },
                exitViewport: function() {
                    $('#last-event').text('exitViewport');
                },
                partiallyExitViewport: function() {
                    $('#last-event').text('partiallyExitViewport');
                }
            });
        }
            initTopbar();
        
        if ($(window).width() < 750) {
            $.scrollupbar.destroy('.topbarWrapper');
        }
        
        $(window).scroll(function(event) {
            // didScroll = true;
            var st = $(this).scrollTop();
            // Gdy jesteśmy na samej górze, to pokazyjemy całe logo
            if (st === 0) {
                $('.topbarWrapper').removeClass('topbarWrapper--visible');
            }
        });

        var tabs = (function() {
            var currentTab;
            return {
                init: function() {
                    // pobieramy href
                    currentTab = $('.tabsMenu__item--current .link--tab').attr('href');
                    // href jest jednocześnie id odpowiedniego tabu, który wyświetlamy
                    $(currentTab).addClass('tab__content--visible');
                    // ładujemy obrazki
                    bLazy.load($(".blazy", currentTab), true);
                    console.info('Tabs initiated:', currentTab);
                },
                reset: function() {
                    // Z tym #tabsReset, to taki hack. Wykorzystywany dlatego, że
                    // po kliknięciu chowają się wszystkie taby, oprócz tej z odpowiednim id
                    currentTab = $('#tabsReset .link--tab').attr('href');
                    $(currentTab).removeClass("tab__content--hidden").addClass("tab__content--visible");
                    console.info('Tabs initiated:', currentTab);
                }
            };
        })();
        tabs.init();
        
        $(".global").on('click', '.link--tab', function(event) {
            // wyłącza domyślne przejście na adres linku
            event.preventDefault();
            // dodaje klasę do <li>
            $(this).parent().addClass("tabsMenu__item--current");
            // usuwa klasę z <li>
            $(this).parent().siblings().removeClass("tabsMenu__item--current");
            // pobieramy id z hrefu
            var tab = $(this).attr("href");
            // jeśli blok nie ma takiego id, to chowamy go
            $(".tab__content").not(tab).addClass("tab__content--hidden").removeClass("tab__content--visible");
            // a jeśli ma, to pokazujemy
            $(tab).removeClass("tab__content--hidden").addClass("tab__content--visible");
            // ładujemy obrazki w bloku z odpowiednim id
            bLazy.load($(".blazy", tab), true);
        });

        // http://codepen.io/jakubtursky/pen/vEwZop
        	$.fn.jQuerySimpleCounter = function( options ) {
        	    var settings = $.extend({
        	        start:  0,
        	        end:    100,
        	        easing: 'swing',
        	        duration: 400,
        	        complete: ''
        	    }, options );
        
        	    var thisElement = $(this);
        
        	    $({count: settings.start}).animate({count: settings.end}, {
        			duration: settings.duration,
        			easing: settings.easing,
        			step: function() {
        				var mathCount = Math.ceil(this.count);
        				thisElement.children('.counters__count').text(mathCount);
        			},
        			complete: settings.complete
        		});
        	};
        
        // var finishedNumber = $('#finished').data('finished');
        // console.log(finishedNumber);
        // $('#finished').jQuerySimpleCounter({end: finishedNumber, duration: 3000});
        // $('#number2').jQuerySimpleCounter({end: 55,duration: 3000});
        // $('#number3').jQuerySimpleCounter({end: 359,duration: 2000});
        // $('#number4').jQuerySimpleCounter({end: 246,duration: 2500});

        (function() {
            // https://marcin.laber.pl/2014/09/odmiana-liczebnikow-w-javascript/
            var num = function(value, numerals, wovalue) {
                var t0 = value % 10,
                    t1 = value % 100,
                    vo = [];
                if (wovalue !== true)
                    vo.push(value);
                if (value === 1 && numerals[1])
                    vo.push(numerals[1]);
                else if ((value === 0 || (t0 >= 0 && t0 <= 1) || (t0 >= 5 && t0 <= 9) || (t1 > 10 && t1 < 20)) && numerals[0])
                    vo.push(numerals[0]);
                else if (((t1 < 10 || t1 > 20) && t0 >= 2 && t0 <= 4) && numerals[2])
                    vo.push(numerals[2]);
                return vo[1];
            };
        
            $('.counter').each(function(index) {
                var status = $(this).attr('id');
                var count = parseInt($(this).children('a').html());
                console.log(count, status);
                if (status === 'finished') {
                    $(this).find('.counter__label').html(num(count, ["Projektów ukończonych", "Projekt ukończony", "Projekty ukończone"]));
                } else {
                    $(this).find('.counter__label').html(num(count, ["Projektów realizowanych", "Projekt realizowany", "Projekty realizowane"]));
                }
            });
            $('.counters__counter').each(function(index) {
                var status = $(this).attr('id');
                var count = parseInt($(this).children('.counters__count').data(status));
                console.log(count, status);
                if (status === 'finished') {
                    $(this).find('.counters__label').html(num(count, ["Projektów ukończonych", "Projekt ukończony", "Projekty ukończone"]));
                } else if (status === 'in-progress'){
                    $(this).find('.counters__label').html(num(count, ["Projektów realizowanych", "Projekt realizowany", "Projekty realizowane"]));
                }
                $('#'+status).jQuerySimpleCounter({end: count, duration: 2500});
        
            });
        
        })();

        (function() {
            // animacja ze zmieniającym się gradientem obciąża CPU,
            // więc włączam ją tylko, gdy użytkownik dosroluje do końca strony
            $(window).scroll(function () {
               if ($(window).scrollTop() >= $(document).height() - $(window).height() - 500) {
                  $('.footer-wrapper').addClass('footer-wrapper--animate');
              } else {
                  $('.footer-wrapper').removeClass('footer-wrapper--animate');
              }
            });
        })();

        (function () {
        
            let glide = new Glide('.glide', {
                type: 'carousel',
                focusAt: 'center',
                perView: 1,
                gap: 20,
                slideWidth: 800
            })
        
            glide.mount()
        })();

        // Tak w ogóle, to okno modalne należy oddzielić od
        // SPONSORÓW i WSPÓŁPRACY, zrobić niezależnym elementem
        
        (function() {
            $('.brand').each(function(index) {
                if ($(this).data('brand-desc').length < 1) {
                    $(this).find('.brand__more').remove();
                }
            });
        
            $('.brand__more').bind("click", function(e) {
                e.preventDefault();
                var brand = $(this).parents('.brand');
                var brandName = brand.data('brand-name');
                var brandLink = brand.data('brand-link');
                var brandDesc = brand.data('brand-desc');
                var brandLogo = brand.find('.brand__logo').attr('src');
                console.log(brand, brandName, brandLink, brandDesc, brandLogo);
        
                $('.modal__title').html(brandName);
                $('.modal__content a').html(brandLink).attr('href', brandLink);
                $('.modal__content p').html(brandDesc);
                $('.modal__content p').html(brandDesc);
                $('.modal__image').attr('src', brandLogo);
        
                $("html").addClass("doNotScroll");
                $('.modal').addClass('visible');
            });
        
            //On clicking the modal background
            $('[data-modal-close]').bind("click", function(e) {
                $('.modal').removeClass('visible');
                $("html").removeClass("doNotScroll");
            });
        
        })();

        (function() {
            Slider = $('#slider').Swipe({
              auto: 0,
              continuous: true,
            }).data('Swipe');
            if (Slider) {
              $('.swipe__next').on('click', Slider.next);
              $('.swipe__prev').on('click', Slider.prev);
            }
        
        })();

        (function($) {
            var updateTime = 5;
            var ultronFileLocation = "http://" + window.location.hostname + "/ultron/data.json";
            var ustate = document.getElementById('state');
            var utime = document.getElementById('time');
        
        if(document.body.classList.contains('page-template-lab') === true) {
            // Pierwszy request
            requestJSON();
            window.setInterval(function(){
                console.info('Interval request...');
                requestJSON();
            }, updateTime * 1000);
        }
        
        
            function requestJSON() {
                $.ajaxSetup({
                    beforeSend: function(xhr) {
                        if (xhr.overrideMimeType) {
                            xhr.overrideMimeType("application/json");
                        }
                    }
                });
        
                $.ajax({
                    dataType: "json",
                    type: "GET",
                    url: ultronFileLocation,
                    cache: false,
                    success: function(data) {
                        console.info("Latest", latestData(data));
                        setState(latestData(data));
                        setTime(calcTime(latestData(data)));
                    },
                    error: function(e, xhr) {
                        console.error("err");
                        return e;
                    }
                });
            }
        
            function setState(latest) {
                ustate.innerHTML = isOpenText(latest.state);
            }
        
            function setTime(time) {
                utime.innerHTML = time;
            }
        
            function calcTime(latest) {
                var time = Math.round(new Date().getTime() / 1000);
                var min = parseInt((time - latest.time) / 60);
                var hours = parseInt((time - latest.time) / 3600);
                if (time - latest.time < 60) {
                    return (time - latest.time) + "s temu";
                } else if (time - latest.time < 3600) {
                    return min + "m temu";
                } else {
                    min = min - hours * 60;
                    return hours + "g " + min + "m temu";
                }
            }
        
            function isOpenText(data) {
                if (data === "1") {
                    return "Otwarte";
                } else {
                    return "Zamknięte";
                }
            }
        
            function latestData(data) {
                return data.slice(-1)[0];
            }
        })(jQuery);

    });

    // Prezes zawsze na pierwszym miejscu //
    $('.membercard#president').insertBefore('#current_members .cardsWrapper div:eq(0)');

    // Dodaje do <a> klasę "link"
    $('.project__content a').addClass('link');

});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1haW4uanMgLy9cbi8vIFdzenlzdGtvIHdyenVjYW15IHR1XG5cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lZHVhcmRvbWIvc2Nyb2xsLXVwLWJhci9cblxuKGZ1bmN0aW9uKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIHZhciBfZGVzdHJveUZuO1xuICBcbiAgICAkLnNjcm9sbHVwYmFyID0gZnVuY3Rpb24oJGJhciwgb3B0aW9ucykge1xuICAgICAgLy8gRGVmYXVsdCBvcHRpb25zXG4gICAgICBvcHRpb25zID0gJC5leHRlbmQoe1xuICAgICAgICBlbnRlclZpZXdwb3J0OiAkLm5vb3AsXG4gICAgICAgIGZ1bGx5RW50ZXJWaWV3cG9ydDogJC5ub29wLFxuICAgICAgICBleGl0Vmlld3BvcnQ6ICQubm9vcCxcbiAgICAgICAgcGFydGlhbGx5RXhpdFZpZXdwb3J0OiAkLm5vb3BcbiAgICAgIH0sIG9wdGlvbnMpO1xuICBcbiAgICAgIGZ1bmN0aW9uIGlzRnVsbHlJblZpZXdwb3J0KCkge1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5zY3JvbGxUb3AoKSA8PSAkYmFyLm9mZnNldCgpLnRvcDtcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiBpc0luVmlld3BvcnQoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LnNjcm9sbFRvcCgpIDwgJGJhci5vZmZzZXQoKS50b3AgKyAkYmFyLm91dGVySGVpZ2h0KCk7XG4gICAgICB9XG4gIFxuICAgICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyksXG4gICAgICAgICAgJGRvY3VtZW50ID0gJChkb2N1bWVudCksXG4gICAgICAgICAgbWluWSA9ICRiYXIuY3NzKCdwb3NpdGlvbicpID09ICdmaXhlZCcgPyAwIDogJGJhci5vZmZzZXQoKS50b3AsXG4gICAgICAgICAgbGFzdFkgPSAkd2luZG93LnNjcm9sbFRvcCgpLCAvLyBVc2UgbGFzdCBZIHRvIGRldGVjdCBzY3JvbGwgZGlyZWN0aW9uLlxuICAgICAgICAgIGluaXRpYWxQb3NUb3AgPSAkYmFyLnBvc2l0aW9uKCkudG9wLFxuICAgICAgICAgIHRpbWVvdXQ7XG4gIFxuICAgICAgJC5zY3JvbGx1cGJhci5pc0luVmlld3BvcnQgPSBpc0luVmlld3BvcnQoKTtcbiAgICAgICQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQgPSBpc0Z1bGx5SW5WaWV3cG9ydCgpO1xuICBcbiAgICAgICR3aW5kb3cub24oJ3Njcm9sbC5zY3JvbGx1cGJhcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgeSA9ICR3aW5kb3cuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICBiYXJIZWlnaHQgPSAkYmFyLm91dGVySGVpZ2h0KCk7XG4gIFxuICAgICAgICAvLyBJZ25vcmUgZWxhc3RpYyBzY3JvbGxpbmcuXG4gICAgICAgIGlmICh5IDwgMCB8fCB5ID4gKCRkb2N1bWVudC5oZWlnaHQoKSAtICR3aW5kb3cuaGVpZ2h0KCkpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gIFxuICAgICAgICAvLyBDYW5jZWwgdGhlIGV2ZW50IGZpcmVkIGJ5IHRoZSBwcmV2aW91cyBzY3JvbGwuXG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICB9XG4gIFxuICAgICAgICBpZiAoeSA8IGxhc3RZKSB7IC8vIFNjcm9sbGluZyB1cFxuICAgICAgICAgIC8vIElmIHRoZSBiYXIgaXMgaGlkZGVuLCBwbGFjZSBpdCByaWdodCBhYm92ZSB0aGUgdG9wIGZyYW1lLlxuICAgICAgICAgIGlmICghJC5zY3JvbGx1cGJhci5pc0luVmlld3BvcnQgJiYgbGFzdFkgLSBiYXJIZWlnaHQgPj0gbWluWSkge1xuICAgICAgICAgICAgJGJhci5jc3MoJ3RvcCcsIGxhc3RZIC0gYmFySGVpZ2h0KTtcbiAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNJblZpZXdwb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgIG9wdGlvbnMuZW50ZXJWaWV3cG9ydCgpO1xuICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgLy8gU2Nyb2xscyB1cCBiaWdnZXIgdGhhbiB0aGUgYmFyJ3MgaGVpZ2h0IGZpeGVzIHRoZSBiYXIgb24gdG9wLlxuICAgICAgICAgIGlmIChpc0Z1bGx5SW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICBpZiAoeSA+PSBtaW5ZKSB7XG4gICAgICAgICAgICAgICRiYXIuY3NzKHtcbiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICd0b3AnOiAwXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJGJhci5jc3Moe1xuICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgJ3RvcCc6IGluaXRpYWxQb3NUb3BcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gIFxuICAgICAgICAgICAgaWYgKCEkLnNjcm9sbHVwYmFyLmlzRnVsbHlJblZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQgPSB0cnVlO1xuICAgICAgICAgICAgICBvcHRpb25zLmZ1bGx5RW50ZXJWaWV3cG9ydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgLy8gRmlyZSBhbiBldmVudCB0byByZXZlYWwgdGhlIGVudGlyZSBiYXIgYWZ0ZXIgNDAwbXMgaWYgdGhlIHNjcm9sbFxuICAgICAgICAgIC8vIHdhc24ndCBiaWcgZW5vdWdoLlxuICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkLnNjcm9sbHVwYmFyLmlzRnVsbHlJblZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICRiYXIuY3NzKHtcbiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICd0b3AnOiAkYmFyLm9mZnNldCgpLnRvcCAtIHlcbiAgICAgICAgICAgICAgfSk7XG4gIFxuICAgICAgICAgICAgICAkYmFyLmFuaW1hdGUoeyd0b3AnOiAwfSwgMTAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzRnVsbHlJblZpZXdwb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmZ1bGx5RW50ZXJWaWV3cG9ydCgpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9IGVsc2UgaWYgKHkgPiBsYXN0WSkgeyAvLyBTY3JvbGxpbmcgZG93blxuICAgICAgICAgIC8vIFVuZml4IHRoZSBiYXIgYWxsb3dpbmcgaXQgdG8gc2Nyb2xsIHdpdGggdGhlIHBhZ2UuXG4gICAgICAgICAgaWYgKCQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQpIHtcbiAgICAgICAgICAgICRiYXIuY3NzKHtcbiAgICAgICAgICAgICAgLy8gdHJhbnNsYXRlM2QgZml4ZXMgaU9TIGludmlzaWJsZSBlbGVtZW50IGJ1ZyB3aGVuIGNoYW5naW5nXG4gICAgICAgICAgICAgIC8vIHBvc2l0aW9uIHZhbHVlcyB3aGlsZSBzY3JvbGxpbmcuXG4gICAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlM2QoMCwgMCwgMCknLFxuICAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAndG9wJzogbGFzdFkgPiBtaW5ZID8gbGFzdFkgOiBpbml0aWFsUG9zVG9wXG4gICAgICAgICAgICB9KTtcbiAgXG4gICAgICAgICAgICBpZiAoIWlzRnVsbHlJblZpZXdwb3J0KCkpIHtcbiAgICAgICAgICAgICAgJC5zY3JvbGx1cGJhci5pc0Z1bGx5SW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgICAgICBvcHRpb25zLnBhcnRpYWxseUV4aXRWaWV3cG9ydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgaWYgKCQuc2Nyb2xsdXBiYXIuaXNJblZpZXdwb3J0ICYmICFpc0luVmlld3BvcnQoKSkge1xuICAgICAgICAgICAgJC5zY3JvbGx1cGJhci5pc0luVmlld3BvcnQgPSBmYWxzZTtcbiAgICAgICAgICAgIG9wdGlvbnMuZXhpdFZpZXdwb3J0KCk7XG4gICAgICAgICAgfVxuICBcbiAgICAgICAgICAvLyBGaXJlIGFuIGV2ZW50IHRvIGhpZGUgdGhlIGVudGlyZSBiYXIgYWZ0ZXIgNDAwbXMgaWYgdGhlIHNjcm9sbFxuICAgICAgICAgIC8vIHdhc24ndCBiaWcgZW5vdWdoLlxuICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGlzSW5WaWV3cG9ydCgpICYmIHkgLSBiYXJIZWlnaHQgPj0gbWluWSkge1xuICAgICAgICAgICAgICAkYmFyLmFuaW1hdGUoeyd0b3AnOiB5IC0gYmFySGVpZ2h0fSwgMTAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzSW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuZXhpdFZpZXdwb3J0KCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH1cbiAgXG4gICAgICAgIGxhc3RZID0geTtcbiAgICAgIH0pO1xuICBcbiAgICAgIF9kZXN0cm95Rm4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVW5iaW5kIGFsbCBsaXN0ZW5lcnMgYWRkZWQgYnkgc2Nyb2xsdXBiYXIgcGx1Z2luXG4gICAgICAgICR3aW5kb3cub2ZmKCcuc2Nyb2xsdXBiYXInKTtcbiAgXG4gICAgICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgYmFyIHBvc2l0aW9uLlxuICAgICAgICAkYmFyLmNzcyh7XG4gICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcbiAgICAgICAgICAndG9wJzogaW5pdGlhbFBvc1RvcFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gIFxuICAgICAgcmV0dXJuICRiYXI7XG4gICAgfTtcbiAgXG4gICAgJC5zY3JvbGx1cGJhci5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoX2Rlc3Ryb3lGbikge1xuICAgICAgICByZXR1cm4gX2Rlc3Ryb3lGbigpO1xuICAgICAgfVxuICAgIH07XG4gIFxuICAgICQuZm4uc2Nyb2xsdXBiYXIgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICByZXR1cm4gJC5zY3JvbGx1cGJhcih0aGlzLCBvcHRpb25zKTtcbiAgICB9O1xuICB9KShqUXVlcnkpO1xuXG5qUXVlcnkoZnVuY3Rpb24oJCkge1xuXG4gICAgLyoqXG4gICAgICogRHJvcHlcbiAgICAgKiBodHRwOi8vY29kZXBlbi5pby9Ub21iZWsvcGVuL09QdnBMZVxuICAgICAqL1xuICAgIHZhciBkcm9weSA9IHtcbiAgICAgICRkcm9weXM6IG51bGwsXG4gICAgICBvcGVuQ2xhc3M6ICdvcGVuJyxcbiAgICAgIHNlbGVjdENsYXNzOiAnc2VsZWN0ZWQnLFxuICAgICAgaW5pdDogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFxuICAgICAgICBzZWxmLiRkcm9weXMgPSAkKCcuZHJvcHknKTtcbiAgICAgICAgc2VsZi5ldmVudEhhbmRsZXIoKTtcbiAgICAgIH0sXG4gICAgICBldmVudEhhbmRsZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBcbiAgICAgICAgLy8gT3BlbmluZyBhIGRyb3B5XG4gICAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX3RpdGxlJykuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgICBzZWxmLiRkcm9weXMucmVtb3ZlQ2xhc3Moc2VsZi5vcGVuQ2xhc3MpO1xuICAgICAgICAgICQodGhpcykucGFyZW50cygnLmRyb3B5JykuYWRkQ2xhc3Moc2VsZi5vcGVuQ2xhc3MpO1xuICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgLy8gQ2xpY2sgb24gYSBkcm9weSBsaXN0XG4gICAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX2NvbnRlbnQgdWwgbGkgYScpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKTtcbiAgICAgICAgICB2YXIgJGRyb3B5ID0gJHRoYXQucGFyZW50cygnLmRyb3B5Jyk7XG4gICAgICAgICAgdmFyICRpbnB1dCA9ICRkcm9weS5maW5kKCdpbnB1dCcpO1xuICAgICAgICAgIHZhciAkdGl0bGUgPSAkKHRoaXMpLnBhcmVudHMoJy5kcm9weScpLmZpbmQoJy5kcm9weV9fdGl0bGUgc3BhbicpO1xuICAgIFxuICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3RlZCBjbGFzc1xuICAgICAgICAgICRkcm9weS5maW5kKCcuZHJvcHlfX2NvbnRlbnQgYScpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3Moc2VsZi5zZWxlY3RDbGFzcyk7XG4gICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGVkIHZhbHVlXG4gICAgICAgICAgJHRpdGxlLmh0bWwoJHRoYXQuaHRtbCgpKTtcbiAgICAgICAgICAkaW5wdXQudmFsKCR0aGF0LmF0dHIoJ2RhdGEtdmFsdWUnKSkudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgXG4gICAgICAgICAgLy8gSWYgYmFjayB0byBkZWZhdWx0LCByZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZWxzZSBhZGRjbGFzcyBvbiByaWdodCBlbGVtZW50XG4gICAgICAgICAgaWYoJHRoYXQuaGFzQ2xhc3MoJ2Ryb3B5X19oZWFkZXInKSl7XG4gICAgICAgICAgICAkdGl0bGUucmVtb3ZlQ2xhc3Moc2VsZi5zZWxlY3RDbGFzcyk7XG4gICAgICAgICAgICAkdGl0bGUuaHRtbCgkdGl0bGUuYXR0cignZGF0YS10aXRsZScpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICR0aXRsZS5hZGRDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgICAgICR0aGF0LmFkZENsYXNzKHNlbGYuc2VsZWN0Q2xhc3MpO1xuICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAvLyBDbG9zZSBkcm9wZG93blxuICAgICAgICAgICRkcm9weS5yZW1vdmVDbGFzcyhzZWxmLm9wZW5DbGFzcyk7XG4gICAgICAgIH0pO1xuICAgIFxuICAgICAgICAvLyBDbG9zZSBhbGwgZHJvcGRvd24gb25jbGljayBvbiBhbm90aGVyIGVsZW1lbnRcbiAgICAgICAgJChkb2N1bWVudCkuYmluZCgnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIGlmICghICQoZS50YXJnZXQpLnBhcmVudHMoKS5oYXNDbGFzcygnZHJvcHknKSl7IHNlbGYuJGRyb3B5cy5yZW1vdmVDbGFzcyhzZWxmLm9wZW5DbGFzcyk7IH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBcbiAgICAkKGZ1bmN0aW9uKCl7XG4gICAgICBkcm9weS5pbml0KCk7XG4gICAgfSk7XG5cbiAgICAgICBmdW5jdGlvbiBjYXJkRXhjZXJwdCgpIHtcbiAgICAgICAgJChcIi5jYXJkX19leGNlcnB0XCIpLnRleHQoZnVuY3Rpb24oaW5kZXgsIGN1cnJlbnRUZXh0KSB7XG4gICAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCAxMjUpICsgJ1xcdTIwMjYnO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNhcmRFeGNlcnB0KCk7XG5cbiAgICAvLyBQYWt1amUgbW5pZWpzemUgb2JyYXpraSBiZXogcG9kcGlzdSB3IDxmaWd1cmU+IC8vXG4gICAgLy8gSmXFm2xpIG9icmF6ZWsgbWEgdHl0dcWCLCB0eW0gc2nEmSB6YWptdWplIHBocCBmdW5rY2phIHcgcHJvamVjdC1mdW5jdGlvbnMucGhwXG4gICAgJCgnLnByb2plY3RfX2NvbnRlbnQgcCcpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIHZhciBzb21lX2ltZyA9ICQodGhpcykuZmluZCgnaW1nJyk7XG4gICAgICB2YXIgd2lkdGggPSBzb21lX2ltZy53aWR0aCgpO1xuICAgICAgaWYgKHdpZHRoIDwgOTgwKSB7XG4gICAgICAgIHNvbWVfaW1nLndyYXAoXCI8ZmlndXJlPjwvZmlndXJlPlwiKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE5vdHlmaWthY2plLCBwb3dpYWRvbWllbmlhIC8vXG4gICAgJChcIi5ub3RlLWNsb3NlXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgJCh0aGlzKS5wYXJlbnQoKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9LCAyNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAwXG4gICAgICAgICAgICB9LCAyNTApXG4gICAgICAgICAgICAuY2hpbGRyZW4oKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICBwYWRkaW5nOiAwXG4gICAgICAgICAgICB9LCAyNTApXG4gICAgICAgICAgICAud3JhcElubmVyKFwiPGRpdiAvPlwiKVxuICAgICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAgIC5zbGlkZVVwKDI1MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdChcIi5ub3RlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcmVjcnVpdG1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjcnVpdG1lbnQnKTtcbiAgICAgICAgaWYgKHJlY3J1aXRtZW50KSB7XG4gICAgICAgICAgICByZWNydWl0bWVudC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyByZWNydWl0bWVudC5kYXRhc2V0LmJnICsgXCInKVwiO1xuICAgICAgICB9XG4gICAgfSkoKTtcblxuICAgIC8vLy8gPSBwYXJ0aWFscy9zaG93LW5pY2tuYW1lcy5qc1xuXG4gICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gJChcIiNuYXYtbW9iaWxlXCIpLmh0bWwoJChcIiNuYXYtbWFpblwiKS5odG1sKCkpO1xuICAgICAgICAkKFwiI25hdi10cmlnZ2VyIC5uYXZpY29uLWJ1dHRvblwiKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAgIGNvbnNvbGUuaW5mbygnQnVyZ2VyIGNsaWNrZWQnKTtcbiAgICAgICAgICAgIGlmICgkKFwiI25hdiB1bFwiKS5oYXNDbGFzcyhcIm5hdl9fbWVudS0tZXhwYW5kZWRcIikpIHtcbiAgICAgICAgICAgICAgICAkKFwiI25hdiB1bFwiKS5yZW1vdmVDbGFzcyhcIm5hdl9fbWVudS0tZXhwYW5kZWRcIikuc2xpZGVVcCgyNTApO1xuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI25hdiB1bFwiKS5hZGRDbGFzcyhcIm5hdl9fbWVudS0tZXhwYW5kZWRcIikuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyDFu2VieSB0b29sdGlwIG5pZSBrbGlrYcWCXG4gICAgICAgICQoJy50b29sdGlwJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgJCgnW2RhdGEtZ2l0aHViXScpLmhvdmVyKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGxvYWRHaXRodWIoKTtcbiAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJy50b29sdGlwJykuYWRkQ2xhc3MoJ3Rvb2x0aXAtLWFjdGl2ZScpO1xuICAgICAgICB9LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCcudG9vbHRpcCcpLnJlbW92ZUNsYXNzKCd0b29sdGlwLS1hY3RpdmUnKTtcbiAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICQoJ1tkYXRhLWxhc3RmbV0nKS5ob3ZlcihmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBsb2FkTGFzdGZtKCk7XG4gICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCcudG9vbHRpcCcpLmFkZENsYXNzKCd0b29sdGlwLS1hY3RpdmUnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbignLnRvb2x0aXAnKS5yZW1vdmVDbGFzcygndG9vbHRpcC0tYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuICAgIH0pKCk7XG5cbiAgICBmdW5jdGlvbiBsb2FkR2l0aHViKCkge1xuICAgICAgICAvLyBQb2JpZXJhIHVybCB6IGhyZWZhXG4gICAgICAgIHZhciBwcm9maWxlVXJsID0gJCgnYVtkYXRhLWdpdGh1Yl0nKS5hdHRyKCdocmVmJyk7XG4gICAgICAgIC8vIE9kcG93aWVkbmlvIG9iY2luYSBnbyBkbyB1c2VybmFtZVxuICAgICAgICB2YXIgdXNlcm5hbWUgPSBwcm9maWxlVXJsLnN1YnN0cigxOSk7XG4gICAgICAgIC8vIERvZGFqZSB1c2VybmFtZSBkbyB1cmwgemFweXRhbmlhXG4gICAgICAgIHZhciByZXF1cmkgPSAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy8nICsgdXNlcm5hbWU7XG4gICAgICAgIC8vIFNwcmF3ZHphLCBjenkgdG9vbHRpcCBwdXN0eSwgYnkgbmllIGdlbmVyb3dhxIcgbm93eWNoIHphcHl0YcWEXG4gICAgICAgIC8vIGkgbmllIGRvZGF3YcSHIHBvIHJheiBrb2xlam55IGRhbmUgZG8gdG9vbHRpcGFcbiAgICAgICAgaWYgKCQoJ1tkYXRhLWdpdGh1Yl0gLnRvb2x0aXAnKS5pcygnOmVtcHR5JykpIHtcbiAgICAgICAgICAgIHJlcXVlc3RKU09OKHJlcXVyaSwgZnVuY3Rpb24oanNvbikge1xuICAgICAgICAgICAgICAgIGlmIChqc29uLm1lc3NhZ2UgPT09IFwiTmllIHpuYWxlemlvbm9cIiB8fCB1c2VybmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnW2RhdGEtZ2l0aHViXSAudG9vbHRpcCcpLmh0bWwoXCI8aDI+QnJhayBpbmZvcm1hY2ppPC9oMj5cIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBqc29uLmxvZ2luO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZXVybCA9IGpzb24uaHRtbF91cmw7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXBvc251bSA9IGpzb24ucHVibGljX3JlcG9zO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXZpdXJsID0ganNvbi5hdmF0YXJfdXJsO1xuICAgIFxuICAgIFxuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0aHRtbCA9ICc8ZGl2IGNsYXNzPVwiZ2hcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8aDQgY2xhc3M9XCJnaF9fbmFtZVwiPjxhIGNsYXNzPVwibGlua1wiIGhyZWY9XCInICsgcHJvZmlsZXVybCArICdcIj48aW1nIGNsYXNzPVwiZ2hfX2F2YXRhclwiIHNyYz1cIicgKyBhdml1cmwgKyAnXCI+QCcgKyB1c2VybmFtZSArICc8L2E+PC9oND4nO1xuICAgICAgICAgICAgICAgICAgICBvdXRodG1sID0gb3V0aHRtbCArICc8c3BhbiBjbGFzcz1cImdoX19yZXBvc1wiPlJlcG96eXRvcmnDs3c6ICcgKyByZXBvc251bSArICc8L3NwYW4+PGhyLz48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAkKCdbZGF0YS1naXRodWJdIC50b29sdGlwJykuYXBwZW5kKG91dGh0bWwpO1xuICAgIFxuICAgICAgICAgICAgICAgIH0gLy8gZW5kIGVsc2Ugc3RhdGVtZW50XG4gICAgICAgICAgICB9KTsgLy8gZW5kIHJlcXVlc3RKU09OIEFqYXggY2FsbFxuICAgICAgICB9XG4gICAgXG4gICAgICAgIGZ1bmN0aW9uIHJlcXVlc3RKU09OKHVybCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKHhocikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKG51bGwsIHhoci5yZXNwb25zZUpTT04pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9hZExhc3RmbSgpIHtcbiAgICAgICAgLy8gUG9iaWVyYSB1cmwgeiBocmVmYVxuICAgICAgICB2YXIgcHJvZmlsZVVybCA9ICQoJ2FbZGF0YS1sYXN0Zm1dJykuYXR0cignaHJlZicpO1xuICAgICAgICAvLyBPZHBvd2llZG5pbyBvYmNpbmEgZ28gZG8gdXNlcm5hbWVcbiAgICAgICAgdmFyIHVzZXJuYW1lID0gcHJvZmlsZVVybC5zdWJzdHIoMjcpO1xuICAgICAgICB2YXIgYmFzZVVybCA9ICdodHRwOi8vd3MuYXVkaW9zY3JvYmJsZXIuY29tLzIuMC8/bWV0aG9kPXVzZXIuZ2V0cmVjZW50dHJhY2tzJztcbiAgICAgICAgdmFyIGFwaV9rZXkgPSAnMjk5MDIwYzA2MmM0ODFmMDgzZWNkMDI3NmMzMTVlM2EnO1xuICAgIFxuICAgICAgICB2YXIgcmVxdWVzdFVybCA9IGJhc2VVcmwgKyAnJnVzZXI9JyArIHVzZXJuYW1lICsgJyZhcGlfa2V5PScgKyBhcGlfa2V5ICsgJyZmb3JtYXQ9anNvbic7XG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXJuYW1lKTtcbiAgICAgICAgaWYgKCQoJ1tkYXRhLWxhc3RmbV0gLnRvb2x0aXAnKS5pcygnOmVtcHR5JykpIHtcbiAgICAgICAgICAgICQuZ2V0SlNPTihyZXF1ZXN0VXJsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFydGlzdCA9IGRhdGEucmVjZW50dHJhY2tzLnRyYWNrWzBdLmFydGlzdFtcIiN0ZXh0XCJdO1xuICAgICAgICAgICAgICAgIHZhciBzb25nID0gZGF0YS5yZWNlbnR0cmFja3MudHJhY2tbMF1bXCJuYW1lXCJdO1xuICAgICAgICAgICAgICAgIHZhciBjb3ZlciA9IGRhdGEucmVjZW50dHJhY2tzLnRyYWNrWzBdLmltYWdlWzNdW1wiI3RleHRcIl07XG4gICAgICAgICAgICAgICAgaWYgKGNvdmVyID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdmVyID0gXCJodHRwOi8vaW1nMi1hay5sc3QuZm0vaS91LzE3NHMvNDEyOGE2ZWIyOWY5NDk0M2M5ZDIwNmMwOGU2MjU5MDQucG5nXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBvdXRodG1sID0gJzxkaXYgY2xhc3M9XCJsZlwiPjxpbWcgY2xhc3M9XCJsZl9fY292ZXJcIiBzcmM9XCInICsgY292ZXIgKyAnXCIvPjxkaXYgY2xhc3M9XCJsZl9fdHJhY2tJbmZvXCI+PHNwYW4gY2xhc3M9XCJsZl9fYXJ0aXN0XCI+JyArIGFydGlzdCArICc8L3NwYW4+PHNwYW4gY2xhc3M9XCJsZl9fc29uZ1wiPicgKyBzb25nICsgJzwvc3Bhbj48L2Rpdj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICQoJ1tkYXRhLWxhc3RmbV0gLnRvb2x0aXAnKS5hcHBlbmQob3V0aHRtbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQoZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJ2FbaHJlZio9XCIjXCJdOm5vdCgubGluay0tdGFiKScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoL15cXC8vLCAnJykgPT0gdGhpcy5wYXRobmFtZS5yZXBsYWNlKC9eXFwvLywgJycpICYmIGxvY2F0aW9uLmhvc3RuYW1lID09IHRoaXMuaG9zdG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzLmhhc2gpO1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5sZW5ndGggPyB0YXJnZXQgOiAkKCdbbmFtZT0nICsgdGhpcy5oYXNoLnNsaWNlKDEpICsgJ10nKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IHRhcmdldC5vZmZzZXQoKS50b3BcbiAgICAgICAgICAgICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgYkxhenkgPSBuZXcgQmxhenkoe1xuICAgICAgICAgICAgb2Zmc2V0OiAyMCxcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnLmJsYXp5JyxcbiAgICAgICAgICAgIGxvYWRJbnZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgYnJlYWtwb2ludHM6IFt7XG4gICAgICAgICAgICAgIHdpZHRoOiAzNjAsIC8vIE1heC13aWR0aFxuICAgICAgICAgICAgICBzcmM6ICdkYXRhLXNyYy1zbWFsbCdcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAkKGVsZW1lbnQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJywgNTAwKTtcbiAgICAgICAgICAgICAgdXBkYXRlQ291bnRlcigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlbGVtZW50LCBtc2cpIHtcbiAgICAgICAgICAgICAgaWYgKG1zZyA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnbG9hZGluZycsIDUwMCk7IC8vIERhdGEtc3JjIGlzIG1pc3NpbmdcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiYkxhenk6IGRhdGEtc3JjIGlzIG1pc3NpbmdcIik7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnID09PSAnaW52YWxpZCcpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJywgNTAwKTtcbiAgICAgICAgICAgICAgICAvLyBEYXRhLXNyYyBpcyBpbnZhbGlkXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImJMYXp5OiBkYXRhLXNyYyBpcyBpbnZhbGlkXCIpO1xuICAgICAgICBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIC8vIG5vdCBuZWVkZWQsIG9ubHkgaGVyZSB0byBpbGx1c3RyYXRlIGFtb3VudCBvZiBsb2FkZWQgaW1hZ2VzXG4gICAgICAgICAgdmFyIGltYWdlTG9hZGVkID0gMDtcbiAgICAgICAgXG4gICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ291bnRlcigpIHtcbiAgICAgICAgICAgIGltYWdlTG9hZGVkKys7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oXCJiTGF6eTogSW1hZ2VzIGxvYWRlZDogJWRcIiwgaW1hZ2VMb2FkZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgLy8gdGFicyhiTGF6eSk7XG5cbiAgICAgICAgLy8vLz0gbWVtYmVyLmpzXG5cbiAgICAgICAgLy9Ta3JhY2EgaW1pb25hLCBieSBuaWUgd3ljaG9kemnFgnkgemEgYmxva2lcbiAgICAgICAgJCgnLm1lbWJlcmNhcmRfX25hbWUgYScpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBhID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGlmIChhLmh0bWwoKS5sZW5ndGggPiAxNykge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIHRyaW1tZWRfbmFtZSA9IG5hbWUuY2hhckF0KDApICsgXCIuIFwiICsgbmFtZS5zdWJzdHIobmFtZS5pbmRleE9mKCcgJykgKyAxKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0cmltbWVkX25hbWUpO1xuICAgICAgICAgICAgICAgIGEudGV4dCh0cmltbWVkX25hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChhLmh0bWwoKS5sZW5ndGggPiAxNykge1xuICAgICAgICAgICAgICAgICAgICBhLnBhcmVudCgpLmFkZENsYXNzKCdtZW1iZXJjYXJkX19uYW1lLS10b29Mb25nJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgICQoJy5tZW1iZXJjYXJkU21hbGxfX25hbWUgYScpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSAkKHRoaXMpLmh0bWwoKS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAobGVuZ3RoID4gMTQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9ICQodGhpcykudGV4dCgpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciB0cmltbWVkX25hbWUgPSBuYW1lLmNoYXJBdCgwKSArIFwiLiBcIiArIG5hbWUuc3Vic3RyKG5hbWUuaW5kZXhPZignICcpICsgMSk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codHJpbW1lZF9uYW1lKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnRleHQodHJpbW1lZF9uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHJlY3J1aXRtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY3J1aXRtZW50Jyk7XG4gICAgICAgICAgICBpZiAocmVjcnVpdG1lbnQpIHtcbiAgICAgICAgICAgICAgICByZWNydWl0bWVudC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyByZWNydWl0bWVudC5kYXRhc2V0LmJnICsgXCInKVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpO1xuXG4gICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBhamF4X3VybCA9ICQoJy5nbG9iYWwnKS5hdHRyKCdkYXRhLWFqYXgtdXJsJyk7XG4gICAgICAgICAgICB2YXIgcG9zdF9vZmZzZXQgPSAwO1xuICAgICAgICAgICAgdmFyIGluY051bWJlciA9IDY7IC8vIGlsb8WbxIcgcG9zdMOzdyBkbyB6YcWCYWRvd2FuaWFcbiAgICAgICAgXG4gICAgICAgICAgICB2YXIgcHJvamVjdHMgPSAoZnVuY3Rpb24oc2V0UHJvamVjdHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbG9hZGVkO1xuICAgICAgICAgICAgICAgIHZhciB0b3RhbDtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBpbmNMb2FkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gbG9hZGVkICsgaW5jTnVtYmVyO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRMb2FkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRlZDtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9hZGVkOiBmdW5jdGlvbihzZXRQcm9qZWN0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gc2V0UHJvamVjdHM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNldFRvdGFsOiBmdW5jdGlvbihzZXRQcm9qZWN0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBzZXRQcm9qZWN0cztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VG90YWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICB2YXIgbG9hZGluZ0J1dHRvbiA9IChmdW5jdGlvbihidXR0b24pe1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHNob3dTcGlubmVyOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5odG1sKCc8ZGl2IGNsYXNzPVwic3Bpbm5lclwiPjwvZGl2PicpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzaG93Q2FwdGlvbjogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uaHRtbCgnWm9iYWN6IHN0YXJzemUnKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIFxuICAgICAgICAgICAgJCgnI2xvYWRfbW9yZV9wb3N0cycpLm9uKCdjbGljaycsIGxvYWRNb3JlKTtcbiAgICAgICAgICAgICQoJyNsb2FkX21vcmUnKS5vbignY2xpY2snLCBsb2FkUHJvamVjdHMpO1xuICAgICAgICBcbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWRNb3JlKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDbGlja2VkIGxvYWRfbW9yZScpO1xuICAgICAgICAgICAgICAgICQodGhpcykuaHRtbCgnPGRpdiBjbGFzcz1cInNwaW5uZXJcIj48L2Rpdj4nKTtcbiAgICAgICAgICAgICAgICBwb3N0X29mZnNldCA9IHBhcnNlSW50KHBvc3Rfb2Zmc2V0KSArIDY7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBhamF4X3VybCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdsb2FkX3Bvc3RzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Rfb2Zmc2V0OiBwb3N0X29mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvYWRfbW9yZV9wb3N0cycpLmh0bWwoJ1pvYmFjeiBzdGFyc3plJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcG9zdHMgLmNhcmRzV3JhcHBlcicpLmFwcGVuZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnQWpheDogT0snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJMYXp5LnJldmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmRFeGNlcnB0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICBmdW5jdGlvbiBsb2FkUHJvamVjdHMoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoaXNQYXJlbnQgPSAkKHRoaXMpLnBhcmVudCgpO1xuICAgICAgICAgICAgICAgIC8vIHVzdGF3aWEgY2HFgmtvd2l0xIUgbGljemLEmSBkYW55Y2ggcHJvamVrdMOzd1xuICAgICAgICAgICAgICAgIHByb2plY3RzLnNldFRvdGFsKHRoaXNQYXJlbnQuYXR0cignZGF0YS10b3RhbCcpKTtcbiAgICAgICAgICAgICAgICAvLyBqZcWbbGkgamVzemN6ZSBuaWUgcG9iaWVyYW5vIGFqYXhlbSBwcm9qZWt0w7N3LCB0byB1c3Rhd2lhIHdhcnRvxZvEh1xuICAgICAgICAgICAgICAgIC8vIHLDs3duxIUganXFvCB3ecWbd2lldGxvbnljaFxuICAgICAgICAgICAgICAgIGlmICghcHJvamVjdHMuZ2V0TG9hZGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdHMuc2V0TG9hZGVkKHRoaXNQYXJlbnQuZmluZCgnLmNhcmQnKS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWxyZWFkeTonLCBwcm9qZWN0cy5nZXRMb2FkZWQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwcm9qZWN0c19zdGF0dXMgPSB0aGlzUGFyZW50LmF0dHIoJ2RhdGEtcHJvamVjdHMtc3RhdHVzJyk7XG4gICAgICAgICAgICAgICAgcG9zdF9vZmZzZXQgPSBwYXJzZUludChwb3N0X29mZnNldCkgKyBpbmNOdW1iZXI7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0cy5nZXRUb3RhbCgpID4gcHJvamVjdHMuZ2V0TG9hZGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0J1dHRvbi5zaG93U3Bpbm5lcigkKCcjbG9hZF9tb3JlJykpO1xuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBhamF4X3VybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdsb2FkX3Byb2plY3RzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0X29mZnNldDogcG9zdF9vZmZzZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdHNfc3RhdHVzOiBwcm9qZWN0c19zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNQYXJlbnQuY2hpbGRyZW4oJy5jYXJkc1dyYXBwZXInKS5hcHBlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYkxhenkucmV2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcmRFeGNlcnB0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0J1dHRvbi5zaG93Q2FwdGlvbigkKCcjbG9hZF9tb3JlJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RzLmluY0xvYWRlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnQWpheDogTG9hZGVkIG1vcmUgJXMgcHJvamVjdHM6ICVkLyVkJywgcHJvamVjdHNfc3RhdHVzLCBwcm9qZWN0cy5nZXRMb2FkZWQoKSwgcHJvamVjdHMuZ2V0VG90YWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3RzLmdldFRvdGFsKCkgPD0gcHJvamVjdHMuZ2V0TG9hZGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0J1dHRvbi5oaWRlKCQoJyNsb2FkX21vcmUnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXRUb3BiYXIoKSB7XG4gICAgICAgICAgICAkKCcudG9wYmFyV3JhcHBlcicpLnNjcm9sbHVwYmFyKHtcbiAgICAgICAgICAgICAgICBlbnRlclZpZXdwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLnRvcGJhcldyYXBwZXInKS5hZGRDbGFzcygndG9wYmFyV3JhcHBlci0tdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVsbHlFbnRlclZpZXdwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI2xhc3QtZXZlbnQnKS50ZXh0KCdmdWxseUVudGVyVmlld3BvcnQnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGV4aXRWaWV3cG9ydDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNsYXN0LWV2ZW50JykudGV4dCgnZXhpdFZpZXdwb3J0Jyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJ0aWFsbHlFeGl0Vmlld3BvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjbGFzdC1ldmVudCcpLnRleHQoJ3BhcnRpYWxseUV4aXRWaWV3cG9ydCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICAgICBpbml0VG9wYmFyKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCA3NTApIHtcbiAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuZGVzdHJveSgnLnRvcGJhcldyYXBwZXInKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgLy8gZGlkU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBzdCA9ICQodGhpcykuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAvLyBHZHkgamVzdGXFm215IG5hIHNhbWVqIGfDs3J6ZSwgdG8gcG9rYXp5amVteSBjYcWCZSBsb2dvXG4gICAgICAgICAgICBpZiAoc3QgPT09IDApIHtcbiAgICAgICAgICAgICAgICAkKCcudG9wYmFyV3JhcHBlcicpLnJlbW92ZUNsYXNzKCd0b3BiYXJXcmFwcGVyLS12aXNpYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciB0YWJzID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRUYWI7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBwb2JpZXJhbXkgaHJlZlxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VGFiID0gJCgnLnRhYnNNZW51X19pdGVtLS1jdXJyZW50IC5saW5rLS10YWInKS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGhyZWYgamVzdCBqZWRub2N6ZcWbbmllIGlkIG9kcG93aWVkbmllZ28gdGFidSwga3TDs3J5IHd5xZt3aWV0bGFteVxuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRUYWIpLmFkZENsYXNzKCd0YWJfX2NvbnRlbnQtLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gxYJhZHVqZW15IG9icmF6a2lcbiAgICAgICAgICAgICAgICAgICAgYkxhenkubG9hZCgkKFwiLmJsYXp5XCIsIGN1cnJlbnRUYWIpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdUYWJzIGluaXRpYXRlZDonLCBjdXJyZW50VGFiKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gWiB0eW0gI3RhYnNSZXNldCwgdG8gdGFraSBoYWNrLiBXeWtvcnp5c3R5d2FueSBkbGF0ZWdvLCDFvGVcbiAgICAgICAgICAgICAgICAgICAgLy8gcG8ga2xpa25pxJljaXUgY2hvd2FqxIUgc2nEmSB3c3p5c3RraWUgdGFieSwgb3Byw7NjeiB0ZWogeiBvZHBvd2llZG5pbSBpZFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VGFiID0gJCgnI3RhYnNSZXNldCAubGluay0tdGFiJykuYXR0cignaHJlZicpO1xuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRUYWIpLnJlbW92ZUNsYXNzKFwidGFiX19jb250ZW50LS1oaWRkZW5cIikuYWRkQ2xhc3MoXCJ0YWJfX2NvbnRlbnQtLXZpc2libGVcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnVGFicyBpbml0aWF0ZWQ6JywgY3VycmVudFRhYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgdGFicy5pbml0KCk7XG4gICAgICAgIFxuICAgICAgICAkKFwiLmdsb2JhbFwiKS5vbignY2xpY2snLCAnLmxpbmstLXRhYicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAvLyB3ecWCxIVjemEgZG9tecWbbG5lIHByemVqxZtjaWUgbmEgYWRyZXMgbGlua3VcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAvLyBkb2RhamUga2xhc8SZIGRvIDxsaT5cbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoXCJ0YWJzTWVudV9faXRlbS0tY3VycmVudFwiKTtcbiAgICAgICAgICAgIC8vIHVzdXdhIGtsYXPEmSB6IDxsaT5cbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcInRhYnNNZW51X19pdGVtLS1jdXJyZW50XCIpO1xuICAgICAgICAgICAgLy8gcG9iaWVyYW15IGlkIHogaHJlZnVcbiAgICAgICAgICAgIHZhciB0YWIgPSAkKHRoaXMpLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAgICAgLy8gamXFm2xpIGJsb2sgbmllIG1hIHRha2llZ28gaWQsIHRvIGNob3dhbXkgZ29cbiAgICAgICAgICAgICQoXCIudGFiX19jb250ZW50XCIpLm5vdCh0YWIpLmFkZENsYXNzKFwidGFiX19jb250ZW50LS1oaWRkZW5cIikucmVtb3ZlQ2xhc3MoXCJ0YWJfX2NvbnRlbnQtLXZpc2libGVcIik7XG4gICAgICAgICAgICAvLyBhIGplxZtsaSBtYSwgdG8gcG9rYXp1amVteVxuICAgICAgICAgICAgJCh0YWIpLnJlbW92ZUNsYXNzKFwidGFiX19jb250ZW50LS1oaWRkZW5cIikuYWRkQ2xhc3MoXCJ0YWJfX2NvbnRlbnQtLXZpc2libGVcIik7XG4gICAgICAgICAgICAvLyDFgmFkdWplbXkgb2JyYXpraSB3IGJsb2t1IHogb2Rwb3dpZWRuaW0gaWRcbiAgICAgICAgICAgIGJMYXp5LmxvYWQoJChcIi5ibGF6eVwiLCB0YWIpLCB0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gaHR0cDovL2NvZGVwZW4uaW8vamFrdWJ0dXJza3kvcGVuL3ZFd1pvcFxuICAgICAgICBcdCQuZm4ualF1ZXJ5U2ltcGxlQ291bnRlciA9IGZ1bmN0aW9uKCBvcHRpb25zICkge1xuICAgICAgICBcdCAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAgIFx0ICAgICAgICBzdGFydDogIDAsXG4gICAgICAgIFx0ICAgICAgICBlbmQ6ICAgIDEwMCxcbiAgICAgICAgXHQgICAgICAgIGVhc2luZzogJ3N3aW5nJyxcbiAgICAgICAgXHQgICAgICAgIGR1cmF0aW9uOiA0MDAsXG4gICAgICAgIFx0ICAgICAgICBjb21wbGV0ZTogJydcbiAgICAgICAgXHQgICAgfSwgb3B0aW9ucyApO1xuICAgICAgICBcbiAgICAgICAgXHQgICAgdmFyIHRoaXNFbGVtZW50ID0gJCh0aGlzKTtcbiAgICAgICAgXG4gICAgICAgIFx0ICAgICQoe2NvdW50OiBzZXR0aW5ncy5zdGFydH0pLmFuaW1hdGUoe2NvdW50OiBzZXR0aW5ncy5lbmR9LCB7XG4gICAgICAgIFx0XHRcdGR1cmF0aW9uOiBzZXR0aW5ncy5kdXJhdGlvbixcbiAgICAgICAgXHRcdFx0ZWFzaW5nOiBzZXR0aW5ncy5lYXNpbmcsXG4gICAgICAgIFx0XHRcdHN0ZXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0XHRcdHZhciBtYXRoQ291bnQgPSBNYXRoLmNlaWwodGhpcy5jb3VudCk7XG4gICAgICAgIFx0XHRcdFx0dGhpc0VsZW1lbnQuY2hpbGRyZW4oJy5jb3VudGVyc19fY291bnQnKS50ZXh0KG1hdGhDb3VudCk7XG4gICAgICAgIFx0XHRcdH0sXG4gICAgICAgIFx0XHRcdGNvbXBsZXRlOiBzZXR0aW5ncy5jb21wbGV0ZVxuICAgICAgICBcdFx0fSk7XG4gICAgICAgIFx0fTtcbiAgICAgICAgXG4gICAgICAgIC8vIHZhciBmaW5pc2hlZE51bWJlciA9ICQoJyNmaW5pc2hlZCcpLmRhdGEoJ2ZpbmlzaGVkJyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGZpbmlzaGVkTnVtYmVyKTtcbiAgICAgICAgLy8gJCgnI2ZpbmlzaGVkJykualF1ZXJ5U2ltcGxlQ291bnRlcih7ZW5kOiBmaW5pc2hlZE51bWJlciwgZHVyYXRpb246IDMwMDB9KTtcbiAgICAgICAgLy8gJCgnI251bWJlcjInKS5qUXVlcnlTaW1wbGVDb3VudGVyKHtlbmQ6IDU1LGR1cmF0aW9uOiAzMDAwfSk7XG4gICAgICAgIC8vICQoJyNudW1iZXIzJykualF1ZXJ5U2ltcGxlQ291bnRlcih7ZW5kOiAzNTksZHVyYXRpb246IDIwMDB9KTtcbiAgICAgICAgLy8gJCgnI251bWJlcjQnKS5qUXVlcnlTaW1wbGVDb3VudGVyKHtlbmQ6IDI0NixkdXJhdGlvbjogMjUwMH0pO1xuXG4gICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vbWFyY2luLmxhYmVyLnBsLzIwMTQvMDkvb2RtaWFuYS1saWN6ZWJuaWtvdy13LWphdmFzY3JpcHQvXG4gICAgICAgICAgICB2YXIgbnVtID0gZnVuY3Rpb24odmFsdWUsIG51bWVyYWxzLCB3b3ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQwID0gdmFsdWUgJSAxMCxcbiAgICAgICAgICAgICAgICAgICAgdDEgPSB2YWx1ZSAlIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgdm8gPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAod292YWx1ZSAhPT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgdm8ucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAxICYmIG51bWVyYWxzWzFdKVxuICAgICAgICAgICAgICAgICAgICB2by5wdXNoKG51bWVyYWxzWzFdKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgodmFsdWUgPT09IDAgfHwgKHQwID49IDAgJiYgdDAgPD0gMSkgfHwgKHQwID49IDUgJiYgdDAgPD0gOSkgfHwgKHQxID4gMTAgJiYgdDEgPCAyMCkpICYmIG51bWVyYWxzWzBdKVxuICAgICAgICAgICAgICAgICAgICB2by5wdXNoKG51bWVyYWxzWzBdKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoKHQxIDwgMTAgfHwgdDEgPiAyMCkgJiYgdDAgPj0gMiAmJiB0MCA8PSA0KSAmJiBudW1lcmFsc1syXSlcbiAgICAgICAgICAgICAgICAgICAgdm8ucHVzaChudW1lcmFsc1syXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvWzFdO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICAgICAkKCcuY291bnRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gJCh0aGlzKS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IHBhcnNlSW50KCQodGhpcykuY2hpbGRyZW4oJ2EnKS5odG1sKCkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50LCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdmaW5pc2hlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuY291bnRlcl9fbGFiZWwnKS5odG1sKG51bShjb3VudCwgW1wiUHJvamVrdMOzdyB1a2/FhGN6b255Y2hcIiwgXCJQcm9qZWt0IHVrb8WEY3pvbnlcIiwgXCJQcm9qZWt0eSB1a2/FhGN6b25lXCJdKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuY291bnRlcl9fbGFiZWwnKS5odG1sKG51bShjb3VudCwgW1wiUHJvamVrdMOzdyByZWFsaXpvd2FueWNoXCIsIFwiUHJvamVrdCByZWFsaXpvd2FueVwiLCBcIlByb2pla3R5IHJlYWxpem93YW5lXCJdKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKCcuY291bnRlcnNfX2NvdW50ZXInKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9ICQodGhpcykuYXR0cignaWQnKTtcbiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSBwYXJzZUludCgkKHRoaXMpLmNoaWxkcmVuKCcuY291bnRlcnNfX2NvdW50JykuZGF0YShzdGF0dXMpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb3VudCwgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnZmluaXNoZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLmNvdW50ZXJzX19sYWJlbCcpLmh0bWwobnVtKGNvdW50LCBbXCJQcm9qZWt0w7N3IHVrb8WEY3pvbnljaFwiLCBcIlByb2pla3QgdWtvxYRjem9ueVwiLCBcIlByb2pla3R5IHVrb8WEY3pvbmVcIl0pKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ2luLXByb2dyZXNzJyl7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLmNvdW50ZXJzX19sYWJlbCcpLmh0bWwobnVtKGNvdW50LCBbXCJQcm9qZWt0w7N3IHJlYWxpem93YW55Y2hcIiwgXCJQcm9qZWt0IHJlYWxpem93YW55XCIsIFwiUHJvamVrdHkgcmVhbGl6b3dhbmVcIl0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJCgnIycrc3RhdHVzKS5qUXVlcnlTaW1wbGVDb3VudGVyKHtlbmQ6IGNvdW50LCBkdXJhdGlvbjogMjUwMH0pO1xuICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBhbmltYWNqYSB6ZSB6bWllbmlhasSFY3ltIHNpxJkgZ3JhZGllbnRlbSBvYmNpxIXFvGEgQ1BVLFxuICAgICAgICAgICAgLy8gd2nEmWMgd8WCxIVjemFtIGrEhSB0eWxrbywgZ2R5IHXFvHl0a293bmlrIGRvc3JvbHVqZSBkbyBrb8WEY2Egc3Ryb255XG4gICAgICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPj0gJChkb2N1bWVudCkuaGVpZ2h0KCkgLSAkKHdpbmRvdykuaGVpZ2h0KCkgLSA1MDApIHtcbiAgICAgICAgICAgICAgICAgICQoJy5mb290ZXItd3JhcHBlcicpLmFkZENsYXNzKCdmb290ZXItd3JhcHBlci0tYW5pbWF0ZScpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgJCgnLmZvb3Rlci13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ2Zvb3Rlci13cmFwcGVyLS1hbmltYXRlJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSgpO1xuXG4gICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFxuICAgICAgICAgICAgbGV0IGdsaWRlID0gbmV3IEdsaWRlKCcuZ2xpZGUnLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2Nhcm91c2VsJyxcbiAgICAgICAgICAgICAgICBmb2N1c0F0OiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICBwZXJWaWV3OiAxLFxuICAgICAgICAgICAgICAgIGdhcDogMjAsXG4gICAgICAgICAgICAgICAgc2xpZGVXaWR0aDogODAwXG4gICAgICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgICAgIGdsaWRlLm1vdW50KClcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAvLyBUYWsgdyBvZ8OzbGUsIHRvIG9rbm8gbW9kYWxuZSBuYWxlxbx5IG9kZHppZWxpxIcgb2RcbiAgICAgICAgLy8gU1BPTlNPUsOTVyBpIFdTUMOTxYFQUkFDWSwgenJvYmnEhyBuaWV6YWxlxbxueW0gZWxlbWVudGVtXG4gICAgICAgIFxuICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuYnJhbmQnKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YSgnYnJhbmQtZGVzYycpLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuYnJhbmRfX21vcmUnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgICAgICAkKCcuYnJhbmRfX21vcmUnKS5iaW5kKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgYnJhbmQgPSAkKHRoaXMpLnBhcmVudHMoJy5icmFuZCcpO1xuICAgICAgICAgICAgICAgIHZhciBicmFuZE5hbWUgPSBicmFuZC5kYXRhKCdicmFuZC1uYW1lJyk7XG4gICAgICAgICAgICAgICAgdmFyIGJyYW5kTGluayA9IGJyYW5kLmRhdGEoJ2JyYW5kLWxpbmsnKTtcbiAgICAgICAgICAgICAgICB2YXIgYnJhbmREZXNjID0gYnJhbmQuZGF0YSgnYnJhbmQtZGVzYycpO1xuICAgICAgICAgICAgICAgIHZhciBicmFuZExvZ28gPSBicmFuZC5maW5kKCcuYnJhbmRfX2xvZ28nKS5hdHRyKCdzcmMnKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhicmFuZCwgYnJhbmROYW1lLCBicmFuZExpbmssIGJyYW5kRGVzYywgYnJhbmRMb2dvKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgJCgnLm1vZGFsX190aXRsZScpLmh0bWwoYnJhbmROYW1lKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWxfX2NvbnRlbnQgYScpLmh0bWwoYnJhbmRMaW5rKS5hdHRyKCdocmVmJywgYnJhbmRMaW5rKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWxfX2NvbnRlbnQgcCcpLmh0bWwoYnJhbmREZXNjKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWxfX2NvbnRlbnQgcCcpLmh0bWwoYnJhbmREZXNjKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWxfX2ltYWdlJykuYXR0cignc3JjJywgYnJhbmRMb2dvKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgJChcImh0bWxcIikuYWRkQ2xhc3MoXCJkb05vdFNjcm9sbFwiKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5hZGRDbGFzcygndmlzaWJsZScpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAgICAgLy9PbiBjbGlja2luZyB0aGUgbW9kYWwgYmFja2dyb3VuZFxuICAgICAgICAgICAgJCgnW2RhdGEtbW9kYWwtY2xvc2VdJykuYmluZChcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmVDbGFzcygndmlzaWJsZScpO1xuICAgICAgICAgICAgICAgICQoXCJodG1sXCIpLnJlbW92ZUNsYXNzKFwiZG9Ob3RTY3JvbGxcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgU2xpZGVyID0gJCgnI3NsaWRlcicpLlN3aXBlKHtcbiAgICAgICAgICAgICAgYXV0bzogMCxcbiAgICAgICAgICAgICAgY29udGludW91czogdHJ1ZSxcbiAgICAgICAgICAgIH0pLmRhdGEoJ1N3aXBlJyk7XG4gICAgICAgICAgICBpZiAoU2xpZGVyKSB7XG4gICAgICAgICAgICAgICQoJy5zd2lwZV9fbmV4dCcpLm9uKCdjbGljaycsIFNsaWRlci5uZXh0KTtcbiAgICAgICAgICAgICAgJCgnLnN3aXBlX19wcmV2Jykub24oJ2NsaWNrJywgU2xpZGVyLnByZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAoZnVuY3Rpb24oJCkge1xuICAgICAgICAgICAgdmFyIHVwZGF0ZVRpbWUgPSA1O1xuICAgICAgICAgICAgdmFyIHVsdHJvbkZpbGVMb2NhdGlvbiA9IFwiaHR0cDovL1wiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgXCIvdWx0cm9uL2RhdGEuanNvblwiO1xuICAgICAgICAgICAgdmFyIHVzdGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0ZScpO1xuICAgICAgICAgICAgdmFyIHV0aW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWUnKTtcbiAgICAgICAgXG4gICAgICAgIGlmKGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdwYWdlLXRlbXBsYXRlLWxhYicpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyBQaWVyd3N6eSByZXF1ZXN0XG4gICAgICAgICAgICByZXF1ZXN0SlNPTigpO1xuICAgICAgICAgICAgd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdJbnRlcnZhbCByZXF1ZXN0Li4uJyk7XG4gICAgICAgICAgICAgICAgcmVxdWVzdEpTT04oKTtcbiAgICAgICAgICAgIH0sIHVwZGF0ZVRpbWUgKiAxMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgICAgICBmdW5jdGlvbiByZXF1ZXN0SlNPTigpIHtcbiAgICAgICAgICAgICAgICAkLmFqYXhTZXR1cCh7XG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5vdmVycmlkZU1pbWVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm92ZXJyaWRlTWltZVR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1bHRyb25GaWxlTG9jYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiTGF0ZXN0XCIsIGxhdGVzdERhdGEoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3RhdGUobGF0ZXN0RGF0YShkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lKGNhbGNUaW1lKGxhdGVzdERhdGEoZGF0YSkpKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGUsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImVyclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGUobGF0ZXN0KSB7XG4gICAgICAgICAgICAgICAgdXN0YXRlLmlubmVySFRNTCA9IGlzT3BlblRleHQobGF0ZXN0LnN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRUaW1lKHRpbWUpIHtcbiAgICAgICAgICAgICAgICB1dGltZS5pbm5lckhUTUwgPSB0aW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbGNUaW1lKGxhdGVzdCkge1xuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xuICAgICAgICAgICAgICAgIHZhciBtaW4gPSBwYXJzZUludCgodGltZSAtIGxhdGVzdC50aW1lKSAvIDYwKTtcbiAgICAgICAgICAgICAgICB2YXIgaG91cnMgPSBwYXJzZUludCgodGltZSAtIGxhdGVzdC50aW1lKSAvIDM2MDApO1xuICAgICAgICAgICAgICAgIGlmICh0aW1lIC0gbGF0ZXN0LnRpbWUgPCA2MCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHRpbWUgLSBsYXRlc3QudGltZSkgKyBcInMgdGVtdVwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGltZSAtIGxhdGVzdC50aW1lIDwgMzYwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWluICsgXCJtIHRlbXVcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtaW4gPSBtaW4gLSBob3VycyAqIDYwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG91cnMgKyBcImcgXCIgKyBtaW4gKyBcIm0gdGVtdVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICBmdW5jdGlvbiBpc09wZW5UZXh0KGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiT3R3YXJ0ZVwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlphbWtuacSZdGVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgZnVuY3Rpb24gbGF0ZXN0RGF0YShkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuc2xpY2UoLTEpWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KShqUXVlcnkpO1xuXG4gICAgfSk7XG5cbiAgICAvLyBQcmV6ZXMgemF3c3plIG5hIHBpZXJ3c3p5bSBtaWVqc2N1IC8vXG4gICAgJCgnLm1lbWJlcmNhcmQjcHJlc2lkZW50JykuaW5zZXJ0QmVmb3JlKCcjY3VycmVudF9tZW1iZXJzIC5jYXJkc1dyYXBwZXIgZGl2OmVxKDApJyk7XG5cbiAgICAvLyBEb2RhamUgZG8gPGE+IGtsYXPEmSBcImxpbmtcIlxuICAgICQoJy5wcm9qZWN0X19jb250ZW50IGEnKS5hZGRDbGFzcygnbGluaycpO1xuXG59KTsiXSwiZmlsZSI6Im1haW4ubWluLmpzIn0=
