// main.js //
// Wszystko wrzucamy tu

(function($) {
  'use strict';

  var _destroyFn;

  $.scrollupbar = function($bar, options) {
    // Default options
    options = $.extend({
      enterViewport: $.noop,
      fullyEnterViewport: $.noop,
      exitViewport: $.noop,
      partiallyExitViewport: $.noop
    }, options);

    function isFullyInViewport() {
      return $window.scrollTop() <= $bar.offset().top;
    }

    function isInViewport() {
      return $window.scrollTop() < $bar.offset().top + $bar.outerHeight();
    }

    var $window = $(window),
        $document = $(document),
        minY = $bar.css('position') == 'fixed' ? 0 : $bar.offset().top,
        lastY = $window.scrollTop(), // Use last Y to detect scroll direction.
        initialPosTop = $bar.position().top,
        iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent),
        timeout;

    $.scrollupbar.isInViewport = isInViewport();
    $.scrollupbar.isFullyInViewport = isFullyInViewport();

    // iOS can't handle momentum scroll properly (See discussion on
    // http://stackoverflow.com/questions/2863547).
    if (!iOS) {
      $window.on('scroll.scrollupbar', function() {
        var y = $window.scrollTop(),
            barHeight = $bar.outerHeight();

        // Ignore elastic scrolling.
        if (y < 0 || y > ($document.height() - $window.height())) {
          return;
        }

        // Cancel the event fired by the previous scroll.
        if (timeout) {
          clearTimeout(timeout);
        }

        if (y < lastY) { // Scrolling up
          // If the bar is hidden, place it right above the top frame.
          if (!$.scrollupbar.isInViewport && lastY - barHeight >= minY) {
            $bar.css('top', lastY - barHeight);
            $.scrollupbar.isInViewport = true;
            options.enterViewport();
          }

          // Scrolls up bigger than the bar's height fixes the bar on top.
          if (isFullyInViewport()) {
            if (y >= minY) {
              $bar.css({
                'position': 'fixed',
                'top': 0
              });
            } else {
              $bar.css({
                'position': 'absolute',
                'top': initialPosTop
              });
            }

            if (!$.scrollupbar.isFullyInViewport) {
              $.scrollupbar.isFullyInViewport = true;
              options.fullyEnterViewport();
            }
          }

          // Fire an event to reveal the entire bar after 400ms if the scroll
          // wasn't big enough.
          timeout = setTimeout(function() {
            if (!isFullyInViewport()) {
              $bar.css({
                'position': 'fixed',
                'top': $bar.offset().top - y
              });

              $bar.animate({'top': 0}, 100, function() {
                $.scrollupbar.isFullyInViewport = true;
                options.fullyEnterViewport();
              });
            }
          }, 400);
        } else if (y > lastY) { // Scrolling down
          // Unfix the bar allowing it to scroll with the page.
          if ($.scrollupbar.isFullyInViewport) {
            $bar.css({
              'position': 'absolute',
              'top': lastY > minY ? lastY : initialPosTop
            });

            if (!isFullyInViewport()) {
              $.scrollupbar.isFullyInViewport = false;
              options.partiallyExitViewport();
            }
          }

          if ($.scrollupbar.isInViewport && !isInViewport()) {
            $.scrollupbar.isInViewport = false;
            options.exitViewport();
          }

          // Fire an event to hide the entire bar after 400ms if the scroll
          // wasn't big enough.
          timeout = setTimeout(function() {
            if (isInViewport() && y - barHeight >= minY) {
              $bar.animate({'top': y - barHeight}, 100, function() {
                $.scrollupbar.isInViewport = false;
                options.exitViewport();
              });
            }
          }, 400);
        }

        lastY = y;
      });
    } else { // Fallback simplified behaviour for iOS.
      $window.on('touchstart.scrollupbar', function () {
        lastY = $window.scrollTop();
      });

      $window.on('touchend.scrollupbar', function () {
        var y = $window.scrollTop();

        if (y < lastY || y - $bar.outerHeight() < minY) { // Scrolling up
          if (y <= minY) {
            // Restore original position.
            $bar.css({
              'position': 'absolute',
              'top': initialPosTop
            });

            $bar.show(function() {
              $.scrollupbar.isInViewport = true;
              $.scrollupbar.isFullyInViewport = true;
              options.enterViewport();
              options.fullyEnterViewport();
            });
          } else {
            $bar.css({
              'position': 'fixed',
              'top': 0
            });

            $.scrollupbar.isInViewport = true;
            options.enterViewport();

            $bar.slideDown(function() {
              $.scrollupbar.isFullyInViewport = true;
              options.fullyEnterViewport();
            });
          }
        } else if (y > lastY) { // Scrolling down
          $.scrollupbar.isFullyInViewport = false;
          options.partiallyExitViewport();

          $bar.slideUp(function() {
            $.scrollupbar.isInViewport = false;
            options.exitViewport();
          });
        }

        lastY = y;
      });
    }

    _destroyFn = function() {
      // Unbind all listeners added by scrollupbar plugin
      $window.off('.scrollupbar');

      // Restore original bar position.
      $bar.css({
        'position': 'absolute',
        'top': initialPosTop
      });
    };

    return $bar;
  };

  $.scrollupbar.destroy = function() {
    if (_destroyFn) {
      return _destroyFn();
    }
  };

  $.fn.scrollupbar = function(options) {
    return $.scrollupbar(this, options);
  };
})(jQuery);

(function($){

    /**
     * Copyright 2012, Digital Fusion
     * Licensed under the MIT license.
     * http://teamdf.com/jquery-plugins/license/
     *
     * @author Sam Sehnert
     * @desc A small plugin that checks whether elements are within
     *       the user visible viewport of a web browser.
     *       only accounts for vertical position, not horizontal.
     */
    var $w = $(window);
    $.fn.visible = function(partial,hidden,direction){

        if (this.length < 1)
            return;

        var $t        = this.length > 1 ? this.eq(0) : this,
            t         = $t.get(0),
            vpWidth   = $w.width(),
            vpHeight  = $w.height(),
            direction = (direction) ? direction : 'both',
            clientSize = hidden === true ? t.offsetWidth * t.offsetHeight : true;

        if (typeof t.getBoundingClientRect === 'function'){

            // Use this native browser method, if available.
            var rec = t.getBoundingClientRect(),
                tViz = rec.top    >= 0 && rec.top    <  vpHeight,
                bViz = rec.bottom >  0 && rec.bottom <= vpHeight,
                lViz = rec.left   >= 0 && rec.left   <  vpWidth,
                rViz = rec.right  >  0 && rec.right  <= vpWidth,
                vVisible   = partial ? tViz || bViz : tViz && bViz,
                hVisible   = partial ? lViz || rViz : lViz && rViz;

            if(direction === 'both')
                return clientSize && vVisible && hVisible;
            else if(direction === 'vertical')
                return clientSize && vVisible;
            else if(direction === 'horizontal')
                return clientSize && hVisible;
        } else {

            var viewTop         = $w.scrollTop(),
                viewBottom      = viewTop + vpHeight,
                viewLeft        = $w.scrollLeft(),
                viewRight       = viewLeft + vpWidth,
                offset          = $t.offset(),
                _top            = offset.top,
                _bottom         = _top + $t.height(),
                _left           = offset.left,
                _right          = _left + $t.width(),
                compareTop      = partial === true ? _bottom : _top,
                compareBottom   = partial === true ? _top : _bottom,
                compareLeft     = partial === true ? _right : _left,
                compareRight    = partial === true ? _left : _right;

            if(direction === 'both')
                return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop)) && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
            else if(direction === 'vertical')
                return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop));
            else if(direction === 'horizontal')
                return !!clientSize && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
        }
    };

})(jQuery);

jQuery(function($) {

  /**
   * Dropy
   * http://codepen.io/Tombek/pen/OPvpLe
   */
  var dropy = {
    $dropys: null,
    openClass: 'open',
    selectClass: 'selected',
    init: function(){
      var self = this;
  
      self.$dropys = $('.dropy');
      self.eventHandler();
    },
    eventHandler: function(){
      var self = this;
  
      // Opening a dropy
      self.$dropys.find('.dropy__title').click(function(){
        self.$dropys.removeClass(self.openClass);
        $(this).parents('.dropy').addClass(self.openClass);
      });
  
      // Click on a dropy list
      self.$dropys.find('.dropy__content ul li a').click(function(){
        var $that = $(this);
        var $dropy = $that.parents('.dropy');
        var $input = $dropy.find('input');
        var $title = $(this).parents('.dropy').find('.dropy__title span');
  
        // Remove selected class
        $dropy.find('.dropy__content a').each(function(){
          $(this).removeClass(self.selectClass);
        });
  
        // Update selected value
        $title.html($that.html());
        $input.val($that.attr('data-value')).trigger('change');
  
        // If back to default, remove selected class else addclass on right element
        if($that.hasClass('dropy__header')){
          $title.removeClass(self.selectClass);
          $title.html($title.attr('data-title'));
        }
        else{
          $title.addClass(self.selectClass);
          $that.addClass(self.selectClass);
        }
  
        // Close dropdown
        $dropy.removeClass(self.openClass);
      });
  
      // Close all dropdown onclick on another element
      $(document).bind('click', function(e){
          if (! $(e.target).parents().hasClass('dropy')){ self.$dropys.removeClass(self.openClass); }
      });
    }
  };
  
  $(function(){
    dropy.init();
  });

     function cardExcerpt() {
      $(".card__excerpt").text(function(index, currentText) {
        return currentText.substr(0, 140) + '\u2026';
      });
    }
    cardExcerpt();

  // Pakuje mniejsze obrazki bez podpisu w <figure> //
  // Jeśli obrazek ma tytuł, tym się zajmuje php funkcja w project-functions.php
  $('.project__content p').each(function(index) {
    var some_img = $(this).find('img');
    var width = some_img.width();
    if (width < 980) {
      some_img.wrap("<figure></figure>");
    }
  });

  //Skraca imiona, by nie wychodziły za bloki
  $('.membercard__name a').each(function(index) {
    var length = $(this).html().length;
    if (length > 17) {
      var name = $(this).text();
      $(this).parent().addClass('membercard__name--tooLong');
      // console.log(name);
      var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
      // console.log(trimmed_name);
      $(this).text(trimmed_name);
    }
  });
  
  $('.membercardSmall__name a').each(function(index) {
    var length = $(this).html().length;
    if (length > 14) {
      var name = $(this).text();
      // console.log(name);
      var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
      // console.log(trimmed_name);
      $(this).text(trimmed_name);
    }
  });

  // Notyfikacje, powiadomienia //
  $(".note-close").click(function() {
    $(this).parent()
      .animate({
        opacity: 0
      }, 250, function() {
        $(this)
          .animate({
            marginBottom: 0
          }, 250)
          .children()
          .animate({
            padding: 0
          }, 250)
          .wrapInner("<div />")
          .children()
          .slideUp(250, function() {
            $(this).closest(".note").remove();
          });
      });
  });

  // Animacje dla banera rekrutacji //
  $('label.button').on('click', function() {
    $('.fb').addClass('animated fadeInUp');
    $('.date .icon-container').addClass('animated slideInLeft');
    $('.date span').addClass('animated slideInLeft');
    $('.location .icon-container').addClass('animated slideInRight');
    $('.location span').addClass('animated slideInRight');
  
  });
  $('#close_banner').on('click', function() {
    $('.fb').removeClass('animated fadeInUp');
    $('.date .icon-container').removeClass('animated slideInLeft');
    $('.date span').removeClass('animated slideInLeft');
    $('.location .icon-container').removeClass('animated slideInRight');
    $('.location span').removeClass('animated slideInRight');
  });
  
  // http://stackoverflow.com/questions/24070627/create-dropdown-banner-when-user-first-visits-website
  // Pozwalają otwierać baner tylko przy pierwszej wizycie
  
  // cookie-js

  //// = partials/show-nicknames.js

  $(document).ready(function(){
      // $("#nav-mobile").html($("#nav-main").html());
      $("#nav-trigger .navicon-button").click(function(){
        console.info('Burger clicked');
          if ($("#nav ul").hasClass("nav__menu--expanded")) {
              $("#nav ul").removeClass("nav__menu--expanded").slideUp(250);
              $(this).removeClass("open");
          } else {
              $("#nav ul").addClass("nav__menu--expanded").slideDown(250);
              $(this).addClass("open");
          }
      });
  });

  $(document).ready(function() {
    Slider = $('#slider').Swipe({
      auto: 0,
      continuous: true,
    }).data('Swipe');
    if (Slider) {
      $('.next').on('click', Slider.next);
      $('.prev').on('click', Slider.prev);
    }
  });

  // przez to gnwo nie działa .on()
  ////= partials/smooth-scrolling.js

  

  (function() {
      // Żeby tooltip nie klikał
      $('.tooltip').on('click', function(e) {
          e.preventDefault();
      });
  
      $('[data-github]').hover(function(e) {
          loadGithub();
          $(this).children('.tooltip').addClass('tooltip--active');
      }, function(e) {
          $(this).children('.tooltip').removeClass('tooltip--active');
      });
  
      $('[data-lastfm]').hover(function(e) {
          loadLastfm();
          $(this).children('.tooltip').addClass('tooltip--active');
      }, function(e) {
          $(this).children('.tooltip').removeClass('tooltip--active');
      });
  })();

  function loadGithub() {
      // Pobiera url z hrefa
      var profileUrl = $('a[data-github]').attr('href');
      // Odpowiednio obcina go do username
      var username = profileUrl.substr(19);
      // Dodaje username do url zapytania
      var requri = 'https://api.github.com/users/' + username;
      // Sprawdza, czy tooltip pusty, by nie generować nowych zapytań
      // i nie dodawać po raz kolejny dane do tooltipa
      if ($('[data-github] .tooltip').is(':empty')) {
          requestJSON(requri, function(json) {
              if (json.message === "Nie znaleziono" || username === '') {
                  $('[data-github] .tooltip').html("<h2>Brak informacji</h2>");
              } else {
                  username = json.login;
                  var profileurl = json.html_url;
                  var reposnum = json.public_repos;
                  var aviurl = json.avatar_url;
  
  
                  var outhtml = '<div class="gh">' +
                      '<h4 class="gh__name"><a class="link" href="' + profileurl + '"><img class="gh__avatar" src="' + aviurl + '">@' + username + '</a></h4>';
                  outhtml = outhtml + '<span class="gh__repos">Repozytoriów: ' + reposnum + '</span><hr/></div>';
                  $('[data-github] .tooltip').append(outhtml);
  
              } // end else statement
          }); // end requestJSON Ajax call
      }
  
      function requestJSON(url, callback) {
          $.ajax({
              url: url,
              complete: function(xhr) {
                  callback.call(null, xhr.responseJSON);
              }
          });
      }
  }

  function loadLastfm() {
      // Pobiera url z hrefa
      var profileUrl = $('a[data-lastfm]').attr('href');
      // Odpowiednio obcina go do username
      var username = profileUrl.substr(27);
      var baseUrl = 'http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks';
      var api_key = '299020c062c481f083ecd0276c315e3a';
  
      var requestUrl = baseUrl + '&user=' + username + '&api_key=' + api_key + '&format=json';
      console.log(username);
      if ($('[data-lastfm] .tooltip').is(':empty')) {
          $.getJSON(requestUrl, function(data) {
              var artist = data.recenttracks.track[0].artist["#text"];
              var song = data.recenttracks.track[0]["name"];
              var cover = data.recenttracks.track[0].image[3]["#text"];
              if (cover === "") {
                  cover = "http://img2-ak.lst.fm/i/u/174s/4128a6eb29f94943c9d206c08e625904.png";
              }
              var outhtml = '<div class="lf"><img class="lf__cover" src="' + cover + '"/><div class="lf__trackInfo"><span class="lf__artist">' + artist + '</span><span class="lf__song">' + song + '</span></div></div>';
              $('[data-lastfm] .tooltip').append(outhtml);
          });
      }
  }

  $(document).ready(function() {
      var bLazy = new Blazy({
        offset: 20,
        selector: '.blazy',
        loadInvisible: false,
        breakpoints: [{
          width: 360, // Max-width
          src: 'data-src-small'
        }],
        success: function(element) {
          $(element).parent().removeClass('loading', 500);
          updateCounter();
        },
        error: function(element, msg) {
          if (msg === 'missing') {
            $(element).parent().removeClass('loading', 500); // Data-src is missing
            console.error("bLazy: data-src is missing");
          } else if (msg === 'invalid') {
            $(element).parent().removeClass('loading', 500);
            // Data-src is invalid
            console.error("bLazy: data-src is invalid");
    
          }
        }
      });
      // not needed, only here to illustrate amount of loaded images
      var imageLoaded = 0;
    
      function updateCounter() {
        imageLoaded++;
        console.info("bLazy: Images loaded: %d", imageLoaded);
      }
    
      // tabs(bLazy);

    ////= member.js

    ////= partials/infinite-scroll.js

    (function() {
        var ajax_url = $('.global').attr('data-ajax-url');
        var post_offset = 0;
        var incNumber = 6; // ilość postów do załadowania
    
        var projects = (function(setProjects) {
            var loaded;
            var total;
            return {
                incLoaded: function() {
                    loaded = loaded + incNumber;
                },
                getLoaded: function() {
                    return loaded;
                },
                setLoaded: function(setProjects) {
                    loaded = setProjects;
                },
                setTotal: function(setProjects) {
                    total = setProjects;
                },
                getTotal: function() {
                    return total;
                }
            };
        })();
        var loadingButton = (function(button){
            return {
                showSpinner: function(button) {
                    button.html('<div class="spinner"></div>');
                },
                showCaption: function(button) {
                    button.html('Zobacz starsze');
                },
                hide: function(button) {
                    button.hide();
                }
            };
        })();
    
        $('#load_more_posts').on('click', loadMore);
        $('#load_more').on('click', loadProjects);
    
        function loadMore() {
            console.log('Clicked load_more');
            $(this).html('<div class="spinner"></div>');
            post_offset = parseInt(post_offset) + 6;
            $.ajax({
                url: ajax_url,
                type: 'POST',
                data: {
                    action: 'load_posts',
                    post_offset: post_offset,
                },
                success: function(data) {
                    $('#load_more_posts').html('Zobacz starsze');
                    $('#posts .cardsWrapper').append(data);
                    console.info('Ajax: OK');
                    bLazy.revalidate();
                    cardExcerpt();
                }
            });
        }
    
        function loadProjects() {
            var thisParent = $(this).parent();
            // ustawia całkowitą liczbę danych projektów
            projects.setTotal(thisParent.attr('data-total'));
            // jeśli jeszcze nie pobierano ajaxem projektów, to ustawia wartość
            // równą już wyświetlonych
            if (!projects.getLoaded()) {
                projects.setLoaded(thisParent.find('.card').length);
                console.log('Already:', projects.getLoaded());
            }
            var projects_status = thisParent.attr('data-projects-status');
            post_offset = parseInt(post_offset) + incNumber;
    
            if (projects.getTotal() > projects.getLoaded()) {
                loadingButton.showSpinner($('#load_more'));
                $.ajax({
                    url: ajax_url,
                    type: 'POST',
                    data: {
                        action: 'load_projects',
                        post_offset: post_offset,
                        projects_status: projects_status,
                    },
                    success: function(data) {
                        thisParent.children('.cardsWrapper').append(data);
                        bLazy.revalidate();
                        cardExcerpt();
                        loadingButton.showCaption($('#load_more'));
                        projects.incLoaded();
                        console.info('Ajax: Loaded more %s projects: %d/%d', projects_status, projects.getLoaded(), projects.getTotal());
                        if (projects.getTotal() <= projects.getLoaded()) {
                            loadingButton.hide($('#load_more'));
                        }
                    }
                });
            } else {
                return false;
            }
        }
    })();

    function initTopbar() {
        $('.topbarWrapper').scrollupbar({
            enterViewport: function() {
                $('.topbarWrapper').addClass('topbarWrapper--visible');
            },
            fullyEnterViewport: function() {
                $('#last-event').text('fullyEnterViewport');
            },
            exitViewport: function() {
                $('#last-event').text('exitViewport');
            },
            partiallyExitViewport: function() {
                $('#last-event').text('partiallyExitViewport');
            }
        });
    }
    initTopbar();
    
    if ($(window).width() < 750) {
        $.scrollupbar.destroy('.topbarWrapper');
    }
    
    $(window).scroll(function(event) {
        // didScroll = true;
        var st = $(this).scrollTop();
        // Gdy jesteśmy na samej górze, to pokazyjemy całe logo
        if (st === 0) {
            $('.topbarWrapper').removeClass('topbarWrapper--visible');
        }
    });

    var tabs = (function() {
        var currentTab;
        return {
            init: function() {
                // pobieramy href
                currentTab = $('.tabsMenu__item--current .link--tab').attr('href');
                // href jest jednocześnie id odpowiedniego tabu, który wyświetlamy
                $(currentTab).addClass('tab__content--visible');
                // ładujemy obrazki
                bLazy.load($(".blazy", currentTab), true);
                console.info('Tabs initiated:', currentTab);
            },
            reset: function() {
                // Z tym #tabsReset, to taki hack. Wykorzystywany dlatego, że
                // po kliknięciu chowają się wszystkie taby, oprócz tej z odpowiednim id
                currentTab = $('#tabsReset .link--tab').attr('href');
                $(currentTab).removeClass("tab__content--hidden").addClass("tab__content--visible");
                console.info('Tabs initiated:', currentTab);
            }
        };
    })();
    tabs.init();
    
    $(".global").on('click', '.link--tab', function(event) {
        // wyłącza domyślne przejście na adres linku
        event.preventDefault();
        // dodaje klasę do <li>
        $(this).parent().addClass("tabsMenu__item--current");
        // usuwa klasę z <li>
        $(this).parent().siblings().removeClass("tabsMenu__item--current");
        // pobieramy id z hrefu
        var tab = $(this).attr("href");
        // jeśli blok nie ma takiego id, to chowamy go
        $(".tab__content").not(tab).addClass("tab__content--hidden").removeClass("tab__content--visible");
        // a jeśli ma, to pokazujemy
        $(tab).removeClass("tab__content--hidden").addClass("tab__content--visible");
        // ładujemy obrazki w bloku z odpowiednim id
        bLazy.load($(".blazy", tab), true);
    });

    // http://codepen.io/jakubtursky/pen/vEwZop
    	$.fn.jQuerySimpleCounter = function( options ) {
    	    var settings = $.extend({
    	        start:  0,
    	        end:    100,
    	        easing: 'swing',
    	        duration: 400,
    	        complete: ''
    	    }, options );
    
    	    var thisElement = $(this);
    
    	    $({count: settings.start}).animate({count: settings.end}, {
    			duration: settings.duration,
    			easing: settings.easing,
    			step: function() {
    				var mathCount = Math.ceil(this.count);
    				thisElement.children('.counters__count').text(mathCount);
    			},
    			complete: settings.complete
    		});
    	};
    
    // var finishedNumber = $('#finished').data('finished');
    // console.log(finishedNumber);
    // $('#finished').jQuerySimpleCounter({end: finishedNumber, duration: 3000});
    // $('#number2').jQuerySimpleCounter({end: 55,duration: 3000});
    // $('#number3').jQuerySimpleCounter({end: 359,duration: 2000});
    // $('#number4').jQuerySimpleCounter({end: 246,duration: 2500});

    (function() {
        // https://marcin.laber.pl/2014/09/odmiana-liczebnikow-w-javascript/
        var num = function(value, numerals, wovalue) {
            var t0 = value % 10,
                t1 = value % 100,
                vo = [];
            if (wovalue !== true)
                vo.push(value);
            if (value === 1 && numerals[1])
                vo.push(numerals[1]);
            else if ((value === 0 || (t0 >= 0 && t0 <= 1) || (t0 >= 5 && t0 <= 9) || (t1 > 10 && t1 < 20)) && numerals[0])
                vo.push(numerals[0]);
            else if (((t1 < 10 || t1 > 20) && t0 >= 2 && t0 <= 4) && numerals[2])
                vo.push(numerals[2]);
            return vo[1];
        };
    
        $('.counter').each(function(index) {
            var status = $(this).attr('id');
            var count = parseInt($(this).children('a').html());
            console.log(count, status);
            if (status === 'finished') {
                $(this).find('.counter__label').html(num(count, ["Projektów ukończonych", "Projekt ukończony", "Projekty ukończone"]));
            } else {
                $(this).find('.counter__label').html(num(count, ["Projektów realizowanych", "Projekt realizowany", "Projekty realizowane"]));
            }
        });
        $('.counters__counter').each(function(index) {
            var status = $(this).attr('id');
            var count = parseInt($(this).children('.counters__count').data(status));
            console.log(count, status);
            if (status === 'finished') {
                $(this).find('.counters__label').html(num(count, ["Projektów ukończonych", "Projekt ukończony", "Projekty ukończone"]));
            } else if (status === 'in-progress'){
                $(this).find('.counters__label').html(num(count, ["Projektów realizowanych", "Projekt realizowany", "Projekty realizowane"]));
            }
            $('#'+status).jQuerySimpleCounter({end: count, duration: 2500});
    
        });
    
    })();

    (function() {
        // animacja ze zmieniającym się gradientem obciąża CPU,
        // więc włączam ją tylko, gdy użytkownik dosroluje do końca strony
        $(window).scroll(function () {
           if ($(window).scrollTop() >= $(document).height() - $(window).height() - 500) {
              $('.footer-wrapper').addClass('footer-wrapper--animate');
          } else {
              $('.footer-wrapper').removeClass('footer-wrapper--animate');
          }
        });
    })();

    (function() {
        $(".banner__middleTitle").one('animationend webkitAnimationEnd oAnimationEnd oanimationend MSAnimationEnd',
        function() {
            $(this).removeClass('banner__middleTitle--animation');
        });
        $(".banner__leftTitle").one('animationend webkitAnimationEnd oAnimationEnd oanimationend MSAnimationEnd',
        function() {
            $(this).removeClass('banner__leftTitle--animation');
        });
        $(".banner__rightTitle").one('animationend webkitAnimationEnd oAnimationEnd oanimationend MSAnimationEnd',
        function() {
            $(this).removeClass('banner__rightTitle--animation');
        });
    
    
        $('.banner__left').hover(function() {
            $('.banner__middle').addClass('banner__middle--collapsedL');
            $('.banner__middleTitle').addClass('banner__middleTitle--opacity80');
            $(this).addClass('banner__left--mvR');
        }, function() {
            $('.banner__middle').removeClass('banner__middle--collapsedL');
            $('.banner__middleTitle').removeClass('banner__middleTitle--opacity80');
            $(this).removeClass('banner__left--mvR');
        });
        $('.banner__right').hover(function() {
            $('.banner__middle').addClass('banner__middle--collapsedR');
            $('.banner__middleTitle').addClass('banner__middleTitle--opacity80');
            $(this).addClass('banner__right--mvL');
    
        }, function() {
            $('.banner__middle').removeClass('banner__middle--collapsedR');
            $('.banner__middleTitle').removeClass('banner__middleTitle--opacity80');
            $(this).removeClass('banner__right--mvL');
    
        });
    })();

    // http://codepen.io/codyhouse/pen/szKvm
    
    //set your google maps parameters
    var $latitude = 51.10830,
        $longitude = 17.06542,
        $map_zoom = 16;
    
    //google map custom marker icon - .png fallback for IE11
    var is_internetExplorer11 = navigator.userAgent.toLowerCase().indexOf('trident') > -1;
    var $marker_url = (is_internetExplorer11) ? 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location.png' : 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/cd-icon-location_1.svg';
    
    //define the basic color of your map, plus a value for saturation and brightness
    var $main_color = '#6c4892',
        $saturation = -20,
        $brightness = 5;
    
    //we define here the style of the map
    var style = [{
            //set saturation for the labels on the map
            elementType: "labels",
            stylers: [{
                saturation: $saturation
            }]
        }, { //poi stands for point of interest - don't show these lables on the map
            featureType: "poi",
            elementType: "labels",
            stylers: [{
                visibility: "on"
            }]
        }, {
            //don't show highways lables on the map
            featureType: 'road.highway',
            elementType: 'labels',
            stylers: [{
                visibility: "off"
            }]
        }, {
            //don't show local road lables on the map
            featureType: "road.local",
            elementType: "labels.icon",
            stylers: [{
                visibility: "off"
            }]
        }, {
            //don't show arterial road lables on the map
            featureType: "road.arterial",
            elementType: "labels.icon",
            stylers: [{
                visibility: "off"
            }]
        }, {
            //don't show road lables on the map
            featureType: "road",
            elementType: "geometry.stroke",
            stylers: [{
                visibility: "off"
            }]
        },
        //style different elements on the map
        {
            featureType: "transit",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "poi",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "poi.government",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "poi.sport_complex",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "poi.attraction",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "off"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "poi.business",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "transit",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "transit.station",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "landscape",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
    
        }, {
            featureType: "road",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "road.highway",
            elementType: "geometry.fill",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }, {
            featureType: "water",
            elementType: "geometry",
            stylers: [{
                hue: $main_color
            }, {
                visibility: "on"
            }, {
                lightness: $brightness
            }, {
                saturation: $saturation
            }]
        }
    ];
    
    //set google map options
    var map_options = {
        center: new google.maps.LatLng($latitude, $longitude),
        zoom: $map_zoom,
        panControl: false,
        zoomControl: false,
        mapTypeControl: false,
        streetViewControl: false,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        scrollwheel: false,
        styles: style,
    };
    //inizialize the map
    var map = new google.maps.Map(document.getElementById('snrg-map'), map_options);
    //add a custom marker to the map
    var marker = new google.maps.Marker({
        position: new google.maps.LatLng($latitude, $longitude),
        map: map,
        visible: true,
        icon: $marker_url,
    });
    
    //add custom buttons for the zoom-in/zoom-out on the map
    function CustomZoomControl(controlDiv, map) {
        //grap the zoom elements from the DOM and insert them in the map
        var controlUIzoomIn = document.getElementById('snrg-zoom-in'),
            controlUIzoomOut = document.getElementById('snrg-zoom-out');
        controlDiv.appendChild(controlUIzoomIn);
        controlDiv.appendChild(controlUIzoomOut);
    
        // Setup the click event listeners and zoom-in or out according to the clicked element
        google.maps.event.addDomListener(controlUIzoomIn, 'click', function() {
            map.setZoom(map.getZoom() + 1);
        });
        google.maps.event.addDomListener(controlUIzoomOut, 'click', function() {
            map.setZoom(map.getZoom() - 1);
        });
    }
    
    var zoomControlDiv = document.createElement('div');
    var zoomControl = new CustomZoomControl(zoomControlDiv, map);
    
    //insert the zoom div on the top left of the map
    map.controls[google.maps.ControlPosition.LEFT_TOP].push(zoomControlDiv);

  });

  // Prezes zawsze na pierwszym miejscu //
  $('.membercard#president').insertBefore('#current_members .cardsWrapper div:eq(0)');

  // Dodaje do <a> klasę "link"
  $('.project__content a').addClass('link');

});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1haW4uanMgLy9cbi8vIFdzenlzdGtvIHdyenVjYW15IHR1XG5cbihmdW5jdGlvbigkKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgX2Rlc3Ryb3lGbjtcblxuICAkLnNjcm9sbHVwYmFyID0gZnVuY3Rpb24oJGJhciwgb3B0aW9ucykge1xuICAgIC8vIERlZmF1bHQgb3B0aW9uc1xuICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7XG4gICAgICBlbnRlclZpZXdwb3J0OiAkLm5vb3AsXG4gICAgICBmdWxseUVudGVyVmlld3BvcnQ6ICQubm9vcCxcbiAgICAgIGV4aXRWaWV3cG9ydDogJC5ub29wLFxuICAgICAgcGFydGlhbGx5RXhpdFZpZXdwb3J0OiAkLm5vb3BcbiAgICB9LCBvcHRpb25zKTtcblxuICAgIGZ1bmN0aW9uIGlzRnVsbHlJblZpZXdwb3J0KCkge1xuICAgICAgcmV0dXJuICR3aW5kb3cuc2Nyb2xsVG9wKCkgPD0gJGJhci5vZmZzZXQoKS50b3A7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNJblZpZXdwb3J0KCkge1xuICAgICAgcmV0dXJuICR3aW5kb3cuc2Nyb2xsVG9wKCkgPCAkYmFyLm9mZnNldCgpLnRvcCArICRiYXIub3V0ZXJIZWlnaHQoKTtcbiAgICB9XG5cbiAgICB2YXIgJHdpbmRvdyA9ICQod2luZG93KSxcbiAgICAgICAgJGRvY3VtZW50ID0gJChkb2N1bWVudCksXG4gICAgICAgIG1pblkgPSAkYmFyLmNzcygncG9zaXRpb24nKSA9PSAnZml4ZWQnID8gMCA6ICRiYXIub2Zmc2V0KCkudG9wLFxuICAgICAgICBsYXN0WSA9ICR3aW5kb3cuc2Nyb2xsVG9wKCksIC8vIFVzZSBsYXN0IFkgdG8gZGV0ZWN0IHNjcm9sbCBkaXJlY3Rpb24uXG4gICAgICAgIGluaXRpYWxQb3NUb3AgPSAkYmFyLnBvc2l0aW9uKCkudG9wLFxuICAgICAgICBpT1MgPSAvKGlQYWR8aVBob25lfGlQb2QpL2cudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxcbiAgICAgICAgdGltZW91dDtcblxuICAgICQuc2Nyb2xsdXBiYXIuaXNJblZpZXdwb3J0ID0gaXNJblZpZXdwb3J0KCk7XG4gICAgJC5zY3JvbGx1cGJhci5pc0Z1bGx5SW5WaWV3cG9ydCA9IGlzRnVsbHlJblZpZXdwb3J0KCk7XG5cbiAgICAvLyBpT1MgY2FuJ3QgaGFuZGxlIG1vbWVudHVtIHNjcm9sbCBwcm9wZXJseSAoU2VlIGRpc2N1c3Npb24gb25cbiAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI4NjM1NDcpLlxuICAgIGlmICghaU9TKSB7XG4gICAgICAkd2luZG93Lm9uKCdzY3JvbGwuc2Nyb2xsdXBiYXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHkgPSAkd2luZG93LnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgYmFySGVpZ2h0ID0gJGJhci5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgIC8vIElnbm9yZSBlbGFzdGljIHNjcm9sbGluZy5cbiAgICAgICAgaWYgKHkgPCAwIHx8IHkgPiAoJGRvY3VtZW50LmhlaWdodCgpIC0gJHdpbmRvdy5oZWlnaHQoKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDYW5jZWwgdGhlIGV2ZW50IGZpcmVkIGJ5IHRoZSBwcmV2aW91cyBzY3JvbGwuXG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHkgPCBsYXN0WSkgeyAvLyBTY3JvbGxpbmcgdXBcbiAgICAgICAgICAvLyBJZiB0aGUgYmFyIGlzIGhpZGRlbiwgcGxhY2UgaXQgcmlnaHQgYWJvdmUgdGhlIHRvcCBmcmFtZS5cbiAgICAgICAgICBpZiAoISQuc2Nyb2xsdXBiYXIuaXNJblZpZXdwb3J0ICYmIGxhc3RZIC0gYmFySGVpZ2h0ID49IG1pblkpIHtcbiAgICAgICAgICAgICRiYXIuY3NzKCd0b3AnLCBsYXN0WSAtIGJhckhlaWdodCk7XG4gICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzSW5WaWV3cG9ydCA9IHRydWU7XG4gICAgICAgICAgICBvcHRpb25zLmVudGVyVmlld3BvcnQoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTY3JvbGxzIHVwIGJpZ2dlciB0aGFuIHRoZSBiYXIncyBoZWlnaHQgZml4ZXMgdGhlIGJhciBvbiB0b3AuXG4gICAgICAgICAgaWYgKGlzRnVsbHlJblZpZXdwb3J0KCkpIHtcbiAgICAgICAgICAgIGlmICh5ID49IG1pblkpIHtcbiAgICAgICAgICAgICAgJGJhci5jc3Moe1xuICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdmaXhlZCcsXG4gICAgICAgICAgICAgICAgJ3RvcCc6IDBcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkYmFyLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICAndG9wJzogaW5pdGlhbFBvc1RvcFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCEkLnNjcm9sbHVwYmFyLmlzRnVsbHlJblZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQgPSB0cnVlO1xuICAgICAgICAgICAgICBvcHRpb25zLmZ1bGx5RW50ZXJWaWV3cG9ydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEZpcmUgYW4gZXZlbnQgdG8gcmV2ZWFsIHRoZSBlbnRpcmUgYmFyIGFmdGVyIDQwMG1zIGlmIHRoZSBzY3JvbGxcbiAgICAgICAgICAvLyB3YXNuJ3QgYmlnIGVub3VnaC5cbiAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghaXNGdWxseUluVmlld3BvcnQoKSkge1xuICAgICAgICAgICAgICAkYmFyLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2ZpeGVkJyxcbiAgICAgICAgICAgICAgICAndG9wJzogJGJhci5vZmZzZXQoKS50b3AgLSB5XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICRiYXIuYW5pbWF0ZSh7J3RvcCc6IDB9LCAxMDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuZnVsbHlFbnRlclZpZXdwb3J0KCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH0gZWxzZSBpZiAoeSA+IGxhc3RZKSB7IC8vIFNjcm9sbGluZyBkb3duXG4gICAgICAgICAgLy8gVW5maXggdGhlIGJhciBhbGxvd2luZyBpdCB0byBzY3JvbGwgd2l0aCB0aGUgcGFnZS5cbiAgICAgICAgICBpZiAoJC5zY3JvbGx1cGJhci5pc0Z1bGx5SW5WaWV3cG9ydCkge1xuICAgICAgICAgICAgJGJhci5jc3Moe1xuICAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAndG9wJzogbGFzdFkgPiBtaW5ZID8gbGFzdFkgOiBpbml0aWFsUG9zVG9wXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFpc0Z1bGx5SW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNGdWxseUluVmlld3BvcnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgb3B0aW9ucy5wYXJ0aWFsbHlFeGl0Vmlld3BvcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoJC5zY3JvbGx1cGJhci5pc0luVmlld3BvcnQgJiYgIWlzSW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzSW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgICAgb3B0aW9ucy5leGl0Vmlld3BvcnQoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBGaXJlIGFuIGV2ZW50IHRvIGhpZGUgdGhlIGVudGlyZSBiYXIgYWZ0ZXIgNDAwbXMgaWYgdGhlIHNjcm9sbFxuICAgICAgICAgIC8vIHdhc24ndCBiaWcgZW5vdWdoLlxuICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGlzSW5WaWV3cG9ydCgpICYmIHkgLSBiYXJIZWlnaHQgPj0gbWluWSkge1xuICAgICAgICAgICAgICAkYmFyLmFuaW1hdGUoeyd0b3AnOiB5IC0gYmFySGVpZ2h0fSwgMTAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzSW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuZXhpdFZpZXdwb3J0KCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXN0WSA9IHk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgeyAvLyBGYWxsYmFjayBzaW1wbGlmaWVkIGJlaGF2aW91ciBmb3IgaU9TLlxuICAgICAgJHdpbmRvdy5vbigndG91Y2hzdGFydC5zY3JvbGx1cGJhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGFzdFkgPSAkd2luZG93LnNjcm9sbFRvcCgpO1xuICAgICAgfSk7XG5cbiAgICAgICR3aW5kb3cub24oJ3RvdWNoZW5kLnNjcm9sbHVwYmFyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgeSA9ICR3aW5kb3cuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgaWYgKHkgPCBsYXN0WSB8fCB5IC0gJGJhci5vdXRlckhlaWdodCgpIDwgbWluWSkgeyAvLyBTY3JvbGxpbmcgdXBcbiAgICAgICAgICBpZiAoeSA8PSBtaW5ZKSB7XG4gICAgICAgICAgICAvLyBSZXN0b3JlIG9yaWdpbmFsIHBvc2l0aW9uLlxuICAgICAgICAgICAgJGJhci5jc3Moe1xuICAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAndG9wJzogaW5pdGlhbFBvc1RvcFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRiYXIuc2hvdyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgJC5zY3JvbGx1cGJhci5pc0luVmlld3BvcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzRnVsbHlJblZpZXdwb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgb3B0aW9ucy5lbnRlclZpZXdwb3J0KCk7XG4gICAgICAgICAgICAgIG9wdGlvbnMuZnVsbHlFbnRlclZpZXdwb3J0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGJhci5jc3Moe1xuICAgICAgICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAndG9wJzogMFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQuc2Nyb2xsdXBiYXIuaXNJblZpZXdwb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgIG9wdGlvbnMuZW50ZXJWaWV3cG9ydCgpO1xuXG4gICAgICAgICAgICAkYmFyLnNsaWRlRG93bihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgJC5zY3JvbGx1cGJhci5pc0Z1bGx5SW5WaWV3cG9ydCA9IHRydWU7XG4gICAgICAgICAgICAgIG9wdGlvbnMuZnVsbHlFbnRlclZpZXdwb3J0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoeSA+IGxhc3RZKSB7IC8vIFNjcm9sbGluZyBkb3duXG4gICAgICAgICAgJC5zY3JvbGx1cGJhci5pc0Z1bGx5SW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgIG9wdGlvbnMucGFydGlhbGx5RXhpdFZpZXdwb3J0KCk7XG5cbiAgICAgICAgICAkYmFyLnNsaWRlVXAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkLnNjcm9sbHVwYmFyLmlzSW5WaWV3cG9ydCA9IGZhbHNlO1xuICAgICAgICAgICAgb3B0aW9ucy5leGl0Vmlld3BvcnQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxhc3RZID0geTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIF9kZXN0cm95Rm4gPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vIFVuYmluZCBhbGwgbGlzdGVuZXJzIGFkZGVkIGJ5IHNjcm9sbHVwYmFyIHBsdWdpblxuICAgICAgJHdpbmRvdy5vZmYoJy5zY3JvbGx1cGJhcicpO1xuXG4gICAgICAvLyBSZXN0b3JlIG9yaWdpbmFsIGJhciBwb3NpdGlvbi5cbiAgICAgICRiYXIuY3NzKHtcbiAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcbiAgICAgICAgJ3RvcCc6IGluaXRpYWxQb3NUb3BcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gJGJhcjtcbiAgfTtcblxuICAkLnNjcm9sbHVwYmFyLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoX2Rlc3Ryb3lGbikge1xuICAgICAgcmV0dXJuIF9kZXN0cm95Rm4oKTtcbiAgICB9XG4gIH07XG5cbiAgJC5mbi5zY3JvbGx1cGJhciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gJC5zY3JvbGx1cGJhcih0aGlzLCBvcHRpb25zKTtcbiAgfTtcbn0pKGpRdWVyeSk7XG5cbihmdW5jdGlvbigkKXtcblxuICAgIC8qKlxuICAgICAqIENvcHlyaWdodCAyMDEyLCBEaWdpdGFsIEZ1c2lvblxuICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiAgICAgKiBodHRwOi8vdGVhbWRmLmNvbS9qcXVlcnktcGx1Z2lucy9saWNlbnNlL1xuICAgICAqXG4gICAgICogQGF1dGhvciBTYW0gU2VobmVydFxuICAgICAqIEBkZXNjIEEgc21hbGwgcGx1Z2luIHRoYXQgY2hlY2tzIHdoZXRoZXIgZWxlbWVudHMgYXJlIHdpdGhpblxuICAgICAqICAgICAgIHRoZSB1c2VyIHZpc2libGUgdmlld3BvcnQgb2YgYSB3ZWIgYnJvd3Nlci5cbiAgICAgKiAgICAgICBvbmx5IGFjY291bnRzIGZvciB2ZXJ0aWNhbCBwb3NpdGlvbiwgbm90IGhvcml6b250YWwuXG4gICAgICovXG4gICAgdmFyICR3ID0gJCh3aW5kb3cpO1xuICAgICQuZm4udmlzaWJsZSA9IGZ1bmN0aW9uKHBhcnRpYWwsaGlkZGVuLGRpcmVjdGlvbil7XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoIDwgMSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB2YXIgJHQgICAgICAgID0gdGhpcy5sZW5ndGggPiAxID8gdGhpcy5lcSgwKSA6IHRoaXMsXG4gICAgICAgICAgICB0ICAgICAgICAgPSAkdC5nZXQoMCksXG4gICAgICAgICAgICB2cFdpZHRoICAgPSAkdy53aWR0aCgpLFxuICAgICAgICAgICAgdnBIZWlnaHQgID0gJHcuaGVpZ2h0KCksXG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAoZGlyZWN0aW9uKSA/IGRpcmVjdGlvbiA6ICdib3RoJyxcbiAgICAgICAgICAgIGNsaWVudFNpemUgPSBoaWRkZW4gPT09IHRydWUgPyB0Lm9mZnNldFdpZHRoICogdC5vZmZzZXRIZWlnaHQgOiB0cnVlO1xuXG4gICAgICAgIGlmICh0eXBlb2YgdC5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPT09ICdmdW5jdGlvbicpe1xuXG4gICAgICAgICAgICAvLyBVc2UgdGhpcyBuYXRpdmUgYnJvd3NlciBtZXRob2QsIGlmIGF2YWlsYWJsZS5cbiAgICAgICAgICAgIHZhciByZWMgPSB0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgICAgIHRWaXogPSByZWMudG9wICAgID49IDAgJiYgcmVjLnRvcCAgICA8ICB2cEhlaWdodCxcbiAgICAgICAgICAgICAgICBiVml6ID0gcmVjLmJvdHRvbSA+ICAwICYmIHJlYy5ib3R0b20gPD0gdnBIZWlnaHQsXG4gICAgICAgICAgICAgICAgbFZpeiA9IHJlYy5sZWZ0ICAgPj0gMCAmJiByZWMubGVmdCAgIDwgIHZwV2lkdGgsXG4gICAgICAgICAgICAgICAgclZpeiA9IHJlYy5yaWdodCAgPiAgMCAmJiByZWMucmlnaHQgIDw9IHZwV2lkdGgsXG4gICAgICAgICAgICAgICAgdlZpc2libGUgICA9IHBhcnRpYWwgPyB0Vml6IHx8IGJWaXogOiB0Vml6ICYmIGJWaXosXG4gICAgICAgICAgICAgICAgaFZpc2libGUgICA9IHBhcnRpYWwgPyBsVml6IHx8IHJWaXogOiBsVml6ICYmIHJWaXo7XG5cbiAgICAgICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ2JvdGgnKVxuICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRTaXplICYmIHZWaXNpYmxlICYmIGhWaXNpYmxlO1xuICAgICAgICAgICAgZWxzZSBpZihkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudFNpemUgJiYgdlZpc2libGU7XG4gICAgICAgICAgICBlbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnKVxuICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRTaXplICYmIGhWaXNpYmxlO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICB2YXIgdmlld1RvcCAgICAgICAgID0gJHcuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICAgICAgdmlld0JvdHRvbSAgICAgID0gdmlld1RvcCArIHZwSGVpZ2h0LFxuICAgICAgICAgICAgICAgIHZpZXdMZWZ0ICAgICAgICA9ICR3LnNjcm9sbExlZnQoKSxcbiAgICAgICAgICAgICAgICB2aWV3UmlnaHQgICAgICAgPSB2aWV3TGVmdCArIHZwV2lkdGgsXG4gICAgICAgICAgICAgICAgb2Zmc2V0ICAgICAgICAgID0gJHQub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgX3RvcCAgICAgICAgICAgID0gb2Zmc2V0LnRvcCxcbiAgICAgICAgICAgICAgICBfYm90dG9tICAgICAgICAgPSBfdG9wICsgJHQuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgX2xlZnQgICAgICAgICAgID0gb2Zmc2V0LmxlZnQsXG4gICAgICAgICAgICAgICAgX3JpZ2h0ICAgICAgICAgID0gX2xlZnQgKyAkdC53aWR0aCgpLFxuICAgICAgICAgICAgICAgIGNvbXBhcmVUb3AgICAgICA9IHBhcnRpYWwgPT09IHRydWUgPyBfYm90dG9tIDogX3RvcCxcbiAgICAgICAgICAgICAgICBjb21wYXJlQm90dG9tICAgPSBwYXJ0aWFsID09PSB0cnVlID8gX3RvcCA6IF9ib3R0b20sXG4gICAgICAgICAgICAgICAgY29tcGFyZUxlZnQgICAgID0gcGFydGlhbCA9PT0gdHJ1ZSA/IF9yaWdodCA6IF9sZWZ0LFxuICAgICAgICAgICAgICAgIGNvbXBhcmVSaWdodCAgICA9IHBhcnRpYWwgPT09IHRydWUgPyBfbGVmdCA6IF9yaWdodDtcblxuICAgICAgICAgICAgaWYoZGlyZWN0aW9uID09PSAnYm90aCcpXG4gICAgICAgICAgICAgICAgcmV0dXJuICEhY2xpZW50U2l6ZSAmJiAoKGNvbXBhcmVCb3R0b20gPD0gdmlld0JvdHRvbSkgJiYgKGNvbXBhcmVUb3AgPj0gdmlld1RvcCkpICYmICgoY29tcGFyZVJpZ2h0IDw9IHZpZXdSaWdodCkgJiYgKGNvbXBhcmVMZWZ0ID49IHZpZXdMZWZ0KSk7XG4gICAgICAgICAgICBlbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJylcbiAgICAgICAgICAgICAgICByZXR1cm4gISFjbGllbnRTaXplICYmICgoY29tcGFyZUJvdHRvbSA8PSB2aWV3Qm90dG9tKSAmJiAoY29tcGFyZVRvcCA+PSB2aWV3VG9wKSk7XG4gICAgICAgICAgICBlbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnKVxuICAgICAgICAgICAgICAgIHJldHVybiAhIWNsaWVudFNpemUgJiYgKChjb21wYXJlUmlnaHQgPD0gdmlld1JpZ2h0KSAmJiAoY29tcGFyZUxlZnQgPj0gdmlld0xlZnQpKTtcbiAgICAgICAgfVxuICAgIH07XG5cbn0pKGpRdWVyeSk7XG5cbmpRdWVyeShmdW5jdGlvbigkKSB7XG5cbiAgLyoqXG4gICAqIERyb3B5XG4gICAqIGh0dHA6Ly9jb2RlcGVuLmlvL1RvbWJlay9wZW4vT1B2cExlXG4gICAqL1xuICB2YXIgZHJvcHkgPSB7XG4gICAgJGRyb3B5czogbnVsbCxcbiAgICBvcGVuQ2xhc3M6ICdvcGVuJyxcbiAgICBzZWxlY3RDbGFzczogJ3NlbGVjdGVkJyxcbiAgICBpbml0OiBmdW5jdGlvbigpe1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICBcbiAgICAgIHNlbGYuJGRyb3B5cyA9ICQoJy5kcm9weScpO1xuICAgICAgc2VsZi5ldmVudEhhbmRsZXIoKTtcbiAgICB9LFxuICAgIGV2ZW50SGFuZGxlcjogZnVuY3Rpb24oKXtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgXG4gICAgICAvLyBPcGVuaW5nIGEgZHJvcHlcbiAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX3RpdGxlJykuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgc2VsZi4kZHJvcHlzLnJlbW92ZUNsYXNzKHNlbGYub3BlbkNsYXNzKTtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnRzKCcuZHJvcHknKS5hZGRDbGFzcyhzZWxmLm9wZW5DbGFzcyk7XG4gICAgICB9KTtcbiAgXG4gICAgICAvLyBDbGljayBvbiBhIGRyb3B5IGxpc3RcbiAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX2NvbnRlbnQgdWwgbGkgYScpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciAkdGhhdCA9ICQodGhpcyk7XG4gICAgICAgIHZhciAkZHJvcHkgPSAkdGhhdC5wYXJlbnRzKCcuZHJvcHknKTtcbiAgICAgICAgdmFyICRpbnB1dCA9ICRkcm9weS5maW5kKCdpbnB1dCcpO1xuICAgICAgICB2YXIgJHRpdGxlID0gJCh0aGlzKS5wYXJlbnRzKCcuZHJvcHknKS5maW5kKCcuZHJvcHlfX3RpdGxlIHNwYW4nKTtcbiAgXG4gICAgICAgIC8vIFJlbW92ZSBzZWxlY3RlZCBjbGFzc1xuICAgICAgICAkZHJvcHkuZmluZCgnLmRyb3B5X19jb250ZW50IGEnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgfSk7XG4gIFxuICAgICAgICAvLyBVcGRhdGUgc2VsZWN0ZWQgdmFsdWVcbiAgICAgICAgJHRpdGxlLmh0bWwoJHRoYXQuaHRtbCgpKTtcbiAgICAgICAgJGlucHV0LnZhbCgkdGhhdC5hdHRyKCdkYXRhLXZhbHVlJykpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICBcbiAgICAgICAgLy8gSWYgYmFjayB0byBkZWZhdWx0LCByZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZWxzZSBhZGRjbGFzcyBvbiByaWdodCBlbGVtZW50XG4gICAgICAgIGlmKCR0aGF0Lmhhc0NsYXNzKCdkcm9weV9faGVhZGVyJykpe1xuICAgICAgICAgICR0aXRsZS5yZW1vdmVDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgICAkdGl0bGUuaHRtbCgkdGl0bGUuYXR0cignZGF0YS10aXRsZScpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICR0aXRsZS5hZGRDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgICAkdGhhdC5hZGRDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgLy8gQ2xvc2UgZHJvcGRvd25cbiAgICAgICAgJGRyb3B5LnJlbW92ZUNsYXNzKHNlbGYub3BlbkNsYXNzKTtcbiAgICAgIH0pO1xuICBcbiAgICAgIC8vIENsb3NlIGFsbCBkcm9wZG93biBvbmNsaWNrIG9uIGFub3RoZXIgZWxlbWVudFxuICAgICAgJChkb2N1bWVudCkuYmluZCgnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICBpZiAoISAkKGUudGFyZ2V0KS5wYXJlbnRzKCkuaGFzQ2xhc3MoJ2Ryb3B5JykpeyBzZWxmLiRkcm9weXMucmVtb3ZlQ2xhc3Moc2VsZi5vcGVuQ2xhc3MpOyB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIFxuICAkKGZ1bmN0aW9uKCl7XG4gICAgZHJvcHkuaW5pdCgpO1xuICB9KTtcblxuICAgICBmdW5jdGlvbiBjYXJkRXhjZXJwdCgpIHtcbiAgICAgICQoXCIuY2FyZF9fZXhjZXJwdFwiKS50ZXh0KGZ1bmN0aW9uKGluZGV4LCBjdXJyZW50VGV4dCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFRleHQuc3Vic3RyKDAsIDE0MCkgKyAnXFx1MjAyNic7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY2FyZEV4Y2VycHQoKTtcblxuICAvLyBQYWt1amUgbW5pZWpzemUgb2JyYXpraSBiZXogcG9kcGlzdSB3IDxmaWd1cmU+IC8vXG4gIC8vIEplxZtsaSBvYnJhemVrIG1hIHR5dHXFgiwgdHltIHNpxJkgemFqbXVqZSBwaHAgZnVua2NqYSB3IHByb2plY3QtZnVuY3Rpb25zLnBocFxuICAkKCcucHJvamVjdF9fY29udGVudCBwJykuZWFjaChmdW5jdGlvbihpbmRleCkge1xuICAgIHZhciBzb21lX2ltZyA9ICQodGhpcykuZmluZCgnaW1nJyk7XG4gICAgdmFyIHdpZHRoID0gc29tZV9pbWcud2lkdGgoKTtcbiAgICBpZiAod2lkdGggPCA5ODApIHtcbiAgICAgIHNvbWVfaW1nLndyYXAoXCI8ZmlndXJlPjwvZmlndXJlPlwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vU2tyYWNhIGltaW9uYSwgYnkgbmllIHd5Y2hvZHppxYJ5IHphIGJsb2tpXG4gICQoJy5tZW1iZXJjYXJkX19uYW1lIGEnKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgdmFyIGxlbmd0aCA9ICQodGhpcykuaHRtbCgpLmxlbmd0aDtcbiAgICBpZiAobGVuZ3RoID4gMTcpIHtcbiAgICAgIHZhciBuYW1lID0gJCh0aGlzKS50ZXh0KCk7XG4gICAgICAkKHRoaXMpLnBhcmVudCgpLmFkZENsYXNzKCdtZW1iZXJjYXJkX19uYW1lLS10b29Mb25nJyk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhuYW1lKTtcbiAgICAgIHZhciB0cmltbWVkX25hbWUgPSBuYW1lLmNoYXJBdCgwKSArIFwiLiBcIiArIG5hbWUuc3Vic3RyKG5hbWUuaW5kZXhPZignICcpICsgMSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyh0cmltbWVkX25hbWUpO1xuICAgICAgJCh0aGlzKS50ZXh0KHRyaW1tZWRfbmFtZSk7XG4gICAgfVxuICB9KTtcbiAgXG4gICQoJy5tZW1iZXJjYXJkU21hbGxfX25hbWUgYScpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICB2YXIgbGVuZ3RoID0gJCh0aGlzKS5odG1sKCkubGVuZ3RoO1xuICAgIGlmIChsZW5ndGggPiAxNCkge1xuICAgICAgdmFyIG5hbWUgPSAkKHRoaXMpLnRleHQoKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG5hbWUpO1xuICAgICAgdmFyIHRyaW1tZWRfbmFtZSA9IG5hbWUuY2hhckF0KDApICsgXCIuIFwiICsgbmFtZS5zdWJzdHIobmFtZS5pbmRleE9mKCcgJykgKyAxKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHRyaW1tZWRfbmFtZSk7XG4gICAgICAkKHRoaXMpLnRleHQodHJpbW1lZF9uYW1lKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIE5vdHlmaWthY2plLCBwb3dpYWRvbWllbmlhIC8vXG4gICQoXCIubm90ZS1jbG9zZVwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpXG4gICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDBcbiAgICAgIH0sIDI1MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICQodGhpcylcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBtYXJnaW5Cb3R0b206IDBcbiAgICAgICAgICB9LCAyNTApXG4gICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBwYWRkaW5nOiAwXG4gICAgICAgICAgfSwgMjUwKVxuICAgICAgICAgIC53cmFwSW5uZXIoXCI8ZGl2IC8+XCIpXG4gICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAuc2xpZGVVcCgyNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KFwiLm5vdGVcIikucmVtb3ZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfSk7XG5cbiAgLy8gQW5pbWFjamUgZGxhIGJhbmVyYSByZWtydXRhY2ppIC8vXG4gICQoJ2xhYmVsLmJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICQoJy5mYicpLmFkZENsYXNzKCdhbmltYXRlZCBmYWRlSW5VcCcpO1xuICAgICQoJy5kYXRlIC5pY29uLWNvbnRhaW5lcicpLmFkZENsYXNzKCdhbmltYXRlZCBzbGlkZUluTGVmdCcpO1xuICAgICQoJy5kYXRlIHNwYW4nKS5hZGRDbGFzcygnYW5pbWF0ZWQgc2xpZGVJbkxlZnQnKTtcbiAgICAkKCcubG9jYXRpb24gLmljb24tY29udGFpbmVyJykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5SaWdodCcpO1xuICAgICQoJy5sb2NhdGlvbiBzcGFuJykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5SaWdodCcpO1xuICBcbiAgfSk7XG4gICQoJyNjbG9zZV9iYW5uZXInKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcuZmInKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgZmFkZUluVXAnKTtcbiAgICAkKCcuZGF0ZSAuaWNvbi1jb250YWluZXInKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgc2xpZGVJbkxlZnQnKTtcbiAgICAkKCcuZGF0ZSBzcGFuJykucmVtb3ZlQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5MZWZ0Jyk7XG4gICAgJCgnLmxvY2F0aW9uIC5pY29uLWNvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgICAkKCcubG9jYXRpb24gc3BhbicpLnJlbW92ZUNsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgfSk7XG4gIFxuICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI0MDcwNjI3L2NyZWF0ZS1kcm9wZG93bi1iYW5uZXItd2hlbi11c2VyLWZpcnN0LXZpc2l0cy13ZWJzaXRlXG4gIC8vIFBvendhbGFqxIUgb3R3aWVyYcSHIGJhbmVyIHR5bGtvIHByenkgcGllcndzemVqIHdpenljaWVcbiAgXG4gIC8vIGNvb2tpZS1qc1xuXG4gIC8vLy8gPSBwYXJ0aWFscy9zaG93LW5pY2tuYW1lcy5qc1xuXG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICAvLyAkKFwiI25hdi1tb2JpbGVcIikuaHRtbCgkKFwiI25hdi1tYWluXCIpLmh0bWwoKSk7XG4gICAgICAkKFwiI25hdi10cmlnZ2VyIC5uYXZpY29uLWJ1dHRvblwiKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmluZm8oJ0J1cmdlciBjbGlja2VkJyk7XG4gICAgICAgICAgaWYgKCQoXCIjbmF2IHVsXCIpLmhhc0NsYXNzKFwibmF2X19tZW51LS1leHBhbmRlZFwiKSkge1xuICAgICAgICAgICAgICAkKFwiI25hdiB1bFwiKS5yZW1vdmVDbGFzcyhcIm5hdl9fbWVudS0tZXhwYW5kZWRcIikuc2xpZGVVcCgyNTApO1xuICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkKFwiI25hdiB1bFwiKS5hZGRDbGFzcyhcIm5hdl9fbWVudS0tZXhwYW5kZWRcIikuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgIH1cbiAgICAgIH0pO1xuICB9KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBTbGlkZXIgPSAkKCcjc2xpZGVyJykuU3dpcGUoe1xuICAgICAgYXV0bzogMCxcbiAgICAgIGNvbnRpbnVvdXM6IHRydWUsXG4gICAgfSkuZGF0YSgnU3dpcGUnKTtcbiAgICBpZiAoU2xpZGVyKSB7XG4gICAgICAkKCcubmV4dCcpLm9uKCdjbGljaycsIFNsaWRlci5uZXh0KTtcbiAgICAgICQoJy5wcmV2Jykub24oJ2NsaWNrJywgU2xpZGVyLnByZXYpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gcHJ6ZXogdG8gZ253byBuaWUgZHppYcWCYSAub24oKVxuICAvLy8vPSBwYXJ0aWFscy9zbW9vdGgtc2Nyb2xsaW5nLmpzXG5cbiAgXG5cbiAgKGZ1bmN0aW9uKCkge1xuICAgICAgLy8gxbtlYnkgdG9vbHRpcCBuaWUga2xpa2HFglxuICAgICAgJCgnLnRvb2x0aXAnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gIFxuICAgICAgJCgnW2RhdGEtZ2l0aHViXScpLmhvdmVyKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBsb2FkR2l0aHViKCk7XG4gICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbignLnRvb2x0aXAnKS5hZGRDbGFzcygndG9vbHRpcC0tYWN0aXZlJyk7XG4gICAgICB9LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbignLnRvb2x0aXAnKS5yZW1vdmVDbGFzcygndG9vbHRpcC0tYWN0aXZlJyk7XG4gICAgICB9KTtcbiAgXG4gICAgICAkKCdbZGF0YS1sYXN0Zm1dJykuaG92ZXIoZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGxvYWRMYXN0Zm0oKTtcbiAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCcudG9vbHRpcCcpLmFkZENsYXNzKCd0b29sdGlwLS1hY3RpdmUnKTtcbiAgICAgIH0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCcudG9vbHRpcCcpLnJlbW92ZUNsYXNzKCd0b29sdGlwLS1hY3RpdmUnKTtcbiAgICAgIH0pO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIGxvYWRHaXRodWIoKSB7XG4gICAgICAvLyBQb2JpZXJhIHVybCB6IGhyZWZhXG4gICAgICB2YXIgcHJvZmlsZVVybCA9ICQoJ2FbZGF0YS1naXRodWJdJykuYXR0cignaHJlZicpO1xuICAgICAgLy8gT2Rwb3dpZWRuaW8gb2JjaW5hIGdvIGRvIHVzZXJuYW1lXG4gICAgICB2YXIgdXNlcm5hbWUgPSBwcm9maWxlVXJsLnN1YnN0cigxOSk7XG4gICAgICAvLyBEb2RhamUgdXNlcm5hbWUgZG8gdXJsIHphcHl0YW5pYVxuICAgICAgdmFyIHJlcXVyaSA9ICdodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzLycgKyB1c2VybmFtZTtcbiAgICAgIC8vIFNwcmF3ZHphLCBjenkgdG9vbHRpcCBwdXN0eSwgYnkgbmllIGdlbmVyb3dhxIcgbm93eWNoIHphcHl0YcWEXG4gICAgICAvLyBpIG5pZSBkb2Rhd2HEhyBwbyByYXoga29sZWpueSBkYW5lIGRvIHRvb2x0aXBhXG4gICAgICBpZiAoJCgnW2RhdGEtZ2l0aHViXSAudG9vbHRpcCcpLmlzKCc6ZW1wdHknKSkge1xuICAgICAgICAgIHJlcXVlc3RKU09OKHJlcXVyaSwgZnVuY3Rpb24oanNvbikge1xuICAgICAgICAgICAgICBpZiAoanNvbi5tZXNzYWdlID09PSBcIk5pZSB6bmFsZXppb25vXCIgfHwgdXNlcm5hbWUgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAkKCdbZGF0YS1naXRodWJdIC50b29sdGlwJykuaHRtbChcIjxoMj5CcmFrIGluZm9ybWFjamk8L2gyPlwiKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0ganNvbi5sb2dpbjtcbiAgICAgICAgICAgICAgICAgIHZhciBwcm9maWxldXJsID0ganNvbi5odG1sX3VybDtcbiAgICAgICAgICAgICAgICAgIHZhciByZXBvc251bSA9IGpzb24ucHVibGljX3JlcG9zO1xuICAgICAgICAgICAgICAgICAgdmFyIGF2aXVybCA9IGpzb24uYXZhdGFyX3VybDtcbiAgXG4gIFxuICAgICAgICAgICAgICAgICAgdmFyIG91dGh0bWwgPSAnPGRpdiBjbGFzcz1cImdoXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgJzxoNCBjbGFzcz1cImdoX19uYW1lXCI+PGEgY2xhc3M9XCJsaW5rXCIgaHJlZj1cIicgKyBwcm9maWxldXJsICsgJ1wiPjxpbWcgY2xhc3M9XCJnaF9fYXZhdGFyXCIgc3JjPVwiJyArIGF2aXVybCArICdcIj5AJyArIHVzZXJuYW1lICsgJzwvYT48L2g0Pic7XG4gICAgICAgICAgICAgICAgICBvdXRodG1sID0gb3V0aHRtbCArICc8c3BhbiBjbGFzcz1cImdoX19yZXBvc1wiPlJlcG96eXRvcmnDs3c6ICcgKyByZXBvc251bSArICc8L3NwYW4+PGhyLz48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgJCgnW2RhdGEtZ2l0aHViXSAudG9vbHRpcCcpLmFwcGVuZChvdXRodG1sKTtcbiAgXG4gICAgICAgICAgICAgIH0gLy8gZW5kIGVsc2Ugc3RhdGVtZW50XG4gICAgICAgICAgfSk7IC8vIGVuZCByZXF1ZXN0SlNPTiBBamF4IGNhbGxcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiByZXF1ZXN0SlNPTih1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwobnVsbCwgeGhyLnJlc3BvbnNlSlNPTik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGxvYWRMYXN0Zm0oKSB7XG4gICAgICAvLyBQb2JpZXJhIHVybCB6IGhyZWZhXG4gICAgICB2YXIgcHJvZmlsZVVybCA9ICQoJ2FbZGF0YS1sYXN0Zm1dJykuYXR0cignaHJlZicpO1xuICAgICAgLy8gT2Rwb3dpZWRuaW8gb2JjaW5hIGdvIGRvIHVzZXJuYW1lXG4gICAgICB2YXIgdXNlcm5hbWUgPSBwcm9maWxlVXJsLnN1YnN0cigyNyk7XG4gICAgICB2YXIgYmFzZVVybCA9ICdodHRwOi8vd3MuYXVkaW9zY3JvYmJsZXIuY29tLzIuMC8/bWV0aG9kPXVzZXIuZ2V0cmVjZW50dHJhY2tzJztcbiAgICAgIHZhciBhcGlfa2V5ID0gJzI5OTAyMGMwNjJjNDgxZjA4M2VjZDAyNzZjMzE1ZTNhJztcbiAgXG4gICAgICB2YXIgcmVxdWVzdFVybCA9IGJhc2VVcmwgKyAnJnVzZXI9JyArIHVzZXJuYW1lICsgJyZhcGlfa2V5PScgKyBhcGlfa2V5ICsgJyZmb3JtYXQ9anNvbic7XG4gICAgICBjb25zb2xlLmxvZyh1c2VybmFtZSk7XG4gICAgICBpZiAoJCgnW2RhdGEtbGFzdGZtXSAudG9vbHRpcCcpLmlzKCc6ZW1wdHknKSkge1xuICAgICAgICAgICQuZ2V0SlNPTihyZXF1ZXN0VXJsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIHZhciBhcnRpc3QgPSBkYXRhLnJlY2VudHRyYWNrcy50cmFja1swXS5hcnRpc3RbXCIjdGV4dFwiXTtcbiAgICAgICAgICAgICAgdmFyIHNvbmcgPSBkYXRhLnJlY2VudHRyYWNrcy50cmFja1swXVtcIm5hbWVcIl07XG4gICAgICAgICAgICAgIHZhciBjb3ZlciA9IGRhdGEucmVjZW50dHJhY2tzLnRyYWNrWzBdLmltYWdlWzNdW1wiI3RleHRcIl07XG4gICAgICAgICAgICAgIGlmIChjb3ZlciA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgY292ZXIgPSBcImh0dHA6Ly9pbWcyLWFrLmxzdC5mbS9pL3UvMTc0cy80MTI4YTZlYjI5Zjk0OTQzYzlkMjA2YzA4ZTYyNTkwNC5wbmdcIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB2YXIgb3V0aHRtbCA9ICc8ZGl2IGNsYXNzPVwibGZcIj48aW1nIGNsYXNzPVwibGZfX2NvdmVyXCIgc3JjPVwiJyArIGNvdmVyICsgJ1wiLz48ZGl2IGNsYXNzPVwibGZfX3RyYWNrSW5mb1wiPjxzcGFuIGNsYXNzPVwibGZfX2FydGlzdFwiPicgKyBhcnRpc3QgKyAnPC9zcGFuPjxzcGFuIGNsYXNzPVwibGZfX3NvbmdcIj4nICsgc29uZyArICc8L3NwYW4+PC9kaXY+PC9kaXY+JztcbiAgICAgICAgICAgICAgJCgnW2RhdGEtbGFzdGZtXSAudG9vbHRpcCcpLmFwcGVuZChvdXRodG1sKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgfVxuXG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGJMYXp5ID0gbmV3IEJsYXp5KHtcbiAgICAgICAgb2Zmc2V0OiAyMCxcbiAgICAgICAgc2VsZWN0b3I6ICcuYmxhenknLFxuICAgICAgICBsb2FkSW52aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgYnJlYWtwb2ludHM6IFt7XG4gICAgICAgICAgd2lkdGg6IDM2MCwgLy8gTWF4LXdpZHRoXG4gICAgICAgICAgc3JjOiAnZGF0YS1zcmMtc21hbGwnXG4gICAgICAgIH1dLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgJChlbGVtZW50KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnbG9hZGluZycsIDUwMCk7XG4gICAgICAgICAgdXBkYXRlQ291bnRlcigpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oZWxlbWVudCwgbXNnKSB7XG4gICAgICAgICAgaWYgKG1zZyA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgICAkKGVsZW1lbnQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJywgNTAwKTsgLy8gRGF0YS1zcmMgaXMgbWlzc2luZ1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImJMYXp5OiBkYXRhLXNyYyBpcyBtaXNzaW5nXCIpO1xuICAgICAgICAgIH0gZWxzZSBpZiAobXNnID09PSAnaW52YWxpZCcpIHtcbiAgICAgICAgICAgICQoZWxlbWVudCkucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnLCA1MDApO1xuICAgICAgICAgICAgLy8gRGF0YS1zcmMgaXMgaW52YWxpZFxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImJMYXp5OiBkYXRhLXNyYyBpcyBpbnZhbGlkXCIpO1xuICAgIFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBub3QgbmVlZGVkLCBvbmx5IGhlcmUgdG8gaWxsdXN0cmF0ZSBhbW91bnQgb2YgbG9hZGVkIGltYWdlc1xuICAgICAgdmFyIGltYWdlTG9hZGVkID0gMDtcbiAgICBcbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXIoKSB7XG4gICAgICAgIGltYWdlTG9hZGVkKys7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhcImJMYXp5OiBJbWFnZXMgbG9hZGVkOiAlZFwiLCBpbWFnZUxvYWRlZCk7XG4gICAgICB9XG4gICAgXG4gICAgICAvLyB0YWJzKGJMYXp5KTtcblxuICAgIC8vLy89IG1lbWJlci5qc1xuXG4gICAgLy8vLz0gcGFydGlhbHMvaW5maW5pdGUtc2Nyb2xsLmpzXG5cbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhamF4X3VybCA9ICQoJy5nbG9iYWwnKS5hdHRyKCdkYXRhLWFqYXgtdXJsJyk7XG4gICAgICAgIHZhciBwb3N0X29mZnNldCA9IDA7XG4gICAgICAgIHZhciBpbmNOdW1iZXIgPSA2OyAvLyBpbG/Fm8SHIHBvc3TDs3cgZG8gemHFgmFkb3dhbmlhXG4gICAgXG4gICAgICAgIHZhciBwcm9qZWN0cyA9IChmdW5jdGlvbihzZXRQcm9qZWN0cykge1xuICAgICAgICAgICAgdmFyIGxvYWRlZDtcbiAgICAgICAgICAgIHZhciB0b3RhbDtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5jTG9hZGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gbG9hZGVkICsgaW5jTnVtYmVyO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ2V0TG9hZGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRlZDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNldExvYWRlZDogZnVuY3Rpb24oc2V0UHJvamVjdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkID0gc2V0UHJvamVjdHM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZXRUb3RhbDogZnVuY3Rpb24oc2V0UHJvamVjdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBzZXRQcm9qZWN0cztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdldFRvdGFsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKCk7XG4gICAgICAgIHZhciBsb2FkaW5nQnV0dG9uID0gKGZ1bmN0aW9uKGJ1dHRvbil7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNob3dTcGlubmVyOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmh0bWwoJzxkaXYgY2xhc3M9XCJzcGlubmVyXCI+PC9kaXY+Jyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzaG93Q2FwdGlvbjogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5odG1sKCdab2JhY3ogc3RhcnN6ZScpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkoKTtcbiAgICBcbiAgICAgICAgJCgnI2xvYWRfbW9yZV9wb3N0cycpLm9uKCdjbGljaycsIGxvYWRNb3JlKTtcbiAgICAgICAgJCgnI2xvYWRfbW9yZScpLm9uKCdjbGljaycsIGxvYWRQcm9qZWN0cyk7XG4gICAgXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRNb3JlKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NsaWNrZWQgbG9hZF9tb3JlJyk7XG4gICAgICAgICAgICAkKHRoaXMpLmh0bWwoJzxkaXYgY2xhc3M9XCJzcGlubmVyXCI+PC9kaXY+Jyk7XG4gICAgICAgICAgICBwb3N0X29mZnNldCA9IHBhcnNlSW50KHBvc3Rfb2Zmc2V0KSArIDY7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogYWpheF91cmwsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnbG9hZF9wb3N0cycsXG4gICAgICAgICAgICAgICAgICAgIHBvc3Rfb2Zmc2V0OiBwb3N0X29mZnNldCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI2xvYWRfbW9yZV9wb3N0cycpLmh0bWwoJ1pvYmFjeiBzdGFyc3plJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwb3N0cyAuY2FyZHNXcmFwcGVyJykuYXBwZW5kKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ0FqYXg6IE9LJyk7XG4gICAgICAgICAgICAgICAgICAgIGJMYXp5LnJldmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FyZEV4Y2VycHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBmdW5jdGlvbiBsb2FkUHJvamVjdHMoKSB7XG4gICAgICAgICAgICB2YXIgdGhpc1BhcmVudCA9ICQodGhpcykucGFyZW50KCk7XG4gICAgICAgICAgICAvLyB1c3Rhd2lhIGNhxYJrb3dpdMSFIGxpY3pixJkgZGFueWNoIHByb2pla3TDs3dcbiAgICAgICAgICAgIHByb2plY3RzLnNldFRvdGFsKHRoaXNQYXJlbnQuYXR0cignZGF0YS10b3RhbCcpKTtcbiAgICAgICAgICAgIC8vIGplxZtsaSBqZXN6Y3plIG5pZSBwb2JpZXJhbm8gYWpheGVtIHByb2pla3TDs3csIHRvIHVzdGF3aWEgd2FydG/Fm8SHXG4gICAgICAgICAgICAvLyByw7N3bsSFIGp1xbwgd3nFm3dpZXRsb255Y2hcbiAgICAgICAgICAgIGlmICghcHJvamVjdHMuZ2V0TG9hZGVkKCkpIHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0cy5zZXRMb2FkZWQodGhpc1BhcmVudC5maW5kKCcuY2FyZCcpLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FscmVhZHk6JywgcHJvamVjdHMuZ2V0TG9hZGVkKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHByb2plY3RzX3N0YXR1cyA9IHRoaXNQYXJlbnQuYXR0cignZGF0YS1wcm9qZWN0cy1zdGF0dXMnKTtcbiAgICAgICAgICAgIHBvc3Rfb2Zmc2V0ID0gcGFyc2VJbnQocG9zdF9vZmZzZXQpICsgaW5jTnVtYmVyO1xuICAgIFxuICAgICAgICAgICAgaWYgKHByb2plY3RzLmdldFRvdGFsKCkgPiBwcm9qZWN0cy5nZXRMb2FkZWQoKSkge1xuICAgICAgICAgICAgICAgIGxvYWRpbmdCdXR0b24uc2hvd1NwaW5uZXIoJCgnI2xvYWRfbW9yZScpKTtcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IGFqYXhfdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2xvYWRfcHJvamVjdHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdF9vZmZzZXQ6IHBvc3Rfb2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdHNfc3RhdHVzOiBwcm9qZWN0c19zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNQYXJlbnQuY2hpbGRyZW4oJy5jYXJkc1dyYXBwZXInKS5hcHBlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBiTGF6eS5yZXZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXJkRXhjZXJwdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0J1dHRvbi5zaG93Q2FwdGlvbigkKCcjbG9hZF9tb3JlJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdHMuaW5jTG9hZGVkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ0FqYXg6IExvYWRlZCBtb3JlICVzIHByb2plY3RzOiAlZC8lZCcsIHByb2plY3RzX3N0YXR1cywgcHJvamVjdHMuZ2V0TG9hZGVkKCksIHByb2plY3RzLmdldFRvdGFsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3RzLmdldFRvdGFsKCkgPD0gcHJvamVjdHMuZ2V0TG9hZGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQnV0dG9uLmhpZGUoJCgnI2xvYWRfbW9yZScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSgpO1xuXG4gICAgZnVuY3Rpb24gaW5pdFRvcGJhcigpIHtcbiAgICAgICAgJCgnLnRvcGJhcldyYXBwZXInKS5zY3JvbGx1cGJhcih7XG4gICAgICAgICAgICBlbnRlclZpZXdwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcudG9wYmFyV3JhcHBlcicpLmFkZENsYXNzKCd0b3BiYXJXcmFwcGVyLS12aXNpYmxlJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVsbHlFbnRlclZpZXdwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcjbGFzdC1ldmVudCcpLnRleHQoJ2Z1bGx5RW50ZXJWaWV3cG9ydCcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4aXRWaWV3cG9ydDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnI2xhc3QtZXZlbnQnKS50ZXh0KCdleGl0Vmlld3BvcnQnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJ0aWFsbHlFeGl0Vmlld3BvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoJyNsYXN0LWV2ZW50JykudGV4dCgncGFydGlhbGx5RXhpdFZpZXdwb3J0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpbml0VG9wYmFyKCk7XG4gICAgXG4gICAgaWYgKCQod2luZG93KS53aWR0aCgpIDwgNzUwKSB7XG4gICAgICAgICQuc2Nyb2xsdXBiYXIuZGVzdHJveSgnLnRvcGJhcldyYXBwZXInKTtcbiAgICB9XG4gICAgXG4gICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAvLyBkaWRTY3JvbGwgPSB0cnVlO1xuICAgICAgICB2YXIgc3QgPSAkKHRoaXMpLnNjcm9sbFRvcCgpO1xuICAgICAgICAvLyBHZHkgamVzdGXFm215IG5hIHNhbWVqIGfDs3J6ZSwgdG8gcG9rYXp5amVteSBjYcWCZSBsb2dvXG4gICAgICAgIGlmIChzdCA9PT0gMCkge1xuICAgICAgICAgICAgJCgnLnRvcGJhcldyYXBwZXInKS5yZW1vdmVDbGFzcygndG9wYmFyV3JhcHBlci0tdmlzaWJsZScpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgdGFicyA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRUYWI7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBwb2JpZXJhbXkgaHJlZlxuICAgICAgICAgICAgICAgIGN1cnJlbnRUYWIgPSAkKCcudGFic01lbnVfX2l0ZW0tLWN1cnJlbnQgLmxpbmstLXRhYicpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICAvLyBocmVmIGplc3QgamVkbm9jemXFm25pZSBpZCBvZHBvd2llZG5pZWdvIHRhYnUsIGt0w7NyeSB3ecWbd2lldGxhbXlcbiAgICAgICAgICAgICAgICAkKGN1cnJlbnRUYWIpLmFkZENsYXNzKCd0YWJfX2NvbnRlbnQtLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICAvLyDFgmFkdWplbXkgb2JyYXpraVxuICAgICAgICAgICAgICAgIGJMYXp5LmxvYWQoJChcIi5ibGF6eVwiLCBjdXJyZW50VGFiKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdUYWJzIGluaXRpYXRlZDonLCBjdXJyZW50VGFiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy8gWiB0eW0gI3RhYnNSZXNldCwgdG8gdGFraSBoYWNrLiBXeWtvcnp5c3R5d2FueSBkbGF0ZWdvLCDFvGVcbiAgICAgICAgICAgICAgICAvLyBwbyBrbGlrbmnEmWNpdSBjaG93YWrEhSBzacSZIHdzenlzdGtpZSB0YWJ5LCBvcHLDs2N6IHRlaiB6IG9kcG93aWVkbmltIGlkXG4gICAgICAgICAgICAgICAgY3VycmVudFRhYiA9ICQoJyN0YWJzUmVzZXQgLmxpbmstLXRhYicpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICAkKGN1cnJlbnRUYWIpLnJlbW92ZUNsYXNzKFwidGFiX19jb250ZW50LS1oaWRkZW5cIikuYWRkQ2xhc3MoXCJ0YWJfX2NvbnRlbnQtLXZpc2libGVcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdUYWJzIGluaXRpYXRlZDonLCBjdXJyZW50VGFiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KSgpO1xuICAgIHRhYnMuaW5pdCgpO1xuICAgIFxuICAgICQoXCIuZ2xvYmFsXCIpLm9uKCdjbGljaycsICcubGluay0tdGFiJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgLy8gd3nFgsSFY3phIGRvbXnFm2xuZSBwcnplasWbY2llIG5hIGFkcmVzIGxpbmt1XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIGRvZGFqZSBrbGFzxJkgZG8gPGxpPlxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFkZENsYXNzKFwidGFic01lbnVfX2l0ZW0tLWN1cnJlbnRcIik7XG4gICAgICAgIC8vIHVzdXdhIGtsYXPEmSB6IDxsaT5cbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwidGFic01lbnVfX2l0ZW0tLWN1cnJlbnRcIik7XG4gICAgICAgIC8vIHBvYmllcmFteSBpZCB6IGhyZWZ1XG4gICAgICAgIHZhciB0YWIgPSAkKHRoaXMpLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAvLyBqZcWbbGkgYmxvayBuaWUgbWEgdGFraWVnbyBpZCwgdG8gY2hvd2FteSBnb1xuICAgICAgICAkKFwiLnRhYl9fY29udGVudFwiKS5ub3QodGFiKS5hZGRDbGFzcyhcInRhYl9fY29udGVudC0taGlkZGVuXCIpLnJlbW92ZUNsYXNzKFwidGFiX19jb250ZW50LS12aXNpYmxlXCIpO1xuICAgICAgICAvLyBhIGplxZtsaSBtYSwgdG8gcG9rYXp1amVteVxuICAgICAgICAkKHRhYikucmVtb3ZlQ2xhc3MoXCJ0YWJfX2NvbnRlbnQtLWhpZGRlblwiKS5hZGRDbGFzcyhcInRhYl9fY29udGVudC0tdmlzaWJsZVwiKTtcbiAgICAgICAgLy8gxYJhZHVqZW15IG9icmF6a2kgdyBibG9rdSB6IG9kcG93aWVkbmltIGlkXG4gICAgICAgIGJMYXp5LmxvYWQoJChcIi5ibGF6eVwiLCB0YWIpLCB0cnVlKTtcbiAgICB9KTtcblxuICAgIC8vIGh0dHA6Ly9jb2RlcGVuLmlvL2pha3VidHVyc2t5L3Blbi92RXdab3BcbiAgICBcdCQuZm4ualF1ZXJ5U2ltcGxlQ291bnRlciA9IGZ1bmN0aW9uKCBvcHRpb25zICkge1xuICAgIFx0ICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcbiAgICBcdCAgICAgICAgc3RhcnQ6ICAwLFxuICAgIFx0ICAgICAgICBlbmQ6ICAgIDEwMCxcbiAgICBcdCAgICAgICAgZWFzaW5nOiAnc3dpbmcnLFxuICAgIFx0ICAgICAgICBkdXJhdGlvbjogNDAwLFxuICAgIFx0ICAgICAgICBjb21wbGV0ZTogJydcbiAgICBcdCAgICB9LCBvcHRpb25zICk7XG4gICAgXG4gICAgXHQgICAgdmFyIHRoaXNFbGVtZW50ID0gJCh0aGlzKTtcbiAgICBcbiAgICBcdCAgICAkKHtjb3VudDogc2V0dGluZ3Muc3RhcnR9KS5hbmltYXRlKHtjb3VudDogc2V0dGluZ3MuZW5kfSwge1xuICAgIFx0XHRcdGR1cmF0aW9uOiBzZXR0aW5ncy5kdXJhdGlvbixcbiAgICBcdFx0XHRlYXNpbmc6IHNldHRpbmdzLmVhc2luZyxcbiAgICBcdFx0XHRzdGVwOiBmdW5jdGlvbigpIHtcbiAgICBcdFx0XHRcdHZhciBtYXRoQ291bnQgPSBNYXRoLmNlaWwodGhpcy5jb3VudCk7XG4gICAgXHRcdFx0XHR0aGlzRWxlbWVudC5jaGlsZHJlbignLmNvdW50ZXJzX19jb3VudCcpLnRleHQobWF0aENvdW50KTtcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdGNvbXBsZXRlOiBzZXR0aW5ncy5jb21wbGV0ZVxuICAgIFx0XHR9KTtcbiAgICBcdH07XG4gICAgXG4gICAgLy8gdmFyIGZpbmlzaGVkTnVtYmVyID0gJCgnI2ZpbmlzaGVkJykuZGF0YSgnZmluaXNoZWQnKTtcbiAgICAvLyBjb25zb2xlLmxvZyhmaW5pc2hlZE51bWJlcik7XG4gICAgLy8gJCgnI2ZpbmlzaGVkJykualF1ZXJ5U2ltcGxlQ291bnRlcih7ZW5kOiBmaW5pc2hlZE51bWJlciwgZHVyYXRpb246IDMwMDB9KTtcbiAgICAvLyAkKCcjbnVtYmVyMicpLmpRdWVyeVNpbXBsZUNvdW50ZXIoe2VuZDogNTUsZHVyYXRpb246IDMwMDB9KTtcbiAgICAvLyAkKCcjbnVtYmVyMycpLmpRdWVyeVNpbXBsZUNvdW50ZXIoe2VuZDogMzU5LGR1cmF0aW9uOiAyMDAwfSk7XG4gICAgLy8gJCgnI251bWJlcjQnKS5qUXVlcnlTaW1wbGVDb3VudGVyKHtlbmQ6IDI0NixkdXJhdGlvbjogMjUwMH0pO1xuXG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBodHRwczovL21hcmNpbi5sYWJlci5wbC8yMDE0LzA5L29kbWlhbmEtbGljemVibmlrb3ctdy1qYXZhc2NyaXB0L1xuICAgICAgICB2YXIgbnVtID0gZnVuY3Rpb24odmFsdWUsIG51bWVyYWxzLCB3b3ZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgdDAgPSB2YWx1ZSAlIDEwLFxuICAgICAgICAgICAgICAgIHQxID0gdmFsdWUgJSAxMDAsXG4gICAgICAgICAgICAgICAgdm8gPSBbXTtcbiAgICAgICAgICAgIGlmICh3b3ZhbHVlICE9PSB0cnVlKVxuICAgICAgICAgICAgICAgIHZvLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAxICYmIG51bWVyYWxzWzFdKVxuICAgICAgICAgICAgICAgIHZvLnB1c2gobnVtZXJhbHNbMV0pO1xuICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlID09PSAwIHx8ICh0MCA+PSAwICYmIHQwIDw9IDEpIHx8ICh0MCA+PSA1ICYmIHQwIDw9IDkpIHx8ICh0MSA+IDEwICYmIHQxIDwgMjApKSAmJiBudW1lcmFsc1swXSlcbiAgICAgICAgICAgICAgICB2by5wdXNoKG51bWVyYWxzWzBdKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKCgodDEgPCAxMCB8fCB0MSA+IDIwKSAmJiB0MCA+PSAyICYmIHQwIDw9IDQpICYmIG51bWVyYWxzWzJdKVxuICAgICAgICAgICAgICAgIHZvLnB1c2gobnVtZXJhbHNbMl0pO1xuICAgICAgICAgICAgcmV0dXJuIHZvWzFdO1xuICAgICAgICB9O1xuICAgIFxuICAgICAgICAkKCcuY291bnRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBzdGF0dXMgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICB2YXIgY291bnQgPSBwYXJzZUludCgkKHRoaXMpLmNoaWxkcmVuKCdhJykuaHRtbCgpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50LCBzdGF0dXMpO1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykge1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLmNvdW50ZXJfX2xhYmVsJykuaHRtbChudW0oY291bnQsIFtcIlByb2pla3TDs3cgdWtvxYRjem9ueWNoXCIsIFwiUHJvamVrdCB1a2/FhGN6b255XCIsIFwiUHJvamVrdHkgdWtvxYRjem9uZVwiXSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5jb3VudGVyX19sYWJlbCcpLmh0bWwobnVtKGNvdW50LCBbXCJQcm9qZWt0w7N3IHJlYWxpem93YW55Y2hcIiwgXCJQcm9qZWt0IHJlYWxpem93YW55XCIsIFwiUHJvamVrdHkgcmVhbGl6b3dhbmVcIl0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICQoJy5jb3VudGVyc19fY291bnRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBzdGF0dXMgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICB2YXIgY291bnQgPSBwYXJzZUludCgkKHRoaXMpLmNoaWxkcmVuKCcuY291bnRlcnNfX2NvdW50JykuZGF0YShzdGF0dXMpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50LCBzdGF0dXMpO1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykge1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnLmNvdW50ZXJzX19sYWJlbCcpLmh0bWwobnVtKGNvdW50LCBbXCJQcm9qZWt0w7N3IHVrb8WEY3pvbnljaFwiLCBcIlByb2pla3QgdWtvxYRjem9ueVwiLCBcIlByb2pla3R5IHVrb8WEY3pvbmVcIl0pKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSAnaW4tcHJvZ3Jlc3MnKXtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5jb3VudGVyc19fbGFiZWwnKS5odG1sKG51bShjb3VudCwgW1wiUHJvamVrdMOzdyByZWFsaXpvd2FueWNoXCIsIFwiUHJvamVrdCByZWFsaXpvd2FueVwiLCBcIlByb2pla3R5IHJlYWxpem93YW5lXCJdKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKCcjJytzdGF0dXMpLmpRdWVyeVNpbXBsZUNvdW50ZXIoe2VuZDogY291bnQsIGR1cmF0aW9uOiAyNTAwfSk7XG4gICAgXG4gICAgICAgIH0pO1xuICAgIFxuICAgIH0pKCk7XG5cbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGFuaW1hY2phIHplIHptaWVuaWFqxIVjeW0gc2nEmSBncmFkaWVudGVtIG9iY2nEhcW8YSBDUFUsXG4gICAgICAgIC8vIHdpxJljIHfFgsSFY3phbSBqxIUgdHlsa28sIGdkeSB1xbx5dGtvd25payBkb3Nyb2x1amUgZG8ga2/FhGNhIHN0cm9ueVxuICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSA+PSAkKGRvY3VtZW50KS5oZWlnaHQoKSAtICQod2luZG93KS5oZWlnaHQoKSAtIDUwMCkge1xuICAgICAgICAgICAgICAkKCcuZm9vdGVyLXdyYXBwZXInKS5hZGRDbGFzcygnZm9vdGVyLXdyYXBwZXItLWFuaW1hdGUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkKCcuZm9vdGVyLXdyYXBwZXInKS5yZW1vdmVDbGFzcygnZm9vdGVyLXdyYXBwZXItLWFuaW1hdGUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pKCk7XG5cbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICQoXCIuYmFubmVyX19taWRkbGVUaXRsZVwiKS5vbmUoJ2FuaW1hdGlvbmVuZCB3ZWJraXRBbmltYXRpb25FbmQgb0FuaW1hdGlvbkVuZCBvYW5pbWF0aW9uZW5kIE1TQW5pbWF0aW9uRW5kJyxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdiYW5uZXJfX21pZGRsZVRpdGxlLS1hbmltYXRpb24nKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIuYmFubmVyX19sZWZ0VGl0bGVcIikub25lKCdhbmltYXRpb25lbmQgd2Via2l0QW5pbWF0aW9uRW5kIG9BbmltYXRpb25FbmQgb2FuaW1hdGlvbmVuZCBNU0FuaW1hdGlvbkVuZCcsXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYmFubmVyX19sZWZ0VGl0bGUtLWFuaW1hdGlvbicpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIi5iYW5uZXJfX3JpZ2h0VGl0bGVcIikub25lKCdhbmltYXRpb25lbmQgd2Via2l0QW5pbWF0aW9uRW5kIG9BbmltYXRpb25FbmQgb2FuaW1hdGlvbmVuZCBNU0FuaW1hdGlvbkVuZCcsXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYmFubmVyX19yaWdodFRpdGxlLS1hbmltYXRpb24nKTtcbiAgICAgICAgfSk7XG4gICAgXG4gICAgXG4gICAgICAgICQoJy5iYW5uZXJfX2xlZnQnKS5ob3ZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5iYW5uZXJfX21pZGRsZScpLmFkZENsYXNzKCdiYW5uZXJfX21pZGRsZS0tY29sbGFwc2VkTCcpO1xuICAgICAgICAgICAgJCgnLmJhbm5lcl9fbWlkZGxlVGl0bGUnKS5hZGRDbGFzcygnYmFubmVyX19taWRkbGVUaXRsZS0tb3BhY2l0eTgwJyk7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdiYW5uZXJfX2xlZnQtLW12UicpO1xuICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5iYW5uZXJfX21pZGRsZScpLnJlbW92ZUNsYXNzKCdiYW5uZXJfX21pZGRsZS0tY29sbGFwc2VkTCcpO1xuICAgICAgICAgICAgJCgnLmJhbm5lcl9fbWlkZGxlVGl0bGUnKS5yZW1vdmVDbGFzcygnYmFubmVyX19taWRkbGVUaXRsZS0tb3BhY2l0eTgwJyk7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdiYW5uZXJfX2xlZnQtLW12UicpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnLmJhbm5lcl9fcmlnaHQnKS5ob3ZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5iYW5uZXJfX21pZGRsZScpLmFkZENsYXNzKCdiYW5uZXJfX21pZGRsZS0tY29sbGFwc2VkUicpO1xuICAgICAgICAgICAgJCgnLmJhbm5lcl9fbWlkZGxlVGl0bGUnKS5hZGRDbGFzcygnYmFubmVyX19taWRkbGVUaXRsZS0tb3BhY2l0eTgwJyk7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdiYW5uZXJfX3JpZ2h0LS1tdkwnKTtcbiAgICBcbiAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuYmFubmVyX19taWRkbGUnKS5yZW1vdmVDbGFzcygnYmFubmVyX19taWRkbGUtLWNvbGxhcHNlZFInKTtcbiAgICAgICAgICAgICQoJy5iYW5uZXJfX21pZGRsZVRpdGxlJykucmVtb3ZlQ2xhc3MoJ2Jhbm5lcl9fbWlkZGxlVGl0bGUtLW9wYWNpdHk4MCcpO1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYmFubmVyX19yaWdodC0tbXZMJyk7XG4gICAgXG4gICAgICAgIH0pO1xuICAgIH0pKCk7XG5cbiAgICAvLyBodHRwOi8vY29kZXBlbi5pby9jb2R5aG91c2UvcGVuL3N6S3ZtXG4gICAgXG4gICAgLy9zZXQgeW91ciBnb29nbGUgbWFwcyBwYXJhbWV0ZXJzXG4gICAgdmFyICRsYXRpdHVkZSA9IDUxLjEwODMwLFxuICAgICAgICAkbG9uZ2l0dWRlID0gMTcuMDY1NDIsXG4gICAgICAgICRtYXBfem9vbSA9IDE2O1xuICAgIFxuICAgIC8vZ29vZ2xlIG1hcCBjdXN0b20gbWFya2VyIGljb24gLSAucG5nIGZhbGxiYWNrIGZvciBJRTExXG4gICAgdmFyIGlzX2ludGVybmV0RXhwbG9yZXIxMSA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd0cmlkZW50JykgPiAtMTtcbiAgICB2YXIgJG1hcmtlcl91cmwgPSAoaXNfaW50ZXJuZXRFeHBsb3JlcjExKSA/ICdodHRwczovL3MzLXVzLXdlc3QtMi5hbWF6b25hd3MuY29tL3MuY2Rwbi5pby8xNDg4NjYvY2QtaWNvbi1sb2NhdGlvbi5wbmcnIDogJ2h0dHBzOi8vczMtdXMtd2VzdC0yLmFtYXpvbmF3cy5jb20vcy5jZHBuLmlvLzE0ODg2Ni9jZC1pY29uLWxvY2F0aW9uXzEuc3ZnJztcbiAgICBcbiAgICAvL2RlZmluZSB0aGUgYmFzaWMgY29sb3Igb2YgeW91ciBtYXAsIHBsdXMgYSB2YWx1ZSBmb3Igc2F0dXJhdGlvbiBhbmQgYnJpZ2h0bmVzc1xuICAgIHZhciAkbWFpbl9jb2xvciA9ICcjNmM0ODkyJyxcbiAgICAgICAgJHNhdHVyYXRpb24gPSAtMjAsXG4gICAgICAgICRicmlnaHRuZXNzID0gNTtcbiAgICBcbiAgICAvL3dlIGRlZmluZSBoZXJlIHRoZSBzdHlsZSBvZiB0aGUgbWFwXG4gICAgdmFyIHN0eWxlID0gW3tcbiAgICAgICAgICAgIC8vc2V0IHNhdHVyYXRpb24gZm9yIHRoZSBsYWJlbHMgb24gdGhlIG1hcFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwibGFiZWxzXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7IC8vcG9pIHN0YW5kcyBmb3IgcG9pbnQgb2YgaW50ZXJlc3QgLSBkb24ndCBzaG93IHRoZXNlIGxhYmxlcyBvbiB0aGUgbWFwXG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2lcIixcbiAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImxhYmVsc1wiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9uXCJcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIC8vZG9uJ3Qgc2hvdyBoaWdod2F5cyBsYWJsZXMgb24gdGhlIG1hcFxuICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdyb2FkLmhpZ2h3YXknLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdsYWJlbHMnLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9mZlwiXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICAvL2Rvbid0IHNob3cgbG9jYWwgcm9hZCBsYWJsZXMgb24gdGhlIG1hcFxuICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwicm9hZC5sb2NhbFwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwibGFiZWxzLmljb25cIixcbiAgICAgICAgICAgIHN0eWxlcnM6IFt7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvZmZcIlxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgLy9kb24ndCBzaG93IGFydGVyaWFsIHJvYWQgbGFibGVzIG9uIHRoZSBtYXBcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInJvYWQuYXJ0ZXJpYWxcIixcbiAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImxhYmVscy5pY29uXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwib2ZmXCJcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIC8vZG9uJ3Qgc2hvdyByb2FkIGxhYmxlcyBvbiB0aGUgbWFwXG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJyb2FkXCIsXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJnZW9tZXRyeS5zdHJva2VcIixcbiAgICAgICAgICAgIHN0eWxlcnM6IFt7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvZmZcIlxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSxcbiAgICAgICAgLy9zdHlsZSBkaWZmZXJlbnQgZWxlbWVudHMgb24gdGhlIG1hcFxuICAgICAgICB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJ0cmFuc2l0XCIsXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJnZW9tZXRyeS5maWxsXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIGh1ZTogJG1haW5fY29sb3JcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9uXCJcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBsaWdodG5lc3M6ICRicmlnaHRuZXNzXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2F0dXJhdGlvbjogJHNhdHVyYXRpb25cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInBvaVwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnkuZmlsbFwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvblwiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbGlnaHRuZXNzOiAkYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2kuZ292ZXJubWVudFwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnkuZmlsbFwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvblwiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbGlnaHRuZXNzOiAkYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2kuc3BvcnRfY29tcGxleFwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnkuZmlsbFwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvblwiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbGlnaHRuZXNzOiAkYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2kuYXR0cmFjdGlvblwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnkuZmlsbFwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvZmZcIlxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGxpZ2h0bmVzczogJGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzYXR1cmF0aW9uOiAkc2F0dXJhdGlvblxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwicG9pLmJ1c2luZXNzXCIsXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJnZW9tZXRyeS5maWxsXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIGh1ZTogJG1haW5fY29sb3JcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9uXCJcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBsaWdodG5lc3M6ICRicmlnaHRuZXNzXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2F0dXJhdGlvbjogJHNhdHVyYXRpb25cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInRyYW5zaXRcIixcbiAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImdlb21ldHJ5LmZpbGxcIixcbiAgICAgICAgICAgIHN0eWxlcnM6IFt7XG4gICAgICAgICAgICAgICAgaHVlOiAkbWFpbl9jb2xvclxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwib25cIlxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGxpZ2h0bmVzczogJGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzYXR1cmF0aW9uOiAkc2F0dXJhdGlvblxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwidHJhbnNpdC5zdGF0aW9uXCIsXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJnZW9tZXRyeS5maWxsXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIGh1ZTogJG1haW5fY29sb3JcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9uXCJcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBsaWdodG5lc3M6ICRicmlnaHRuZXNzXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2F0dXJhdGlvbjogJHNhdHVyYXRpb25cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcImxhbmRzY2FwZVwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvblwiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbGlnaHRuZXNzOiAkYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgIFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJyb2FkXCIsXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJnZW9tZXRyeS5maWxsXCIsXG4gICAgICAgICAgICBzdHlsZXJzOiBbe1xuICAgICAgICAgICAgICAgIGh1ZTogJG1haW5fY29sb3JcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcIm9uXCJcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBsaWdodG5lc3M6ICRicmlnaHRuZXNzXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2F0dXJhdGlvbjogJHNhdHVyYXRpb25cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInJvYWQuaGlnaHdheVwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnkuZmlsbFwiLFxuICAgICAgICAgICAgc3R5bGVyczogW3tcbiAgICAgICAgICAgICAgICBodWU6ICRtYWluX2NvbG9yXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJvblwiXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbGlnaHRuZXNzOiAkYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb246ICRzYXR1cmF0aW9uXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJ3YXRlclwiLFxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwiZ2VvbWV0cnlcIixcbiAgICAgICAgICAgIHN0eWxlcnM6IFt7XG4gICAgICAgICAgICAgICAgaHVlOiAkbWFpbl9jb2xvclxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwib25cIlxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGxpZ2h0bmVzczogJGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzYXR1cmF0aW9uOiAkc2F0dXJhdGlvblxuICAgICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgIF07XG4gICAgXG4gICAgLy9zZXQgZ29vZ2xlIG1hcCBvcHRpb25zXG4gICAgdmFyIG1hcF9vcHRpb25zID0ge1xuICAgICAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoJGxhdGl0dWRlLCAkbG9uZ2l0dWRlKSxcbiAgICAgICAgem9vbTogJG1hcF96b29tLFxuICAgICAgICBwYW5Db250cm9sOiBmYWxzZSxcbiAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxuICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXG4gICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcbiAgICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlLFxuICAgICAgICBzdHlsZXM6IHN0eWxlLFxuICAgIH07XG4gICAgLy9pbml6aWFsaXplIHRoZSBtYXBcbiAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc25yZy1tYXAnKSwgbWFwX29wdGlvbnMpO1xuICAgIC8vYWRkIGEgY3VzdG9tIG1hcmtlciB0byB0aGUgbWFwXG4gICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZygkbGF0aXR1ZGUsICRsb25naXR1ZGUpLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgaWNvbjogJG1hcmtlcl91cmwsXG4gICAgfSk7XG4gICAgXG4gICAgLy9hZGQgY3VzdG9tIGJ1dHRvbnMgZm9yIHRoZSB6b29tLWluL3pvb20tb3V0IG9uIHRoZSBtYXBcbiAgICBmdW5jdGlvbiBDdXN0b21ab29tQ29udHJvbChjb250cm9sRGl2LCBtYXApIHtcbiAgICAgICAgLy9ncmFwIHRoZSB6b29tIGVsZW1lbnRzIGZyb20gdGhlIERPTSBhbmQgaW5zZXJ0IHRoZW0gaW4gdGhlIG1hcFxuICAgICAgICB2YXIgY29udHJvbFVJem9vbUluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nucmctem9vbS1pbicpLFxuICAgICAgICAgICAgY29udHJvbFVJem9vbU91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbnJnLXpvb20tb3V0Jyk7XG4gICAgICAgIGNvbnRyb2xEaXYuYXBwZW5kQ2hpbGQoY29udHJvbFVJem9vbUluKTtcbiAgICAgICAgY29udHJvbERpdi5hcHBlbmRDaGlsZChjb250cm9sVUl6b29tT3V0KTtcbiAgICBcbiAgICAgICAgLy8gU2V0dXAgdGhlIGNsaWNrIGV2ZW50IGxpc3RlbmVycyBhbmQgem9vbS1pbiBvciBvdXQgYWNjb3JkaW5nIHRvIHRoZSBjbGlja2VkIGVsZW1lbnRcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkRG9tTGlzdGVuZXIoY29udHJvbFVJem9vbUluLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1hcC5zZXRab29tKG1hcC5nZXRab29tKCkgKyAxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZERvbUxpc3RlbmVyKGNvbnRyb2xVSXpvb21PdXQsICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbWFwLnNldFpvb20obWFwLmdldFpvb20oKSAtIDEpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgdmFyIHpvb21Db250cm9sRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdmFyIHpvb21Db250cm9sID0gbmV3IEN1c3RvbVpvb21Db250cm9sKHpvb21Db250cm9sRGl2LCBtYXApO1xuICAgIFxuICAgIC8vaW5zZXJ0IHRoZSB6b29tIGRpdiBvbiB0aGUgdG9wIGxlZnQgb2YgdGhlIG1hcFxuICAgIG1hcC5jb250cm9sc1tnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uTEVGVF9UT1BdLnB1c2goem9vbUNvbnRyb2xEaXYpO1xuXG4gIH0pO1xuXG4gIC8vIFByZXplcyB6YXdzemUgbmEgcGllcndzenltIG1pZWpzY3UgLy9cbiAgJCgnLm1lbWJlcmNhcmQjcHJlc2lkZW50JykuaW5zZXJ0QmVmb3JlKCcjY3VycmVudF9tZW1iZXJzIC5jYXJkc1dyYXBwZXIgZGl2OmVxKDApJyk7XG5cbiAgLy8gRG9kYWplIGRvIDxhPiBrbGFzxJkgXCJsaW5rXCJcbiAgJCgnLnByb2plY3RfX2NvbnRlbnQgYScpLmFkZENsYXNzKCdsaW5rJyk7XG5cbn0pOyJdLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
