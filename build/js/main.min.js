// main.js //
// Wszystko wrzucamy tu

jQuery(function($) {

  /**
   * Dropy
   * http://codepen.io/Tombek/pen/OPvpLe
   */
  var dropy = {
    $dropys: null,
    openClass: 'open',
    selectClass: 'selected',
    init: function(){
      var self = this;
  
      self.$dropys = $('.dropy');
      self.eventHandler();
    },
    eventHandler: function(){
      var self = this;
  
      // Opening a dropy
      self.$dropys.find('.dropy__title').click(function(){
        self.$dropys.removeClass(self.openClass);
        $(this).parents('.dropy').addClass(self.openClass);
      });
  
      // Click on a dropy list
      self.$dropys.find('.dropy__content ul li a').click(function(){
        var $that = $(this);
        var $dropy = $that.parents('.dropy');
        var $input = $dropy.find('input');
        var $title = $(this).parents('.dropy').find('.dropy__title span');
  
        // Remove selected class
        $dropy.find('.dropy__content a').each(function(){
          $(this).removeClass(self.selectClass);
        });
  
        // Update selected value
        $title.html($that.html());
        $input.val($that.attr('data-value')).trigger('change');
  
        // If back to default, remove selected class else addclass on right element
        if($that.hasClass('dropy__header')){
          $title.removeClass(self.selectClass);
          $title.html($title.attr('data-title'));
        }
        else{
          $title.addClass(self.selectClass);
          $that.addClass(self.selectClass);
        }
  
        // Close dropdown
        $dropy.removeClass(self.openClass);
      });
  
      // Close all dropdown onclick on another element
      $(document).bind('click', function(e){
          if (! $(e.target).parents().hasClass('dropy')){ self.$dropys.removeClass(self.openClass); }
      });
    }
  };
  
  $(function(){
    dropy.init();
  });

    function acts() {
      var te;
      var min = $('.post-list-item-content h2').height();
      $('.post-list-item .post-list-item-content h2').each(function() {
        if ($(this).height() < min)
          min = $(this).height();
      });
  
      $('.post-list-item-content h2').each(function() {
        if ($(this).height() == min) {
          te = $(this).parent().parent().children('.excerpt');
          $(te).text(function(index, currentText) {
            if (currentText.substr(currentText.length - 3) != '\u2026')
              return currentText.substr(0, 150) + '\u2026';
          });
        } else if (($(this).height() < (min - 1) * 3) && ($(this).height() > min)) {
          te = $(this).parent().parent().children('.excerpt');
          $(te).text(function(index, currentText) {
            return currentText.substr(0, 80) + '\u2026';
          });
        } else {
          te = $(this).parent().parent().children('.excerpt');
          $(this).text(function(index, currentText) {
            if ((currentText.substr(currentText.length - 3) != '\u2026') && (currentText.length > 120))
              return currentText.substr(0, 120) + '\u2026';
          });
          te.css("display", "none");
        }
      });
    }
    acts();
    $(window).resize(acts);
  
     function cardExcerpt() {
      $(".card__excerpt").text(function(index, currentText) {
        return currentText.substr(0, 140) + '\u2026';
      });
    }
    cardExcerpt();

  // Pakuje mniejsze obrazki bez podpisu w <figure> //
  // Jeśli obrazek ma tytuł, tym się zajmuje php funkcja w project-functions.php
  $('.project-content p').each(function(index) {
    var some_img = $(this).find('img');
    var width = some_img.width();
    if (width < 980) {
      some_img.wrap("<figure></figure>");
    }
  });

  //Skraca imiona, by nie wychodziły za bloki
  $('.co-author h3 a').each(function(index) {
    var length = $(this).html().length;
    if (length > 13) {
      var name = $(this).text();
      // console.log(name);
      var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
      // console.log(trimmed_name);
      $(this).text(trimmed_name);
    }
  });

  // Notyfikacje, powiadomienia //
  $(".note-close").click(function() {
    $(this).parent()
      .animate({
        opacity: 0
      }, 250, function() {
        $(this)
          .animate({
            marginBottom: 0
          }, 250)
          .children()
          .animate({
            padding: 0
          }, 250)
          .wrapInner("<div />")
          .children()
          .slideUp(250, function() {
            $(this).closest(".note").remove();
          });
      });
  });

  // Animacje dla banera rekrutacji //
  $('label.button').on('click', function() {
    $('.fb').addClass('animated fadeInUp');
    $('.date .icon-container').addClass('animated slideInLeft');
    $('.date span').addClass('animated slideInLeft');
    $('.location .icon-container').addClass('animated slideInRight');
    $('.location span').addClass('animated slideInRight');
  
  });
  $('#close_banner').on('click', function() {
    $('.fb').removeClass('animated fadeInUp');
    $('.date .icon-container').removeClass('animated slideInLeft');
    $('.date span').removeClass('animated slideInLeft');
    $('.location .icon-container').removeClass('animated slideInRight');
    $('.location span').removeClass('animated slideInRight');
  });
  
  // http://stackoverflow.com/questions/24070627/create-dropdown-banner-when-user-first-visits-website
  // Pozwalają otwierać baner tylko przy pierwszej wizycie
  
  // cookie-js

  // Pobieranie nicków z url i wyświetlanie ich koło ikon społecznościowych
  // oraz wykorzystanie username'u githuba do wyświetlenia ostatnie aktywności
  $('.userinfo a').each(function(index) {
    var profile = $(this).attr('href');
    var github_profile = profile.substr(19);
    if (profile.indexOf('github') > -1) {
      $('a[data-github]').append(github_profile);
      Github.onlyuserActivity({
        username: github_profile,
        selector: ".github",
        limit: 10
      });
    }
    if (profile.indexOf('twitter') > -1) {
      $('a[data-twitter]').append(profile.substr(20));
    }
    if (profile.indexOf('facebook') > -1) {
      $('a[data-facebook]').append(profile.substr(25));
    }
  });
  
  // Github.onlyuserActivity({
  //   username: "synergia",
  //   selector: ".github_s",
  //   limit: 5
  // });

  function tabs(bLazy) {
    // set active radio to address bar
    $(document).on('click', '.tabs .tabs-nav label', function() {
      var tab_nr = $(this).attr('for');
      var hash = '#' + tab_nr;
      window.history.replaceState('', '', hash);
      if(tab_nr === 'tab-1'){
        bLazy.load($('.tab:nth-of-type(1) .blazy'), true);
      } else if (tab_nr === 'tab-2') {
        bLazy.load($('.tab:nth-of-type(2) .blazy'), true);
      }else if (tab_nr === 'tab-3') {
        bLazy.load($('.tab:nth-of-type(3) .blazy'), true);
      }
  
    });
    // select active radio based on hash
    $(document.location.hash).prop('checked', true);
  }

  /* ========================================================================
   * Bootstrap: transition.js v3.3.6
   * http://getbootstrap.com/javascript/#transitions
   * ========================================================================
   * Copyright 2011-2015 Twitter, Inc.
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
   * ======================================================================== */
  
  
  +function ($) {
    'use strict';
  
    // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
    // ============================================================
  
    function transitionEnd() {
      var el = document.createElement('bootstrap')
  
      var transEndEventNames = {
        WebkitTransition : 'webkitTransitionEnd',
        MozTransition    : 'transitionend',
        OTransition      : 'oTransitionEnd otransitionend',
        transition       : 'transitionend'
      }
  
      for (var name in transEndEventNames) {
        if (el.style[name] !== undefined) {
          return { end: transEndEventNames[name] }
        }
      }
  
      return false // explicit for ie8 (  ._.)
    }
  
    // http://blog.alexmaccaw.com/css-transitions
    $.fn.emulateTransitionEnd = function (duration) {
      var called = false
      var $el = this
      $(this).one('bsTransitionEnd', function () { called = true })
      var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
      setTimeout(callback, duration)
      return this
    }
  
    $(function () {
      $.support.transition = transitionEnd()
  
      if (!$.support.transition) return
  
      $.event.special.bsTransitionEnd = {
        bindType: $.support.transition.end,
        delegateType: $.support.transition.end,
        handle: function (e) {
          if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
        }
      }
    })
  
  }(jQuery);

  $(document).ready(function(){
      $("#nav-mobile").html($("#nav-main").html());
      $("#nav-trigger .navicon-button").click(function(){
        console.info('Burger clicked');
          if ($("nav#nav-mobile ul").hasClass("expanded")) {
              $("nav#nav-mobile ul.expanded").removeClass("expanded").slideUp(250);
              $(this).removeClass("open");
          } else {
              $("nav#nav-mobile ul").addClass("expanded").slideDown(250);
              $(this).addClass("open");
          }
      });
  });

  $(document).ready(function() {
    Slider = $('#slider').Swipe({
      auto: 0,
      continuous: true,
    }).data('Swipe');
    if (Slider) {
      $('.next').on('click', Slider.next);
      $('.prev').on('click', Slider.prev);
    }
  });

  // Płynne skrolowanie //
  // https://css-tricks.com/snippets/jquery/smooth-scrolling/#comment-197181
  
  jQuery(function($) {
    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {
  
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
        if (target.length) {
          $('html,body').animate({
            scrollTop: target.offset().top
          }, 1000);
          return false;
        }
      }
    });
  });


  $(document).ready(function() {

      var bLazy = new Blazy({
        offset: 20,
        selector: '.blazy',
        loadInvisible: false,
        breakpoints: [{
          width: 360, // Max-width
          src: 'data-src-small'
        }],
        success: function(element) {
          $(element).parent().removeClass('loading', 500);
          updateCounter();
        },
        error: function(element, msg) {
          if (msg === 'missing') {
            $(element).parent().removeClass('loading', 500); // Data-src is missing
            console.error("bLazy: data-src is missing");
          } else if (msg === 'invalid') {
            $(element).parent().removeClass('loading', 500);
            // Data-src is invalid
            console.error("bLazy: data-src is invalid");
    
          }
        }
      });
      // not needed, only here to illustrate amount of loaded images
      var imageLoaded = 0;
    
      function updateCounter() {
        imageLoaded++;
        console.info("bLazy: Images loaded: %d", imageLoaded);
      }
    
      tabs(bLazy);

    // http://arresteddeveloper.net/wordpress-infinite-scroll-with-wordpress-posts-and-waypoints-js/
    
    // Chyba z tego zrobić należy objekt
    
    var project_status = jQuery('#finished_projects').attr('data-projects-status');
    var ajax_url = jQuery('#projects').attr('data-ajax-url');
    var total_finished_projects = jQuery('#finished_projects').attr('data-total-finished-projects');
    var total_in_progress_projects = jQuery('#in_progress_projects').attr('data-total-in-progress-projects');
    var total_ideas_projects = jQuery('#ideas_projects').attr('data-total-ideas-projects');
    var post_offset = 0;
    var loaded_finished_projects = 0;
    
    // Skrolujemy do stopki, wtedy uruchamia się funkcja loadProjects()
    if (ajax_url) {
      $(window).scroll(function() {
        if ($(window).scrollTop() >= $(document).height() - $(window).height() - 100) {
          if ($('#ideas_projects').is(':visible')) {
            loaded_ideas_projects = $('#ideas_projects').children().length;
            loadProjects('ideas', total_ideas_projects, loaded_ideas_projects);
          }
          else if ($('#in_progress_projects').is(':visible')) {
            loaded_in_progress_projects = $('#in_progress_projects').children().length;
            loadProjects('in_progress', total_in_progress_projects, loaded_in_progress_projects);
          }
          else if ($('#finished_projects').is(':visible')) {
            loaded_finished_projects = $('#finished_projects').children().length;
            loadProjects('finished', total_finished_projects, loaded_finished_projects);
          }
        }
      });
    }
    
    
    function loadProjects(projects_status, total_projects, loaded_projects) {
      post_offset = parseInt(post_offset) + 6;
      console.info("Loaded %s projects: %d/%d",projects_status, loaded_projects, total_projects);
    
      if (total_projects > loaded_projects) {
        $('.loader').show();
        $.ajax({
          url: ajax_url,
          type: 'POST',
          data: {
            action: 'load_projects',
            post_offset: post_offset,
            projects_status: projects_status,
          },
          success: function(data) {
            $('#' + projects_status + '_projects').append(data);
            // $(data).hide().appendTo('#' + projects_status + '_projects').show(200);
            console.info('Ajax: Loaded more %s projects', projects_status);
            bLazy.revalidate();
            cardExcerpt();
            $('.loader').hide();
          }
        });
      } else {
        return false;
      }
    }

  });
  // Prezes zawsze na pierwszym miejscu //
  $('#management_board li#admin').insertBefore('#management_board li:eq(0)');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1haW4uanMgLy9cbi8vIFdzenlzdGtvIHdyenVjYW15IHR1XG5cbmpRdWVyeShmdW5jdGlvbigkKSB7XG5cbiAgLyoqXG4gICAqIERyb3B5XG4gICAqIGh0dHA6Ly9jb2RlcGVuLmlvL1RvbWJlay9wZW4vT1B2cExlXG4gICAqL1xuICB2YXIgZHJvcHkgPSB7XG4gICAgJGRyb3B5czogbnVsbCxcbiAgICBvcGVuQ2xhc3M6ICdvcGVuJyxcbiAgICBzZWxlY3RDbGFzczogJ3NlbGVjdGVkJyxcbiAgICBpbml0OiBmdW5jdGlvbigpe1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICBcbiAgICAgIHNlbGYuJGRyb3B5cyA9ICQoJy5kcm9weScpO1xuICAgICAgc2VsZi5ldmVudEhhbmRsZXIoKTtcbiAgICB9LFxuICAgIGV2ZW50SGFuZGxlcjogZnVuY3Rpb24oKXtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgXG4gICAgICAvLyBPcGVuaW5nIGEgZHJvcHlcbiAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX3RpdGxlJykuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgc2VsZi4kZHJvcHlzLnJlbW92ZUNsYXNzKHNlbGYub3BlbkNsYXNzKTtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnRzKCcuZHJvcHknKS5hZGRDbGFzcyhzZWxmLm9wZW5DbGFzcyk7XG4gICAgICB9KTtcbiAgXG4gICAgICAvLyBDbGljayBvbiBhIGRyb3B5IGxpc3RcbiAgICAgIHNlbGYuJGRyb3B5cy5maW5kKCcuZHJvcHlfX2NvbnRlbnQgdWwgbGkgYScpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciAkdGhhdCA9ICQodGhpcyk7XG4gICAgICAgIHZhciAkZHJvcHkgPSAkdGhhdC5wYXJlbnRzKCcuZHJvcHknKTtcbiAgICAgICAgdmFyICRpbnB1dCA9ICRkcm9weS5maW5kKCdpbnB1dCcpO1xuICAgICAgICB2YXIgJHRpdGxlID0gJCh0aGlzKS5wYXJlbnRzKCcuZHJvcHknKS5maW5kKCcuZHJvcHlfX3RpdGxlIHNwYW4nKTtcbiAgXG4gICAgICAgIC8vIFJlbW92ZSBzZWxlY3RlZCBjbGFzc1xuICAgICAgICAkZHJvcHkuZmluZCgnLmRyb3B5X19jb250ZW50IGEnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgfSk7XG4gIFxuICAgICAgICAvLyBVcGRhdGUgc2VsZWN0ZWQgdmFsdWVcbiAgICAgICAgJHRpdGxlLmh0bWwoJHRoYXQuaHRtbCgpKTtcbiAgICAgICAgJGlucHV0LnZhbCgkdGhhdC5hdHRyKCdkYXRhLXZhbHVlJykpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICBcbiAgICAgICAgLy8gSWYgYmFjayB0byBkZWZhdWx0LCByZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZWxzZSBhZGRjbGFzcyBvbiByaWdodCBlbGVtZW50XG4gICAgICAgIGlmKCR0aGF0Lmhhc0NsYXNzKCdkcm9weV9faGVhZGVyJykpe1xuICAgICAgICAgICR0aXRsZS5yZW1vdmVDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgICAkdGl0bGUuaHRtbCgkdGl0bGUuYXR0cignZGF0YS10aXRsZScpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICR0aXRsZS5hZGRDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgICAkdGhhdC5hZGRDbGFzcyhzZWxmLnNlbGVjdENsYXNzKTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgLy8gQ2xvc2UgZHJvcGRvd25cbiAgICAgICAgJGRyb3B5LnJlbW92ZUNsYXNzKHNlbGYub3BlbkNsYXNzKTtcbiAgICAgIH0pO1xuICBcbiAgICAgIC8vIENsb3NlIGFsbCBkcm9wZG93biBvbmNsaWNrIG9uIGFub3RoZXIgZWxlbWVudFxuICAgICAgJChkb2N1bWVudCkuYmluZCgnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICBpZiAoISAkKGUudGFyZ2V0KS5wYXJlbnRzKCkuaGFzQ2xhc3MoJ2Ryb3B5JykpeyBzZWxmLiRkcm9weXMucmVtb3ZlQ2xhc3Moc2VsZi5vcGVuQ2xhc3MpOyB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIFxuICAkKGZ1bmN0aW9uKCl7XG4gICAgZHJvcHkuaW5pdCgpO1xuICB9KTtcblxuICAgIGZ1bmN0aW9uIGFjdHMoKSB7XG4gICAgICB2YXIgdGU7XG4gICAgICB2YXIgbWluID0gJCgnLnBvc3QtbGlzdC1pdGVtLWNvbnRlbnQgaDInKS5oZWlnaHQoKTtcbiAgICAgICQoJy5wb3N0LWxpc3QtaXRlbSAucG9zdC1saXN0LWl0ZW0tY29udGVudCBoMicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmhlaWdodCgpIDwgbWluKVxuICAgICAgICAgIG1pbiA9ICQodGhpcykuaGVpZ2h0KCk7XG4gICAgICB9KTtcbiAgXG4gICAgICAkKCcucG9zdC1saXN0LWl0ZW0tY29udGVudCBoMicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmhlaWdodCgpID09IG1pbikge1xuICAgICAgICAgIHRlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbignLmV4Y2VycHQnKTtcbiAgICAgICAgICAkKHRlKS50ZXh0KGZ1bmN0aW9uKGluZGV4LCBjdXJyZW50VGV4dCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRUZXh0LnN1YnN0cihjdXJyZW50VGV4dC5sZW5ndGggLSAzKSAhPSAnXFx1MjAyNicpXG4gICAgICAgICAgICAgIHJldHVybiBjdXJyZW50VGV4dC5zdWJzdHIoMCwgMTUwKSArICdcXHUyMDI2JztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgoJCh0aGlzKS5oZWlnaHQoKSA8IChtaW4gLSAxKSAqIDMpICYmICgkKHRoaXMpLmhlaWdodCgpID4gbWluKSkge1xuICAgICAgICAgIHRlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbignLmV4Y2VycHQnKTtcbiAgICAgICAgICAkKHRlKS50ZXh0KGZ1bmN0aW9uKGluZGV4LCBjdXJyZW50VGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCA4MCkgKyAnXFx1MjAyNic7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGUgPSAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmNoaWxkcmVuKCcuZXhjZXJwdCcpO1xuICAgICAgICAgICQodGhpcykudGV4dChmdW5jdGlvbihpbmRleCwgY3VycmVudFRleHQpIHtcbiAgICAgICAgICAgIGlmICgoY3VycmVudFRleHQuc3Vic3RyKGN1cnJlbnRUZXh0Lmxlbmd0aCAtIDMpICE9ICdcXHUyMDI2JykgJiYgKGN1cnJlbnRUZXh0Lmxlbmd0aCA+IDEyMCkpXG4gICAgICAgICAgICAgIHJldHVybiBjdXJyZW50VGV4dC5zdWJzdHIoMCwgMTIwKSArICdcXHUyMDI2JztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0ZS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGFjdHMoKTtcbiAgICAkKHdpbmRvdykucmVzaXplKGFjdHMpO1xuICBcbiAgICAgZnVuY3Rpb24gY2FyZEV4Y2VycHQoKSB7XG4gICAgICAkKFwiLmNhcmRfX2V4Y2VycHRcIikudGV4dChmdW5jdGlvbihpbmRleCwgY3VycmVudFRleHQpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCAxNDApICsgJ1xcdTIwMjYnO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGNhcmRFeGNlcnB0KCk7XG5cbiAgLy8gUGFrdWplIG1uaWVqc3plIG9icmF6a2kgYmV6IHBvZHBpc3UgdyA8ZmlndXJlPiAvL1xuICAvLyBKZcWbbGkgb2JyYXplayBtYSB0eXR1xYIsIHR5bSBzacSZIHpham11amUgcGhwIGZ1bmtjamEgdyBwcm9qZWN0LWZ1bmN0aW9ucy5waHBcbiAgJCgnLnByb2plY3QtY29udGVudCBwJykuZWFjaChmdW5jdGlvbihpbmRleCkge1xuICAgIHZhciBzb21lX2ltZyA9ICQodGhpcykuZmluZCgnaW1nJyk7XG4gICAgdmFyIHdpZHRoID0gc29tZV9pbWcud2lkdGgoKTtcbiAgICBpZiAod2lkdGggPCA5ODApIHtcbiAgICAgIHNvbWVfaW1nLndyYXAoXCI8ZmlndXJlPjwvZmlndXJlPlwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vU2tyYWNhIGltaW9uYSwgYnkgbmllIHd5Y2hvZHppxYJ5IHphIGJsb2tpXG4gICQoJy5jby1hdXRob3IgaDMgYScpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICB2YXIgbGVuZ3RoID0gJCh0aGlzKS5odG1sKCkubGVuZ3RoO1xuICAgIGlmIChsZW5ndGggPiAxMykge1xuICAgICAgdmFyIG5hbWUgPSAkKHRoaXMpLnRleHQoKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG5hbWUpO1xuICAgICAgdmFyIHRyaW1tZWRfbmFtZSA9IG5hbWUuY2hhckF0KDApICsgXCIuIFwiICsgbmFtZS5zdWJzdHIobmFtZS5pbmRleE9mKCcgJykgKyAxKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHRyaW1tZWRfbmFtZSk7XG4gICAgICAkKHRoaXMpLnRleHQodHJpbW1lZF9uYW1lKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIE5vdHlmaWthY2plLCBwb3dpYWRvbWllbmlhIC8vXG4gICQoXCIubm90ZS1jbG9zZVwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpXG4gICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDBcbiAgICAgIH0sIDI1MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICQodGhpcylcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBtYXJnaW5Cb3R0b206IDBcbiAgICAgICAgICB9LCAyNTApXG4gICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBwYWRkaW5nOiAwXG4gICAgICAgICAgfSwgMjUwKVxuICAgICAgICAgIC53cmFwSW5uZXIoXCI8ZGl2IC8+XCIpXG4gICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAuc2xpZGVVcCgyNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KFwiLm5vdGVcIikucmVtb3ZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfSk7XG5cbiAgLy8gQW5pbWFjamUgZGxhIGJhbmVyYSByZWtydXRhY2ppIC8vXG4gICQoJ2xhYmVsLmJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICQoJy5mYicpLmFkZENsYXNzKCdhbmltYXRlZCBmYWRlSW5VcCcpO1xuICAgICQoJy5kYXRlIC5pY29uLWNvbnRhaW5lcicpLmFkZENsYXNzKCdhbmltYXRlZCBzbGlkZUluTGVmdCcpO1xuICAgICQoJy5kYXRlIHNwYW4nKS5hZGRDbGFzcygnYW5pbWF0ZWQgc2xpZGVJbkxlZnQnKTtcbiAgICAkKCcubG9jYXRpb24gLmljb24tY29udGFpbmVyJykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5SaWdodCcpO1xuICAgICQoJy5sb2NhdGlvbiBzcGFuJykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5SaWdodCcpO1xuICBcbiAgfSk7XG4gICQoJyNjbG9zZV9iYW5uZXInKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcuZmInKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgZmFkZUluVXAnKTtcbiAgICAkKCcuZGF0ZSAuaWNvbi1jb250YWluZXInKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgc2xpZGVJbkxlZnQnKTtcbiAgICAkKCcuZGF0ZSBzcGFuJykucmVtb3ZlQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5MZWZ0Jyk7XG4gICAgJCgnLmxvY2F0aW9uIC5pY29uLWNvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgICAkKCcubG9jYXRpb24gc3BhbicpLnJlbW92ZUNsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgfSk7XG4gIFxuICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI0MDcwNjI3L2NyZWF0ZS1kcm9wZG93bi1iYW5uZXItd2hlbi11c2VyLWZpcnN0LXZpc2l0cy13ZWJzaXRlXG4gIC8vIFBvendhbGFqxIUgb3R3aWVyYcSHIGJhbmVyIHR5bGtvIHByenkgcGllcndzemVqIHdpenljaWVcbiAgXG4gIC8vIGNvb2tpZS1qc1xuXG4gIC8vIFBvYmllcmFuaWUgbmlja8OzdyB6IHVybCBpIHd5xZt3aWV0bGFuaWUgaWNoIGtvxYJvIGlrb24gc3BvxYJlY3pub8WbY2lvd3ljaFxuICAvLyBvcmF6IHd5a29yenlzdGFuaWUgdXNlcm5hbWUndSBnaXRodWJhIGRvIHd5xZt3aWV0bGVuaWEgb3N0YXRuaWUgYWt0eXdub8WbY2lcbiAgJCgnLnVzZXJpbmZvIGEnKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgdmFyIHByb2ZpbGUgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICB2YXIgZ2l0aHViX3Byb2ZpbGUgPSBwcm9maWxlLnN1YnN0cigxOSk7XG4gICAgaWYgKHByb2ZpbGUuaW5kZXhPZignZ2l0aHViJykgPiAtMSkge1xuICAgICAgJCgnYVtkYXRhLWdpdGh1Yl0nKS5hcHBlbmQoZ2l0aHViX3Byb2ZpbGUpO1xuICAgICAgR2l0aHViLm9ubHl1c2VyQWN0aXZpdHkoe1xuICAgICAgICB1c2VybmFtZTogZ2l0aHViX3Byb2ZpbGUsXG4gICAgICAgIHNlbGVjdG9yOiBcIi5naXRodWJcIixcbiAgICAgICAgbGltaXQ6IDEwXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHByb2ZpbGUuaW5kZXhPZigndHdpdHRlcicpID4gLTEpIHtcbiAgICAgICQoJ2FbZGF0YS10d2l0dGVyXScpLmFwcGVuZChwcm9maWxlLnN1YnN0cigyMCkpO1xuICAgIH1cbiAgICBpZiAocHJvZmlsZS5pbmRleE9mKCdmYWNlYm9vaycpID4gLTEpIHtcbiAgICAgICQoJ2FbZGF0YS1mYWNlYm9va10nKS5hcHBlbmQocHJvZmlsZS5zdWJzdHIoMjUpKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgLy8gR2l0aHViLm9ubHl1c2VyQWN0aXZpdHkoe1xuICAvLyAgIHVzZXJuYW1lOiBcInN5bmVyZ2lhXCIsXG4gIC8vICAgc2VsZWN0b3I6IFwiLmdpdGh1Yl9zXCIsXG4gIC8vICAgbGltaXQ6IDVcbiAgLy8gfSk7XG5cbiAgZnVuY3Rpb24gdGFicyhiTGF6eSkge1xuICAgIC8vIHNldCBhY3RpdmUgcmFkaW8gdG8gYWRkcmVzcyBiYXJcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhYnMgLnRhYnMtbmF2IGxhYmVsJywgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdGFiX25yID0gJCh0aGlzKS5hdHRyKCdmb3InKTtcbiAgICAgIHZhciBoYXNoID0gJyMnICsgdGFiX25yO1xuICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKCcnLCAnJywgaGFzaCk7XG4gICAgICBpZih0YWJfbnIgPT09ICd0YWItMScpe1xuICAgICAgICBiTGF6eS5sb2FkKCQoJy50YWI6bnRoLW9mLXR5cGUoMSkgLmJsYXp5JyksIHRydWUpO1xuICAgICAgfSBlbHNlIGlmICh0YWJfbnIgPT09ICd0YWItMicpIHtcbiAgICAgICAgYkxhenkubG9hZCgkKCcudGFiOm50aC1vZi10eXBlKDIpIC5ibGF6eScpLCB0cnVlKTtcbiAgICAgIH1lbHNlIGlmICh0YWJfbnIgPT09ICd0YWItMycpIHtcbiAgICAgICAgYkxhenkubG9hZCgkKCcudGFiOm50aC1vZi10eXBlKDMpIC5ibGF6eScpLCB0cnVlKTtcbiAgICAgIH1cbiAgXG4gICAgfSk7XG4gICAgLy8gc2VsZWN0IGFjdGl2ZSByYWRpbyBiYXNlZCBvbiBoYXNoXG4gICAgJChkb2N1bWVudC5sb2NhdGlvbi5oYXNoKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7XG4gIH1cblxuICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICogQm9vdHN0cmFwOiB0cmFuc2l0aW9uLmpzIHYzLjMuNlxuICAgKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyN0cmFuc2l0aW9uc1xuICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICogQ29weXJpZ2h0IDIwMTEtMjAxNSBUd2l0dGVyLCBJbmMuXG4gICAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuICBcbiAgXG4gICtmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgXG4gICAgLy8gQ1NTIFRSQU5TSVRJT04gU1VQUE9SVCAoU2hvdXRvdXQ6IGh0dHA6Ly93d3cubW9kZXJuaXpyLmNvbS8pXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIFxuICAgIGZ1bmN0aW9uIHRyYW5zaXRpb25FbmQoKSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib290c3RyYXAnKVxuICBcbiAgICAgIHZhciB0cmFuc0VuZEV2ZW50TmFtZXMgPSB7XG4gICAgICAgIFdlYmtpdFRyYW5zaXRpb24gOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgICAgIE1velRyYW5zaXRpb24gICAgOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgIE9UcmFuc2l0aW9uICAgICAgOiAnb1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQnLFxuICAgICAgICB0cmFuc2l0aW9uICAgICAgIDogJ3RyYW5zaXRpb25lbmQnXG4gICAgICB9XG4gIFxuICAgICAgZm9yICh2YXIgbmFtZSBpbiB0cmFuc0VuZEV2ZW50TmFtZXMpIHtcbiAgICAgICAgaWYgKGVsLnN0eWxlW25hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4geyBlbmQ6IHRyYW5zRW5kRXZlbnROYW1lc1tuYW1lXSB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgXG4gICAgICByZXR1cm4gZmFsc2UgLy8gZXhwbGljaXQgZm9yIGllOCAoICAuXy4pXG4gICAgfVxuICBcbiAgICAvLyBodHRwOi8vYmxvZy5hbGV4bWFjY2F3LmNvbS9jc3MtdHJhbnNpdGlvbnNcbiAgICAkLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24gKGR1cmF0aW9uKSB7XG4gICAgICB2YXIgY2FsbGVkID0gZmFsc2VcbiAgICAgIHZhciAkZWwgPSB0aGlzXG4gICAgICAkKHRoaXMpLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24gKCkgeyBjYWxsZWQgPSB0cnVlIH0pXG4gICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7IGlmICghY2FsbGVkKSAkKCRlbCkudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpIH1cbiAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIGR1cmF0aW9uKVxuICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG4gIFxuICAgICQoZnVuY3Rpb24gKCkge1xuICAgICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRW5kKClcbiAgXG4gICAgICBpZiAoISQuc3VwcG9ydC50cmFuc2l0aW9uKSByZXR1cm5cbiAgXG4gICAgICAkLmV2ZW50LnNwZWNpYWwuYnNUcmFuc2l0aW9uRW5kID0ge1xuICAgICAgICBiaW5kVHlwZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLFxuICAgICAgICBkZWxlZ2F0ZVR5cGU6ICQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxcbiAgICAgICAgaGFuZGxlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGlmICgkKGUudGFyZ2V0KS5pcyh0aGlzKSkgcmV0dXJuIGUuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgXG4gIH0oalF1ZXJ5KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuICAgICAgJChcIiNuYXYtbW9iaWxlXCIpLmh0bWwoJChcIiNuYXYtbWFpblwiKS5odG1sKCkpO1xuICAgICAgJChcIiNuYXYtdHJpZ2dlciAubmF2aWNvbi1idXR0b25cIikuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5pbmZvKCdCdXJnZXIgY2xpY2tlZCcpO1xuICAgICAgICAgIGlmICgkKFwibmF2I25hdi1tb2JpbGUgdWxcIikuaGFzQ2xhc3MoXCJleHBhbmRlZFwiKSkge1xuICAgICAgICAgICAgICAkKFwibmF2I25hdi1tb2JpbGUgdWwuZXhwYW5kZWRcIikucmVtb3ZlQ2xhc3MoXCJleHBhbmRlZFwiKS5zbGlkZVVwKDI1MCk7XG4gICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICQoXCJuYXYjbmF2LW1vYmlsZSB1bFwiKS5hZGRDbGFzcyhcImV4cGFuZGVkXCIpLnNsaWRlRG93bigyNTApO1xuICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICB9XG4gICAgICB9KTtcbiAgfSk7XG5cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgU2xpZGVyID0gJCgnI3NsaWRlcicpLlN3aXBlKHtcbiAgICAgIGF1dG86IDAsXG4gICAgICBjb250aW51b3VzOiB0cnVlLFxuICAgIH0pLmRhdGEoJ1N3aXBlJyk7XG4gICAgaWYgKFNsaWRlcikge1xuICAgICAgJCgnLm5leHQnKS5vbignY2xpY2snLCBTbGlkZXIubmV4dCk7XG4gICAgICAkKCcucHJldicpLm9uKCdjbGljaycsIFNsaWRlci5wcmV2KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFDFgnlubmUgc2tyb2xvd2FuaWUgLy9cbiAgLy8gaHR0cHM6Ly9jc3MtdHJpY2tzLmNvbS9zbmlwcGV0cy9qcXVlcnkvc21vb3RoLXNjcm9sbGluZy8jY29tbWVudC0xOTcxODFcbiAgXG4gIGpRdWVyeShmdW5jdGlvbigkKSB7XG4gICAgJCgnYVtocmVmKj0jXTpub3QoW2hyZWY9I10pJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICBpZiAobG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvXlxcLy8sICcnKSA9PSB0aGlzLnBhdGhuYW1lLnJlcGxhY2UoL15cXC8vLCAnJykgfHwgbG9jYXRpb24uaG9zdG5hbWUgPT0gdGhpcy5ob3N0bmFtZSkge1xuICBcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcy5oYXNoKTtcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0Lmxlbmd0aCA/IHRhcmdldCA6ICQoJ1tuYW1lPScgKyB0aGlzLmhhc2guc2xpY2UoMSkgKyAnXScpO1xuICAgICAgICBpZiAodGFyZ2V0Lmxlbmd0aCkge1xuICAgICAgICAgICQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgc2Nyb2xsVG9wOiB0YXJnZXQub2Zmc2V0KCkudG9wXG4gICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG5cbiAgICAgIHZhciBiTGF6eSA9IG5ldyBCbGF6eSh7XG4gICAgICAgIG9mZnNldDogMjAsXG4gICAgICAgIHNlbGVjdG9yOiAnLmJsYXp5JyxcbiAgICAgICAgbG9hZEludmlzaWJsZTogZmFsc2UsXG4gICAgICAgIGJyZWFrcG9pbnRzOiBbe1xuICAgICAgICAgIHdpZHRoOiAzNjAsIC8vIE1heC13aWR0aFxuICAgICAgICAgIHNyYzogJ2RhdGEtc3JjLXNtYWxsJ1xuICAgICAgICB9XSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICQoZWxlbWVudCkucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnLCA1MDApO1xuICAgICAgICAgIHVwZGF0ZUNvdW50ZXIoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVsZW1lbnQsIG1zZykge1xuICAgICAgICAgIGlmIChtc2cgPT09ICdtaXNzaW5nJykge1xuICAgICAgICAgICAgJChlbGVtZW50KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnbG9hZGluZycsIDUwMCk7IC8vIERhdGEtc3JjIGlzIG1pc3NpbmdcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJiTGF6eTogZGF0YS1zcmMgaXMgbWlzc2luZ1wiKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1zZyA9PT0gJ2ludmFsaWQnKSB7XG4gICAgICAgICAgICAkKGVsZW1lbnQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJywgNTAwKTtcbiAgICAgICAgICAgIC8vIERhdGEtc3JjIGlzIGludmFsaWRcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJiTGF6eTogZGF0YS1zcmMgaXMgaW52YWxpZFwiKTtcbiAgICBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gbm90IG5lZWRlZCwgb25seSBoZXJlIHRvIGlsbHVzdHJhdGUgYW1vdW50IG9mIGxvYWRlZCBpbWFnZXNcbiAgICAgIHZhciBpbWFnZUxvYWRlZCA9IDA7XG4gICAgXG4gICAgICBmdW5jdGlvbiB1cGRhdGVDb3VudGVyKCkge1xuICAgICAgICBpbWFnZUxvYWRlZCsrO1xuICAgICAgICBjb25zb2xlLmluZm8oXCJiTGF6eTogSW1hZ2VzIGxvYWRlZDogJWRcIiwgaW1hZ2VMb2FkZWQpO1xuICAgICAgfVxuICAgIFxuICAgICAgdGFicyhiTGF6eSk7XG5cbiAgICAvLyBodHRwOi8vYXJyZXN0ZWRkZXZlbG9wZXIubmV0L3dvcmRwcmVzcy1pbmZpbml0ZS1zY3JvbGwtd2l0aC13b3JkcHJlc3MtcG9zdHMtYW5kLXdheXBvaW50cy1qcy9cbiAgICBcbiAgICAvLyBDaHliYSB6IHRlZ28genJvYmnEhyBuYWxlxbx5IG9iamVrdFxuICAgIFxuICAgIHZhciBwcm9qZWN0X3N0YXR1cyA9IGpRdWVyeSgnI2ZpbmlzaGVkX3Byb2plY3RzJykuYXR0cignZGF0YS1wcm9qZWN0cy1zdGF0dXMnKTtcbiAgICB2YXIgYWpheF91cmwgPSBqUXVlcnkoJyNwcm9qZWN0cycpLmF0dHIoJ2RhdGEtYWpheC11cmwnKTtcbiAgICB2YXIgdG90YWxfZmluaXNoZWRfcHJvamVjdHMgPSBqUXVlcnkoJyNmaW5pc2hlZF9wcm9qZWN0cycpLmF0dHIoJ2RhdGEtdG90YWwtZmluaXNoZWQtcHJvamVjdHMnKTtcbiAgICB2YXIgdG90YWxfaW5fcHJvZ3Jlc3NfcHJvamVjdHMgPSBqUXVlcnkoJyNpbl9wcm9ncmVzc19wcm9qZWN0cycpLmF0dHIoJ2RhdGEtdG90YWwtaW4tcHJvZ3Jlc3MtcHJvamVjdHMnKTtcbiAgICB2YXIgdG90YWxfaWRlYXNfcHJvamVjdHMgPSBqUXVlcnkoJyNpZGVhc19wcm9qZWN0cycpLmF0dHIoJ2RhdGEtdG90YWwtaWRlYXMtcHJvamVjdHMnKTtcbiAgICB2YXIgcG9zdF9vZmZzZXQgPSAwO1xuICAgIHZhciBsb2FkZWRfZmluaXNoZWRfcHJvamVjdHMgPSAwO1xuICAgIFxuICAgIC8vIFNrcm9sdWplbXkgZG8gc3RvcGtpLCB3dGVkeSB1cnVjaGFtaWEgc2nEmSBmdW5rY2phIGxvYWRQcm9qZWN0cygpXG4gICAgaWYgKGFqYXhfdXJsKSB7XG4gICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpID49ICQoZG9jdW1lbnQpLmhlaWdodCgpIC0gJCh3aW5kb3cpLmhlaWdodCgpIC0gMTAwKSB7XG4gICAgICAgICAgaWYgKCQoJyNpZGVhc19wcm9qZWN0cycpLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICBsb2FkZWRfaWRlYXNfcHJvamVjdHMgPSAkKCcjaWRlYXNfcHJvamVjdHMnKS5jaGlsZHJlbigpLmxlbmd0aDtcbiAgICAgICAgICAgIGxvYWRQcm9qZWN0cygnaWRlYXMnLCB0b3RhbF9pZGVhc19wcm9qZWN0cywgbG9hZGVkX2lkZWFzX3Byb2plY3RzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAoJCgnI2luX3Byb2dyZXNzX3Byb2plY3RzJykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgIGxvYWRlZF9pbl9wcm9ncmVzc19wcm9qZWN0cyA9ICQoJyNpbl9wcm9ncmVzc19wcm9qZWN0cycpLmNoaWxkcmVuKCkubGVuZ3RoO1xuICAgICAgICAgICAgbG9hZFByb2plY3RzKCdpbl9wcm9ncmVzcycsIHRvdGFsX2luX3Byb2dyZXNzX3Byb2plY3RzLCBsb2FkZWRfaW5fcHJvZ3Jlc3NfcHJvamVjdHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmICgkKCcjZmluaXNoZWRfcHJvamVjdHMnKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgbG9hZGVkX2ZpbmlzaGVkX3Byb2plY3RzID0gJCgnI2ZpbmlzaGVkX3Byb2plY3RzJykuY2hpbGRyZW4oKS5sZW5ndGg7XG4gICAgICAgICAgICBsb2FkUHJvamVjdHMoJ2ZpbmlzaGVkJywgdG90YWxfZmluaXNoZWRfcHJvamVjdHMsIGxvYWRlZF9maW5pc2hlZF9wcm9qZWN0cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgZnVuY3Rpb24gbG9hZFByb2plY3RzKHByb2plY3RzX3N0YXR1cywgdG90YWxfcHJvamVjdHMsIGxvYWRlZF9wcm9qZWN0cykge1xuICAgICAgcG9zdF9vZmZzZXQgPSBwYXJzZUludChwb3N0X29mZnNldCkgKyA2O1xuICAgICAgY29uc29sZS5pbmZvKFwiTG9hZGVkICVzIHByb2plY3RzOiAlZC8lZFwiLHByb2plY3RzX3N0YXR1cywgbG9hZGVkX3Byb2plY3RzLCB0b3RhbF9wcm9qZWN0cyk7XG4gICAgXG4gICAgICBpZiAodG90YWxfcHJvamVjdHMgPiBsb2FkZWRfcHJvamVjdHMpIHtcbiAgICAgICAgJCgnLmxvYWRlcicpLnNob3coKTtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICB1cmw6IGFqYXhfdXJsLFxuICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBhY3Rpb246ICdsb2FkX3Byb2plY3RzJyxcbiAgICAgICAgICAgIHBvc3Rfb2Zmc2V0OiBwb3N0X29mZnNldCxcbiAgICAgICAgICAgIHByb2plY3RzX3N0YXR1czogcHJvamVjdHNfc3RhdHVzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJCgnIycgKyBwcm9qZWN0c19zdGF0dXMgKyAnX3Byb2plY3RzJykuYXBwZW5kKGRhdGEpO1xuICAgICAgICAgICAgLy8gJChkYXRhKS5oaWRlKCkuYXBwZW5kVG8oJyMnICsgcHJvamVjdHNfc3RhdHVzICsgJ19wcm9qZWN0cycpLnNob3coMjAwKTtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnQWpheDogTG9hZGVkIG1vcmUgJXMgcHJvamVjdHMnLCBwcm9qZWN0c19zdGF0dXMpO1xuICAgICAgICAgICAgYkxhenkucmV2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgY2FyZEV4Y2VycHQoKTtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5oaWRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfSk7XG4gIC8vIFByZXplcyB6YXdzemUgbmEgcGllcndzenltIG1pZWpzY3UgLy9cbiAgJCgnI21hbmFnZW1lbnRfYm9hcmQgbGkjYWRtaW4nKS5pbnNlcnRCZWZvcmUoJyNtYW5hZ2VtZW50X2JvYXJkIGxpOmVxKDApJyk7XG59KTsiXSwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
