// main.js //
// Wszystko wrzucamy tu

jQuery(function($) {

  $(document).ready(function bLazy_f() {
    var bLazy = new Blazy({
      offset: 20,
      selector: '.blazy',
      loadInvisible: false,
      success: function() {
        updateCounter();
      },
      error: function(ele, msg) {
        if (msg === 'missing') {
          // Data-src is missing
          console.error("bLazy: data-src is missing");
        } else if (msg === 'invalid') {
          // Data-src is invalid
          console.error("bLazy: data-src is invalid");
  
        }
      }
    });
    // not needed, only here to illustrate amount of loaded images
    var imageLoaded = 0;
    function updateCounter() {
      imageLoaded++;
      console.info("bLazy: Images loaded: %d", imageLoaded);
    }
  
    tabs(bLazy);
  });

  // Dropdown download button //
  // http://codepen.io/georgehastings/pen/vptdb
  $(".dropdown").on("click", function(event) {
    $(this).toggleClass("flip");
    event.stopPropagation();
    console.info("Dropdown-download opened");
  });
  $(document).on("click", function(event) {
    $(".dropdown").removeClass("flip");
  });

    function acts() {
      var te;
      var min = $('.post-list-item-content h2').height();
      $('.post-list-item .post-list-item-content h2').each(function() {
        if ($(this).height() < min)
          min = $(this).height();
      });
  
      $('.post-list-item-content h2').each(function() {
        if ($(this).height() == min) {
          te = $(this).parent().parent().children('.excerpt');
          $(te).text(function(index, currentText) {
            if (currentText.substr(currentText.length - 3) != '&hellip;')
              return currentText.substr(0, 150) + '&hellip;';
          });
        } else if (($(this).height() < (min - 1) * 3) && ($(this).height() > min)) {
          te = $(this).parent().parent().children('.excerpt');
          $(te).text(function(index, currentText) {
            return currentText.substr(0, 80) + '&hellip;';
          });
        } else {
          te = $(this).parent().parent().children('.excerpt');
          $(this).text(function(index, currentText) {
            if ((currentText.substr(currentText.length - 3) != '&hellip;') && (currentText.length > 120))
              return currentText.substr(0, 120) + '&hellip;';
          });
          te.css("display", "none");
        }
      });
    }
    acts();
    $(window).resize(acts);
  
  
  $(".card .excerpt").text(function(index, currentText) {
    return currentText.substr(0, 140) + '&hellip;';
  });

  // Pakuje mniejsze obrazki bez podpisu w <figure> //
  // Jeśli obrazek ma tytuł, tym się zajmuje php funkcja w project-functions.php
  $('.project-content p').each(function(index) {
    var some_img = $(this).find('img');
    var width = some_img.width();
    if (width < 980) {
      some_img.wrap("<figure></figure>");
    }
  });

  //Skraca imiona, by nie wychodziły za bloki
  $('.co-author h3 a').each(function(index) {
    var length = $(this).html().length;
    if (length > 13) {
      var name = $(this).text();
      // console.log(name);
      var trimmed_name = name.charAt(0) + ". " + name.substr(name.indexOf(' ') + 1);
      // console.log(trimmed_name);
      $(this).text(trimmed_name);
    }
  });

  // Notyfikacje, powiadomienia //
  $(".note-close").click(function() {
    $(this).parent()
      .animate({
        opacity: 0
      }, 250, function() {
        $(this)
          .animate({
            marginBottom: 0
          }, 250)
          .children()
          .animate({
            padding: 0
          }, 250)
          .wrapInner("<div />")
          .children()
          .slideUp(250, function() {
            $(this).closest(".note").remove();
          });
      });
  });

  // Animacje dla banera rekrutacji //
  $('label.button').on('click', function() {
    $('.fb').addClass('animated fadeInUp');
    $('.date .icon-container').addClass('animated slideInLeft');
    $('.date span').addClass('animated slideInLeft');
    $('.location .icon-container').addClass('animated slideInRight');
    $('.location span').addClass('animated slideInRight');
  
  });
  $('#close_banner').on('click', function() {
    $('.fb').removeClass('animated fadeInUp');
    $('.date .icon-container').removeClass('animated slideInLeft');
    $('.date span').removeClass('animated slideInLeft');
    $('.location .icon-container').removeClass('animated slideInRight');
    $('.location span').removeClass('animated slideInRight');
  });
  
  // http://stackoverflow.com/questions/24070627/create-dropdown-banner-when-user-first-visits-website
  // Pozwalają otwierać baner tylko przy pierwszej wizycie
  
  // cookie-js

  
    $(function() {
      // Touch ripple effect on buttons
      $('.button:not(.button.disabled)').on('click',
  
        function(e) {
  
          /*!
          SVG version for ripple effect via Jonathan Cutrell (gently modified)
          http://webdesign.tutsplus.com/tutorials/recreating-the-touch-ripple-effect-as-seen-on-google-design--cms-21655
          */
  
          var x = e.pageX;
          var y = e.pageY;
          var clickY = y - $(this).offset().top;
          var clickX = x - $(this).offset().left;
          var box = this;
  
          var setX = parseInt(clickX);
          var setY = parseInt(clickY);
          var ripple = '<svg class="ink"><circle cx="' + setX + '" cy="' + setY + '" r="' + 0 + '"></circle></svg>';
  
          $(this).find('.ink').remove();
          $(this).append(ripple);
  
          var c = $(box).find('circle');
          c.animate({
            'r': $(box).outerWidth()
          }, {
            duration: 333,
            step: function(val) {
              c.attr('r', val);
            },
            complete: function() {
              c.fadeOut('fast');
            }
          });
  
          return true;
  
        });
  
    });

  // Pobieranie nicków z url i wyświetlanie ich koło ikon społecznościowych
  // oraz wykorzystanie username'u githuba do wyświetlenia ostatnie aktywności
  $('.userinfo a').each(function(index) {
    var profile = $(this).attr('href');
    var github_profile = profile.substr(19);
    if (profile.indexOf('github') > -1) {
      $('a[data-github]').append(github_profile);
      Github.onlyuserActivity({
        username: github_profile,
        selector: ".github",
        limit: 10
      });
    }
    if (profile.indexOf('twitter') > -1) {
      $('a[data-twitter]').append(profile.substr(20));
    }
    if (profile.indexOf('facebook') > -1) {
      $('a[data-facebook]').append(profile.substr(25));
    }
  });
  
  // Github.onlyuserActivity({
  //   username: "synergia",
  //   selector: ".github_s",
  //   limit: 5
  // });

  function tabs(bLazy) {
    // set active radio to address bar
    $(document).on('click', '.tabs .tabs-nav label', function() {
      var tab_nr = $(this).attr('for');
      var hash = '#' + tab_nr;
      window.history.replaceState('', '', hash);
      if(tab_nr === 'tab-1'){
        bLazy.load($('.tab:nth-of-type(1) .blazy'), true);
      } else if (tab_nr === 'tab-2') {
        bLazy.load($('.tab:nth-of-type(2) .blazy'), true);
      }else if (tab_nr === 'tab-3') {
        bLazy.load($('.tab:nth-of-type(3) .blazy'), true);
      }
  
    });
    // select active radio based on hash
    $(document.location.hash).prop('checked', true);
  }

  /* ========================================================================
   * Bootstrap: transition.js v3.3.6
   * http://getbootstrap.com/javascript/#transitions
   * ========================================================================
   * Copyright 2011-2015 Twitter, Inc.
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
   * ======================================================================== */
  
  
  +function ($) {
    'use strict';
  
    // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
    // ============================================================
  
    function transitionEnd() {
      var el = document.createElement('bootstrap')
  
      var transEndEventNames = {
        WebkitTransition : 'webkitTransitionEnd',
        MozTransition    : 'transitionend',
        OTransition      : 'oTransitionEnd otransitionend',
        transition       : 'transitionend'
      }
  
      for (var name in transEndEventNames) {
        if (el.style[name] !== undefined) {
          return { end: transEndEventNames[name] }
        }
      }
  
      return false // explicit for ie8 (  ._.)
    }
  
    // http://blog.alexmaccaw.com/css-transitions
    $.fn.emulateTransitionEnd = function (duration) {
      var called = false
      var $el = this
      $(this).one('bsTransitionEnd', function () { called = true })
      var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
      setTimeout(callback, duration)
      return this
    }
  
    $(function () {
      $.support.transition = transitionEnd()
  
      if (!$.support.transition) return
  
      $.event.special.bsTransitionEnd = {
        bindType: $.support.transition.end,
        delegateType: $.support.transition.end,
        handle: function (e) {
          if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
        }
      }
    })
  
  }(jQuery);

  $(document).ready(function(){
      $("#nav-mobile").html($("#nav-main").html());
      $("#nav-trigger .navicon-button").click(function(){
        console.info('Burger clicked');
          if ($("nav#nav-mobile ul").hasClass("expanded")) {
              $("nav#nav-mobile ul.expanded").removeClass("expanded").slideUp(250);
              $(this).removeClass("open");
          } else {
              $("nav#nav-mobile ul").addClass("expanded").slideDown(250);
              $(this).addClass("open");
          }
      });
  });

  $(document).ready(function() {
    Slider = $('#slider').Swipe({
      auto: 0,
      continuous: true,
    }).data('Swipe');
    if (Slider) {
      $('.next').on('click', Slider.next);
      $('.prev').on('click', Slider.prev);
    }
  });

  $(document).ready(function() {
  
      $('.blog-list-archive li ul').hide();
      $('.archive-list > li > h2').click(function(){
          $(this).parent().addClass('selected');
          $(this).parent().children('ul').slideDown(250);
          $(this).parent().siblings().children('ul').slideUp(250);
          $(this).parent().siblings().removeClass('selected');
      });
  });

  // Prezes zawsze na pierwszym miejscu //
  $('#management_board li#admin').insertBefore('#management_board li:eq(0)');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1haW4uanMgLy9cbi8vIFdzenlzdGtvIHdyenVjYW15IHR1XG5cbmpRdWVyeShmdW5jdGlvbigkKSB7XG5cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gYkxhenlfZigpIHtcbiAgICB2YXIgYkxhenkgPSBuZXcgQmxhenkoe1xuICAgICAgb2Zmc2V0OiAyMCxcbiAgICAgIHNlbGVjdG9yOiAnLmJsYXp5JyxcbiAgICAgIGxvYWRJbnZpc2libGU6IGZhbHNlLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHVwZGF0ZUNvdW50ZXIoKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZWxlLCBtc2cpIHtcbiAgICAgICAgaWYgKG1zZyA9PT0gJ21pc3NpbmcnKSB7XG4gICAgICAgICAgLy8gRGF0YS1zcmMgaXMgbWlzc2luZ1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJiTGF6eTogZGF0YS1zcmMgaXMgbWlzc2luZ1wiKTtcbiAgICAgICAgfSBlbHNlIGlmIChtc2cgPT09ICdpbnZhbGlkJykge1xuICAgICAgICAgIC8vIERhdGEtc3JjIGlzIGludmFsaWRcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiYkxhenk6IGRhdGEtc3JjIGlzIGludmFsaWRcIik7XG4gIFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gbm90IG5lZWRlZCwgb25seSBoZXJlIHRvIGlsbHVzdHJhdGUgYW1vdW50IG9mIGxvYWRlZCBpbWFnZXNcbiAgICB2YXIgaW1hZ2VMb2FkZWQgPSAwO1xuICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXIoKSB7XG4gICAgICBpbWFnZUxvYWRlZCsrO1xuICAgICAgY29uc29sZS5pbmZvKFwiYkxhenk6IEltYWdlcyBsb2FkZWQ6ICVkXCIsIGltYWdlTG9hZGVkKTtcbiAgICB9XG4gIFxuICAgIHRhYnMoYkxhenkpO1xuICB9KTtcblxuICAvLyBEcm9wZG93biBkb3dubG9hZCBidXR0b24gLy9cbiAgLy8gaHR0cDovL2NvZGVwZW4uaW8vZ2VvcmdlaGFzdGluZ3MvcGVuL3ZwdGRiXG4gICQoXCIuZHJvcGRvd25cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoXCJmbGlwXCIpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGNvbnNvbGUuaW5mbyhcIkRyb3Bkb3duLWRvd25sb2FkIG9wZW5lZFwiKTtcbiAgfSk7XG4gICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAkKFwiLmRyb3Bkb3duXCIpLnJlbW92ZUNsYXNzKFwiZmxpcFwiKTtcbiAgfSk7XG5cbiAgICBmdW5jdGlvbiBhY3RzKCkge1xuICAgICAgdmFyIHRlO1xuICAgICAgdmFyIG1pbiA9ICQoJy5wb3N0LWxpc3QtaXRlbS1jb250ZW50IGgyJykuaGVpZ2h0KCk7XG4gICAgICAkKCcucG9zdC1saXN0LWl0ZW0gLnBvc3QtbGlzdC1pdGVtLWNvbnRlbnQgaDInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5oZWlnaHQoKSA8IG1pbilcbiAgICAgICAgICBtaW4gPSAkKHRoaXMpLmhlaWdodCgpO1xuICAgICAgfSk7XG4gIFxuICAgICAgJCgnLnBvc3QtbGlzdC1pdGVtLWNvbnRlbnQgaDInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5oZWlnaHQoKSA9PSBtaW4pIHtcbiAgICAgICAgICB0ZSA9ICQodGhpcykucGFyZW50KCkucGFyZW50KCkuY2hpbGRyZW4oJy5leGNlcnB0Jyk7XG4gICAgICAgICAgJCh0ZSkudGV4dChmdW5jdGlvbihpbmRleCwgY3VycmVudFRleHQpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50VGV4dC5zdWJzdHIoY3VycmVudFRleHQubGVuZ3RoIC0gMykgIT0gJyZoZWxsaXA7JylcbiAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCAxNTApICsgJyZoZWxsaXA7JztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgoJCh0aGlzKS5oZWlnaHQoKSA8IChtaW4gLSAxKSAqIDMpICYmICgkKHRoaXMpLmhlaWdodCgpID4gbWluKSkge1xuICAgICAgICAgIHRlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbignLmV4Y2VycHQnKTtcbiAgICAgICAgICAkKHRlKS50ZXh0KGZ1bmN0aW9uKGluZGV4LCBjdXJyZW50VGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCA4MCkgKyAnJmhlbGxpcDsnO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbignLmV4Y2VycHQnKTtcbiAgICAgICAgICAkKHRoaXMpLnRleHQoZnVuY3Rpb24oaW5kZXgsIGN1cnJlbnRUZXh0KSB7XG4gICAgICAgICAgICBpZiAoKGN1cnJlbnRUZXh0LnN1YnN0cihjdXJyZW50VGV4dC5sZW5ndGggLSAzKSAhPSAnJmhlbGxpcDsnKSAmJiAoY3VycmVudFRleHQubGVuZ3RoID4gMTIwKSlcbiAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRUZXh0LnN1YnN0cigwLCAxMjApICsgJyZoZWxsaXA7JztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0ZS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGFjdHMoKTtcbiAgICAkKHdpbmRvdykucmVzaXplKGFjdHMpO1xuICBcbiAgXG4gICQoXCIuY2FyZCAuZXhjZXJwdFwiKS50ZXh0KGZ1bmN0aW9uKGluZGV4LCBjdXJyZW50VGV4dCkge1xuICAgIHJldHVybiBjdXJyZW50VGV4dC5zdWJzdHIoMCwgMTQwKSArICcmaGVsbGlwOyc7XG4gIH0pO1xuXG4gIC8vIFBha3VqZSBtbmllanN6ZSBvYnJhemtpIGJleiBwb2RwaXN1IHcgPGZpZ3VyZT4gLy9cbiAgLy8gSmXFm2xpIG9icmF6ZWsgbWEgdHl0dcWCLCB0eW0gc2nEmSB6YWptdWplIHBocCBmdW5rY2phIHcgcHJvamVjdC1mdW5jdGlvbnMucGhwXG4gICQoJy5wcm9qZWN0LWNvbnRlbnQgcCcpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICB2YXIgc29tZV9pbWcgPSAkKHRoaXMpLmZpbmQoJ2ltZycpO1xuICAgIHZhciB3aWR0aCA9IHNvbWVfaW1nLndpZHRoKCk7XG4gICAgaWYgKHdpZHRoIDwgOTgwKSB7XG4gICAgICBzb21lX2ltZy53cmFwKFwiPGZpZ3VyZT48L2ZpZ3VyZT5cIik7XG4gICAgfVxuICB9KTtcblxuICAvL1NrcmFjYSBpbWlvbmEsIGJ5IG5pZSB3eWNob2R6acWCeSB6YSBibG9raVxuICAkKCcuY28tYXV0aG9yIGgzIGEnKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgdmFyIGxlbmd0aCA9ICQodGhpcykuaHRtbCgpLmxlbmd0aDtcbiAgICBpZiAobGVuZ3RoID4gMTMpIHtcbiAgICAgIHZhciBuYW1lID0gJCh0aGlzKS50ZXh0KCk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhuYW1lKTtcbiAgICAgIHZhciB0cmltbWVkX25hbWUgPSBuYW1lLmNoYXJBdCgwKSArIFwiLiBcIiArIG5hbWUuc3Vic3RyKG5hbWUuaW5kZXhPZignICcpICsgMSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyh0cmltbWVkX25hbWUpO1xuICAgICAgJCh0aGlzKS50ZXh0KHRyaW1tZWRfbmFtZSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBOb3R5ZmlrYWNqZSwgcG93aWFkb21pZW5pYSAvL1xuICAkKFwiLm5vdGUtY2xvc2VcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKVxuICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwXG4gICAgICB9LCAyNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAwXG4gICAgICAgICAgfSwgMjUwKVxuICAgICAgICAgIC5jaGlsZHJlbigpXG4gICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgcGFkZGluZzogMFxuICAgICAgICAgIH0sIDI1MClcbiAgICAgICAgICAud3JhcElubmVyKFwiPGRpdiAvPlwiKVxuICAgICAgICAgIC5jaGlsZHJlbigpXG4gICAgICAgICAgLnNsaWRlVXAoMjUwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQodGhpcykuY2xvc2VzdChcIi5ub3RlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH0pO1xuXG4gIC8vIEFuaW1hY2plIGRsYSBiYW5lcmEgcmVrcnV0YWNqaSAvL1xuICAkKCdsYWJlbC5idXR0b24nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcuZmInKS5hZGRDbGFzcygnYW5pbWF0ZWQgZmFkZUluVXAnKTtcbiAgICAkKCcuZGF0ZSAuaWNvbi1jb250YWluZXInKS5hZGRDbGFzcygnYW5pbWF0ZWQgc2xpZGVJbkxlZnQnKTtcbiAgICAkKCcuZGF0ZSBzcGFuJykuYWRkQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5MZWZ0Jyk7XG4gICAgJCgnLmxvY2F0aW9uIC5pY29uLWNvbnRhaW5lcicpLmFkZENsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgICAkKCcubG9jYXRpb24gc3BhbicpLmFkZENsYXNzKCdhbmltYXRlZCBzbGlkZUluUmlnaHQnKTtcbiAgXG4gIH0pO1xuICAkKCcjY2xvc2VfYmFubmVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgJCgnLmZiJykucmVtb3ZlQ2xhc3MoJ2FuaW1hdGVkIGZhZGVJblVwJyk7XG4gICAgJCgnLmRhdGUgLmljb24tY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2FuaW1hdGVkIHNsaWRlSW5MZWZ0Jyk7XG4gICAgJCgnLmRhdGUgc3BhbicpLnJlbW92ZUNsYXNzKCdhbmltYXRlZCBzbGlkZUluTGVmdCcpO1xuICAgICQoJy5sb2NhdGlvbiAuaWNvbi1jb250YWluZXInKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgc2xpZGVJblJpZ2h0Jyk7XG4gICAgJCgnLmxvY2F0aW9uIHNwYW4nKS5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgc2xpZGVJblJpZ2h0Jyk7XG4gIH0pO1xuICBcbiAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNDA3MDYyNy9jcmVhdGUtZHJvcGRvd24tYmFubmVyLXdoZW4tdXNlci1maXJzdC12aXNpdHMtd2Vic2l0ZVxuICAvLyBQb3p3YWxhasSFIG90d2llcmHEhyBiYW5lciB0eWxrbyBwcnp5IHBpZXJ3c3plaiB3aXp5Y2llXG4gIFxuICAvLyBjb29raWUtanNcblxuICBcbiAgICAkKGZ1bmN0aW9uKCkge1xuICAgICAgLy8gVG91Y2ggcmlwcGxlIGVmZmVjdCBvbiBidXR0b25zXG4gICAgICAkKCcuYnV0dG9uOm5vdCguYnV0dG9uLmRpc2FibGVkKScpLm9uKCdjbGljaycsXG4gIFxuICAgICAgICBmdW5jdGlvbihlKSB7XG4gIFxuICAgICAgICAgIC8qIVxuICAgICAgICAgIFNWRyB2ZXJzaW9uIGZvciByaXBwbGUgZWZmZWN0IHZpYSBKb25hdGhhbiBDdXRyZWxsIChnZW50bHkgbW9kaWZpZWQpXG4gICAgICAgICAgaHR0cDovL3dlYmRlc2lnbi50dXRzcGx1cy5jb20vdHV0b3JpYWxzL3JlY3JlYXRpbmctdGhlLXRvdWNoLXJpcHBsZS1lZmZlY3QtYXMtc2Vlbi1vbi1nb29nbGUtZGVzaWduLS1jbXMtMjE2NTVcbiAgICAgICAgICAqL1xuICBcbiAgICAgICAgICB2YXIgeCA9IGUucGFnZVg7XG4gICAgICAgICAgdmFyIHkgPSBlLnBhZ2VZO1xuICAgICAgICAgIHZhciBjbGlja1kgPSB5IC0gJCh0aGlzKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgdmFyIGNsaWNrWCA9IHggLSAkKHRoaXMpLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgdmFyIGJveCA9IHRoaXM7XG4gIFxuICAgICAgICAgIHZhciBzZXRYID0gcGFyc2VJbnQoY2xpY2tYKTtcbiAgICAgICAgICB2YXIgc2V0WSA9IHBhcnNlSW50KGNsaWNrWSk7XG4gICAgICAgICAgdmFyIHJpcHBsZSA9ICc8c3ZnIGNsYXNzPVwiaW5rXCI+PGNpcmNsZSBjeD1cIicgKyBzZXRYICsgJ1wiIGN5PVwiJyArIHNldFkgKyAnXCIgcj1cIicgKyAwICsgJ1wiPjwvY2lyY2xlPjwvc3ZnPic7XG4gIFxuICAgICAgICAgICQodGhpcykuZmluZCgnLmluaycpLnJlbW92ZSgpO1xuICAgICAgICAgICQodGhpcykuYXBwZW5kKHJpcHBsZSk7XG4gIFxuICAgICAgICAgIHZhciBjID0gJChib3gpLmZpbmQoJ2NpcmNsZScpO1xuICAgICAgICAgIGMuYW5pbWF0ZSh7XG4gICAgICAgICAgICAncic6ICQoYm94KS5vdXRlcldpZHRoKClcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMzMzLFxuICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgIGMuYXR0cigncicsIHZhbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBjLmZhZGVPdXQoJ2Zhc3QnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gIFxuICAgICAgICB9KTtcbiAgXG4gICAgfSk7XG5cbiAgLy8gUG9iaWVyYW5pZSBuaWNrw7N3IHogdXJsIGkgd3nFm3dpZXRsYW5pZSBpY2gga2/Fgm8gaWtvbiBzcG/FgmVjem5vxZtjaW93eWNoXG4gIC8vIG9yYXogd3lrb3J6eXN0YW5pZSB1c2VybmFtZSd1IGdpdGh1YmEgZG8gd3nFm3dpZXRsZW5pYSBvc3RhdG5pZSBha3R5d25vxZtjaVxuICAkKCcudXNlcmluZm8gYScpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICB2YXIgcHJvZmlsZSA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgIHZhciBnaXRodWJfcHJvZmlsZSA9IHByb2ZpbGUuc3Vic3RyKDE5KTtcbiAgICBpZiAocHJvZmlsZS5pbmRleE9mKCdnaXRodWInKSA+IC0xKSB7XG4gICAgICAkKCdhW2RhdGEtZ2l0aHViXScpLmFwcGVuZChnaXRodWJfcHJvZmlsZSk7XG4gICAgICBHaXRodWIub25seXVzZXJBY3Rpdml0eSh7XG4gICAgICAgIHVzZXJuYW1lOiBnaXRodWJfcHJvZmlsZSxcbiAgICAgICAgc2VsZWN0b3I6IFwiLmdpdGh1YlwiLFxuICAgICAgICBsaW1pdDogMTBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocHJvZmlsZS5pbmRleE9mKCd0d2l0dGVyJykgPiAtMSkge1xuICAgICAgJCgnYVtkYXRhLXR3aXR0ZXJdJykuYXBwZW5kKHByb2ZpbGUuc3Vic3RyKDIwKSk7XG4gICAgfVxuICAgIGlmIChwcm9maWxlLmluZGV4T2YoJ2ZhY2Vib29rJykgPiAtMSkge1xuICAgICAgJCgnYVtkYXRhLWZhY2Vib29rXScpLmFwcGVuZChwcm9maWxlLnN1YnN0cigyNSkpO1xuICAgIH1cbiAgfSk7XG4gIFxuICAvLyBHaXRodWIub25seXVzZXJBY3Rpdml0eSh7XG4gIC8vICAgdXNlcm5hbWU6IFwic3luZXJnaWFcIixcbiAgLy8gICBzZWxlY3RvcjogXCIuZ2l0aHViX3NcIixcbiAgLy8gICBsaW1pdDogNVxuICAvLyB9KTtcblxuICBmdW5jdGlvbiB0YWJzKGJMYXp5KSB7XG4gICAgLy8gc2V0IGFjdGl2ZSByYWRpbyB0byBhZGRyZXNzIGJhclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFicyAudGFicy1uYXYgbGFiZWwnLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB0YWJfbnIgPSAkKHRoaXMpLmF0dHIoJ2ZvcicpO1xuICAgICAgdmFyIGhhc2ggPSAnIycgKyB0YWJfbnI7XG4gICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsICcnLCBoYXNoKTtcbiAgICAgIGlmKHRhYl9uciA9PT0gJ3RhYi0xJyl7XG4gICAgICAgIGJMYXp5LmxvYWQoJCgnLnRhYjpudGgtb2YtdHlwZSgxKSAuYmxhenknKSwgdHJ1ZSk7XG4gICAgICB9IGVsc2UgaWYgKHRhYl9uciA9PT0gJ3RhYi0yJykge1xuICAgICAgICBiTGF6eS5sb2FkKCQoJy50YWI6bnRoLW9mLXR5cGUoMikgLmJsYXp5JyksIHRydWUpO1xuICAgICAgfWVsc2UgaWYgKHRhYl9uciA9PT0gJ3RhYi0zJykge1xuICAgICAgICBiTGF6eS5sb2FkKCQoJy50YWI6bnRoLW9mLXR5cGUoMykgLmJsYXp5JyksIHRydWUpO1xuICAgICAgfVxuICBcbiAgICB9KTtcbiAgICAvLyBzZWxlY3QgYWN0aXZlIHJhZGlvIGJhc2VkIG9uIGhhc2hcbiAgICAkKGRvY3VtZW50LmxvY2F0aW9uLmhhc2gpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTtcbiAgfVxuXG4gIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgKiBCb290c3RyYXA6IHRyYW5zaXRpb24uanMgdjMuMy42XG4gICAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RyYW5zaXRpb25zXG4gICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy5cbiAgICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG4gIFxuICBcbiAgK2Z1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgICAvLyBDU1MgVFJBTlNJVElPTiBTVVBQT1JUIChTaG91dG91dDogaHR0cDovL3d3dy5tb2Rlcm5penIuY29tLylcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgXG4gICAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHtcbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Jvb3RzdHJhcCcpXG4gIFxuICAgICAgdmFyIHRyYW5zRW5kRXZlbnROYW1lcyA9IHtcbiAgICAgICAgV2Via2l0VHJhbnNpdGlvbiA6ICd3ZWJraXRUcmFuc2l0aW9uRW5kJyxcbiAgICAgICAgTW96VHJhbnNpdGlvbiAgICA6ICd0cmFuc2l0aW9uZW5kJyxcbiAgICAgICAgT1RyYW5zaXRpb24gICAgICA6ICdvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCcsXG4gICAgICAgIHRyYW5zaXRpb24gICAgICAgOiAndHJhbnNpdGlvbmVuZCdcbiAgICAgIH1cbiAgXG4gICAgICBmb3IgKHZhciBuYW1lIGluIHRyYW5zRW5kRXZlbnROYW1lcykge1xuICAgICAgICBpZiAoZWwuc3R5bGVbbmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiB7IGVuZDogdHJhbnNFbmRFdmVudE5hbWVzW25hbWVdIH1cbiAgICAgICAgfVxuICAgICAgfVxuICBcbiAgICAgIHJldHVybiBmYWxzZSAvLyBleHBsaWNpdCBmb3IgaWU4ICggIC5fLilcbiAgICB9XG4gIFxuICAgIC8vIGh0dHA6Ly9ibG9nLmFsZXhtYWNjYXcuY29tL2Nzcy10cmFuc2l0aW9uc1xuICAgICQuZm4uZW11bGF0ZVRyYW5zaXRpb25FbmQgPSBmdW5jdGlvbiAoZHVyYXRpb24pIHtcbiAgICAgIHZhciBjYWxsZWQgPSBmYWxzZVxuICAgICAgdmFyICRlbCA9IHRoaXNcbiAgICAgICQodGhpcykub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7IGNhbGxlZCA9IHRydWUgfSlcbiAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsgaWYgKCFjYWxsZWQpICQoJGVsKS50cmlnZ2VyKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCkgfVxuICAgICAgc2V0VGltZW91dChjYWxsYmFjaywgZHVyYXRpb24pXG4gICAgICByZXR1cm4gdGhpc1xuICAgIH1cbiAgXG4gICAgJChmdW5jdGlvbiAoKSB7XG4gICAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25FbmQoKVxuICBcbiAgICAgIGlmICghJC5zdXBwb3J0LnRyYW5zaXRpb24pIHJldHVyblxuICBcbiAgICAgICQuZXZlbnQuc3BlY2lhbC5ic1RyYW5zaXRpb25FbmQgPSB7XG4gICAgICAgIGJpbmRUeXBlOiAkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsXG4gICAgICAgIGRlbGVnYXRlVHlwZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLFxuICAgICAgICBoYW5kbGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgaWYgKCQoZS50YXJnZXQpLmlzKHRoaXMpKSByZXR1cm4gZS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICBcbiAgfShqUXVlcnkpO1xuXG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICAkKFwiI25hdi1tb2JpbGVcIikuaHRtbCgkKFwiI25hdi1tYWluXCIpLmh0bWwoKSk7XG4gICAgICAkKFwiI25hdi10cmlnZ2VyIC5uYXZpY29uLWJ1dHRvblwiKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmluZm8oJ0J1cmdlciBjbGlja2VkJyk7XG4gICAgICAgICAgaWYgKCQoXCJuYXYjbmF2LW1vYmlsZSB1bFwiKS5oYXNDbGFzcyhcImV4cGFuZGVkXCIpKSB7XG4gICAgICAgICAgICAgICQoXCJuYXYjbmF2LW1vYmlsZSB1bC5leHBhbmRlZFwiKS5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpLnNsaWRlVXAoMjUwKTtcbiAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJChcIm5hdiNuYXYtbW9iaWxlIHVsXCIpLmFkZENsYXNzKFwiZXhwYW5kZWRcIikuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgIH1cbiAgICAgIH0pO1xuICB9KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBTbGlkZXIgPSAkKCcjc2xpZGVyJykuU3dpcGUoe1xuICAgICAgYXV0bzogMCxcbiAgICAgIGNvbnRpbnVvdXM6IHRydWUsXG4gICAgfSkuZGF0YSgnU3dpcGUnKTtcbiAgICBpZiAoU2xpZGVyKSB7XG4gICAgICAkKCcubmV4dCcpLm9uKCdjbGljaycsIFNsaWRlci5uZXh0KTtcbiAgICAgICQoJy5wcmV2Jykub24oJ2NsaWNrJywgU2xpZGVyLnByZXYpO1xuICAgIH1cbiAgfSk7XG5cbiAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gIFxuICAgICAgJCgnLmJsb2ctbGlzdC1hcmNoaXZlIGxpIHVsJykuaGlkZSgpO1xuICAgICAgJCgnLmFyY2hpdmUtbGlzdCA+IGxpID4gaDInKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5jaGlsZHJlbigndWwnKS5zbGlkZURvd24oMjUwKTtcbiAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnNpYmxpbmdzKCkuY2hpbGRyZW4oJ3VsJykuc2xpZGVVcCgyNTApO1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgIH0pO1xuICB9KTtcblxuICAvLyBQcmV6ZXMgemF3c3plIG5hIHBpZXJ3c3p5bSBtaWVqc2N1IC8vXG4gICQoJyNtYW5hZ2VtZW50X2JvYXJkIGxpI2FkbWluJykuaW5zZXJ0QmVmb3JlKCcjbWFuYWdlbWVudF9ib2FyZCBsaTplcSgwKScpO1xufSk7Il0sImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
