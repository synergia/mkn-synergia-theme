// Zwraca stan animacji. Je≈õli true, to animacja zostanie odpalona
var animationState = (function() {
    var value = true;
    return {
        change: function() {
            value = !value;
        },
        value: function() {
            return value;
        }
    };
})();

(function() {
    'strict use';
    var ajax_url = jQuery('.global').attr('data-ajax-url');
    var membercard;

    $('.link--name').on('click', changePage);
    $('.membercard__close').on('click', changePage);
    $(window).on('popstate', changePage);

    function changePage(event) {
        var prevUrl = window.location.href;

        // Dodaje dane w odpowiednie miejsce
        var addData = function(data) {
            if ($('.memberWrapper').children().length < 1) {
                $('.memberWrapper').append(data);
            } else {
                $('.memberWrapper').children().detach().remove();
                $('.memberWrapper').append(data);
            }
        };

        if (event.type === 'click') {
            event.preventDefault();
            console.log(event.type);

            membercard = $(this).parents('.membercard');
            var id = membercard.attr('data-id');
            var memberUrl = membercard.find('.link--name').attr('href');

            changeUrl(memberUrl);

            request({
                action: 'load_member_page',
                id: id
            }, addData);

            animateMembercard(membercard);

        } else if (event.type === 'popstate') {
            console.log(event.type);

            animateMembercard(membercard);
            changeUrl(prevUrl);
        }
    }

    function animateMembercard(membercard) {
        if (animationState.value()) {
            $('.memberOverlay').addClass('memberOverlay--visible');
                // .one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',
                //     function(e) {
                //
                //     });
            console.log("Changing state:", animationState.value());
        } else {
            $('.memberOverlay').removeClass('memberOverlay--visible');
            console.log("Changing state:", animationState.value());
        }
        animationState.change();
        console.log("State changed to:", animationState.value());

    }

    function changeUrl(url) {
        if (url != window.location) {
            //add the new page to the window.history
            window.history.pushState({
                path: url
            }, '', url);
        }
    }

    function request(requestingData, addData) {
        $.ajax({
            url: ajax_url,
            type: 'POST',
            data: requestingData,
            success: function(data) {
                addData(data);
                console.log('Data loaded');
                bLazy.revalidate();
            },
            error: function(errorThrown) {
                console.log(errorThrown);
            }
        });
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtZW1iZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gWndyYWNhIHN0YW4gYW5pbWFjamkuIEplxZtsaSB0cnVlLCB0byBhbmltYWNqYSB6b3N0YW5pZSBvZHBhbG9uYVxudmFyIGFuaW1hdGlvblN0YXRlID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciB2YWx1ZSA9IHRydWU7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhbHVlID0gIXZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9O1xufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuICAgICdzdHJpY3QgdXNlJztcbiAgICB2YXIgYWpheF91cmwgPSBqUXVlcnkoJy5nbG9iYWwnKS5hdHRyKCdkYXRhLWFqYXgtdXJsJyk7XG4gICAgdmFyIG1lbWJlcmNhcmQ7XG5cbiAgICAkKCcubGluay0tbmFtZScpLm9uKCdjbGljaycsIGNoYW5nZVBhZ2UpO1xuICAgICQoJy5tZW1iZXJjYXJkX19jbG9zZScpLm9uKCdjbGljaycsIGNoYW5nZVBhZ2UpO1xuICAgICQod2luZG93KS5vbigncG9wc3RhdGUnLCBjaGFuZ2VQYWdlKTtcblxuICAgIGZ1bmN0aW9uIGNoYW5nZVBhZ2UoZXZlbnQpIHtcbiAgICAgICAgdmFyIHByZXZVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcblxuICAgICAgICAvLyBEb2RhamUgZGFuZSB3IG9kcG93aWVkbmllIG1pZWpzY2VcbiAgICAgICAgdmFyIGFkZERhdGEgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBpZiAoJCgnLm1lbWJlcldyYXBwZXInKS5jaGlsZHJlbigpLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAkKCcubWVtYmVyV3JhcHBlcicpLmFwcGVuZChkYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnLm1lbWJlcldyYXBwZXInKS5jaGlsZHJlbigpLmRldGFjaCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJy5tZW1iZXJXcmFwcGVyJykuYXBwZW5kKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSAnY2xpY2snKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQudHlwZSk7XG5cbiAgICAgICAgICAgIG1lbWJlcmNhcmQgPSAkKHRoaXMpLnBhcmVudHMoJy5tZW1iZXJjYXJkJyk7XG4gICAgICAgICAgICB2YXIgaWQgPSBtZW1iZXJjYXJkLmF0dHIoJ2RhdGEtaWQnKTtcbiAgICAgICAgICAgIHZhciBtZW1iZXJVcmwgPSBtZW1iZXJjYXJkLmZpbmQoJy5saW5rLS1uYW1lJykuYXR0cignaHJlZicpO1xuXG4gICAgICAgICAgICBjaGFuZ2VVcmwobWVtYmVyVXJsKTtcblxuICAgICAgICAgICAgcmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnbG9hZF9tZW1iZXJfcGFnZScsXG4gICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICB9LCBhZGREYXRhKTtcblxuICAgICAgICAgICAgYW5pbWF0ZU1lbWJlcmNhcmQobWVtYmVyY2FyZCk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAncG9wc3RhdGUnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC50eXBlKTtcblxuICAgICAgICAgICAgYW5pbWF0ZU1lbWJlcmNhcmQobWVtYmVyY2FyZCk7XG4gICAgICAgICAgICBjaGFuZ2VVcmwocHJldlVybCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhbmltYXRlTWVtYmVyY2FyZChtZW1iZXJjYXJkKSB7XG4gICAgICAgIGlmIChhbmltYXRpb25TdGF0ZS52YWx1ZSgpKSB7XG4gICAgICAgICAgICAkKCcubWVtYmVyT3ZlcmxheScpLmFkZENsYXNzKCdtZW1iZXJPdmVybGF5LS12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgLy8gLm9uZSgnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICAgICAgLy8gICAgIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ2hhbmdpbmcgc3RhdGU6XCIsIGFuaW1hdGlvblN0YXRlLnZhbHVlKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLm1lbWJlck92ZXJsYXknKS5yZW1vdmVDbGFzcygnbWVtYmVyT3ZlcmxheS0tdmlzaWJsZScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJDaGFuZ2luZyBzdGF0ZTpcIiwgYW5pbWF0aW9uU3RhdGUudmFsdWUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgYW5pbWF0aW9uU3RhdGUuY2hhbmdlKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RhdGUgY2hhbmdlZCB0bzpcIiwgYW5pbWF0aW9uU3RhdGUudmFsdWUoKSk7XG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGFuZ2VVcmwodXJsKSB7XG4gICAgICAgIGlmICh1cmwgIT0gd2luZG93LmxvY2F0aW9uKSB7XG4gICAgICAgICAgICAvL2FkZCB0aGUgbmV3IHBhZ2UgdG8gdGhlIHdpbmRvdy5oaXN0b3J5XG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe1xuICAgICAgICAgICAgICAgIHBhdGg6IHVybFxuICAgICAgICAgICAgfSwgJycsIHVybCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXF1ZXN0KHJlcXVlc3RpbmdEYXRhLCBhZGREYXRhKSB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IGFqYXhfdXJsLFxuICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YTogcmVxdWVzdGluZ0RhdGEsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgYWRkRGF0YShkYXRhKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YSBsb2FkZWQnKTtcbiAgICAgICAgICAgICAgICBiTGF6eS5yZXZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3JUaHJvd24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KSgpOyJdLCJmaWxlIjoibWVtYmVyLm1pbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
